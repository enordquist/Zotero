typeof JSON!="object"&&(JSON={}),function(){"use strict";function f(e){return e<10?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return typeof t=="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,r,i,s,o=gap,u,a=t[e];a&&typeof a=="object"&&typeof a.toJSON=="function"&&(a=a.toJSON(e)),typeof rep=="function"&&(a=rep.call(t,e,a));switch(typeof a){case"string":return quote(a);case"number":return isFinite(a)?String(a):"null";case"boolean":case"null":return String(a);case"object":if(!a)return"null";gap+=indent,u=[];if(Object.prototype.toString.apply(a)==="[object Array]"){s=a.length;for(n=0;n<s;n+=1)u[n]=str(n,a)||"null";return i=u.length===0?"[]":gap?"[\n"+gap+u.join(",\n"+gap)+"\n"+o+"]":"["+u.join(",")+"]",gap=o,i}if(rep&&typeof rep=="object"){s=rep.length;for(n=0;n<s;n+=1)typeof rep[n]=="string"&&(r=rep[n],i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i))}else for(r in a)Object.prototype.hasOwnProperty.call(a,r)&&(i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i));return i=u.length===0?"{}":gap?"{\n"+gap+u.join(",\n"+gap)+"\n"+o+"}":"{"+u.join(",")+"}",gap=o,i}}typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;typeof JSON.stringify!="function"&&(JSON.stringify=function(e,t,n){var r;gap="",indent="";if(typeof n=="number")for(r=0;r<n;r+=1)indent+=" ";else typeof n=="string"&&(indent=n);rep=t;if(!t||typeof t=="function"||typeof t=="object"&&typeof t.length=="number")return str("",{"":e});throw new Error("JSON.stringify")}),typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){function walk(e,t){var n,r,i=e[t];if(i&&typeof i=="object")for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(r=walk(i,n),r!==undefined?i[n]=r:delete i[n]);return reviver.call(e,t,i)}var j;text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}();function createDragMask(){var e;try{var t='<div id="screenshield" ></div>';e=document.createElement(t)}catch(n){e=document.createElement("div"),e.setAttribute("id","screenshield")}e.style.position="fixed",e.style.top="0px",e.style.left="0px",e.style.width=getWinWidth()-50+"px",e.style.height=getWinHeight()-50+"px",e.style.background="transparent",e.style.display="none",e.style.zIndex=highestZIndex++,document.body.appendChild(e),dragMask=e}function divResize(e,t,n,r){var i=!1,s=document.getElementById(e);s.style.display="block",s.firstChild.style.display="none";var o="+";r!=null&&(o=r),o=="+"?(parseInt(s.style.width)<t&&(s.style.width=parseInt(s.style.width)+4+"px",i=!0),parseInt(s.style.height)<n&&(s.style.height=parseInt(s.style.height)+4+"px",i=!0)):(parseInt(s.style.width)>t&&(s.style.width=parseInt(s.style.width)-4+"px",i=!0),parseInt(s.style.height)>n&&(s.style.height=parseInt(s.style.height)-4+"px",i=!0)),i==1?setTimeout('divResize("'+e+'", '+t+", "+n+', "'+o+'")',1):s.firstChild.style.display="block"}function divMoveAnim(divid,toX,toY,finaldisplaystate,callback){finaldisplaystate==null&&(finaldisplaystate="block");var carryon=!1,div;typeof divid=="string"?div=document.getElementById(divid):div=divid,div.style.display="block",parseInt(div.style.left)<toX?parseInt(div.style.left)+4<toX?(div.style.left=parseInt(div.style.left)+4+"px",carryon=!0):div.style.left=toX+"px":parseInt(div.style.left)>toX&&(parseInt(div.style.left)-4>toX?(div.style.left=parseInt(div.style.left)-4+"px",carryon=!0):div.style.left=toX+"px"),parseInt(div.style.top)<toY?parseInt(div.style.top)+4<toY?(div.style.top=parseInt(div.style.top)+4+"px",carryon=!0):div.style.top=toY+"px":parseInt(div.style.top)>toY&&(parseInt(div.style.top)-4>toY?(div.style.top=parseInt(div.style.top)-4+"px",carryon=!0):div.style.top=toY+"px");if(carryon==1)animating=!0,window.requestAnimationFrame(function(){divMoveAnim(divid,toX,toY,finaldisplaystate,callback)});else{animating=!1,finaldisplaystate!=""&&(div.style.display=finaldisplaystate);try{callback()}catch(err){eval(callback)}}}function divResizeAnim(divid,toW,toH,finaldisplaystate,callback,iW,iH,w,h){finaldisplaystate==null&&(finaldisplaystate="block");var div;typeof divid=="string"?(div=document.getElementById(divid),div.style.display="block",w=parseInt(div.style.width),h=parseInt(div.style.height),w>toW?iW=-2:iW=2,h>toH?iH=-2:iH=2):div=divid,iW>0&&w<toW?(w+=iW,w>=toW&&(w=toW)):iW<0&&w>toW&&(w+=iW,w<=toW&&(w=toW)),iH>0&&h<toH?(h+=iH,h>=toH&&(h=toH)):iH<0&&h>toH&&(h+=iH,h<=toH&&(h=toH)),div.style.width=w+"px",div.style.height=h+"px",w==toW&&h==toH?(animating=!1,finaldisplaystate!=""&&(div.style.display=finaldisplaystate),eval(callback)):(animating=!0,divResizeAnimTimeout=setTimeout(function(){divResizeAnim(divid,toW,toH,finaldisplaystate,callback,iW,iH,w,h)},1))}function createPublPopupDiv(e,t,n,r,i,s,o,u,a){a||(a="");var f="absolute";u!=null&&(f=u);var l=document.createElement("div");l.className=s,l.id=i+"_container",l.style.position=f,l.style.top=e+"px",l.style.left=t+"px",l.style.width=n+"px",l.style.height=r+"px",l.style.display="none",l.style.background="#ffffff",l.innerHTML='<div style="height:24px;" onmouseover="this.style.cursor=\'move\';" id="'+i+'_handle" class="pop_titlebar" ><span class="pop_closebutton" onclick="document.getElementById(\''+i+'_container\').style.display=\'none\';return false;" >&nbsp;</span>&nbsp;&nbsp;&nbsp;<span class="pop_title_label" id="'+i+'_title">'+a+'</span></div><div id="'+i+'" style="height:'+(r-60)+"px;width:"+n+'px;overflow:auto" >'+o+'</div><div id="'+i+'_resize" style="height:30px;cursor:se-resize" ></div>',document.body.appendChild(l);var c=null,h=null;return f!="relative"&&(c=0,h=0),Drag.init(document.getElementById(i+"_handle"),l,c,null,h),DragResize.init(document.getElementById(i+"_resize"),l),l.onDragResizeEnd=function(e,t){var n=document.getElementById(i);n.style.width=e+"px",n.style.height=t-60+"px",n.style.display="block",typeof this.onDragResizeEndCallback=="function"&&this.onDragResizeEndCallback(e,t)},l.onDragResizeStart=function(e,t){document.getElementById(i).style.display="none"},l.move=function(e,t){document.getElementById(i+"_handle").move(parseInt(e),parseInt(t))},l}function findPos(e){var t=curtop=0;if(e.offsetParent)do t+=e.offsetLeft,curtop+=e.offsetTop;while(e=e.offsetParent);return[t,curtop]}function getWinWidth(){var e=0;return self.innerHeight?e=self.innerWidth:document.documentElement&&document.documentElement.clientHeight?e=document.documentElement.clientWidth:document.body&&(e=document.body.clientWidth),e}function getWinHeight(){var e=0;return self.innerHeight?e=self.innerHeight:document.documentElement&&document.documentElement.clientHeight?e=document.documentElement.clientHeight:document.body&&(e=document.body.clientHeight),e}function showMoveCursor(e,t,n){var r=e||window.event;if(r&&t){var i=r.target||r.srcElement;if(i&&i!=t){if(i.nodeName=="SELECT"||i.nodeName=="INPUT"||i.nodeName=="TEXTAREA"||i.nodeName=="select"||i.nodeName=="input"||i.nodeName=="textarea")return;!i.onmouseover&&!i.onmouseup&&!i.onmousedown&&!i.onclick&&!i.onchange&&!i.onChange&&(n?t.style.cursor="move":t.style.cursor="auto")}}}function getScreenScrollXY(){var e=0,t=0;return typeof window.pageYOffset=="number"?(t=window.pageYOffset,e=window.pageXOffset):document.body&&(document.body.scrollLeft||document.body.scrollTop)?(t=document.body.scrollTop,e=document.body.scrollLeft):document.documentElement&&(document.documentElement.scrollLeft||document.documentElement.scrollTop)&&(t=document.documentElement.scrollTop,e=document.documentElement.scrollLeft),[e,t]}var highestZIndex=999,animating=!1,dragMask,Drag={obj:null,init:function(e,t,n,r,i,s,o,u,a,f){e.onmousedown=Drag.start,e.ontouchstart=Drag.start,e.hmode=o?!1:!0,u?e.vmode=u?!1:!0:e.vmode=!0,e.root=t&&t!=null?t:e,e.hmode&&isNaN(parseInt(e.root.style.left))&&(e.root.style.left="0px"),e.vmode&&isNaN(parseInt(e.root.style.top))&&(e.root.style.top="0px"),!e.hmode&&isNaN(parseInt(e.root.style.right))&&(e.root.style.right="0px"),!e.vmode&&isNaN(parseInt(e.root.style.bottom))&&(e.root.style.bottom="0px"),e.minX=typeof n!="undefined"?n:null,e.minY=typeof i!="undefined"?i:null,e.maxX=typeof r!="undefined"?r:null,e.maxY=typeof s!="undefined"?s:null,e.xMapper=a?a:null,e.yMapper=f?f:null,e.root.onDragStart=new Function,e.root.onDragEnd=new Function,e.root.onDrag=new Function,dragMask||createDragMask(),e.mask=dragMask,e.move=Drag.move,e.clickmove=Drag.clickmove,e.root.handle=e},start:function(e){e=Drag.fixE(e);var t=Drag.obj=this,n=e||window.event;if(!n)return;var r=n.target||n.srcElement;if(typeof r!="undefined"&&r!=null&&r!=t){if(r.onmouseup||r.onmousedown||r.onclick)return;if(r.nodeName!="undefined")if(r.nodeName=="SELECT"||r.nodeName=="INPUT"||r.nodeName=="TEXTAREA"||r.nodeName=="select"||r.nodeName=="input"||r.nodeName=="textarea")return}e.type=="touchstart"&&(e.preventDefault?e.preventDefault():e.returnValue=!1,t.touch=!0,t.onmousedown=null),t.mask.style.width=getWinWidth()-50+"px",t.mask.style.height=getWinHeight()-50+"px",t.root.style.zIndex=highestZIndex++;var i=e;t.touch&&(i=e.touches[0]);var s=parseInt(t.vmode?t.root.style.top:t.root.style.bottom),o=parseInt(t.hmode?t.root.style.left:t.root.style.right);return t.root.onDragStart(o,s),t.lastMouseX=i.clientX,t.lastMouseY=i.clientY,t.hmode?(t.minX!=null&&(t.minMouseX=i.clientX-o+t.minX),t.maxX!=null&&(t.maxMouseX=t.minMouseX+t.maxX-t.minX)):(t.minX!=null&&(t.maxMouseX=-t.minX+i.clientX+o),t.maxX!=null&&(t.minMouseX=-t.maxX+i.clientX+o)),t.vmode?(t.minY!=null&&(t.minMouseY=i.clientY-s+t.minY),t.maxY!=null&&(t.maxMouseY=t.minMouseY+t.maxY-t.minY)):(t.minY!=null&&(t.maxMouseY=-t.minY+i.clientY+s),t.maxY!=null&&(t.minMouseY=-t.maxY+i.clientY+s)),t.docmouseup=document.onmouseup,t.docmousemove=document.onmousemove,document.onmousemove=Drag.drag,document.onmouseup=Drag.end,document.ontouchmove=Drag.drag,document.ontouchend=Drag.end,e&&e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,!1},drag:function(e){var t=Drag.obj;t.touch==1&&(e.preventDefault?e.preventDefault():e.returnValue=!1),e=Drag.fixE(e);var n=e;t.touch==1&&(n=e.touches[0]);var r=n.clientY,i=n.clientX,s=parseInt(t.vmode?t.root.style.top:t.root.style.bottom),o=parseInt(t.hmode?t.root.style.left:t.root.style.right),u,a;return t.minX!=null&&(i=t.hmode?Math.max(i,t.minMouseX):Math.min(i,t.maxMouseX)),t.maxX!=null&&(i=t.hmode?Math.min(i,t.maxMouseX):Math.max(i,t.minMouseX)),t.minY!=null&&(r=t.vmode?Math.max(r,t.minMouseY):Math.min(r,t.maxMouseY)),t.maxY!=null&&(r=t.vmode?Math.min(r,t.maxMouseY):Math.max(r,t.minMouseY)),u=o+(i-t.lastMouseX)*(t.hmode?1:-1),a=s+(r-t.lastMouseY)*(t.vmode?1:-1),t.xMapper?u=t.xMapper(s):t.yMapper&&(a=t.yMapper(o)),Drag.obj.root.style[t.hmode?"left":"right"]=u+"px",Drag.obj.root.style[t.vmode?"top":"bottom"]=a+"px",Drag.obj.lastMouseX=i,Drag.obj.lastMouseY=r,Drag.obj.root.onDrag(u,a),!1},move:function(e,t){var n=Drag.obj=this,r=t,i=e;return Drag.obj.root.style[n.hmode?"left":"right"]=i+"px",Drag.obj.root.style[n.vmode?"top":"bottom"]=r+"px",Drag.obj.lastMouseX=i,Drag.obj.lastMouseY=r,!1},clickmove:function(e){e=Drag.fixE(e);var t=Drag.obj=this,n=e.target||e.srcElement;if(n!=null&&n==t)return;var r=e.clientY,i=e.clientX,s=parseInt(t.vmode?t.root.style.top:t.root.style.bottom),o=parseInt(t.hmode?t.root.style.left:t.root.style.right),u=findPos(t);t.lastMouseX=u[0],t.lastMouseY=u[1],Drag.obj.root.onDragStart(o,s),t.hmode?(t.minX!=null&&(t.minMouseX=u[0]-o+t.minX),t.maxX!=null&&(t.maxMouseX=t.minMouseX+t.maxX-t.minX)):(t.minX!=null&&(t.maxMouseX=-t.minX+u[0]+o),t.maxX!=null&&(t.minMouseX=-t.maxX+u[0]+o)),t.vmode?(t.minY!=null&&(t.minMouseY=u[1]-s+t.minY),t.maxY!=null&&(t.maxMouseY=t.minMouseY+t.maxY-t.minY)):(t.minY!=null&&(t.maxMouseY=-t.minY+u[1]+s),t.maxY!=null&&(t.minMouseY=-t.maxY+u[1]+s));var a,f;return t.minX!=null&&(i=t.hmode?Math.max(i,t.minMouseX):Math.min(i,t.maxMouseX)),t.maxX!=null&&(i=t.hmode?Math.min(i,t.maxMouseX):Math.max(i,t.minMouseX)),t.minY!=null&&(r=t.vmode?Math.max(r,t.minMouseY):Math.min(r,t.maxMouseY)),t.maxY!=null&&(r=t.vmode?Math.min(r,t.maxMouseY):Math.max(r,t.minMouseY)),a=o+(i-t.lastMouseX)*(t.hmode?1:-1),f=s+(r-t.lastMouseY)*(t.vmode?1:-1),t.xMapper?a=t.xMapper(s):t.yMapper&&(f=t.yMapper(o)),Drag.obj.root.style[t.hmode?"left":"right"]=a+"px",Drag.obj.root.style[t.vmode?"top":"bottom"]=f+"px",Drag.obj.root.onDragEnd(a,f),Drag.obj=null,!1},end:function(e){e=Drag.fixE(e),document.onmouseup=Drag.obj.docmouseup,document.onmousemove=Drag.obj.docmousemove,document.ontouchmove=null;var t=Drag.obj;t.touch==1&&(e.preventDefault?e.preventDefault():e.returnValue=!1),document.ontouchend=null,Drag.obj.root.onDragEnd(parseInt(Drag.obj.root.style[Drag.obj.hmode?"left":"right"]),parseInt(Drag.obj.root.style[Drag.obj.vmode?"top":"bottom"])),Drag.obj.mask.style.width="0px",Drag.obj.mask.style.height="0px",Drag.obj.mask.style.display="none",Drag.obj=null},fixE:function(e){return typeof e=="undefined"&&(e=window.event),typeof e.layerX=="undefined"&&(e.layerX=e.offsetX),typeof e.layerY=="undefined"&&(e.layerY=e.offsetY),e}},DragResize={obj:null,init:function(e,t,n,r,i,s){e.onmousedown=DragResize.start,e.ontouchstart=DragResize.start,e.root=t&&t!=null?t:e,typeof n!="undefined"&&n==-1&&(e.vmode=!0),typeof i!="undefined"&&i==-1&&(e.hmode=!0),e.minW=typeof n!="undefined"?n:50,e.minH=typeof i!="undefined"?i:50,e.maxW=typeof r!="undefined"?r:null,e.maxH=typeof s!="undefined"?s:null,e.root.onDragResizeStart=new Function,e.root.onDragResizeEnd=new Function,e.root.onDragResize=new Function,dragMask||createDragMask(),e.mask=dragMask},start:function(e){var t=DragResize.obj=this,n=e||window.event;if(!n)return;var r=n.target||n.srcElement;if(typeof r!="undefined"&&r!=null&&r!=t)if(r.onmouseup||r.onmousedown||r.onclick)return;e=DragResize.fixE(e);var t=DragResize.obj=this;e.type=="touchstart"&&(t.touch=!0),t.mask.style.width=getWinWidth()-50+"px",t.mask.style.height=getWinHeight()-50+"px",t.mask.style.display="block",t.mask.style.zIndex=highestZIndex++,t.rLeft=parseInt(t.root.style.width)-parseInt(t.style.left),t.rTop=parseInt(t.root.style.height)-parseInt(t.style.top),t.style.display="none",t.root.style.zIndex=highestZIndex++;var i=parseInt(t.root.style.height),s=parseInt(t.root.style.width);t.root.onDragResizeStart(s,i);var o=e;return t.touch&&(o=e.touches[0]),t.lastMouseX=o.clientX,t.lastMouseY=o.clientY,t.docmouseup=document.onmouseup,t.docmousemove=document.onmousemove,document.onmousemove=DragResize.resize,document.onmouseup=DragResize.end,document.ontouchmove=DragResize.resize,document.ontouchend=DragResize.end,!1},resize:function(e){e=DragResize.fixE(e);var t=DragResize.obj,n=e;t.touch==1&&(e.preventDefault(),n=e.touches[0]);var r=n.clientY,i=n.clientX;r>t.lastMouseY+20;var s=parseInt(t.root.style.height),o=parseInt(t.root.style.width),u,a;return u=o+(i-t.lastMouseX),a=s+(r-t.lastMouseY),u<t.minW&&(u=t.minW),t.maxW!=null&&u>t.maxW&&(u=t.maxW),a<t.minH&&(a=t.minH),t.maxH!=null&&a>t.maxH&&(a=t.maxH),t.vmode?(DragResize.obj.root.style.height=a+"px",DragResize.obj.lastMouseX=i,DragResize.obj.lastMouseY=r):t.hmode?(DragResize.obj.root.style.width=u+"px",DragResize.obj.lastMouseX=i,DragResize.obj.lastMouseY=r):(DragResize.obj.root.style.width=u+"px",DragResize.obj.root.style.height=a+"px",DragResize.obj.lastMouseX=i,DragResize.obj.lastMouseY=r),DragResize.obj.root.onDragResize(u,a),!1},end:function(){document.onmouseup=DragResize.obj.docmouseup,document.onmousemove=DragResize.obj.docmousemove,DragResize.obj.root.onDragResizeEnd(parseInt(DragResize.obj.root.style.width),parseInt(DragResize.obj.root.style.height)),DragResize.obj.style.display="block",DragResize.obj.mask.style.width="0px",DragResize.obj.mask.style.height="0px",DragResize.obj.mask.style.display="none",DragResize.obj=null},fixE:function(e){return typeof e=="undefined"&&(e=window.event),typeof e.layerX=="undefined"&&(e.layerX=e.offsetX),typeof e.layerY=="undefined"&&(e.layerY=e.offsetY),e}},divMoveAnimTimeout,divResizeAnimTimeout;Array.prototype.indexOf||(Array.prototype.indexOf=function(e){var t=this.length,n=Number(arguments[1])||0;n=n<0?Math.ceil(n):Math.floor(n),n<0&&(n+=t);for(;n<t;n++)if(n in this&&this[n]===e)return n;return-1});var bestFit=function(){function globalEval(x){eval.call(null,x)}function abort(e){throw Module.print(e+":\n"+(new Error).stack),ABORT=!0,"Assertion: "+e}function assert(e,t){e||abort("Assertion failed: "+t)}function ccall(e,t,n,r){return ccallFunc(getCFunc(e),t,n,r)}function getCFunc(ident){try{var func=globalScope.Module["_"+ident];func||(func=eval("_"+ident))}catch(e){}return assert(func,"Cannot call unknown function "+ident+" (perhaps LLVM optimizations or closure removed it?)"),func}function ccallFunc(e,t,n,r){function s(e,t){if(t=="string"){if(e===null||e===undefined||e===0)return 0;i||(i=Runtime.stackSave());var n=Runtime.stackAlloc(e.length+1);return writeStringToMemory(e,n),n}if(t=="array"){i||(i=Runtime.stackSave());var n=Runtime.stackAlloc(e.length);return writeArrayToMemory(e,n),n}return e}function o(e,t){return t=="string"?Pointer_stringify(e):(assert(t!="array"),e)}var i=0,u=0,a=r?r.map(function(e){return s(e,n[u++])}):[],f=o(e.apply(null,a),t);return i&&Runtime.stackRestore(i),f}function cwrap(e,t,n){var r=getCFunc(e);return function(){return ccallFunc(r,t,n,Array.prototype.slice.call(arguments))}}function setValue(e,t,n,r){n=n||"i8",n.charAt(n.length-1)==="*"&&(n="i32");switch(n){case"i1":HEAP8[e]=t;break;case"i8":HEAP8[e]=t;break;case"i16":HEAP16[e>>1]=t;break;case"i32":HEAP32[e>>2]=t;break;case"i64":tempI64=[t>>>0,Math.min(Math.floor(t/4294967296),4294967295)>>>0],HEAP32[e>>2]=tempI64[0],HEAP32[e+4>>2]=tempI64[1];break;case"float":HEAPF32[e>>2]=t;break;case"double":HEAPF64[e>>3]=t;break;default:abort("invalid type for setValue: "+n)}}function getValue(e,t,n){t=t||"i8",t.charAt(t.length-1)==="*"&&(t="i32");switch(t){case"i1":return HEAP8[e];case"i8":return HEAP8[e];case"i16":return HEAP16[e>>1];case"i32":return HEAP32[e>>2];case"i64":return HEAP32[e>>2];case"float":return HEAPF32[e>>2];case"double":return HEAPF64[e>>3];default:abort("invalid type for setValue: "+t)}return null}function allocate(e,t,n,r){var i,s;typeof e=="number"?(i=!0,s=e):(i=!1,s=e.length);var o=typeof t=="string"?t:null,u;n==ALLOC_NONE?u=r:u=[_malloc,Runtime.stackAlloc,Runtime.staticAlloc,Runtime.dynamicAlloc][n===undefined?ALLOC_STATIC:n](Math.max(s,o?1:t.length));if(i){var r=u,a;assert((u&3)==0),a=u+(s&-4);for(;r<a;r+=4)HEAP32[r>>2]=0;a=u+s;while(r<a)HEAP8[r++|0]=0;return u}if(o==="i8")return HEAPU8.set(new Uint8Array(e),u),u;var f=0,l,c,h;while(f<s){var p=e[f];typeof p=="function"&&(p=Runtime.getFunctionIndex(p)),l=o||t[f];if(l===0){f++;continue}assert(l,"Must know what type to store in allocate!"),l=="i64"&&(l="i32"),setValue(u+f,p,l),h!==l&&(c=Runtime.getNativeTypeSize(l),h=l),f+=c}return u}function Pointer_stringify(e,t){var n=!1,r,i=0;for(;;){r=HEAPU8[e+i|0];if(r>=128)n=!0;else if(r==0&&!t)break;i++;if(t&&i==t)break}t||(t=i);var s="";if(!n){var o=1024,u;while(t>0)u=String.fromCharCode.apply(String,HEAPU8.subarray(e,e+Math.min(t,o))),s=s?s+u:u,e+=o,t-=o;return s}var a=new Runtime.UTF8Processor;for(i=0;i<t;i++)assert(e+i<TOTAL_MEMORY),r=HEAPU8[e+i|0],s+=a.processCChar(r);return s}function alignMemoryPage(e){return e+4095>>12<<12}function enlargeMemory(){abort("Cannot enlarge memory arrays. Either (1) compile with -s TOTAL_MEMORY=X with X higher than the current value, (2) compile with ALLOW_MEMORY_GROWTH which adjusts the size at runtime but prevents some optimizations, or (3) set Module.TOTAL_MEMORY before the program runs.")}function callRuntimeCallbacks(e){while(e.length>0){var t=e.shift();if(typeof t=="function"){t();continue}var n=t.func;typeof n=="number"?t.arg===undefined?Runtime.dynCall("v",n):Runtime.dynCall("vi",n,[t.arg]):n(t.arg===undefined?null:t.arg)}}function ensureInitRuntime(){if(runtimeInitialized)return;runtimeInitialized=!0,callRuntimeCallbacks(__ATINIT__)}function preMain(){callRuntimeCallbacks(__ATMAIN__)}function exitRuntime(){callRuntimeCallbacks(__ATEXIT__)}function intArrayFromString(e,t,n){var r=(new Runtime.UTF8Processor).processJSString(e);return n&&(r.length=n),t||r.push(0),r}function intArrayToString(e){var t=[];for(var n=0;n<e.length;n++){var r=e[n];r>255&&(assert(!1,"Character code "+r+" ("+String.fromCharCode(r)+")  at offset "+n+" not in 0x00-0xFF."),r&=255),t.push(String.fromCharCode(r))}return t.join("")}function writeStringToMemory(e,t,n){var r=intArrayFromString(e,n),i=0;while(i<r.length){var s=r[i];HEAP8[t+i|0]=s,i+=1}}function writeArrayToMemory(e,t){for(var n=0;n<e.length;n++)HEAP8[t+n|0]=e[n]}function unSign(e,t,n,r){return e>=0?e:t<=32?2*Math.abs(1<<t-1)+e:Math.pow(2,t)+e}function reSign(e,t,n,r){if(e<=0)return e;var i=t<=32?Math.abs(1<<t-1):Math.pow(2,t-1);return e>=i&&(t<=32||e>i)&&(e=-2*i+e),e}function addRunDependency(e){runDependencies++,Module.monitorRunDependencies&&Module.monitorRunDependencies(runDependencies),e?(assert(!runDependencyTracking[e]),runDependencyTracking[e]=1,runDependencyWatcher===null&&typeof setInterval!="undefined"&&(runDependencyWatcher=setInterval(function(){var e=!1;for(var t in runDependencyTracking)e||(e=!0,Module.printErr("still waiting on run dependencies:")),Module.printErr("dependency: "+t);e&&Module.printErr("(end of list)")},6e3))):Module.printErr("warning: run dependency added without ID")}function removeRunDependency(e){runDependencies--,Module.monitorRunDependencies&&Module.monitorRunDependencies(runDependencies),e?(assert(runDependencyTracking[e]),delete runDependencyTracking[e]):Module.printErr("warning: run dependency removed without ID"),runDependencies==0&&(runDependencyWatcher!==null&&(clearInterval(runDependencyWatcher),runDependencyWatcher=null),!calledRun&&shouldRunNow&&run())}function addPreRun(e){Module.preRun?typeof Module["preRun"]=="function"&&(Module.preRun=[Module.preRun]):Module.preRun=[],Module.preRun.push(e)}function loadMemoryInitializer(e){function t(e){HEAPU8.set(e,STATIC_BASE),runPostSets()}addPreRun(function(){ENVIRONMENT_IS_NODE||ENVIRONMENT_IS_SHELL?t(Module.readBinary(e)):Browser.asyncLoad(e,function(e){t(e)},function(t){throw"could not load memory initializer "+e})}),awaitingMemoryInitializer=!1}function runPostSets(){}function copyTempFloat(e){HEAP8[tempDoublePtr]=HEAP8[e],HEAP8[tempDoublePtr+1]=HEAP8[e+1],HEAP8[tempDoublePtr+2]=HEAP8[e+2],HEAP8[tempDoublePtr+3]=HEAP8[e+3]}function copyTempDouble(e){HEAP8[tempDoublePtr]=HEAP8[e],HEAP8[tempDoublePtr+1]=HEAP8[e+1],HEAP8[tempDoublePtr+2]=HEAP8[e+2],HEAP8[tempDoublePtr+3]=HEAP8[e+3],HEAP8[tempDoublePtr+4]=HEAP8[e+4],HEAP8[tempDoublePtr+5]=HEAP8[e+5],HEAP8[tempDoublePtr+6]=HEAP8[e+6],HEAP8[tempDoublePtr+7]=HEAP8[e+7]}function _memcpy(e,t,n){e|=0,t|=0,n|=0;var r=0;r=e|0;if((e&3)==(t&3)){while(e&3){if((n|0)==0)return r|0;HEAP8[e]=HEAP8[t],e=e+1|0,t=t+1|0,n=n-1|0}while((n|0)>=4)HEAP32[e>>2]=HEAP32[t>>2],e=e+4|0,t=t+4|0,n=n-4|0}while((n|0)>0)HEAP8[e]=HEAP8[t],e=e+1|0,t=t+1|0,n=n-1|0;return r|0}function _memset(e,t,n){e|=0,t|=0,n|=0;var r=0,i=0,s=0,o=0;r=e+n|0;if((n|0)>=20){t&=255,o=e&3,i=t|t<<8|t<<16|t<<24,s=r&-4;if(o){o=e+4-o|0;while((e|0)<(o|0))HEAP8[e]=t,e=e+1|0}while((e|0)<(s|0))HEAP32[e>>2]=i,e=e+4|0}while((e|0)<(r|0))HEAP8[e]=t,e=e+1|0}function _strlen(e){e|=0;var t=0;t=e;while(HEAP8[t])t=t+1|0;return t-e|0}function __reallyNegative(e){return e<0||e===0&&1/e===-Infinity}function __formatString(e,t){function i(e){var n;return e==="double"?n=HEAPF64[t+r>>3]:e=="i64"?(n=[HEAP32[t+r>>2],HEAP32[t+(r+8)>>2]],r+=8):(e="i32",n=HEAP32[t+r>>2]),r+=Math.max(Runtime.getNativeFieldSize(e),Runtime.getAlignSize(e,null,!0)),n}var n=e,r=0,s=[],o,u,a;for(;;){var f=n;o=HEAP8[n];if(o===0)break;u=HEAP8[n+1|0];if(o==37){var l=!1,c=!1,h=!1,p=!1;e:for(;;){switch(u){case 43:l=!0;break;case 45:c=!0;break;case 35:h=!0;break;case 48:if(p)break e;p=!0;break;default:break e}n++,u=HEAP8[n+1|0]}var d=0;if(u==42)d=i("i32"),n++,u=HEAP8[n+1|0];else while(u>=48&&u<=57)d=d*10+(u-48),n++,u=HEAP8[n+1|0];var v=!1;if(u==46){var m=0;v=!0,n++,u=HEAP8[n+1|0];if(u==42)m=i("i32"),n++;else for(;;){var g=HEAP8[n+1|0];if(g<48||g>57)break;m=m*10+(g-48),n++}u=HEAP8[n+1|0]}else var m=6;var y;switch(String.fromCharCode(u)){case"h":var b=HEAP8[n+2|0];b==104?(n++,y=1):y=2;break;case"l":var b=HEAP8[n+2|0];b==108?(n++,y=8):y=4;break;case"L":case"q":case"j":y=8;break;case"z":case"t":case"I":y=4;break;default:y=null}y&&n++,u=HEAP8[n+1|0];switch(String.fromCharCode(u)){case"d":case"i":case"u":case"o":case"x":case"X":case"p":var w=u==100||u==105;y=y||4;var a=i("i"+y*8),E=a,S;y==8&&(a=Runtime.makeBigInt(a[0],a[1],u==117));if(y<=4){var x=Math.pow(256,y)-1;a=(w?reSign:unSign)(a&x,y*8)}var T=Math.abs(a),N="";if(u==100||u==105)y==8&&i64Math?S=i64Math.stringify(E[0],E[1],null):S=reSign(a,8*y,1).toString(10);else if(u==117)y==8&&i64Math?S=i64Math.stringify(E[0],E[1],!0):S=unSign(a,8*y,1).toString(10),a=Math.abs(a);else if(u==111)S=(h?"0":"")+T.toString(8);else if(u==120||u==88){N=h&&a!=0?"0x":"";if(y==8&&i64Math)if(E[1]){S=(E[1]>>>0).toString(16);var C=(E[0]>>>0).toString(16);while(C.length<8)C="0"+C;S+=C}else S=(E[0]>>>0).toString(16);else if(a<0){a=-a,S=(T-1).toString(16);var k=[];for(var L=0;L<S.length;L++)k.push((15-parseInt(S[L],16)).toString(16));S=k.join("");while(S.length<y*2)S="f"+S}else S=T.toString(16);u==88&&(N=N.toUpperCase(),S=S.toUpperCase())}else u==112&&(T===0?S="(nil)":(N="0x",S=T.toString(16)));if(v)while(S.length<m)S="0"+S;l&&(a<0?N="-"+N:N="+"+N);while(N.length+S.length<d)c?S+=" ":p?S="0"+S:N=" "+N;S=N+S,S.split("").forEach(function(e){s.push(e.charCodeAt(0))});break;case"f":case"F":case"e":case"E":case"g":case"G":var a=i("double"),S;if(isNaN(a))S="nan",p=!1;else if(!isFinite(a))S=(a<0?"-":"")+"inf",p=!1;else{var A=!1,O=Math.min(m,20);if(u==103||u==71){A=!0,m=m||1;var M=parseInt(a.toExponential(O).split("e")[1],10);m>M&&M>=-4?(u=(u==103?"f":"F").charCodeAt(0),m-=M+1):(u=(u==103?"e":"E").charCodeAt(0),m--),O=Math.min(m,20)}if(u==101||u==69)S=a.toExponential(O),/[eE][-+]\d$/.test(S)&&(S=S.slice(0,-1)+"0"+S.slice(-1));else if(u==102||u==70)S=a.toFixed(O),a===0&&__reallyNegative(a)&&(S="-"+S);var _=S.split("e");if(A&&!h)while(_[0].length>1&&_[0].indexOf(".")!=-1&&(_[0].slice(-1)=="0"||_[0].slice(-1)=="."))_[0]=_[0].slice(0,-1);else{h&&S.indexOf(".")==-1&&(_[0]+=".");while(m>O++)_[0]+="0"}S=_[0]+(_.length>1?"e"+_[1]:""),u==69&&(S=S.toUpperCase()),l&&a>=0&&(S="+"+S)}while(S.length<d)c?S+=" ":!p||S[0]!="-"&&S[0]!="+"?S=(p?"0":" ")+S:S=S[0]+"0"+S.slice(1);u<97&&(S=S.toUpperCase()),S.split("").forEach(function(e){s.push(e.charCodeAt(0))});break;case"s":var D=i("i8*"),P=D?_strlen(D):"(null)".length;v&&(P=Math.min(P,m));if(!c)while(P<d--)s.push(32);if(D)for(var L=0;L<P;L++)s.push(HEAPU8[D++|0]);else s=s.concat(intArrayFromString("(null)".substr(0,P),!0));if(c)while(P<d--)s.push(32);break;case"c":c&&s.push(i("i8"));while(--d>0)s.push(32);c||s.push(i("i8"));break;case"n":var H=i("i32*");HEAP32[H>>2]=s.length;break;case"%":s.push(o);break;default:for(var L=f;L<n+2;L++)s.push(HEAP8[L])}n+=2}else s.push(o),n+=1}return s}function _snprintf(e,t,n,r){var i=__formatString(n,r),s=t===undefined?i.length:Math.min(i.length,Math.max(t-1,0));if(e<0){e=-e;var o=_malloc(s+1);HEAP32[e>>2]=o,e=o}for(var u=0;u<s;u++)HEAP8[e+u|0]=i[u];if(s<t||t===undefined)HEAP8[e+u|0]=0;return i.length}function _sprintf(e,t,n){return _snprintf(e,undefined,t,n)}function _malloc(e){Runtime.warnOnce("using stub malloc (reference it from C to have the real one included)");var t=Runtime.dynamicAlloc(e+8);return t+8&4294967288}function _free(){Runtime.warnOnce("using stub free (reference it from C to have the real one included)")}function __ZN8BEST_FIT11fm_identityEPf(e){var t=0,n;n=e;var r=n,i=r|0;HEAPF32[i>>2]=1;var s=n,o=s+20|0;HEAPF32[o>>2]=1;var u=n,a=u+40|0;HEAPF32[a>>2]=1;var f=n,l=f+60|0;HEAPF32[l>>2]=1;var c=n,h=c+16|0;HEAPF32[h>>2]=0;var p=n,d=p+32|0;HEAPF32[d>>2]=0;var v=n,m=v+48|0;HEAPF32[m>>2]=0;var g=n,y=g+4|0;HEAPF32[y>>2]=0;var b=n,w=b+36|0;HEAPF32[w>>2]=0;var E=n,S=E+52|0;HEAPF32[S>>2]=0;var x=n,T=x+8|0;HEAPF32[T>>2]=0;var N=n,C=N+24|0;HEAPF32[C>>2]=0;var k=n,L=k+56|0;HEAPF32[L>>2]=0;var A=n,O=A+12|0;HEAPF32[O>>2]=0;var M=n,_=M+28|0;HEAPF32[_>>2]=0;var D=n,P=D+44|0;HEAPF32[P>>2]=0;return}function __ZN8BEST_FIT17fm_matrixMultiplyEPKfS1_Pf(e,t,n){var r=0,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S;i=e,s=t,o=n;var x=i,T=x|0,N=HEAPF32[T>>2],C=s,k=C|0,L=HEAPF32[k>>2],A=N*L,O=i,M=O+4|0,_=HEAPF32[M>>2],D=s,P=D+16|0,H=HEAPF32[P>>2],B=_*H,j=A+B,F=i,I=F+8|0,q=HEAPF32[I>>2],R=s,U=R+32|0,z=HEAPF32[U>>2],W=q*z,X=j+W,V=i,$=V+12|0,J=HEAPF32[$>>2],K=s,Q=K+48|0,G=HEAPF32[Q>>2],Y=J*G,Z=X+Y;u=Z;var et=i,tt=et|0,nt=HEAPF32[tt>>2],rt=s,it=rt+4|0,st=HEAPF32[it>>2],ot=nt*st,ut=i,at=ut+4|0,ft=HEAPF32[at>>2],lt=s,ct=lt+20|0,ht=HEAPF32[ct>>2],pt=ft*ht,dt=ot+pt,vt=i,mt=vt+8|0,gt=HEAPF32[mt>>2],yt=s,bt=yt+36|0,wt=HEAPF32[bt>>2],Et=gt*wt,St=dt+Et,xt=i,Tt=xt+12|0,Nt=HEAPF32[Tt>>2],Ct=s,kt=Ct+52|0,Lt=HEAPF32[kt>>2],At=Nt*Lt,Ot=St+At;a=Ot;var Mt=i,_t=Mt|0,Dt=HEAPF32[_t>>2],Pt=s,Ht=Pt+8|0,Bt=HEAPF32[Ht>>2],jt=Dt*Bt,Ft=i,It=Ft+4|0,qt=HEAPF32[It>>2],Rt=s,Ut=Rt+24|0,zt=HEAPF32[Ut>>2],Wt=qt*zt,Xt=jt+Wt,Vt=i,$t=Vt+8|0,Jt=HEAPF32[$t>>2],Kt=s,Qt=Kt+40|0,Gt=HEAPF32[Qt>>2],Yt=Jt*Gt,Zt=Xt+Yt,en=i,tn=en+12|0,nn=HEAPF32[tn>>2],rn=s,sn=rn+56|0,on=HEAPF32[sn>>2],un=nn*on,an=Zt+un;f=an;var fn=i,ln=fn|0,cn=HEAPF32[ln>>2],hn=s,pn=hn+12|0,dn=HEAPF32[pn>>2],vn=cn*dn,mn=i,gn=mn+4|0,yn=HEAPF32[gn>>2],bn=s,wn=bn+28|0,En=HEAPF32[wn>>2],Sn=yn*En,xn=vn+Sn,Tn=i,Nn=Tn+8|0,Cn=HEAPF32[Nn>>2],kn=s,Ln=kn+44|0,An=HEAPF32[Ln>>2],On=Cn*An,Mn=xn+On,_n=i,Dn=_n+12|0,Pn=HEAPF32[Dn>>2],Hn=s,Bn=Hn+60|0,jn=HEAPF32[Bn>>2],Fn=Pn*jn,In=Mn+Fn;l=In;var qn=i,Rn=qn+16|0,Un=HEAPF32[Rn>>2],zn=s,Wn=zn|0,Xn=HEAPF32[Wn>>2],Vn=Un*Xn,$n=i,Jn=$n+20|0,Kn=HEAPF32[Jn>>2],Qn=s,Gn=Qn+16|0,Yn=HEAPF32[Gn>>2],Zn=Kn*Yn,er=Vn+Zn,tr=i,nr=tr+24|0,rr=HEAPF32[nr>>2],ir=s,sr=ir+32|0,or=HEAPF32[sr>>2],ur=rr*or,ar=er+ur,fr=i,lr=fr+28|0,cr=HEAPF32[lr>>2],hr=s,pr=hr+48|0,dr=HEAPF32[pr>>2],vr=cr*dr,mr=ar+vr;c=mr;var gr=i,yr=gr+16|0,br=HEAPF32[yr>>2],wr=s,Er=wr+4|0,Sr=HEAPF32[Er>>2],xr=br*Sr,Tr=i,Nr=Tr+20|0,Cr=HEAPF32[Nr>>2],kr=s,Lr=kr+20|0,Ar=HEAPF32[Lr>>2],Or=Cr*Ar,Mr=xr+Or,_r=i,Dr=_r+24|0,Pr=HEAPF32[Dr>>2],Hr=s,Br=Hr+36|0,jr=HEAPF32[Br>>2],Fr=Pr*jr,Ir=Mr+Fr,qr=i,Rr=qr+28|0,Ur=HEAPF32[Rr>>2],zr=s,Wr=zr+52|0,Xr=HEAPF32[Wr>>2],Vr=Ur*Xr,$r=Ir+Vr;h=$r;var Jr=i,Kr=Jr+16|0,Qr=HEAPF32[Kr>>2],Gr=s,Yr=Gr+8|0,Zr=HEAPF32[Yr>>2],ei=Qr*Zr,ti=i,ni=ti+20|0,ri=HEAPF32[ni>>2],ii=s,si=ii+24|0,oi=HEAPF32[si>>2],ui=ri*oi,ai=ei+ui,fi=i,li=fi+24|0,ci=HEAPF32[li>>2],hi=s,pi=hi+40|0,di=HEAPF32[pi>>2],vi=ci*di,mi=ai+vi,gi=i,yi=gi+28|0,bi=HEAPF32[yi>>2],wi=s,Ei=wi+56|0,Si=HEAPF32[Ei>>2],xi=bi*Si,Ti=mi+xi;p=Ti;var Ni=i,Ci=Ni+16|0,ki=HEAPF32[Ci>>2],Li=s,Ai=Li+12|0,Oi=HEAPF32[Ai>>2],Mi=ki*Oi,_i=i,Di=_i+20|0,Pi=HEAPF32[Di>>2],Hi=s,Bi=Hi+28|0,ji=HEAPF32[Bi>>2],Fi=Pi*ji,Ii=Mi+Fi,qi=i,Ri=qi+24|0,Ui=HEAPF32[Ri>>2],zi=s,Wi=zi+44|0,Xi=HEAPF32[Wi>>2],Vi=Ui*Xi,$i=Ii+Vi,Ji=i,Ki=Ji+28|0,Qi=HEAPF32[Ki>>2],Gi=s,Yi=Gi+60|0,Zi=HEAPF32[Yi>>2],es=Qi*Zi,ts=$i+es;d=ts;var ns=i,rs=ns+32|0,is=HEAPF32[rs>>2],ss=s,os=ss|0,us=HEAPF32[os>>2],as=is*us,fs=i,ls=fs+36|0,cs=HEAPF32[ls>>2],hs=s,ps=hs+16|0,ds=HEAPF32[ps>>2],vs=cs*ds,ms=as+vs,gs=i,ys=gs+40|0,bs=HEAPF32[ys>>2],ws=s,Es=ws+32|0,Ss=HEAPF32[Es>>2],xs=bs*Ss,Ts=ms+xs,Ns=i,Cs=Ns+44|0,ks=HEAPF32[Cs>>2],Ls=s,As=Ls+48|0,Os=HEAPF32[As>>2],Ms=ks*Os,_s=Ts+Ms;v=_s;var Ds=i,Ps=Ds+32|0,Hs=HEAPF32[Ps>>2],Bs=s,js=Bs+4|0,Fs=HEAPF32[js>>2],Is=Hs*Fs,qs=i,Rs=qs+36|0,Us=HEAPF32[Rs>>2],zs=s,Ws=zs+20|0,Xs=HEAPF32[Ws>>2],Vs=Us*Xs,$s=Is+Vs,Js=i,Ks=Js+40|0,Qs=HEAPF32[Ks>>2],Gs=s,Ys=Gs+36|0,Zs=HEAPF32[Ys>>2],eo=Qs*Zs,to=$s+eo,no=i,ro=no+44|0,io=HEAPF32[ro>>2],so=s,oo=so+52|0,uo=HEAPF32[oo>>2],ao=io*uo,fo=to+ao;m=fo;var lo=i,co=lo+32|0,ho=HEAPF32[co>>2],po=s,vo=po+8|0,mo=HEAPF32[vo>>2],go=ho*mo,yo=i,bo=yo+36|0,wo=HEAPF32[bo>>2],Eo=s,So=Eo+24|0,xo=HEAPF32[So>>2],To=wo*xo,No=go+To,Co=i,ko=Co+40|0,Lo=HEAPF32[ko>>2],Ao=s,Oo=Ao+40|0,Mo=HEAPF32[Oo>>2],_o=Lo*Mo,Do=No+_o,Po=i,Ho=Po+44|0,Bo=HEAPF32[Ho>>2],jo=s,Fo=jo+56|0,Io=HEAPF32[Fo>>2],qo=Bo*Io,Ro=Do+qo;g=Ro;var Uo=i,zo=Uo+32|0,Wo=HEAPF32[zo>>2],Xo=s,Vo=Xo+12|0,$o=HEAPF32[Vo>>2],Jo=Wo*$o,Ko=i,Qo=Ko+36|0,Go=HEAPF32[Qo>>2],Yo=s,Zo=Yo+28|0,eu=HEAPF32[Zo>>2],tu=Go*eu,nu=Jo+tu,ru=i,iu=ru+40|0,su=HEAPF32[iu>>2],ou=s,uu=ou+44|0,au=HEAPF32[uu>>2],fu=su*au,lu=nu+fu,cu=i,hu=cu+44|0,pu=HEAPF32[hu>>2],du=s,vu=du+60|0,mu=HEAPF32[vu>>2],gu=pu*mu,yu=lu+gu;y=yu;var bu=i,wu=bu+48|0,Eu=HEAPF32[wu>>2],Su=s,xu=Su|0,Tu=HEAPF32[xu>>2],Nu=Eu*Tu,Cu=i,ku=Cu+52|0,Lu=HEAPF32[ku>>2],Au=s,Ou=Au+16|0,Mu=HEAPF32[Ou>>2],_u=Lu*Mu,Du=Nu+_u,Pu=i,Hu=Pu+56|0,Bu=HEAPF32[Hu>>2],ju=s,Fu=ju+32|0,Iu=HEAPF32[Fu>>2],qu=Bu*Iu,Ru=Du+qu,Uu=i,zu=Uu+60|0,Wu=HEAPF32[zu>>2],Xu=s,Vu=Xu+48|0,$u=HEAPF32[Vu>>2],Ju=Wu*$u,Ku=Ru+Ju;b=Ku;var Qu=i,Gu=Qu+48|0,Yu=HEAPF32[Gu>>2],Zu=s,ea=Zu+4|0,ta=HEAPF32[ea>>2],na=Yu*ta,ra=i,ia=ra+52|0,sa=HEAPF32[ia>>2],oa=s,ua=oa+20|0,aa=HEAPF32[ua>>2],fa=sa*aa,la=na+fa,ca=i,ha=ca+56|0,pa=HEAPF32[ha>>2],da=s,va=da+36|0,ma=HEAPF32[va>>2],ga=pa*ma,ya=la+ga,ba=i,wa=ba+60|0,Ea=HEAPF32[wa>>2],Sa=s,xa=Sa+52|0,Ta=HEAPF32[xa>>2],Na=Ea*Ta,Ca=ya+Na;w=Ca;var ka=i,La=ka+48|0,Aa=HEAPF32[La>>2],Oa=s,Ma=Oa+8|0,_a=HEAPF32[Ma>>2],Da=Aa*_a,Pa=i,Ha=Pa+52|0,Ba=HEAPF32[Ha>>2],ja=s,Fa=ja+24|0,Ia=HEAPF32[Fa>>2],qa=Ba*Ia,Ra=Da+qa,Ua=i,za=Ua+56|0,Wa=HEAPF32[za>>2],Xa=s,Va=Xa+40|0,$a=HEAPF32[Va>>2],Ja=Wa*$a,Ka=Ra+Ja,Qa=i,Ga=Qa+60|0,Ya=HEAPF32[Ga>>2],Za=s,ef=Za+56|0,tf=HEAPF32[ef>>2],nf=Ya*tf,rf=Ka+nf;E=rf;var sf=i,of=sf+48|0,uf=HEAPF32[of>>2],af=s,ff=af+12|0,lf=HEAPF32[ff>>2],cf=uf*lf,hf=i,pf=hf+52|0,df=HEAPF32[pf>>2],vf=s,mf=vf+28|0,gf=HEAPF32[mf>>2],yf=df*gf,bf=cf+yf,wf=i,Ef=wf+56|0,Sf=HEAPF32[Ef>>2],xf=s,Tf=xf+44|0,Nf=HEAPF32[Tf>>2],Cf=Sf*Nf,kf=bf+Cf,Lf=i,Af=Lf+60|0,Of=HEAPF32[Af>>2],Mf=s,_f=Mf+60|0,Df=HEAPF32[_f>>2],Pf=Of*Df,Hf=kf+Pf;S=Hf;var Bf=u,jf=o,Ff=jf|0;HEAPF32[Ff>>2]=Bf;var If=a,qf=o,Rf=qf+4|0;HEAPF32[Rf>>2]=If;var Uf=f,zf=o,Wf=zf+8|0;HEAPF32[Wf>>2]=Uf;var Xf=l,Vf=o,$f=Vf+12|0;HEAPF32[$f>>2]=Xf;var Jf=c,Kf=o,Qf=Kf+16|0;HEAPF32[Qf>>2]=Jf;var Gf=h,Yf=o,Zf=Yf+20|0;HEAPF32[Zf>>2]=Gf;var el=p,tl=o,nl=tl+24|0;HEAPF32[nl>>2]=el;var rl=d,il=o,sl=il+28|0;HEAPF32[sl>>2]=rl;var ol=v,ul=o,al=ul+32|0;HEAPF32[al>>2]=ol;var fl=m,ll=o,cl=ll+36|0;HEAPF32[cl>>2]=fl;var hl=g,pl=o,dl=pl+40|0;HEAPF32[dl>>2]=hl;var vl=y,ml=o,gl=ml+44|0;HEAPF32[gl>>2]=vl;var yl=b,bl=o,wl=bl+48|0;HEAPF32[wl>>2]=yl;var El=w,Sl=o,xl=Sl+52|0;HEAPF32[xl>>2]=El;var Tl=E,Nl=o,Cl=Nl+56|0;HEAPF32[Cl>>2]=Tl;var kl=S,Ll=o,Al=Ll+60|0;HEAPF32[Al>>2]=kl;return}function __ZN8BEST_FIT15fm_matrixToQuatEPKfPf(e,t){var n=0,r=STACKTOP;STACKTOP=STACKTOP+32|0,assert((STACKTOP|0)<(STACK_MAX|0)),n=2;for(;;)switch(n){case 2:var i,s,o,u,a=r,f=r+16,l,c,h,p;i=e,s=t;var d=i,v=d|0,m=HEAPF32[v>>2],g=i,y=g+20|0,b=HEAPF32[y>>2],w=m+b,E=i,S=E+40|0,x=HEAPF32[S>>2],T=w+x;o=T;var N=o,C=N>0;if(C){n=3;break}n=4;break;case 3:var k=o,L=k+1,A=L,O=Math.sqrt(A),M=O;u=M;var _=u,D=_*.5,P=s,H=P+12|0;HEAPF32[H>>2]=D;var B=u,j=.5/B;u=j;var F=i,I=F+24|0,q=HEAPF32[I>>2],R=i,U=R+36|0,z=HEAPF32[U>>2],W=q-z,X=u,V=W*X,$=s,J=$|0;HEAPF32[J>>2]=V;var K=i,Q=K+32|0,G=HEAPF32[Q>>2],Y=i,Z=Y+8|0,et=HEAPF32[Z>>2],tt=G-et,nt=u,rt=tt*nt,it=s,st=it+4|0;HEAPF32[st>>2]=rt;var ot=i,ut=ot+4|0,at=HEAPF32[ut>>2],ft=i,lt=ft+16|0,ct=HEAPF32[lt>>2],ht=at-ct,pt=u,dt=ht*pt,vt=s,mt=vt+8|0;HEAPF32[mt>>2]=dt,n=11;break;case 4:var gt=a;assert(!0),HEAP32[gt>>2]=HEAP32[12],HEAP32[gt+4>>2]=HEAP32[13],HEAP32[gt+8>>2]=HEAP32[14],l=0;var yt=i,bt=yt+20|0,wt=HEAPF32[bt>>2],Et=i,St=Et|0,xt=HEAPF32[St>>2],Tt=wt>xt;if(Tt){n=5;break}n=6;break;case 5:l=1,n=6;break;case 6:var Nt=i,Ct=Nt+40|0,kt=HEAPF32[Ct>>2],Lt=l,At=Lt<<2,Ot=l,Mt=At+Ot|0,_t=i,Dt=_t+(Mt<<2)|0,Pt=HEAPF32[Dt>>2],Ht=kt>Pt;if(Ht){n=7;break}n=8;break;case 7:l=2,n=8;break;case 8:var Bt=l,jt=a+(Bt<<2)|0,Ft=HEAP32[jt>>2];c=Ft;var It=c,qt=a+(It<<2)|0,Rt=HEAP32[qt>>2];h=Rt;var Ut=l,zt=Ut<<2,Wt=l,Xt=zt+Wt|0,Vt=i,$t=Vt+(Xt<<2)|0,Jt=HEAPF32[$t>>2],Kt=c,Qt=Kt<<2,Gt=c,Yt=Qt+Gt|0,Zt=i,en=Zt+(Yt<<2)|0,tn=HEAPF32[en>>2],nn=h,rn=nn<<2,sn=h,on=rn+sn|0,un=i,an=un+(on<<2)|0,fn=HEAPF32[an>>2],ln=tn+fn,cn=Jt-ln,hn=cn+1,pn=hn,dn=Math.sqrt(pn),vn=dn;p=vn;var mn=p,gn=mn*.5,yn=l,bn=f+(yn<<2)|0;HEAPF32[bn>>2]=gn;var wn=p,En=wn!=0;if(En){n=9;break}n=10;break;case 9:var Sn=p,xn=.5/Sn;p=xn,n=10;break;case 10:var Tn=c,Nn=Tn<<2,Cn=h,kn=Nn+Cn|0,Ln=i,An=Ln+(kn<<2)|0,On=HEAPF32[An>>2],Mn=h,_n=Mn<<2,Dn=c,Pn=_n+Dn|0,Hn=i,Bn=Hn+(Pn<<2)|0,jn=HEAPF32[Bn>>2],Fn=On-jn,In=p,qn=Fn*In,Rn=f+12|0;HEAPF32[Rn>>2]=qn;var Un=l,zn=Un<<2,Wn=c,Xn=zn+Wn|0,Vn=i,$n=Vn+(Xn<<2)|0,Jn=HEAPF32[$n>>2],Kn=c,Qn=Kn<<2,Gn=l,Yn=Qn+Gn|0,Zn=i,er=Zn+(Yn<<2)|0,tr=HEAPF32[er>>2],nr=Jn+tr,rr=p,ir=nr*rr,sr=c,or=f+(sr<<2)|0;HEAPF32[or>>2]=ir;var ur=l,ar=ur<<2,fr=h,lr=ar+fr|0,cr=i,hr=cr+(lr<<2)|0,pr=HEAPF32[hr>>2],dr=h,vr=dr<<2,mr=l,gr=vr+mr|0,yr=i,br=yr+(gr<<2)|0,wr=HEAPF32[br>>2],Er=pr+wr,Sr=p,xr=Er*Sr,Tr=h,Nr=f+(Tr<<2)|0;HEAPF32[Nr>>2]=xr;var Cr=f|0,kr=HEAPF32[Cr>>2],Lr=s,Ar=Lr|0;HEAPF32[Ar>>2]=kr;var Or=f+4|0,Mr=HEAPF32[Or>>2],_r=s,Dr=_r+4|0;HEAPF32[Dr>>2]=Mr;var Pr=f+8|0,Hr=HEAPF32[Pr>>2],Br=s,jr=Br+8|0;HEAPF32[jr>>2]=Hr;var Fr=f+12|0,Ir=HEAPF32[Fr>>2],qr=s,Rr=qr+12|0;HEAPF32[Rr>>2]=Ir,n=11;break;case 11:STACKTOP=r;return;default:assert(0,"bad label: "+n)}}function __ZN8BEST_FIT9fm_rotateEPKfS1_Pf(e,t,n){var r=0;r=2;for(;;)switch(r){case 2:var i,s,o,u,a,f;i=e,s=t,o=n;var l=i,c=(l|0)!=0;if(c){r=3;break}r=4;break;case 3:var h=i,p=h|0,d=HEAPF32[p>>2],v=s,m=v|0,g=HEAPF32[m>>2],y=d*g,b=i,w=b+16|0,E=HEAPF32[w>>2],S=s,x=S+4|0,T=HEAPF32[x>>2],N=E*T,C=y+N,k=i,L=k+32|0,A=HEAPF32[L>>2],O=s,M=O+8|0,_=HEAPF32[M>>2],D=A*_,P=C+D;u=P;var H=i,B=H+4|0,j=HEAPF32[B>>2],F=s,I=F|0,q=HEAPF32[I>>2],R=j*q,U=i,z=U+20|0,W=HEAPF32[z>>2],X=s,V=X+4|0,$=HEAPF32[V>>2],J=W*$,K=R+J,Q=i,G=Q+36|0,Y=HEAPF32[G>>2],Z=s,et=Z+8|0,tt=HEAPF32[et>>2],nt=Y*tt,rt=K+nt;a=rt;var it=i,st=it+8|0,ot=HEAPF32[st>>2],ut=s,at=ut|0,ft=HEAPF32[at>>2],lt=ot*ft,ct=i,ht=ct+24|0,pt=HEAPF32[ht>>2],dt=s,vt=dt+4|0,mt=HEAPF32[vt>>2],gt=pt*mt,yt=lt+gt,bt=i,wt=bt+40|0,Et=HEAPF32[wt>>2],St=s,xt=St+8|0,Tt=HEAPF32[xt>>2],Nt=Et*Tt,Ct=yt+Nt;f=Ct;var kt=u,Lt=o,At=Lt|0;HEAPF32[At>>2]=kt;var Ot=a,Mt=o,_t=Mt+4|0;HEAPF32[_t>>2]=Ot;var Dt=f,Pt=o,Ht=Pt+8|0;HEAPF32[Ht>>2]=Dt,r=5;break;case 4:var Bt=s,jt=Bt|0,Ft=HEAPF32[jt>>2],It=o,qt=It|0;HEAPF32[qt>>2]=Ft;var Rt=s,Ut=Rt+4|0,zt=HEAPF32[Ut>>2],Wt=o,Xt=Wt+4|0;HEAPF32[Xt>>2]=zt;var Vt=s,$t=Vt+8|0,Jt=HEAPF32[$t>>2],Kt=o,Qt=Kt+8|0;HEAPF32[Qt>>2]=Jt,r=5;break;case 5:return;default:assert(0,"bad label: "+r)}}function __ZN8BEST_FIT12fm_inverseRTEPKfS1_Pf(e,t,n){var r=0,i,s,o,u,a,f;i=e,s=t,o=n;var l=s,c=l|0,h=HEAPF32[c>>2],p=i,d=p+48|0,v=HEAPF32[d>>2],m=h-v;u=m;var g=s,y=g+4|0,b=HEAPF32[y>>2],w=i,E=w+52|0,S=HEAPF32[E>>2],x=b-S;a=x;var T=s,N=T+8|0,C=HEAPF32[N>>2],k=i,L=k+56|0,A=HEAPF32[L>>2],O=C-A;f=O;var M=i,_=M|0,D=HEAPF32[_>>2],P=u,H=D*P,B=i,j=B+4|0,F=HEAPF32[j>>2],I=a,q=F*I,R=H+q,U=i,z=U+8|0,W=HEAPF32[z>>2],X=f,V=W*X,$=R+V,J=o,K=J|0;HEAPF32[K>>2]=$;var Q=i,G=Q+16|0,Y=HEAPF32[G>>2],Z=u,et=Y*Z,tt=i,nt=tt+20|0,rt=HEAPF32[nt>>2],it=a,st=rt*it,ot=et+st,ut=i,at=ut+24|0,ft=HEAPF32[at>>2],lt=f,ct=ft*lt,ht=ot+ct,pt=o,dt=pt+4|0;HEAPF32[dt>>2]=ht;var vt=i,mt=vt+32|0,gt=HEAPF32[mt>>2],yt=u,bt=gt*yt,wt=i,Et=wt+36|0,St=HEAPF32[Et>>2],xt=a,Tt=St*xt,Nt=bt+Tt,Ct=i,kt=Ct+40|0,Lt=HEAPF32[kt>>2],At=f,Ot=Lt*At,Mt=Nt+Ot,_t=o,Dt=_t+8|0;HEAPF32[Dt>>2]=Mt;return}function __ZN8BEST_FIT17fm_setTranslationEPKfPf(e,t){var n=0,r,i;r=e,i=t;var s=r,o=s|0,u=HEAPF32[o>>2],a=i,f=a+48|0;HEAPF32[f>>2]=u;var l=r,c=l+4|0,h=HEAPF32[c>>2],p=i,d=p+52|0;HEAPF32[d>>2]=h;var v=r,m=v+8|0,g=HEAPF32[m>>2],y=i,b=y+56|0;HEAPF32[b>>2]=g;return}function __ZN8BEST_FIT12fm_transformEPKfS1_Pf(e,t,n){var r=0;r=2;for(;;)switch(r){case 2:var i,s,o,u,a,f;i=e,s=t,o=n;var l=i,c=(l|0)!=0;if(c){r=3;break}r=4;break;case 3:var h=i,p=h|0,d=HEAPF32[p>>2],v=s,m=v|0,g=HEAPF32[m>>2],y=d*g,b=i,w=b+16|0,E=HEAPF32[w>>2],S=s,x=S+4|0,T=HEAPF32[x>>2],N=E*T,C=y+N,k=i,L=k+32|0,A=HEAPF32[L>>2],O=s,M=O+8|0,_=HEAPF32[M>>2],D=A*_,P=C+D,H=i,B=H+48|0,j=HEAPF32[B>>2],F=P+j;u=F;var I=i,q=I+4|0,R=HEAPF32[q>>2],U=s,z=U|0,W=HEAPF32[z>>2],X=R*W,V=i,$=V+20|0,J=HEAPF32[$>>2],K=s,Q=K+4|0,G=HEAPF32[Q>>2],Y=J*G,Z=X+Y,et=i,tt=et+36|0,nt=HEAPF32[tt>>2],rt=s,it=rt+8|0,st=HEAPF32[it>>2],ot=nt*st,ut=Z+ot,at=i,ft=at+52|0,lt=HEAPF32[ft>>2],ct=ut+lt;a=ct;var ht=i,pt=ht+8|0,dt=HEAPF32[pt>>2],vt=s,mt=vt|0,gt=HEAPF32[mt>>2],yt=dt*gt,bt=i,wt=bt+24|0,Et=HEAPF32[wt>>2],St=s,xt=St+4|0,Tt=HEAPF32[xt>>2],Nt=Et*Tt,Ct=yt+Nt,kt=i,Lt=kt+40|0,At=HEAPF32[Lt>>2],Ot=s,Mt=Ot+8|0,_t=HEAPF32[Mt>>2],Dt=At*_t,Pt=Ct+Dt,Ht=i,Bt=Ht+56|0,jt=HEAPF32[Bt>>2],Ft=Pt+jt;f=Ft;var It=u,qt=o,Rt=qt|0;HEAPF32[Rt>>2]=It;var Ut=a,zt=o,Wt=zt+4|0;HEAPF32[Wt>>2]=Ut;var Xt=f,Vt=o,$t=Vt+8|0;HEAPF32[$t>>2]=Xt,r=5;break;case 4:var Jt=s,Kt=Jt|0,Qt=HEAPF32[Kt>>2],Gt=o,Yt=Gt|0;HEAPF32[Yt>>2]=Qt;var Zt=s,en=Zt+4|0,tn=HEAPF32[en>>2],nn=o,rn=nn+4|0;HEAPF32[rn>>2]=tn;var sn=s,on=sn+8|0,un=HEAPF32[on>>2],an=o,fn=an+8|0;HEAPF32[fn>>2]=un,r=5;break;case 5:return;default:assert(0,"bad label: "+r)}}function __ZN8BEST_FIT15fm_quatToMatrixEPKfPf(e,t){var n=0,r,i,s,o,u,a,f,l,c,h,p;r=e,i=t;var d=r,v=d|0,m=HEAPF32[v>>2],g=r,y=g|0,b=HEAPF32[y>>2],w=m*b;s=w;var E=r,S=E+4|0,x=HEAPF32[S>>2],T=r,N=T+4|0,C=HEAPF32[N>>2],k=x*C;o=k;var L=r,A=L+8|0,O=HEAPF32[A>>2],M=r,_=M+8|0,D=HEAPF32[_>>2],P=O*D;u=P;var H=r,B=H|0,j=HEAPF32[B>>2],F=r,I=F+4|0,q=HEAPF32[I>>2],R=j*q;a=R;var U=r,z=U|0,W=HEAPF32[z>>2],X=r,V=X+8|0,$=HEAPF32[V>>2],J=W*$;f=J;var K=r,Q=K+4|0,G=HEAPF32[Q>>2],Y=r,Z=Y+8|0,et=HEAPF32[Z>>2],tt=G*et;l=tt;var nt=r,rt=nt+12|0,it=HEAPF32[rt>>2],st=r,ot=st|0,ut=HEAPF32[ot>>2],at=it*ut;c=at;var ft=r,lt=ft+12|0,ct=HEAPF32[lt>>2],ht=r,pt=ht+4|0,dt=HEAPF32[pt>>2],vt=ct*dt;h=vt;var mt=r,gt=mt+12|0,yt=HEAPF32[gt>>2],bt=r,wt=bt+8|0,Et=HEAPF32[wt>>2],St=yt*Et;p=St;var xt=o,Tt=u,Nt=xt+Tt,Ct=Nt*2,kt=1-Ct,Lt=i,At=Lt|0;HEAPF32[At>>2]=kt;var Ot=a,Mt=p,_t=Ot-Mt,Dt=_t*2,Pt=i,Ht=Pt+16|0;HEAPF32[Ht>>2]=Dt;var Bt=f,jt=h,Ft=Bt+jt,It=Ft*2,qt=i,Rt=qt+32|0;HEAPF32[Rt>>2]=It;var Ut=a,zt=p,Wt=Ut+zt,Xt=Wt*2,Vt=i,$t=Vt+4|0;HEAPF32[$t>>2]=Xt;var Jt=s,Kt=u,Qt=Jt+Kt,Gt=Qt*2,Yt=1-Gt,Zt=i,en=Zt+20|0;HEAPF32[en>>2]=Yt;var tn=l,nn=c,rn=tn-nn,sn=rn*2,on=i,un=on+36|0;HEAPF32[un>>2]=sn;var an=f,fn=h,ln=an-fn,cn=ln*2,hn=i,pn=hn+8|0;HEAPF32[pn>>2]=cn;var dn=l,vn=c,mn=dn+vn,gn=mn*2,yn=i,bn=yn+24|0;HEAPF32[bn>>2]=gn;var wn=s,En=o,Sn=wn+En,xn=Sn*2,Tn=1-xn,Nn=i,Cn=Nn+40|0;HEAPF32[Cn>>2]=Tn;var kn=i,Ln=kn+56|0;HEAPF32[Ln>>2]=0;var An=i,On=An+52|0;HEAPF32[On>>2]=0;var Mn=i,_n=Mn+48|0;HEAPF32[_n>>2]=0;var Dn=i,Pn=Dn+44|0;HEAPF32[Pn>>2]=0;var Hn=i,Bn=Hn+28|0;HEAPF32[Bn>>2]=0;var jn=i,Fn=jn+12|0;HEAPF32[Fn>>2]=0;var In=i,qn=In+60|0;HEAPF32[qn>>2]=1;return}function __ZN8BEST_FIT8fm_crossEPfPKfS2_(e,t,n){var r=0,i,s,o;i=e,s=t,o=n;var u=s,a=u+4|0,f=HEAPF32[a>>2],l=o,c=l+8|0,h=HEAPF32[c>>2],p=f*h,d=s,v=d+8|0,m=HEAPF32[v>>2],g=o,y=g+4|0,b=HEAPF32[y>>2],w=m*b,E=p-w,S=i,x=S|0;HEAPF32[x>>2]=E;var T=s,N=T+8|0,C=HEAPF32[N>>2],k=o,L=k|0,A=HEAPF32[L>>2],O=C*A,M=s,_=M|0,D=HEAPF32[_>>2],P=o,H=P+8|0,B=HEAPF32[H>>2],j=D*B,F=O-j,I=i,q=I+4|0;HEAPF32[q>>2]=F;var R=s,U=R|0,z=HEAPF32[U>>2],W=o,X=W+4|0,V=HEAPF32[X>>2],$=z*V,J=s,K=J+4|0,Q=HEAPF32[K>>2],G=o,Y=G|0,Z=HEAPF32[Y>>2],et=Q*Z,tt=$-et,nt=i,rt=nt+8|0;HEAPF32[rt>>2]=tt;return}function __ZN8BEST_FIT6fm_dotEPKfS1_(e,t){var n=0,r,i;r=e,i=t;var s=r,o=s|0,u=HEAPF32[o>>2],a=i,f=a|0,l=HEAPF32[f>>2],c=u*l,h=r,p=h+4|0,d=HEAPF32[p>>2],v=i,m=v+4|0,g=HEAPF32[m>>2],y=d*g,b=c+y,w=r,E=w+8|0,S=HEAPF32[E>>2],x=i,T=x+8|0,N=HEAPF32[T>>2],C=S*N,k=b+C;return k}function __ZN8BEST_FIT14fm_rotationArcEPKfS1_Pf(e,t,n){var r=0,i=STACKTOP;STACKTOP=STACKTOP+16|0,assert((STACKTOP|0)<(STACK_MAX|0));var s,o,u,a=i,f,l,c;s=e,o=t,u=n;var h=a|0,p=s,d=o;__ZN8BEST_FIT8fm_crossEPfPKfS2_(h,p,d);var v=s,m=o,g=__ZN8BEST_FIT6fm_dotEPKfS1_(v,m);f=g;var y=f,b=y+1,w=b*2,E=w,S=Math.sqrt(E),x=S;l=x;var T=l,N=1/T;c=N;var C=a|0,k=HEAPF32[C>>2],L=c,A=k*L,O=u,M=O|0;HEAPF32[M>>2]=A;var _=a+4|0,D=HEAPF32[_>>2],P=c,H=D*P,B=u,j=B+4|0;HEAPF32[j>>2]=H;var F=a+8|0,I=HEAPF32[F>>2],q=c,R=I*q,U=u,z=U+8|0;HEAPF32[z>>2]=R;var W=l,X=W*.5,V=u,$=V+12|0;HEAPF32[$>>2]=X,STACKTOP=i;return}function __ZN8BEST_FIT16fm_planeToMatrixEPKfPf(e,t){var n=0,r=STACKTOP;STACKTOP=STACKTOP+64|0,assert((STACKTOP|0)<(STACK_MAX|0));var i,s,o=r,u=r+16,a=r+32,f=r+48;i=e,s=t;var l=o;assert(!0),HEAP32[l>>2]=HEAP32[8],HEAP32[l+4>>2]=HEAP32[9],HEAP32[l+8>>2]=HEAP32[10];var c=o|0,h=i,p=u|0;__ZN8BEST_FIT14fm_rotationArcEPKfS1_Pf(c,h,p);var d=u|0,v=s;__ZN8BEST_FIT15fm_quatToMatrixEPKfPf(d,v);var m=a|0;HEAPF32[m>>2]=0;var g=m+4|0,y=i,b=y+12|0,w=HEAPF32[b>>2],E=-w;HEAPF32[g>>2]=E;var S=g+4|0;HEAPF32[S>>2]=0;var x=s,T=a|0,N=f|0;__ZN8BEST_FIT12fm_transformEPKfS1_Pf(x,T,N);var C=f|0,k=s;__ZN8BEST_FIT17fm_setTranslationEPKfPf(C,k),STACKTOP=r;return}function __ZN8BEST_FIT14fm_eulerToQuatEfffPf(e,t,n,r){var i=0,s,o,u,a,f,l,c,h,p,d,v,m,g,y;s=e,o=t,u=n,a=r;var b=s,w=b*.5;s=w;var E=o,S=E*.5;o=S;var x=u,T=x*.5;u=T;var N=s,C=N,k=Math.cos(C),L=k;f=L;var A=o,O=A,M=Math.cos(O),_=M;l=_;var D=u,P=D,H=Math.cos(P),B=H;c=B;var j=s,F=j,I=Math.sin(F),q=I;h=q;var R=o,U=R,z=Math.sin(U),W=z;p=W;var X=u,V=X,$=Math.sin(V),J=$;d=J;var K=l,Q=c,G=K*Q;v=G;var Y=p,Z=d,et=Y*Z;m=et;var tt=p,nt=c,rt=tt*nt;g=rt;var it=l,st=d,ot=it*st;y=ot;var ut=h,at=v,ft=ut*at,lt=f,ct=m,ht=lt*ct,pt=ft-ht,dt=a,vt=dt|0;HEAPF32[vt>>2]=pt;var mt=f,gt=g,yt=mt*gt,bt=h,wt=y,Et=bt*wt,St=yt+Et,xt=a,Tt=xt+4|0;HEAPF32[Tt>>2]=St;var Nt=f,Ct=y,kt=Nt*Ct,Lt=h,At=g,Ot=Lt*At,Mt=kt-Ot,_t=a,Dt=_t+8|0;HEAPF32[Dt>>2]=Mt;var Pt=f,Ht=v,Bt=Pt*Ht,jt=h,Ft=m,It=jt*Ft,qt=Bt+It,Rt=a,Ut=Rt+12|0;HEAPF32[Ut>>2]=qt;return}function __ZN8BEST_FIT19computeBestFitPlaneEjPKfjS1_jPfS2_(e,t,n,r,i,s,o){var u=0,a=STACKTOP;STACKTOP=STACKTOP+176|0,assert((STACKTOP|0)<(STACK_MAX|0)),u=2;for(;;)switch(u){case 2:var f,l,c,h,p,d,v,m,g=a,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F=a+16,I=a+32,q=a+96,R=a+112;f=e,l=t,c=n,h=r,p=i,d=s,v=o,m=0;var U=g;HEAP32[U>>2]=0,HEAP32[U+4>>2]=0,HEAP32[U+8>>2]=0,y=0;var z=l,W=z;b=W;var X=h,V=X;w=V,E=0,u=3;break;case 3:var $=E,J=f,K=$>>>0<J>>>0;if(K){u=4;break}u=8;break;case 4:var Q=b,G=Q;S=G,x=1;var Y=w,Z=(Y|0)!=0;if(Z){u=5;break}u=6;break;case 5:var et=w,tt=et;T=tt;var nt=T,rt=HEAPF32[nt>>2];x=rt;var it=p,st=w,ot=st+it|0;w=ot,u=6;break;case 6:var ut=S,at=ut|0,ft=HEAPF32[at>>2],lt=x,ct=ft*lt,ht=g|0,pt=HEAPF32[ht>>2],dt=pt+ct;HEAPF32[ht>>2]=dt;var vt=S,mt=vt+4|0,gt=HEAPF32[mt>>2],yt=x,bt=gt*yt,wt=g+4|0,Et=HEAPF32[wt>>2],St=Et+bt;HEAPF32[wt>>2]=St;var xt=S,Tt=xt+8|0,Nt=HEAPF32[Tt>>2],Ct=x,kt=Nt*Ct,Lt=g+8|0,At=HEAPF32[Lt>>2],Ot=At+kt;HEAPF32[Lt>>2]=Ot;var Mt=x,_t=y,Dt=_t+Mt;y=Dt;var Pt=c,Ht=b,Bt=Ht+Pt|0;b=Bt,u=7;break;case 7:var jt=E,Ft=jt+1|0;E=Ft,u=3;break;case 8:var It=y,qt=1/It;N=qt;var Rt=N,Ut=g|0,zt=HEAPF32[Ut>>2],Wt=zt*Rt;HEAPF32[Ut>>2]=Wt;var Xt=N,Vt=g+4|0,$t=HEAPF32[Vt>>2],Jt=$t*Xt;HEAPF32[Vt>>2]=Jt;var Kt=N,Qt=g+8|0,Gt=HEAPF32[Qt>>2],Yt=Gt*Kt;HEAPF32[Qt>>2]=Yt,C=0,k=0,L=0,A=0,O=0,M=0;var Zt=l,en=Zt;_=en;var tn=h,nn=tn;D=nn,P=0,u=9;break;case 9:var rn=P,sn=f,on=rn>>>0<sn>>>0;if(on){u=10;break}u=14;break;case 10:var un=_,an=un;H=an,B=1;var fn=D,ln=(fn|0)!=0;if(ln){u=11;break}u=12;break;case 11:var cn=D,hn=cn;j=hn;var pn=j,dn=HEAPF32[pn>>2];B=dn;var vn=p,mn=D,gn=mn+vn|0;D=gn,u=12;break;case 12:var yn=B,bn=H,wn=bn|0,En=HEAPF32[wn>>2],Sn=g|0,xn=HEAPF32[Sn>>2],Tn=En-xn,Nn=yn*Tn,Cn=F|0;HEAPF32[Cn>>2]=Nn;var kn=B,Ln=H,An=Ln+4|0,On=HEAPF32[An>>2],Mn=g+4|0,_n=HEAPF32[Mn>>2],Dn=On-_n,Pn=kn*Dn,Hn=F+4|0;HEAPF32[Hn>>2]=Pn;var Bn=B,jn=H,Fn=jn+8|0,In=HEAPF32[Fn>>2],qn=g+8|0,Rn=HEAPF32[qn>>2],Un=In-Rn,zn=Bn*Un,Wn=F+8|0;HEAPF32[Wn>>2]=zn;var Xn=F|0,Vn=HEAPF32[Xn>>2],$n=F|0,Jn=HEAPF32[$n>>2],Kn=Vn*Jn,Qn=C,Gn=Qn+Kn;C=Gn;var Yn=F|0,Zn=HEAPF32[Yn>>2],er=F+4|0,tr=HEAPF32[er>>2],nr=Zn*tr,rr=k,ir=rr+nr;k=ir;var sr=F|0,or=HEAPF32[sr>>2],ur=F+8|0,ar=HEAPF32[ur>>2],fr=or*ar,lr=L,cr=lr+fr;L=cr;var hr=F+4|0,pr=HEAPF32[hr>>2],dr=F+4|0,vr=HEAPF32[dr>>2],mr=pr*vr,gr=A,yr=gr+mr;A=yr;var br=F+4|0,wr=HEAPF32[br>>2],Er=F+8|0,Sr=HEAPF32[Er>>2],xr=wr*Sr,Tr=O,Nr=Tr+xr;O=Nr;var Cr=F+8|0,kr=HEAPF32[Cr>>2],Lr=F+8|0,Ar=HEAPF32[Lr>>2],Or=kr*Ar,Mr=M,_r=Mr+Or;M=_r;var Dr=c,Pr=_,Hr=Pr+Dr|0;_=Hr,u=13;break;case 13:var Br=P,jr=Br+1|0;P=jr,u=9;break;case 14:var Fr=N,Ir=C,qr=Ir*Fr;C=qr;var Rr=N,Ur=k,zr=Ur*Rr;k=zr;var Wr=N,Xr=L,Vr=Xr*Wr;L=Vr;var $r=N,Jr=A,Kr=Jr*$r;A=Kr;var Qr=N,Gr=O,Yr=Gr*Qr;O=Yr;var Zr=N,ei=M,ti=ei*Zr;M=ti;var ni=C,ri=I|0,ii=ri|0,si=ii|0;HEAPF32[si>>2]=ni;var oi=k,ui=I|0,ai=ui|0,fi=ai+4|0;HEAPF32[fi>>2]=oi;var li=L,ci=I|0,hi=ci|0,pi=hi+8|0;HEAPF32[pi>>2]=li;var di=k,vi=I|0,mi=vi+12|0,gi=mi|0;HEAPF32[gi>>2]=di;var yi=A,bi=I|0,wi=bi+12|0,Ei=wi+4|0;HEAPF32[Ei>>2]=yi;var Si=O,xi=I|0,Ti=xi+12|0,Ni=Ti+8|0;HEAPF32[Ni>>2]=Si;var Ci=L,ki=I|0,Li=ki+24|0,Ai=Li|0;HEAPF32[Ai>>2]=Ci;var Oi=O,Mi=I|0,_i=Mi+24|0,Di=_i+4|0;HEAPF32[Di>>2]=Oi;var Pi=M,Hi=I|0,Bi=Hi+24|0,ji=Bi+8|0;HEAPF32[ji>>2]=Pi,__ZN8BEST_FIT5EigenIfE18DecrSortEigenStuffEv(I);var Fi=I|0,Ii=Fi|0,qi=Ii+8|0,Ri=HEAPF32[qi>>2],Ui=q|0;HEAPF32[Ui>>2]=Ri;var zi=I|0,Wi=zi+12|0,Xi=Wi+8|0,Vi=HEAPF32[Xi>>2],$i=q+4|0;HEAPF32[$i>>2]=Vi;var Ji=I|0,Ki=Ji+24|0,Qi=Ki+8|0,Gi=HEAPF32[Qi>>2],Yi=q+8|0;HEAPF32[Yi>>2]=Gi;var Zi=q|0,es=HEAPF32[Zi>>2],ts=d,ns=ts|0;HEAPF32[ns>>2]=es;var rs=q+4|0,is=HEAPF32[rs>>2],ss=d,os=ss+4|0;HEAPF32[os>>2]=is;var us=q+8|0,as=HEAPF32[us>>2],fs=d,ls=fs+8|0;HEAPF32[ls>>2]=as;var cs=q|0,hs=g|0
,ps=__ZN8BEST_FIT6fm_dotEPKfS1_(cs,hs),ds=-ps,vs=d,ms=vs+12|0;HEAPF32[ms>>2]=ds;var gs=R|0;__ZN8BEST_FIT11fm_identityEPf(gs);var ys=d,bs=R|0;__ZN8BEST_FIT16fm_planeToMatrixEPKfPf(ys,bs);var ws=R|0,Es=v;__ZN8BEST_FIT15fm_matrixToQuatEPKfPf(ws,Es),m=1;var Ss=m,xs=Ss&1;return STACKTOP=a,xs;default:assert(0,"bad label: "+u)}}function __ZN8BEST_FIT5EigenIfE18DecrSortEigenStuffEv(e){var t=0,n;n=e;var r=n;__ZN8BEST_FIT5EigenIfE11TridiagonalEv(r);var i=__ZN8BEST_FIT5EigenIfE11QLAlgorithmEv(r);__ZN8BEST_FIT5EigenIfE14DecreasingSortEv(r),__ZN8BEST_FIT5EigenIfE17GuaranteeRotationEv(r);return}function __ZN8BEST_FIT10computeOBBEjPKfjPfS2_(e,t,n,r,i){var s=0,o=STACKTOP;STACKTOP=STACKTOP+80|0,assert((STACKTOP|0)<(STACK_MAX|0)),s=2;for(;;)switch(s){case 2:var u,a,f,l,c,h,p=o,d=o+16,v,m,g=o+32,y=o+48,b=o+64;u=e,a=t,f=n,l=r,c=i;var w=a,E=w;h=E;var S=p;assert(!0),HEAP32[S>>2]=HEAP32[16],HEAP32[S+4>>2]=HEAP32[17],HEAP32[S+8>>2]=HEAP32[18];var x=d;assert(!0),HEAP32[x>>2]=HEAP32[20],HEAP32[x+4>>2]=HEAP32[21],HEAP32[x+8>>2]=HEAP32[22],v=0,s=3;break;case 3:var T=v,N=u,C=T>>>0<N>>>0;if(C){s=4;break}s=18;break;case 4:var k=h,L=k;m=L;var A=c,O=m,M=g|0;__ZN8BEST_FIT12fm_inverseRTEPKfS1_Pf(A,O,M);var _=g|0,D=HEAPF32[_>>2],P=p|0,H=HEAPF32[P>>2],B=D<H;if(B){s=5;break}s=6;break;case 5:var j=g|0,F=HEAPF32[j>>2],I=p|0;HEAPF32[I>>2]=F,s=6;break;case 6:var q=g+4|0,R=HEAPF32[q>>2],U=p+4|0,z=HEAPF32[U>>2],W=R<z;if(W){s=7;break}s=8;break;case 7:var X=g+4|0,V=HEAPF32[X>>2],$=p+4|0;HEAPF32[$>>2]=V,s=8;break;case 8:var J=g+8|0,K=HEAPF32[J>>2],Q=p+8|0,G=HEAPF32[Q>>2],Y=K<G;if(Y){s=9;break}s=10;break;case 9:var Z=g+8|0,et=HEAPF32[Z>>2],tt=p+8|0;HEAPF32[tt>>2]=et,s=10;break;case 10:var nt=g|0,rt=HEAPF32[nt>>2],it=d|0,st=HEAPF32[it>>2],ot=rt>st;if(ot){s=11;break}s=12;break;case 11:var ut=g|0,at=HEAPF32[ut>>2],ft=d|0;HEAPF32[ft>>2]=at,s=12;break;case 12:var lt=g+4|0,ct=HEAPF32[lt>>2],ht=d+4|0,pt=HEAPF32[ht>>2],dt=ct>pt;if(dt){s=13;break}s=14;break;case 13:var vt=g+4|0,mt=HEAPF32[vt>>2],gt=d+4|0;HEAPF32[gt>>2]=mt,s=14;break;case 14:var yt=g+8|0,bt=HEAPF32[yt>>2],wt=d+8|0,Et=HEAPF32[wt>>2],St=bt>Et;if(St){s=15;break}s=16;break;case 15:var xt=g+8|0,Tt=HEAPF32[xt>>2],Nt=d+8|0;HEAPF32[Nt>>2]=Tt,s=16;break;case 16:var Ct=f,kt=h,Lt=kt+Ct|0;h=Lt,s=17;break;case 17:var At=v,Ot=At+1|0;v=Ot,s=3;break;case 18:var Mt=d|0,_t=HEAPF32[Mt>>2],Dt=p|0,Pt=HEAPF32[Dt>>2],Ht=_t-Pt,Bt=l,jt=Bt|0;HEAPF32[jt>>2]=Ht;var Ft=d+4|0,It=HEAPF32[Ft>>2],qt=p+4|0,Rt=HEAPF32[qt>>2],Ut=It-Rt,zt=l,Wt=zt+4|0;HEAPF32[Wt>>2]=Ut;var Xt=d+8|0,Vt=HEAPF32[Xt>>2],$t=p+8|0,Jt=HEAPF32[$t>>2],Kt=Vt-Jt,Qt=l,Gt=Qt+8|0;HEAPF32[Gt>>2]=Kt;var Yt=l,Zt=Yt|0,en=HEAPF32[Zt>>2],tn=en*.5,nn=p|0,rn=HEAPF32[nn>>2],sn=tn+rn,on=y|0;HEAPF32[on>>2]=sn;var un=l,an=un+4|0,fn=HEAPF32[an>>2],ln=fn*.5,cn=p+4|0,hn=HEAPF32[cn>>2],pn=ln+hn,dn=y+4|0;HEAPF32[dn>>2]=pn;var vn=l,mn=vn+8|0,gn=HEAPF32[mn>>2],yn=gn*.5,bn=p+8|0,wn=HEAPF32[bn>>2],En=yn+wn,Sn=y+8|0;HEAPF32[Sn>>2]=En;var xn=c,Tn=y|0,Nn=b|0;__ZN8BEST_FIT9fm_rotateEPKfS1_Pf(xn,Tn,Nn);var Cn=b|0,kn=HEAPF32[Cn>>2],Ln=c,An=Ln+48|0,On=HEAPF32[An>>2],Mn=On+kn;HEAPF32[An>>2]=Mn;var _n=b+4|0,Dn=HEAPF32[_n>>2],Pn=c,Hn=Pn+52|0,Bn=HEAPF32[Hn>>2],jn=Bn+Dn;HEAPF32[Hn>>2]=jn;var Fn=b+8|0,In=HEAPF32[Fn>>2],qn=c,Rn=qn+56|0,Un=HEAPF32[Rn>>2],zn=Un+In;HEAPF32[Rn>>2]=zn,STACKTOP=o;return;default:assert(0,"bad label: "+s)}}function __ZN8BEST_FIT17computeBestFitOBBEjPKfjPfS2_NS_11FitStrategyE(e,t,n,r,i,s){var o=0,u=STACKTOP;STACKTOP=STACKTOP+288|0,assert((STACKTOP|0)<(STACK_MAX|0)),o=2;for(;;)switch(o){case 2:var a,f,l,c,h,p,d=u,v=u+16,m,g=u+32,y=u+48,b,w,E,S=u+64,x,T,N,C=u+128,k=u+144,L=u+208,A=u+272;a=e,f=t,l=n,c=r,h=i,p=s;var O=h;__ZN8BEST_FIT11fm_identityEPf(O);var M=a,_=f,D=l,P=d|0,H=v|0,B=__ZN8BEST_FIT18computeBestFitAABBEjPKfjPfS2_(M,_,D,P,H),j=v|0,F=HEAPF32[j>>2],I=d|0,q=HEAPF32[I>>2],R=F-q,U=v+4|0,z=HEAPF32[U>>2],W=d+4|0,X=HEAPF32[W>>2],V=z-X,$=R*V,J=v+8|0,K=HEAPF32[J>>2],Q=d+8|0,G=HEAPF32[Q>>2],Y=K-G,Z=$*Y;m=Z;var et=a,tt=f,nt=l,rt=y|0,it=g|0,st=__ZN8BEST_FIT19computeBestFitPlaneEjPKfjS1_jPfS2_(et,tt,nt,0,0,rt,it),ot=y|0,ut=h;__ZN8BEST_FIT16fm_planeToMatrixEPKfPf(ot,ut);var at=a,ft=f,lt=l,ct=c,ht=h;__ZN8BEST_FIT10computeOBBEjPKfjPfS2_(at,ft,lt,ct,ht);var pt=v|0,dt=HEAPF32[pt>>2],vt=d|0,mt=HEAPF32[vt>>2],gt=dt-mt;b=gt;var yt=v+8|0,bt=HEAPF32[yt>>2],wt=d+8|0,Et=HEAPF32[wt>>2],St=bt-Et;w=St;var xt=b,Tt=w,Nt=xt/Tt;E=Nt;var Ct=S,kt=h,Lt=kt;assert(!0),_memcpy(Ct,Lt,64);var At=c,Ot=At|0,Mt=HEAPF32[Ot>>2],_t=c,Dt=_t+4|0,Pt=HEAPF32[Dt>>2],Ht=Mt*Pt,Bt=c,jt=Bt+8|0,Ft=HEAPF32[jt>>2],It=Ht*Ft;x=It,T=5;var qt=p;if((qt|0)==0){o=3;break}if((qt|0)==1){o=4;break}if((qt|0)==2){o=5;break}o=6;break;case 3:T=13,o=6;break;case 4:T=7,o=6;break;case 5:T=3,o=6;break;case 6:N=0,o=7;break;case 7:var Rt=N,Ut=Rt<180;if(Ut){o=8;break}o=12;break;case 8:var zt=N,Wt=zt*.01745329238474369,Xt=N,Vt=Xt*.01745329238474369,$t=C|0;__ZN8BEST_FIT14fm_eulerToQuatEfffPf(Wt,Vt,0,$t);var Jt=C|0,Kt=k|0;__ZN8BEST_FIT15fm_quatToMatrixEPKfPf(Jt,Kt);var Qt=k|0,Gt=S|0,Yt=L|0;__ZN8BEST_FIT17fm_matrixMultiplyEPKfS1_Pf(Qt,Gt,Yt);var Zt=a,en=f,tn=l,nn=A|0,rn=L|0;__ZN8BEST_FIT10computeOBBEjPKfjPfS2_(Zt,en,tn,nn,rn);var sn=A|0,on=HEAPF32[sn>>2],un=A+8|0,an=HEAPF32[un>>2],fn=on/an,ln=E,cn=fn>ln;if(cn){o=9;break}o=10;break;case 9:var hn=A|0,pn=HEAPF32[hn>>2];b=pn;var dn=A+8|0,vn=HEAPF32[dn>>2];w=vn;var mn=A|0,gn=HEAPF32[mn>>2],yn=A+8|0,bn=HEAPF32[yn>>2],wn=gn/bn;E=wn;var En=h,Sn=En,xn=L;assert(!0),_memcpy(Sn,xn,64),o=10;break;case 10:o=11;break;case 11:var Tn=N,Nn=Tn+3;N=Nn,o=7;break;case 12:var Cn=E,kn=v|0,Ln=HEAPF32[kn>>2],An=d|0,On=HEAPF32[An>>2],Mn=Ln-On,_n=v+8|0,Dn=HEAPF32[_n>>2],Pn=d+8|0,Hn=HEAPF32[Pn>>2],Bn=Dn-Hn,jn=Mn/Bn,Fn=Cn<jn;if(Fn){o=13;break}o=14;break;case 13:var In=h;__ZN8BEST_FIT11fm_identityEPf(In);var qn=d|0,Rn=HEAPF32[qn>>2],Un=v|0,zn=HEAPF32[Un>>2],Wn=Rn+zn,Xn=Wn*.5,Vn=h,$n=Vn+48|0;HEAPF32[$n>>2]=Xn;var Jn=d+4|0,Kn=HEAPF32[Jn>>2],Qn=v+4|0,Gn=HEAPF32[Qn>>2],Yn=Kn+Gn,Zn=Yn*.5,er=h,tr=er+52|0;HEAPF32[tr>>2]=Zn;var nr=d+8|0,rr=HEAPF32[nr>>2],ir=v+8|0,sr=HEAPF32[ir>>2],or=rr+sr,ur=or*.5,ar=h,fr=ar+56|0;HEAPF32[fr>>2]=ur;var lr=v|0,cr=HEAPF32[lr>>2],hr=d|0,pr=HEAPF32[hr>>2],dr=cr-pr,vr=c,mr=vr|0;HEAPF32[mr>>2]=dr;var gr=v+4|0,yr=HEAPF32[gr>>2],br=d+4|0,wr=HEAPF32[br>>2],Er=yr-wr,Sr=c,xr=Sr+4|0;HEAPF32[xr>>2]=Er;var Tr=v+8|0,Nr=HEAPF32[Tr>>2],Cr=d+8|0,kr=HEAPF32[Cr>>2],Lr=Nr-kr,Ar=c,Or=Ar+8|0;HEAPF32[Or>>2]=Lr,o=14;break;case 14:STACKTOP=u;return;default:assert(0,"bad label: "+o)}}function __ZN8BEST_FIT18computeBestFitAABBEjPKfjPfS2_(e,t,n,r,i){var s=0;s=2;for(;;)switch(s){case 2:var o,u,a,f,l,c,h,p,d,v,m;o=e,u=t,a=n,f=r,l=i;var g=u,y=g;c=y;var b=u,w=b|0,E=HEAPF32[w>>2],S=f,x=S|0;HEAPF32[x>>2]=E;var T=u,N=T+4|0,C=HEAPF32[N>>2],k=f,L=k+4|0;HEAPF32[L>>2]=C;var A=u,O=A+8|0,M=HEAPF32[O>>2],_=f,D=_+8|0;HEAPF32[D>>2]=M;var P=u,H=P|0,B=HEAPF32[H>>2],j=l,F=j|0;HEAPF32[F>>2]=B;var I=u,q=I+4|0,R=HEAPF32[q>>2],U=l,z=U+4|0;HEAPF32[z>>2]=R;var W=u,X=W+8|0,V=HEAPF32[X>>2],$=l,J=$+8|0;HEAPF32[J>>2]=V,h=1,s=3;break;case 3:var K=h,Q=o,G=K>>>0<Q>>>0;if(G){s=4;break}s=18;break;case 4:var Y=a,Z=c,et=Z+Y|0;c=et;var tt=c,nt=tt;p=nt;var rt=p,it=rt|0,st=HEAPF32[it>>2],ot=f,ut=ot|0,at=HEAPF32[ut>>2],ft=st<at;if(ft){s=5;break}s=6;break;case 5:var lt=p,ct=lt|0,ht=HEAPF32[ct>>2],pt=f,dt=pt|0;HEAPF32[dt>>2]=ht,s=6;break;case 6:var vt=p,mt=vt+4|0,gt=HEAPF32[mt>>2],yt=f,bt=yt+4|0,wt=HEAPF32[bt>>2],Et=gt<wt;if(Et){s=7;break}s=8;break;case 7:var St=p,xt=St+4|0,Tt=HEAPF32[xt>>2],Nt=f,Ct=Nt+4|0;HEAPF32[Ct>>2]=Tt,s=8;break;case 8:var kt=p,Lt=kt+8|0,At=HEAPF32[Lt>>2],Ot=f,Mt=Ot+8|0,_t=HEAPF32[Mt>>2],Dt=At<_t;if(Dt){s=9;break}s=10;break;case 9:var Pt=p,Ht=Pt+8|0,Bt=HEAPF32[Ht>>2],jt=f,Ft=jt+8|0;HEAPF32[Ft>>2]=Bt,s=10;break;case 10:var It=p,qt=It|0,Rt=HEAPF32[qt>>2],Ut=l,zt=Ut|0,Wt=HEAPF32[zt>>2],Xt=Rt>Wt;if(Xt){s=11;break}s=12;break;case 11:var Vt=p,$t=Vt|0,Jt=HEAPF32[$t>>2],Kt=l,Qt=Kt|0;HEAPF32[Qt>>2]=Jt,s=12;break;case 12:var Gt=p,Yt=Gt+4|0,Zt=HEAPF32[Yt>>2],en=l,tn=en+4|0,nn=HEAPF32[tn>>2],rn=Zt>nn;if(rn){s=13;break}s=14;break;case 13:var sn=p,on=sn+4|0,un=HEAPF32[on>>2],an=l,fn=an+4|0;HEAPF32[fn>>2]=un,s=14;break;case 14:var ln=p,cn=ln+8|0,hn=HEAPF32[cn>>2],pn=l,dn=pn+8|0,vn=HEAPF32[dn>>2],mn=hn>vn;if(mn){s=15;break}s=16;break;case 15:var gn=p,yn=gn+8|0,bn=HEAPF32[yn>>2],wn=l,En=wn+8|0;HEAPF32[En>>2]=bn,s=16;break;case 16:s=17;break;case 17:var Sn=h,xn=Sn+1|0;h=xn,s=3;break;case 18:var Tn=l,Nn=Tn|0,Cn=HEAPF32[Nn>>2],kn=f,Ln=kn|0,An=HEAPF32[Ln>>2],On=Cn-An;d=On;var Mn=l,_n=Mn+4|0,Dn=HEAPF32[_n>>2],Pn=f,Hn=Pn+4|0,Bn=HEAPF32[Hn>>2],jn=Dn-Bn;v=jn;var Fn=l,In=Fn+8|0,qn=HEAPF32[In>>2],Rn=f,Un=Rn+8|0,zn=HEAPF32[Un>>2],Wn=qn-zn;m=Wn;var Xn=d,Vn=d,$n=Xn*Vn,Jn=v,Kn=v,Qn=Jn*Kn,Gn=$n+Qn,Yn=m,Zn=m,er=Yn*Zn,tr=Gn+er,nr=tr,rr=Math.sqrt(nr),ir=rr;return ir;default:assert(0,"bad label: "+s)}}function __ZN8BEST_FIT17computeBestFitOBBEjPKfjPfS2_S2_NS_11FitStrategyE(e,t,n,r,i,s,o){var u=0,a=STACKTOP;STACKTOP=STACKTOP+64|0,assert((STACKTOP|0)<(STACK_MAX|0));var f,l,c,h,p,d,v,m=a;f=e,l=t,c=n,h=r,p=i,d=s,v=o;var g=f,y=l,b=c,w=h,E=m|0,S=v;__ZN8BEST_FIT17computeBestFitOBBEjPKfjPfS2_NS_11FitStrategyE(g,y,b,w,E,S);var x=m|0,T=d;__ZN8BEST_FIT15fm_matrixToQuatEPKfPf(x,T),STACKTOP=a;return}function _getBestFitPlane(e,t){var n=0,r=STACKTOP;STACKTOP=STACKTOP+120|0,assert((STACKTOP|0)<(STACK_MAX|0));var i,s,o=r,u=r+16,a=r+32,f=r+40;i=e,s=t;var l=i,c=s,h=u|0,p=o|0;__ZN8BEST_FIT17computeBestFitOBBEjPKfjPfS2_S2_NS_11FitStrategyE(l,c,12,a,h,p,2);var d=f|0,v=o|0,m=HEAPF32[v>>2],g=m,y=o+4|0,b=HEAPF32[y>>2],w=b,E=o+8|0,S=HEAPF32[E>>2],x=S,T=o+12|0,N=HEAPF32[T>>2],C=N,k=_sprintf(d,8,(tempInt=STACKTOP,STACKTOP=STACKTOP+32|0,assert((STACKTOP|0)<(STACK_MAX|0)),HEAPF64[tempInt>>3]=g,HEAPF64[tempInt+8>>3]=w,HEAPF64[tempInt+16>>3]=x,HEAPF64[tempInt+24>>3]=C,tempInt)),L=f|0;return STACKTOP=r,L}function __ZN8BEST_FIT5EigenIfE11TridiagonalEv(e){var t=0;t=2;for(;;)switch(t){case 2:var n,r,i,s,o,u,a,f,l,c;n=e;var h=n,p=h|0,d=p|0,v=d|0,m=HEAPF32[v>>2];r=m;var g=h|0,y=g|0,b=y+4|0,w=HEAPF32[b>>2];i=w;var E=h|0,S=E|0,x=S+8|0,T=HEAPF32[x>>2];s=T;var N=h|0,C=N+12|0,k=C+4|0,L=HEAPF32[k>>2];o=L;var A=h|0,O=A+12|0,M=O+8|0,_=HEAPF32[M>>2];u=_;var D=h|0,P=D+24|0,H=P+8|0,B=HEAPF32[H>>2];a=B;var j=r,F=h+36|0,I=F|0;HEAPF32[I>>2]=j;var q=h+48|0,R=q+8|0;HEAPF32[R>>2]=0;var U=s,z=U!=0;if(z){t=3;break}t=4;break;case 3:var W=i,X=i,V=W*X,$=s,J=s,K=$*J,Q=V+K,G=Q,Y=Math.sqrt(G),Z=Y;f=Z;var et=f,tt=1/et;l=tt;var nt=l,rt=i,it=rt*nt;i=it;var st=l,ot=s,ut=ot*st;s=ut;var at=i,ft=at*2,lt=u,ct=ft*lt,ht=s,pt=a,dt=o,vt=pt-dt,mt=ht*vt,gt=ct+mt;c=gt;var yt=o,bt=s,wt=c,Et=bt*wt,St=yt+Et,xt=h+36|0,Tt=xt+4|0;HEAPF32[Tt>>2]=St;var Nt=a,Ct=s,kt=c,Lt=Ct*kt,At=Nt-Lt,Ot=h+36|0,Mt=Ot+8|0;HEAPF32[Mt>>2]=At;var _t=f,Dt=h+48|0,Pt=Dt|0;HEAPF32[Pt>>2]=_t;var Ht=u,Bt=i,jt=c,Ft=Bt*jt,It=Ht-Ft,qt=h+48|0,Rt=qt+4|0;HEAPF32[Rt>>2]=It;var Ut=h|0,zt=Ut|0,Wt=zt|0;HEAPF32[Wt>>2]=1;var Xt=h|0,Vt=Xt|0,$t=Vt+4|0;HEAPF32[$t>>2]=0;var Jt=h|0,Kt=Jt|0,Qt=Kt+8|0;HEAPF32[Qt>>2]=0;var Gt=h|0,Yt=Gt+12|0,Zt=Yt|0;HEAPF32[Zt>>2]=0;var en=i,tn=h|0,nn=tn+12|0,rn=nn+4|0;HEAPF32[rn>>2]=en;var sn=s,on=h|0,un=on+12|0,an=un+8|0;HEAPF32[an>>2]=sn;var fn=h|0,ln=fn+24|0,cn=ln|0;HEAPF32[cn>>2]=0;var hn=s,pn=h|0,dn=pn+24|0,vn=dn+4|0;HEAPF32[vn>>2]=hn;var mn=i,gn=-mn,yn=h|0,bn=yn+24|0,wn=bn+8|0;HEAPF32[wn>>2]=gn;var En=h+60|0;HEAP8[En]=0,t=5;break;case 4:var Sn=o,xn=h+36|0,Tn=xn+4|0;HEAPF32[Tn>>2]=Sn;var Nn=a,Cn=h+36|0,kn=Cn+8|0;HEAPF32[kn>>2]=Nn;var Ln=i,An=h+48|0,On=An|0;HEAPF32[On>>2]=Ln;var Mn=u,_n=h+48|0,Dn=_n+4|0;HEAPF32[Dn>>2]=Mn;var Pn=h|0,Hn=Pn|0,Bn=Hn|0;HEAPF32[Bn>>2]=1;var jn=h|0,Fn=jn|0,In=Fn+4|0;HEAPF32[In>>2]=0;var qn=h|0,Rn=qn|0,Un=Rn+8|0;HEAPF32[Un>>2]=0;var zn=h|0,Wn=zn+12|0,Xn=Wn|0;HEAPF32[Xn>>2]=0;var Vn=h|0,$n=Vn+12|0,Jn=$n+4|0;HEAPF32[Jn>>2]=1;var Kn=h|0,Qn=Kn+12|0,Gn=Qn+8|0;HEAPF32[Gn>>2]=0;var Yn=h|0,Zn=Yn+24|0,er=Zn|0;HEAPF32[er>>2]=0;var tr=h|0,nr=tr+24|0,rr=nr+4|0;HEAPF32[rr>>2]=0;var ir=h|0,sr=ir+24|0,or=sr+8|0;HEAPF32[or>>2]=1;var ur=h+60|0;HEAP8[ur]=1,t=5;break;case 5:return;default:assert(0,"bad label: "+t)}}function __ZN8BEST_FIT5EigenIfE11QLAlgorithmEv(e){var t=0;t=2;for(;;)switch(t){case 2:var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g;r=e;var y=r;i=32,s=0,t=3;break;case 3:var b=s,w=(b|0)<3;if(w){t=4;break}t=34;break;case 4:o=0,t=5;break;case 5:var E=o,S=(E|0)<32;if(S){t=6;break}t=30;break;case 6:var x=s;u=x,t=7;break;case 7:var T=u,N=(T|0)<=1;if(N){t=8;break}t=12;break;case 8:var C=u,k=y+36|0,L=k+(C<<2)|0,A=HEAPF32[L>>2],O=A,M=Math.abs(O),_=u,D=_+1|0,P=y+36|0,H=P+(D<<2)|0,B=HEAPF32[H>>2],j=B,F=Math.abs(j),I=M+F,q=I;a=q;var R=u,U=y+48|0,z=U+(R<<2)|0,W=HEAPF32[z>>2],X=W,V=Math.abs(X),$=a,J=$,K=V+J,Q=a,G=Q,Y=K==G;if(Y){t=9;break}t=10;break;case 9:t=12;break;case 10:t=11;break;case 11:var Z=u,et=Z+1|0;u=et,t=7;break;case 12:var tt=u,nt=s,rt=(tt|0)==(nt|0);if(rt){t=13;break}t=14;break;case 13:t=30;break;case 14:var it=s,st=it+1|0,ot=y+36|0,ut=ot+(st<<2)|0,at=HEAPF32[ut>>2],ft=s,lt=y+36|0,ct=lt+(ft<<2)|0,ht=HEAPF32[ct>>2],pt=at-ht,dt=s,vt=y+48|0,mt=vt+(dt<<2)|0,gt=HEAPF32[mt>>2],yt=gt*2,bt=pt/yt;f=bt;var wt=f,Et=f,St=wt*Et,xt=St+1,Tt=xt,Nt=Math.sqrt(Tt),Ct=Nt;l=Ct;var kt=f,Lt=kt<0;if(Lt){t=15;break}t=16;break;case 15:var At=u,Ot=y+36|0,Mt=Ot+(At<<2)|0,_t=HEAPF32[Mt>>2],Dt=s,Pt=y+36|0,Ht=Pt+(Dt<<2)|0,Bt=HEAPF32[Ht>>2],jt=_t-Bt,Ft=s,It=y+48|0,qt=It+(Ft<<2)|0,Rt=HEAPF32[qt>>2],Ut=f,zt=l,Wt=Ut-zt,Xt=Rt/Wt,Vt=jt+Xt;f=Vt,t=17;break;case 16:var $t=u,Jt=y+36|0,Kt=Jt+($t<<2)|0,Qt=HEAPF32[Kt>>2],Gt=s,Yt=y+36|0,Zt=Yt+(Gt<<2)|0,en=HEAPF32[Zt>>2],tn=Qt-en,nn=s,rn=y+48|0,sn=rn+(nn<<2)|0,on=HEAPF32[sn>>2],un=f,an=l,fn=un+an,ln=on/fn,cn=tn+ln;f=cn,t=17;break;case 17:c=1,h=1,p=0;var hn=u,pn=hn-1|0;d=pn,t=18;break;case 18:var dn=d,vn=s,mn=(dn|0)>=(vn|0);if(mn){t=19;break}t=28;break;case 19:var gn=c,yn=d,bn=y+48|0,wn=bn+(yn<<2)|0,En=HEAPF32[wn>>2],Sn=gn*En;v=Sn;var xn=h,Tn=d,Nn=y+48|0,Cn=Nn+(Tn<<2)|0,kn=HEAPF32[Cn>>2],Ln=xn*kn;m=Ln;var An=v,On=An,Mn=Math.abs(On),_n=f,Dn=_n,Pn=Math.abs(Dn),Hn=Mn>=Pn;if(Hn){t=20;break}t=21;break;case 20:var Bn=f,jn=v,Fn=Bn/jn;h=Fn;var In=h,qn=h,Rn=In*qn,Un=Rn+1,zn=Un,Wn=Math.sqrt(zn),Xn=Wn;l=Xn;var Vn=v,$n=l,Jn=Vn*$n,Kn=d,Qn=Kn+1|0,Gn=y+48|0,Yn=Gn+(Qn<<2)|0;HEAPF32[Yn>>2]=Jn;var Zn=l,er=1/Zn;c=er;var tr=c,nr=h,rr=nr*tr;h=rr,t=22;break;case 21:var ir=v,sr=f,or=ir/sr;c=or;var ur=c,ar=c,fr=ur*ar,lr=fr+1,cr=lr,hr=Math.sqrt(cr),pr=hr;l=pr;var dr=f,vr=l,mr=dr*vr,gr=d,yr=gr+1|0,br=y+48|0,wr=br+(yr<<2)|0;HEAPF32[wr>>2]=mr;var Er=l,Sr=1/Er;h=Sr;var xr=h,Tr=c,Nr=Tr*xr;c=Nr,t=22;break;case 22:var Cr=d,kr=Cr+1|0,Lr=y+36|0,Ar=Lr+(kr<<2)|0,Or=HEAPF32[Ar>>2],Mr=p,_r=Or-Mr;f=_r;var Dr=d,Pr=y+36|0,Hr=Pr+(Dr<<2)|0,Br=HEAPF32[Hr>>2],jr=f,Fr=Br-jr,Ir=c,qr=Fr*Ir,Rr=m,Ur=Rr*2,zr=h,Wr=Ur*zr,Xr=qr+Wr;l=Xr;var Vr=c,$r=l,Jr=Vr*$r;p=Jr;var Kr=f,Qr=p,Gr=Kr+Qr,Yr=d,Zr=Yr+1|0,ei=y+36|0,ti=ei+(Zr<<2)|0;HEAPF32[ti>>2]=Gr;var ni=h,ri=l,ii=ni*ri,si=m,oi=ii-si;f=oi,g=0,t=23;break;case 23:var ui=g,ai=(ui|0)<3;if(ai){t=24;break}t=26;break;case 24:var fi=d,li=fi+1|0,ci=g,hi=y|0,pi=hi+(ci*12&-1)|0,di=pi+(li<<2)|0,vi=HEAPF32[di>>2];v=vi;var mi=c,gi=d,yi=g,bi=y|0,wi=bi+(yi*12&-1)|0,Ei=wi+(gi<<2)|0,Si=HEAPF32[Ei>>2],xi=mi*Si,Ti=h,Ni=v,Ci=Ti*Ni,ki=xi+Ci,Li=d,Ai=Li+1|0,Oi=g,Mi=y|0,_i=Mi+(Oi*12&-1)|0,Di=_i+(Ai<<2)|0;HEAPF32[Di>>2]=ki;var Pi=h,Hi=d,Bi=g,ji=y|0,Fi=ji+(Bi*12&-1)|0,Ii=Fi+(Hi<<2)|0,qi=HEAPF32[Ii>>2],Ri=Pi*qi,Ui=c,zi=v,Wi=Ui*zi,Xi=Ri-Wi,Vi=d,$i=g,Ji=y|0,Ki=Ji+($i*12&-1)|0,Qi=Ki+(Vi<<2)|0;HEAPF32[Qi>>2]=Xi,t=25;break;case 25:var Gi=g,Yi=Gi+1|0;g=Yi,t=23;break;case 26:t=27;break;case 27:var Zi=d,es=Zi-1|0;d=es,t=18;break;case 28:var ts=p,ns=s,rs=y+36|0,is=rs+(ns<<2)|0,ss=HEAPF32[is>>2],os=ss-ts;HEAPF32[is>>2]=os;var us=f,as=s,fs=y+48|0,ls=fs+(as<<2)|0;HEAPF32[ls>>2]=us;var cs=u,hs=y+48|0,ps=hs+(cs<<2)|0;HEAPF32[ps>>2]=0,t=29;break;case 29:var ds=o,vs=ds+1|0;o=vs,t=5;break;case 30:var ms=o,gs=(ms|0)==32;if(gs){t=31;break}t=32;break;case 31:n=0,t=35;break;case 32:t=33;break;case 33:var ys=s,bs=ys+1|0;s=bs,t=3;break;case 34:n=1,t=35;break;case 35:var ws=n;return ws;default:assert(0,"bad label: "+t)}}function __ZN8BEST_FIT5EigenIfE14DecreasingSortEv(e){var t=0;t=2;for(;;)switch(t){case 2:var n,r,i,s,o,u;n=e;var a=n;r=0,t=3;break;case 3:var f=r,l=(f|0)<=1;if(l){t=4;break}t=18;break;case 4:var c=r;i=c;var h=i,p=a+36|0,d=p+(h<<2)|0,v=HEAPF32[d>>2];s=v;var m=r,g=m+1|0;o=g,t=5;break;case 5:var y=o,b=(y|0)<3;if(b){t=6;break}t=10;break;case 6:var w=o,E=a+36|0,S=E+(w<<2)|0,x=HEAPF32[S>>2],T=s,N=x>T;if(N){t=7;break}t=8;break;case 7:var C=o;i=C;var k=i,L=a+36|0,A=L+(k<<2)|0,O=HEAPF32[A>>2];s=O,t=8;break;case 8:t=9;break;case 9:var M=o,_=M+1|0;o=_,t=5;break;case 10:var D=i,P=r,H=(D|0)!=(P|0);if(H){t=11;break}t=16;break;case 11:var B=r,j=a+36|0,F=j+(B<<2)|0,I=HEAPF32[F>>2],q=i,R=a+36|0,U=R+(q<<2)|0;HEAPF32[U>>2]=I;var z=s,W=r,X=a+36|0,V=X+(W<<2)|0;HEAPF32[V>>2]=z,o=0,t=12;break;case 12:var $=o,J=($|0)<3;if(J){t=13;break}t=15;break;case 13:var K=r,Q=o,G=a|0,Y=G+(Q*12&-1)|0,Z=Y+(K<<2)|0,et=HEAPF32[Z>>2];u=et;var tt=i,nt=o,rt=a|0,it=rt+(nt*12&-1)|0,st=it+(tt<<2)|0,ot=HEAPF32[st>>2],ut=r,at=o,ft=a|0,lt=ft+(at*12&-1)|0,ct=lt+(ut<<2)|0;HEAPF32[ct>>2]=ot;var ht=u,pt=i,dt=o,vt=a|0,mt=vt+(dt*12&-1)|0,gt=mt+(pt<<2)|0;HEAPF32[gt>>2]=ht;var yt=a+60|0,bt=HEAP8[yt],wt=bt&1,Et=wt^1,St=a+60|0,xt=Et&1;HEAP8[St]=xt,t=14;break;case 14:var Tt=o,Nt=Tt+1|0;o=Nt,t=12;break;case 15:t=16;break;case 16:t=17;break;case 17:var Ct=r,kt=Ct+1|0;r=kt,t=3;break;case 18:return;default:assert(0,"bad label: "+t)}}function __ZN8BEST_FIT5EigenIfE17GuaranteeRotationEv(e){var t=0;t=2;for(;;)switch(t){case 2:var n,r;n=e;var i=n,s=i+60|0,o=HEAP8[s],u=o&1;if(u){t=8;break}t=3;break;case 3:r=0,t=4;break;case 4:var a=r,f=(a|0)<3;if(f){t=5;break}t=7;break;case 5:var l=r,c=i|0,h=c+(l*12&-1)|0,p=h|0,d=HEAPF32[p>>2],v=-d,m=r,g=i|0,y=g+(m*12&-1)|0,b=y|0;HEAPF32[b>>2]=v,t=6;break;case 6:var w=r,E=w+1|0;r=E,t=4;break;case 7:t=8;break;case 8:return;default:assert(0,"bad label: "+t)}}function run(e){function r(){ensureInitRuntime(),preMain();var t=0;calledRun=!0,Module._main&&shouldRunNow&&(t=Module.callMain(e),Module.noExitRuntime||exitRuntime());if(Module.postRun){typeof Module["postRun"]=="function"&&(Module.postRun=[Module.postRun]);while(Module.postRun.length>0)Module.postRun.pop()()}return t}e=e||Module.arguments;if(runDependencies>0)return Module.printErr("run() called, but dependencies remain, so not running"),0;if(Module.preRun){typeof Module["preRun"]=="function"&&(Module.preRun=[Module.preRun]);var t=Module.preRun;Module.preRun=[];for(var n=t.length-1;n>=0;n--)t[n]();if(runDependencies>0)return 0}return Module.setStatus?(Module.setStatus("Running..."),setTimeout(function(){setTimeout(function(){Module.setStatus("")},1),r()},1),0):r()}try{this.Module=Module}catch(e){this.Module=Module={}}var ENVIRONMENT_IS_NODE=typeof process=="object"&&typeof require=="function",ENVIRONMENT_IS_WEB=typeof window=="object",ENVIRONMENT_IS_WORKER=typeof importScripts=="function",ENVIRONMENT_IS_SHELL=!ENVIRONMENT_IS_WEB&&!ENVIRONMENT_IS_NODE&&!ENVIRONMENT_IS_WORKER;if(ENVIRONMENT_IS_NODE){Module.print=function(e){process.stdout.write(e+"\n")},Module.printErr=function(e){process.stderr.write(e+"\n")};var nodeFS=require("fs"),nodePath=require("path");Module.read=function(e,t){e=nodePath.normalize(e);var n=nodeFS.readFileSync(e);return!n&&e!=nodePath["resolve"](e)&&(e=path.join(__dirname,"..","src",e),n=nodeFS.readFileSync(e)),n&&!t&&(n=n.toString()),n},Module.readBinary=function(e){return Module.read(e,!0)},Module.load=function(e){globalEval(read(e))},Module.arguments||(Module.arguments=process.argv.slice(2))}ENVIRONMENT_IS_SHELL&&(Module.print=print,typeof printErr!="undefined"&&(Module.printErr=printErr),Module.read=read,Module.readBinary=function(e){return read(e,"binary")},Module.arguments||(typeof scriptArgs!="undefined"?Module.arguments=scriptArgs:typeof arguments!="undefined"&&(Module.arguments=arguments))),ENVIRONMENT_IS_WEB&&!ENVIRONMENT_IS_WORKER&&(Module.print||(Module.print=function(e){console.log(e)}),Module.printErr||(Module.printErr=function(e){console.log(e)}));if(ENVIRONMENT_IS_WEB||ENVIRONMENT_IS_WORKER)Module.read=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},Module.arguments||typeof arguments!="undefined"&&(Module.arguments=arguments);if(ENVIRONMENT_IS_WORKER){var TRY_USE_DUMP=!1;Module.print||(Module.print=TRY_USE_DUMP&&typeof dump!="undefined"?function(e){dump(e)}:function(e){}),Module.load=importScripts}if(!ENVIRONMENT_IS_WORKER&&!ENVIRONMENT_IS_WEB&&!ENVIRONMENT_IS_NODE&&!ENVIRONMENT_IS_SHELL)throw"Unknown runtime environment. Where are we?";!Module["load"]=="undefined"&&Module.read&&(Module.load=function(e){globalEval(Module.read(e))}),Module.print||(Module.print=function(){}),Module.printErr||(Module.printErr=Module.print),Module.arguments||(Module.arguments=[]),Module.print=Module.print,Module.printErr=Module.printErr,Module.preRun||(Module.preRun=[]),Module.postRun||(Module.postRun=[]);var Runtime={stackSave:function(){return STACKTOP},stackRestore:function(e){STACKTOP=e},forceAlign:function(e,t){t=t||4;if(t==1)return e;if(isNumber(e)&&isNumber(t))return Math.ceil(e/t)*t;if(isNumber(t)&&isPowerOfTwo(t)){var n=log2(t);return"(((("+e+")+"+(t-1)+")>>"+n+")<<"+n+")"}return"Math.ceil(("+e+")/"+t+")*"+t},isNumberType:function(e){return e in Runtime.INT_TYPES||e in Runtime.FLOAT_TYPES},isPointerType:function(t){return t[t.length-1]=="*"},isStructType:function(t){return isPointerType(t)?!1:/^\[\d+\ x\ (.*)\]/.test(t)?!0:/<?{ ?[^}]* ?}>?/.test(t)?!0:t[0]=="%"},INT_TYPES:{i1:0,i8:0,i16:0,i32:0,i64:0},FLOAT_TYPES:{"float":0,"double":0},or64:function(e,t){var n=e|0|(t|0),r=(Math.round(e/4294967296)|Math.round(t/4294967296))*4294967296;return n+r},and64:function(e,t){var n=(e|0)&(t|0),r=(Math.round(e/4294967296)&Math.round(t/4294967296))*4294967296;return n+r},xor64:function(e,t){var n=(e|0)^(t|0),r=(Math.round(e/4294967296)^Math.round(t/4294967296))*4294967296;return n+r},getNativeTypeSize:function(e,t){if(Runtime.QUANTUM_SIZE==1)return 1;var n={"%i1":1,"%i8":1,"%i16":2,"%i32":4,"%i64":8,"%float":4,"%double":8}["%"+e];if(!n)if(e.charAt(e.length-1)=="*")n=Runtime.QUANTUM_SIZE;else if(e[0]=="i"){var r=parseInt(e.substr(1));assert(r%8==0),n=r/8}return n},getNativeFieldSize:function(e){return Math.max(Runtime.getNativeTypeSize(e),Runtime.QUANTUM_SIZE)},dedup:function(t,n){var r={};return n?t.filter(function(e){return r[e[n]]?!1:(r[e[n]]=!0,!0)}):t.filter(function(e){return r[e]?!1:(r[e]=!0,!0)})},set:function(){var t=typeof arguments[0]=="object"?arguments[0]:arguments,n={};for(var r=0;r<t.length;r++)n[t[r]]=0;return n},STACK_ALIGN:8,getAlignSize:function(e,t,n){return e=="i64"||e=="double"||n?8:e?Math.min(t||(e?Runtime.getNativeFieldSize(e):0),Runtime.QUANTUM_SIZE):Math.min(t,8)},calculateStructAlignment:function(t){t.flatSize=0,t.alignSize=0;var n=[],r=-1;return t.flatIndexes=t.fields.map(function(e){var i,s;if(Runtime.isNumberType(e)||Runtime.isPointerType(e))i=Runtime.getNativeTypeSize(e),s=Runtime.getAlignSize(e,i);else if(Runtime.isStructType(e))i=Types.types[e].flatSize,s=Runtime.getAlignSize(null,Types.types[e].alignSize);else{if(e[0]!="b")throw"Unclear type in struct: "+e+", in "+t.name_+" :: "+dump(Types.types[t.name_]);i=e.substr(1)|0,s=1}t.packed&&(s=1),t.alignSize=Math.max(t.alignSize,s);var o=Runtime.alignMemory(t.flatSize,s);return t.flatSize=o+i,r>=0&&n.push(o-r),r=o,o}),t.flatSize=Runtime.alignMemory(t.flatSize,t.alignSize),n.length==0?t.flatFactor=t.flatSize:Runtime.dedup(n).length==1&&(t.flatFactor=n[0]),t.needsFlattening=t.flatFactor!=1,t.flatIndexes},generateStructInfo:function(e,t,n){var r,i;if(t){n=n||0,r=(typeof Types=="undefined"?Runtime.typeInfo:Types.types)[t];if(!r)return null;if(r.fields.length!=e.length)return printErr("Number of named fields must match the type for "+t+": possibly duplicate struct names. Cannot return structInfo"),null;i=r.flatIndexes}else{var r={fields:e.map(function(e){return e[0]})};i=Runtime.calculateStructAlignment(r)}var s={__size__:r.flatSize};return t?e.forEach(function(e,t){if(typeof e=="string")s[e]=i[t]+n;else{var o;for(var u in e)o=u;s[o]=Runtime.generateStructInfo(e[o],r.fields[t],i[t])}}):e.forEach(function(e,t){s[e[1]]=i[t]}),s},dynCall:function(e,t,n){return n&&n.length?(assert(n.length==e.length-1),FUNCTION_TABLE[t].apply(null,n)):(assert(e.length==1),FUNCTION_TABLE[t]())},addFunction:function(e){var t=FUNCTION_TABLE,n=t.length;return t.push(e),t.push(0),n},removeFunction:function(e){var t=FUNCTION_TABLE;t[e]=null},warnOnce:function(e){Runtime.warnOnce.shown||(Runtime.warnOnce.shown={}),Runtime.warnOnce.shown[e]||(Runtime.warnOnce.shown[e]=1,Module.printErr(e))},funcWrappers:{},getFuncWrapper:function(e,t){return assert(t),Runtime.funcWrappers[e]||(Runtime.funcWrappers[e]=function(){return Runtime.dynCall(t,e,arguments)}),Runtime.funcWrappers[e]},UTF8Processor:function(){var e=[],t=0;this.processCChar=function(n){n&=255,t&&(e.push(n),t--);if(e.length==0)return n<128?String.fromCharCode(n):(e.push(n),n>191&&n<224?t=1:t=2,"");if(t>0)return"";var r=e[0],i=e[1],s=e[2],o;return r>191&&r<224?o=String.fromCharCode((r&31)<<6|i&63):o=String.fromCharCode((r&15)<<12|(i&63)<<6|s&63),e.length=0,o},this.processJSString=function(e){e=unescape(encodeURIComponent(e));var t=[];for(var n=0;n<e.length;n++)t.push(e.charCodeAt(n));return t}},stackAlloc:function(e){var t=STACKTOP;return STACKTOP=STACKTOP+e|0,STACKTOP=STACKTOP+7>>3<<3,assert((STACKTOP|0)<(STACK_MAX|0)),t},staticAlloc:function(e){var t=STATICTOP;return STATICTOP=STATICTOP+(assert(!staticSealed),e)|0,STATICTOP=STATICTOP+7>>3<<3,t},dynamicAlloc:function(e){var t=DYNAMICTOP;return DYNAMICTOP=DYNAMICTOP+(assert(DYNAMICTOP>0),e)|0,DYNAMICTOP=DYNAMICTOP+7>>3<<3,DYNAMICTOP>=TOTAL_MEMORY&&enlargeMemory(),t},alignMemory:function(e,t){var n=e=Math.ceil(e/(t?t:8))*(t?t:8);return n},makeBigInt:function(e,t,n){var r=n?(e>>>0)+(t>>>0)*4294967296:(e>>>0)+(t|0)*4294967296;return r},GLOBAL_BASE:8,QUANTUM_SIZE:4,__dummy__:0},__THREW__=0,setjmpId=1,setjmpLabels={},ABORT=!1,undef=0,tempValue,tempInt,tempBigInt,tempInt2,tempBigInt2,tempPair,tempBigIntI,tempBigIntR,tempBigIntS,tempBigIntP,tempBigIntD,tempI64,tempI64b,tempRet0,tempRet1,tempRet2,tempRet3,tempRet4,tempRet5,tempRet6,tempRet7,tempRet8,tempRet9,globalScope=this;Module.ccall=ccall,Module.cwrap=cwrap,Module.setValue=setValue,Module.getValue=getValue;var ALLOC_NORMAL=0,ALLOC_STACK=1,ALLOC_STATIC=2,ALLOC_DYNAMIC=3,ALLOC_NONE=4;Module.ALLOC_NORMAL=ALLOC_NORMAL,Module.ALLOC_STACK=ALLOC_STACK,Module.ALLOC_STATIC=ALLOC_STATIC,Module.ALLOC_DYNAMIC=ALLOC_DYNAMIC,Module.ALLOC_NONE=ALLOC_NONE,Module.allocate=allocate,Module.Pointer_stringify=Pointer_stringify;var PAGE_SIZE=4096,HEAP,HEAP8,HEAPU8,HEAP16,HEAPU16,HEAP32,HEAPU32,HEAPF32,HEAPF64,STATIC_BASE=0,STATICTOP=0,staticSealed=!1,STACK_BASE=0,STACKTOP=0,STACK_MAX=0,DYNAMIC_BASE=0,DYNAMICTOP=0,TOTAL_STACK=Module.TOTAL_STACK||5242880,TOTAL_MEMORY=Module.TOTAL_MEMORY||16777216,FAST_MEMORY=Module.FAST_MEMORY||2097152;assert(!!Int32Array&&!!Float64Array&&!!(new Int32Array(1)).subarray&&!!(new Int32Array(1)).set,"Cannot fallback to non-typed array case: Code is too specialized");var buffer=new ArrayBuffer(TOTAL_MEMORY);HEAP8=new Int8Array(buffer),HEAP16=new Int16Array(buffer),HEAP32=new Int32Array(buffer),HEAPU8=new Uint8Array(buffer),HEAPU16=new Uint16Array(buffer),HEAPU32=new Uint32Array(buffer),HEAPF32=new Float32Array(buffer),HEAPF64=new Float64Array(buffer),HEAP32[0]=255,assert(HEAPU8[0]===255&&HEAPU8[3]===0,"Typed arrays 2 must be run on a little-endian system"),Module.HEAP=HEAP,Module.HEAP8=HEAP8,Module.HEAP16=HEAP16,Module.HEAP32=HEAP32,Module.HEAPU8=HEAPU8,Module.HEAPU16=HEAPU16,Module.HEAPU32=HEAPU32,Module.HEAPF32=HEAPF32,Module.HEAPF64=HEAPF64;var __ATINIT__=[],__ATMAIN__=[],__ATEXIT__=[],runtimeInitialized=!1;Module.intArrayFromString=intArrayFromString,Module.intArrayToString=intArrayToString,Module.writeStringToMemory=writeStringToMemory,Module.writeArrayToMemory=writeArrayToMemory,Math.imul||(Math.imul=function(e,t){var n=e>>>16,r=e&65535,i=t>>>16,s=t&65535;return r*s+(n*s+r*i<<16)|0});var runDependencies=0,runDependencyTracking={},calledInit=!1,calledRun=!1,runDependencyWatcher=null;Module.addRunDependency=addRunDependency,Module.removeRunDependency=removeRunDependency,Module.preloadedImages={},Module.preloadedAudios={};var awaitingMemoryInitializer=!1;STATIC_BASE=8,STATICTOP=STATIC_BASE+88,allocate([91,37,102,44,32,37,102,44,32,37,102,44,32,37,102,93,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,63,0,0,0,0,0,0,0,0,1,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,40,107,110,78,40,107,110,78,40,107,110,78,0,0,0,0,40,107,110,206,40,107,110,206,40,107,110,206,0,0,0,0],"i8",ALLOC_NONE,Runtime.GLOBAL_BASE),awaitingMemoryInitializer||runPostSets();var tempDoublePtr=Runtime.alignMemory(allocate(12,"i8",ALLOC_STATIC),8);assert(tempDoublePtr%8==0);var _sqrt=Math.sqrt,_llvm_memcpy_p0i8_p0i8_i32=_memcpy,_cos=Math.cos,_sin=Math.sin,_llvm_memset_p0i8_i32=_memset,_fabs=Math.abs,Browser={mainLoop:{scheduler:null,shouldPause:!1,paused:!1,queue:[],pause:function(){Browser.mainLoop.shouldPause=!0},resume:function(){Browser.mainLoop.paused&&(Browser.mainLoop.paused=!1,Browser.mainLoop.scheduler()),Browser.mainLoop.shouldPause=!1},updateStatus:function(){if(Module.setStatus){var e=Module.statusMessage||"Please wait...",t=Browser.mainLoop.remainingBlockers,n=Browser.mainLoop.expectedBlockers;t?t<n?Module.setStatus(e+" ("+(n-t)+"/"+n+")"):Module.setStatus(e):Module.setStatus("")}}},isFullScreen:!1,pointerLock:!1,moduleContextCreatedCallbacks:[],workers:[],init:function(){function t(e){return{jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",bmp:"image/bmp",ogg:"audio/ogg",wav:"audio/wav",mp3:"audio/mpeg"}[e.substr(e.lastIndexOf(".")+1)]}function s(){Browser.pointerLock=document.pointerLockElement===i||document.mozPointerLockElement===i||document.webkitPointerLockElement===i}if(Browser.initted)return;Browser.initted=!0;try{new Blob,Browser.hasBlobConstructor=!0}catch(e){Browser.hasBlobConstructor=!1,console.log("warning: no blob constructor, cannot create blobs with mimetypes")}Browser.BlobBuilder=typeof MozBlobBuilder!="undefined"?MozBlobBuilder:typeof WebKitBlobBuilder!="undefined"?WebKitBlobBuilder:Browser.hasBlobConstructor?null:console.log("warning: no BlobBuilder"),Browser.URLObject=typeof window!="undefined"?window.URL?window.URL:window.webkitURL:console.log("warning: cannot create object URLs"),Module.preloadPlugins||(Module.preloadPlugins=[]);var n={};n.canHandle=function(e){return!Module.noImageDecoding&&/\.(jpg|jpeg|png|bmp)$/.exec(e)},n.handle=function(e,n,r,i){var s=null;if(Browser.hasBlobConstructor)try{s=new Blob([e],{type:t(n)})}catch(o){Runtime.warnOnce("Blob constructor present but fails: "+o+"; falling back to blob builder")}if(!s){var u=new Browser.BlobBuilder;u.append((new Uint8Array(e)).buffer),s=u.getBlob()}var a=Browser.URLObject.createObjectURL(s);assert(typeof a=="string","createObjectURL must return a url as a string");var f=new Image;f.onload=function(){assert(f.complete,"Image "+n+" could not be decoded");var t=document.createElement("canvas");t.width=f.width,t.height=f.height;var i=t.getContext("2d");i.drawImage(f,0,0),Module.preloadedImages[n]=t,Browser.URLObject.revokeObjectURL(a),r&&r(e)},f.onerror=function(e){console.log("Image "+a+" could not be decoded"),i&&i()},f.src=a},Module.preloadPlugins.push(n);var r={};r.canHandle=function(e){return!Module.noAudioDecoding&&e.substr(-4)in{".ogg":1,".wav":1,".mp3":1}},r.handle=function(e,n,r,i){function o(t){if(s)return;s=!0,Module.preloadedAudios[n]=t,r&&r(e)}function u(){if(s)return;s=!0,Module.preloadedAudios[n]=new Audio,i&&i()}var s=!1;if(!Browser.hasBlobConstructor)return u();try{var a=new Blob([e],{type:t(n)})}catch(f){return u()}var l=Browser.URLObject.createObjectURL(a);assert(typeof l=="string","createObjectURL must return a url as a string");var c=new Audio;c.addEventListener("canplaythrough",function(){o(c)},!1),c.onerror=function(t){function r(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n="=",r="",i=0,s=0;for(var o=0;o<e.length;o++){i=i<<8|e[o],s+=8;while(s>=6){var u=i>>s-6&63;s-=6,r+=t[u]}}return s==2?(r+=t[(i&3)<<4],r+=n+n):s==4&&(r+=t[(i&15)<<2],r+=n),r}if(s)return;console.log("warning: browser could not fully decode audio "+n+", trying slower base64 approach"),c.src="data:audio/x-"+n.substr(-3)+";base64,"+r(e),o(c)},c.src=l,setTimeout(function(){o(c)},1e4)},Module.preloadPlugins.push(r);var i=Module.canvas;i.requestPointerLock=i.requestPointerLock||i.mozRequestPointerLock||i.webkitRequestPointerLock,i.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock,i.exitPointerLock=i.exitPointerLock.bind(document),document.addEventListener("pointerlockchange",s,!1),document.addEventListener("mozpointerlockchange",s,!1),document.addEventListener("webkitpointerlockchange",s,!1),Module.elementPointerLock&&i.addEventListener("click",function(e){!Browser.pointerLock&&i.requestPointerLock&&(i.requestPointerLock(),e.preventDefault())},!1)},createContext:
function(e,t,n){var r;try{t?r=e.getContext("experimental-webgl",{alpha:!1}):r=e.getContext("2d");if(!r)throw":("}catch(i){return Module.print("Could not create canvas - "+i),null}return t&&(e.style.backgroundColor="black",e.addEventListener("webglcontextlost",function(e){alert("WebGL context lost. You will need to reload the page.")},!1)),n&&(Module.ctx=r,Module.useWebGL=t,Browser.moduleContextCreatedCallbacks.forEach(function(e){e()}),Browser.init()),r},destroyContext:function(e,t,n){},fullScreenHandlersInstalled:!1,lockPointer:undefined,resizeCanvas:undefined,requestFullScreen:function(e,t){function r(){Browser.isFullScreen=!1,(document.webkitFullScreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.mozFullscreenElement||document.fullScreenElement||document.fullscreenElement)===n?(n.cancelFullScreen=document.cancelFullScreen||document.mozCancelFullScreen||document.webkitCancelFullScreen,n.cancelFullScreen=n.cancelFullScreen.bind(document),Browser.lockPointer&&n.requestPointerLock(),Browser.isFullScreen=!0,Browser.resizeCanvas&&Browser.setFullScreenCanvasSize()):Browser.resizeCanvas&&Browser.setWindowedCanvasSize(),Module.onFullScreen&&Module.onFullScreen(Browser.isFullScreen)}this.lockPointer=e,this.resizeCanvas=t,typeof this.lockPointer=="undefined"&&(this.lockPointer=!0),typeof this.resizeCanvas=="undefined"&&(this.resizeCanvas=!1);var n=Module.canvas;this.fullScreenHandlersInstalled||(this.fullScreenHandlersInstalled=!0,document.addEventListener("fullscreenchange",r,!1),document.addEventListener("mozfullscreenchange",r,!1),document.addEventListener("webkitfullscreenchange",r,!1)),n.requestFullScreen=n.requestFullScreen||n.mozRequestFullScreen||(n.webkitRequestFullScreen?function(){n.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT)}:null),n.requestFullScreen()},requestAnimationFrame:function(e){window.requestAnimationFrame||(window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||window.setTimeout),window.requestAnimationFrame(e)},getMovementX:function(e){return e.movementX||e.mozMovementX||e.webkitMovementX||0},getMovementY:function(e){return e.movementY||e.mozMovementY||e.webkitMovementY||0},mouseX:0,mouseY:0,mouseMovementX:0,mouseMovementY:0,calculateMouseEvent:function(e){if(Browser.pointerLock)e.type!="mousemove"&&"mozMovementX"in e?Browser.mouseMovementX=Browser.mouseMovementY=0:(Browser.mouseMovementX=Browser.getMovementX(e),Browser.mouseMovementY=Browser.getMovementY(e)),Browser.mouseX=SDL.mouseX+Browser.mouseMovementX,Browser.mouseY=SDL.mouseY+Browser.mouseMovementY;else{var t=Module.canvas.getBoundingClientRect(),n=e.pageX-(window.scrollX+t.left),r=e.pageY-(window.scrollY+t.top),i=Module.canvas.width,s=Module.canvas.height;n*=i/t.width,r*=s/t.height,Browser.mouseMovementX=n-Browser.mouseX,Browser.mouseMovementY=r-Browser.mouseY,Browser.mouseX=n,Browser.mouseY=r}},xhrLoad:function(e,t,n){var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=function(){r.status==200||r.status==0&&r.response?t(r.response):n()},r.onerror=n,r.send(null)},asyncLoad:function(e,t,n,r){Browser.xhrLoad(e,function(n){assert(n,'Loading data file "'+e+'" failed (no arrayBuffer).'),t(new Uint8Array(n)),r||removeRunDependency("al "+e)},function(t){if(!n)throw'Loading data file "'+e+'" failed.';n()}),r||addRunDependency("al "+e)},resizeListeners:[],updateResizeListeners:function(){var e=Module.canvas;Browser.resizeListeners.forEach(function(t){t(e.width,e.height)})},setCanvasSize:function(e,t,n){var r=Module.canvas;r.width=e,r.height=t,n||Browser.updateResizeListeners()},windowedWidth:0,windowedHeight:0,setFullScreenCanvasSize:function(){var e=Module.canvas;this.windowedWidth=e.width,this.windowedHeight=e.height,e.width=screen.width,e.height=screen.height;var t=HEAPU32[SDL.screen+Runtime.QUANTUM_SIZE*0>>2];t|=8388608,HEAP32[SDL.screen+Runtime.QUANTUM_SIZE*0>>2]=t,Browser.updateResizeListeners()},setWindowedCanvasSize:function(){var e=Module.canvas;e.width=this.windowedWidth,e.height=this.windowedHeight;var t=HEAPU32[SDL.screen+Runtime.QUANTUM_SIZE*0>>2];t&=-8388609,HEAP32[SDL.screen+Runtime.QUANTUM_SIZE*0>>2]=t,Browser.updateResizeListeners()}};Module.requestFullScreen=function(e,t){Browser.requestFullScreen(e,t)},Module.requestAnimationFrame=function(e){Browser.requestAnimationFrame(e)},Module.pauseMainLoop=function(){Browser.mainLoop.pause()},Module.resumeMainLoop=function(){Browser.mainLoop.resume()},STACK_BASE=STACKTOP=Runtime.alignMemory(STATICTOP),staticSealed=!0,STACK_MAX=STACK_BASE+5242880,DYNAMIC_BASE=DYNAMICTOP=Runtime.alignMemory(STACK_MAX),assert(DYNAMIC_BASE<TOTAL_MEMORY);var FUNCTION_TABLE=[0,0];Module._getBestFitPlane=_getBestFitPlane;var i64Math=null;Module.callMain=function(t){function r(){for(var e=0;e<3;e++)i.push(0)}assert(runDependencies==0,"cannot call main when async dependencies remain! (listen on __ATMAIN__)"),assert(!Module.preRun||Module["preRun"].length==0,"cannot call main when preRun functions remain to be called"),t=t||[],ensureInitRuntime();var n=t.length+1,i=[allocate(intArrayFromString("/bin/this.program"),"i8",ALLOC_NORMAL)];r();for(var s=0;s<n-1;s+=1)i.push(allocate(intArrayFromString(t[s]),"i8",ALLOC_NORMAL)),r();i.push(0),i=allocate(i,"i32",ALLOC_NORMAL);var o,u=STACKTOP;try{o=Module._main(n,i,0)}catch(a){if(a.name=="ExitStatus")return a.status;if(a!="SimulateInfiniteLoop")throw a;Module.noExitRuntime=!0}finally{STACKTOP=u}return o},Module.run=Module.run=run;if(Module.preInit){typeof Module["preInit"]=="function"&&(Module.preInit=[Module.preInit]);while(Module.preInit.length>0)Module.preInit.pop()()}var shouldRunNow=!0;return Module.noInitialRun&&(shouldRunNow=!1),run(),{getBestFitPlane:function(coordarray){var floatData=new Float32Array(coordarray.length);for(i=0;i<floatData.length;i++)floatData[i]=coordarray[i];var numBytes=floatData.length*floatData.BYTES_PER_ELEMENT,ptr=_malloc(numBytes),heapBytes=new Uint8Array(Module.HEAPU8.buffer,ptr,numBytes);heapBytes.set(new Uint8Array(floatData.buffer));var o=_getBestFitPlane(coordarray.length,ptr);return _free(heapBytes.byteOffset),eval(Pointer_stringify(o))}}}();window.mobilecheck=function(){var e=!1;return function(t){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino|android|ipad|playbook|silk/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))e=!0}(navigator.userAgent||navigator.vendor||window.opera),e};var CanvasTextFunctions={};CanvasTextFunctions.letters={" ":{width:16,points:[]},"!":{width:10,points:[[5,21],[5,7],[-1,-1],[5,2],[4,1],[5,0],[6,1],[5,2]]},'"':{width:16,points:[[4,21],[4,14],[-1,-1],[12,21],[12,14]]},"#":{width:21,points:[[11,25],[4,-7],[-1,-1],[17,25],[10,-7],[-1,-1],[4,12],[18,12],[-1,-1],[3,6],[17,6]]},$:{width:20,points:[[8,25],[8,-4],[-1,-1],[12,25],[12,-4],[-1,-1],[17,18],[15,20],[12,21],[8,21],[5,20],[3,18],[3,16],[4,14],[5,13],[7,12],[13,10],[15,9],[16,8],[17,6],[17,3],[15,1],[12,0],[8,0],[5,1],[3,3]]},"%":{width:24,points:[[21,21],[3,0],[-1,-1],[8,21],[10,19],[10,17],[9,15],[7,14],[5,14],[3,16],[3,18],[4,20],[6,21],[8,21],[10,20],[13,19],[16,19],[19,20],[21,21],[-1,-1],[17,7],[15,6],[14,4],[14,2],[16,0],[18,0],[20,1],[21,3],[21,5],[19,7],[17,7]]},"&":{width:26,points:[[23,12],[23,13],[22,14],[21,14],[20,13],[19,11],[17,6],[15,3],[13,1],[11,0],[7,0],[5,1],[4,2],[3,4],[3,6],[4,8],[5,9],[12,13],[13,14],[14,16],[14,18],[13,20],[11,21],[9,20],[8,18],[8,16],[9,13],[11,10],[16,3],[18,1],[20,0],[22,0],[23,1],[23,2]]},"'":{width:10,points:[[5,19],[4,20],[5,21],[6,20],[6,18],[5,16],[4,15]]},"(":{width:14,points:[[11,25],[9,23],[7,20],[5,16],[4,11],[4,7],[5,2],[7,-2],[9,-5],[11,-7]]},")":{width:14,points:[[3,25],[5,23],[7,20],[9,16],[10,11],[10,7],[9,2],[7,-2],[5,-5],[3,-7]]},"*":{width:16,points:[[8,21],[8,9],[-1,-1],[3,18],[13,12],[-1,-1],[13,18],[3,12]]},"+":{width:26,points:[[13,18],[13,0],[-1,-1],[4,9],[22,9]]},",":{width:10,points:[[6,1],[5,0],[4,1],[5,2],[6,1],[6,-1],[5,-3],[4,-4]]},"-":{width:26,points:[[4,9],[22,9]]},".":{width:10,points:[[5,2],[4,1],[5,0],[6,1],[5,2]]},"/":{width:22,points:[[20,25],[2,-7]]},0:{width:20,points:[[9,21],[6,20],[4,17],[3,12],[3,9],[4,4],[6,1],[9,0],[11,0],[14,1],[16,4],[17,9],[17,12],[16,17],[14,20],[11,21],[9,21]]},1:{width:20,points:[[6,17],[8,18],[11,21],[11,0]]},2:{width:20,points:[[4,16],[4,17],[5,19],[6,20],[8,21],[12,21],[14,20],[15,19],[16,17],[16,15],[15,13],[13,10],[3,0],[17,0]]},3:{width:20,points:[[5,21],[16,21],[10,13],[13,13],[15,12],[16,11],[17,8],[17,6],[16,3],[14,1],[11,0],[8,0],[5,1],[4,2],[3,4]]},4:{width:20,points:[[13,21],[3,7],[18,7],[-1,-1],[13,21],[13,0]]},5:{width:20,points:[[15,21],[5,21],[4,12],[5,13],[8,14],[11,14],[14,13],[16,11],[17,8],[17,6],[16,3],[14,1],[11,0],[8,0],[5,1],[4,2],[3,4]]},6:{width:20,points:[[16,18],[15,20],[12,21],[10,21],[7,20],[5,17],[4,12],[4,7],[5,3],[7,1],[10,0],[11,0],[14,1],[16,3],[17,6],[17,7],[16,10],[14,12],[11,13],[10,13],[7,12],[5,10],[4,7]]},7:{width:20,points:[[17,21],[7,0],[-1,-1],[3,21],[17,21]]},8:{width:20,points:[[8,21],[5,20],[4,18],[4,16],[5,14],[7,13],[11,12],[14,11],[16,9],[17,7],[17,4],[16,2],[15,1],[12,0],[8,0],[5,1],[4,2],[3,4],[3,7],[4,9],[6,11],[9,12],[13,13],[15,14],[16,16],[16,18],[15,20],[12,21],[8,21]]},9:{width:20,points:[[16,14],[15,11],[13,9],[10,8],[9,8],[6,9],[4,11],[3,14],[3,15],[4,18],[6,20],[9,21],[10,21],[13,20],[15,18],[16,14],[16,9],[15,4],[13,1],[10,0],[8,0],[5,1],[4,3]]},":":{width:10,points:[[5,14],[4,13],[5,12],[6,13],[5,14],[-1,-1],[5,2],[4,1],[5,0],[6,1],[5,2]]},",":{width:10,points:[[5,14],[4,13],[5,12],[6,13],[5,14],[-1,-1],[6,1],[5,0],[4,1],[5,2],[6,1],[6,-1],[5,-3],[4,-4]]},"<":{width:24,points:[[20,18],[4,9],[20,0]]},"=":{width:26,points:[[4,12],[22,12],[-1,-1],[4,6],[22,6]]},">":{width:24,points:[[4,18],[20,9],[4,0]]},"?":{width:18,points:[[3,16],[3,17],[4,19],[5,20],[7,21],[11,21],[13,20],[14,19],[15,17],[15,15],[14,13],[13,12],[9,10],[9,7],[-1,-1],[9,2],[8,1],[9,0],[10,1],[9,2]]},"@":{width:27,points:[[18,13],[17,15],[15,16],[12,16],[10,15],[9,14],[8,11],[8,8],[9,6],[11,5],[14,5],[16,6],[17,8],[-1,-1],[12,16],[10,14],[9,11],[9,8],[10,6],[11,5],[-1,-1],[18,16],[17,8],[17,6],[19,5],[21,5],[23,7],[24,10],[24,12],[23,15],[22,17],[20,19],[18,20],[15,21],[12,21],[9,20],[7,19],[5,17],[4,15],[3,12],[3,9],[4,6],[5,4],[7,2],[9,1],[12,0],[15,0],[18,1],[20,2],[21,3],[-1,-1],[19,16],[18,8],[18,6],[19,5]]},A:{width:18,points:[[9,21],[1,0],[-1,-1],[9,21],[17,0],[-1,-1],[4,7],[14,7]]},B:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[13,21],[16,20],[17,19],[18,17],[18,15],[17,13],[16,12],[13,11],[-1,-1],[4,11],[13,11],[16,10],[17,9],[18,7],[18,4],[17,2],[16,1],[13,0],[4,0]]},C:{width:21,points:[[18,16],[17,18],[15,20],[13,21],[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5]]},D:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[11,21],[14,20],[16,18],[17,16],[18,13],[18,8],[17,5],[16,3],[14,1],[11,0],[4,0]]},E:{width:19,points:[[4,21],[4,0],[-1,-1],[4,21],[17,21],[-1,-1],[4,11],[12,11],[-1,-1],[4,0],[17,0]]},F:{width:18,points:[[4,21],[4,0],[-1,-1],[4,21],[17,21],[-1,-1],[4,11],[12,11]]},G:{width:21,points:[[18,16],[17,18],[15,20],[13,21],[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5],[18,8],[-1,-1],[13,8],[18,8]]},H:{width:22,points:[[4,21],[4,0],[-1,-1],[18,21],[18,0],[-1,-1],[4,11],[18,11]]},I:{width:8,points:[[4,21],[4,0]]},J:{width:16,points:[[12,21],[12,5],[11,2],[10,1],[8,0],[6,0],[4,1],[3,2],[2,5],[2,7]]},K:{width:21,points:[[4,21],[4,0],[-1,-1],[18,21],[4,7],[-1,-1],[9,12],[18,0]]},L:{width:17,points:[[4,21],[4,0],[-1,-1],[4,0],[16,0]]},M:{width:24,points:[[4,21],[4,0],[-1,-1],[4,21],[12,0],[-1,-1],[20,21],[12,0],[-1,-1],[20,21],[20,0]]},N:{width:22,points:[[4,21],[4,0],[-1,-1],[4,21],[18,0],[-1,-1],[18,21],[18,0]]},O:{width:22,points:[[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5],[19,8],[19,13],[18,16],[17,18],[15,20],[13,21],[9,21]]},P:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[13,21],[16,20],[17,19],[18,17],[18,14],[17,12],[16,11],[13,10],[4,10]]},Q:{width:22,points:[[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5],[19,8],[19,13],[18,16],[17,18],[15,20],[13,21],[9,21],[-1,-1],[12,4],[18,-2]]},R:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[13,21],[16,20],[17,19],[18,17],[18,15],[17,13],[16,12],[13,11],[4,11],[-1,-1],[11,11],[18,0]]},S:{width:20,points:[[17,18],[15,20],[12,21],[8,21],[5,20],[3,18],[3,16],[4,14],[5,13],[7,12],[13,10],[15,9],[16,8],[17,6],[17,3],[15,1],[12,0],[8,0],[5,1],[3,3]]},T:{width:16,points:[[8,21],[8,0],[-1,-1],[1,21],[15,21]]},U:{width:22,points:[[4,21],[4,6],[5,3],[7,1],[10,0],[12,0],[15,1],[17,3],[18,6],[18,21]]},V:{width:18,points:[[1,21],[9,0],[-1,-1],[17,21],[9,0]]},W:{width:24,points:[[2,21],[7,0],[-1,-1],[12,21],[7,0],[-1,-1],[12,21],[17,0],[-1,-1],[22,21],[17,0]]},X:{width:20,points:[[3,21],[17,0],[-1,-1],[17,21],[3,0]]},Y:{width:18,points:[[1,21],[9,11],[9,0],[-1,-1],[17,21],[9,11]]},Z:{width:20,points:[[17,21],[3,0],[-1,-1],[3,21],[17,21],[-1,-1],[3,0],[17,0]]},"[":{width:14,points:[[4,25],[4,-7],[-1,-1],[5,25],[5,-7],[-1,-1],[4,25],[11,25],[-1,-1],[4,-7],[11,-7]]},"\\":{width:14,points:[[0,21],[14,-3]]},"]":{width:14,points:[[9,25],[9,-7],[-1,-1],[10,25],[10,-7],[-1,-1],[3,25],[10,25],[-1,-1],[3,-7],[10,-7]]},"^":{width:16,points:[[6,15],[8,18],[10,15],[-1,-1],[3,12],[8,17],[13,12],[-1,-1],[8,17],[8,0]]},_:{width:16,points:[[0,-2],[16,-2]]},"`":{width:10,points:[[6,21],[5,20],[4,18],[4,16],[5,15],[6,16],[5,17]]},a:{width:19,points:[[15,14],[15,0],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},b:{width:19,points:[[4,21],[4,0],[-1,-1],[4,11],[6,13],[8,14],[11,14],[13,13],[15,11],[16,8],[16,6],[15,3],[13,1],[11,0],[8,0],[6,1],[4,3]]},c:{width:18,points:[[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},d:{width:19,points:[[15,21],[15,0],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},e:{width:18,points:[[3,8],[15,8],[15,10],[14,12],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},f:{width:12,points:[[10,21],[8,21],[6,20],[5,17],[5,0],[-1,-1],[2,14],[9,14]]},g:{width:19,points:[[15,14],[15,-2],[14,-5],[13,-6],[11,-7],[8,-7],[6,-6],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},h:{width:19,points:[[4,21],[4,0],[-1,-1],[4,10],[7,13],[9,14],[12,14],[14,13],[15,10],[15,0]]},i:{width:8,points:[[3,21],[4,20],[5,21],[4,22],[3,21],[-1,-1],[4,14],[4,0]]},j:{width:10,points:[[5,21],[6,20],[7,21],[6,22],[5,21],[-1,-1],[6,14],[6,-3],[5,-6],[3,-7],[1,-7]]},k:{width:17,points:[[4,21],[4,0],[-1,-1],[14,14],[4,4],[-1,-1],[8,8],[15,0]]},l:{width:8,points:[[4,21],[4,0]]},m:{width:30,points:[[4,14],[4,0],[-1,-1],[4,10],[7,13],[9,14],[12,14],[14,13],[15,10],[15,0],[-1,-1],[15,10],[18,13],[20,14],[23,14],[25,13],[26,10],[26,0]]},n:{width:19,points:[[4,14],[4,0],[-1,-1],[4,10],[7,13],[9,14],[12,14],[14,13],[15,10],[15,0]]},o:{width:19,points:[[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3],[16,6],[16,8],[15,11],[13,13],[11,14],[8,14]]},p:{width:19,points:[[4,14],[4,-7],[-1,-1],[4,11],[6,13],[8,14],[11,14],[13,13],[15,11],[16,8],[16,6],[15,3],[13,1],[11,0],[8,0],[6,1],[4,3]]},q:{width:19,points:[[15,14],[15,-7],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},r:{width:13,points:[[4,14],[4,0],[-1,-1],[4,8],[5,11],[7,13],[9,14],[12,14]]},s:{width:17,points:[[14,11],[13,13],[10,14],[7,14],[4,13],[3,11],[4,9],[6,8],[11,7],[13,6],[14,4],[14,3],[13,1],[10,0],[7,0],[4,1],[3,3]]},t:{width:12,points:[[5,21],[5,4],[6,1],[8,0],[10,0],[-1,-1],[2,14],[9,14]]},u:{width:19,points:[[4,14],[4,4],[5,1],[7,0],[10,0],[12,1],[15,4],[-1,-1],[15,14],[15,0]]},v:{width:16,points:[[2,14],[8,0],[-1,-1],[14,14],[8,0]]},w:{width:22,points:[[3,14],[7,0],[-1,-1],[11,14],[7,0],[-1,-1],[11,14],[15,0],[-1,-1],[19,14],[15,0]]},x:{width:17,points:[[3,14],[14,0],[-1,-1],[14,14],[3,0]]},y:{width:16,points:[[2,14],[8,0],[-1,-1],[14,14],[8,0],[6,-4],[4,-6],[2,-7],[1,-7]]},z:{width:17,points:[[14,14],[3,0],[-1,-1],[3,14],[14,14],[-1,-1],[3,0],[14,0]]},"{":{width:14,points:[[9,25],[7,24],[6,23],[5,21],[5,19],[6,17],[7,16],[8,14],[8,12],[6,10],[-1,-1],[7,24],[6,22],[6,20],[7,18],[8,17],[9,15],[9,13],[8,11],[4,9],[8,7],[9,5],[9,3],[8,1],[7,0],[6,-2],[6,-4],[7,-6],[-1,-1],[6,8],[8,6],[8,4],[7,2],[6,1],[5,-1],[5,-3],[6,-5],[7,-6],[9,-7]]},"|":{width:8,points:[[4,25],[4,-7]]},"}":{width:14,points:[[5,25],[7,24],[8,23],[9,21],[9,19],[8,17],[7,16],[6,14],[6,12],[8,10],[-1,-1],[7,24],[8,22],[8,20],[7,18],[6,17],[5,15],[5,13],[6,11],[10,9],[6,7],[5,5],[5,3],[6,1],[7,0],[8,-2],[8,-4],[7,-6],[-1,-1],[8,8],[6,6],[6,4],[7,2],[8,1],[9,-1],[9,-3],[8,-5],[7,-6],[5,-7]]},"~":{width:24,points:[[3,6],[3,8],[4,11],[6,12],[8,12],[10,11],[14,8],[16,7],[18,7],[20,8],[21,10],[-1,-1],[3,8],[4,10],[6,11],[8,11],[10,10],[14,7],[16,6],[18,6],[20,7],[21,10],[21,12]]}},CanvasTextFunctions.letter=function(e){return CanvasTextFunctions.letters[e]},CanvasTextFunctions.ascent=function(e,t){return t},CanvasTextFunctions.descent=function(e,t){return 7*t/25},CanvasTextFunctions.measure=function(e,t,n){var r=0,s=n.length;for(i=0;i<s;i++){var o=CanvasTextFunctions.letter(n.charAt(i));o&&(r+=o.width*t/25)}return r},CanvasTextFunctions.draw=function(e,t,n,r,s,o){try{var u=0,a=o.length,f=n/25;e.save(),e.lineCap="round",e.lineWidth=2*f;for(i=0;i<a;i++){var l=CanvasTextFunctions.letter(o.charAt(i));if(!l)continue;e.beginPath();var c=1,h=0;for(j=0;j<l.points.length;j++){var p=l.points[j];if(p[0]==-1&&p[1]==-1){c=1;continue}c?(e.moveTo(r+p[0]*f,s-p[1]*f),c=!1):e.lineTo(r+p[0]*f,s-p[1]*f)}e.stroke(),r+=l.width*f}e.restore()}catch(d){}return u},CanvasTextFunctions.enable=function(e){e.drawText=function(t,n,r,i,s){return CanvasTextFunctions.draw(e,t,n,r,i,s)},e.measureText=function(e,t,n){return CanvasTextFunctions.measure(e,t,n)},e.fontAscent=function(e,t){return CanvasTextFunctions.ascent(e,t)},e.fontDescent=function(e,t){return CanvasTextFunctions.descent(e,t)},e.drawTextRight=function(t,n,r,i,s){var o=CanvasTextFunctions.measure(t,n,s);return CanvasTextFunctions.draw(e,t,n,r-o,i,s)},e.drawTextCenter=function(t,n,r,i,s){var o=CanvasTextFunctions.measure(t,n,s);return CanvasTextFunctions.draw(e,t,n,r-o/2,i,s)}};var Scif=function(){function e(e,t){return e&&this.parseCif(e,t),!0}return e._block=function(e){return this.id=e,this.cifitems=[],this.cifloops=[],this.rawdata="",this.structure=!1,this.mscif=!1,this.mmcif=!1,this.cifmol=!1,this},e._block.prototype.getItemValues=function(e){var t="";for(var n=0;n<e.length;n++){var r=this.cifitems[e[n]];if(!r)continue;var i=r.getValues(),s=!0;for(var o=0;o<i.length;o++){var u=i[o];u=u.replace(/^\s+|\s+$/g,""),u.substr(0,2)=="\\\n"&&(u=u.replace(/\\\s*\n/g,"")),u=u.replace(/^\s+|\s+$/g,"");if(u!="."&&u!="?"&&u!=""){s=!1,t=e[n];break}}if(s)continue;return{dn:t,dvs:i}}return null},e._block.prototype.getWavevectorMatrices=function(){var e="",t=this.getItemValues(["_cell_modulation_dimension"]),n=1;t&&t.dvs.length>0&&(n=parseInt(t.dvs[0]),isNaN(n)&&(n=1)),n+=3;var r=this.getItemValues(["_cell_subsystems_number"]),i=0;r&&r.dvs.length>0&&(i=parseInt(r.dvs[0]),isNaN(i)&&(i=0));if(i>0){var s=this.cifitems._cell_subsystem_code;s||(s=this.cifitems._cell_subsystem_description);if(!s)return null;var o=[],u="";for(var a=1;a<=n;++a)for(var f=1;f<=n;++f)a==f?u+="1":u+="0",o.push("_cell_subsystem_matrix_w_"+a+"_"+f);var l=[],c=this.cifloops[s.id];if(!c)return null;var h=c.loopheads,p=c.loopvalues,d=[];for(var v=0;v<o.length;v++)d[o[v]]=h.indexOf(o[v]);var m=h.length,g=p.length/m,y=0,b=[],w=[];for(var E=0;E<g;++E){var S=!0,x=0,T="",N=[];for(var v=0;v<o.length;v++){x++;var C=0;if(d[o[v]]>-1){var k=parseFloat(p[y+d[o[v]]]);isNaN(k)||(C=k,S=!1)}x>1&&(T+=" & "),T+=""+C,N.push(C),x==n&&(b.push(N.slice(0)),N.length=0,T+=" \\cr ",x=0)}!S&&T!=""&&(T="W^{"+(E+1)+"}=\\left(\\matrix{"+T+"}\\right)"),w.push(T),y+=m}return{matrices:b,tex:w}}return null},e._block.prototype.getBiomolData=function(){var e=this,t=[],n=0,r=e.cifitems["_pdbx_struct_assembly.id"];if(r){var i=e.cifloops[r.id],s=[],o=[];if(!i){o.push(r.value),s=["_pdbx_struct_assembly.id","_pdbx_struct_assembly.details"];for(var u=1;u<s.length;u++){var a=e.cifitems[s[u]];a?o.push(a.value):o.push("?")}}else s=i.loopheads,o=i.loopvalues;var f=s.indexOf("_pdbx_struct_assembly.id"),l=s.indexOf("_pdbx_struct_assembly.details"),c=s.length,h=o.length/c,p=0;for(var d=0;d<h;++d){if(f==-1){p+=c;continue}t[o[p+f]]={id:o[p+f],details:o[p+l],ops:[],opsByChain:[],chains:[],mats:[]},n++,p+=c}}r=e.cifitems["_pdbx_struct_assembly_gen.assembly_id"];if(r){var i=e.cifloops[r.id],s=[],o=[];if(!i){o.push(r.value),s=["_pdbx_struct_assembly_gen.assembly_id","_pdbx_struct_assembly_gen.oper_expression","_pdbx_struct_assembly_gen.asym_id_list"];for(var u=1;u<s.length;u++){var a=e.cifitems[s[u]];a?o.push(a.value):o.push("?")}}else s=i.loopheads,o=i.loopvalues;var f=s.indexOf("_pdbx_struct_assembly_gen.assembly_id"),v=s.indexOf("_pdbx_struct_assembly_gen.oper_expression"),m=s.indexOf("_pdbx_struct_assembly_gen.asym_id_list"),c=s.length,h=o.length/c,p=0;for(var d=0;d<h;++d){if(f==-1||v==-1||m==-1){p+=c;continue}var g=o[p+v],y=[];if(g.indexOf(/\)\s*\(/)==-1){var b=g.split(")");for(var w=0;w<b.length;w++){var E=b[w].replace(/\(/g,""),S=E.split(",");for(var x=0;x<S.length;x++){var T=/^(\d+)-(\d+)$/.exec(S[x]);if(T&&T.length==3){var N=parseInt(T[1]),C=parseInt(T[2]);for(var k=N;k<=C;k++)y.push(k+"")}else S[x].length>0&&y.push(S[x])}}}if(!t[o[p+f]]){var L=o[p+m].split(","),A=[];for(var O=0;O<L.length;O++)A[L[O]]=y;t[o[p+f]]={id:o[p+f],details:"",ops:y,opsByChain:A,chains:L,mats:[]},n++}else{var L=o[p+m].split(","),A=[];for(var O=0;O<L.length;O++)if(!t[o[p+f]].opsByChain[L[O]])t[o[p+f]].opsByChain[L[O]]=y.slice();else for(var w=0;w<y.length;w++)t[o[p+f]].opsByChain[L[O]].push(y[w]);t[o[p+f]].ops=t[o[p+f]].ops.concat(y),t[o[p+f]].chains=t[o[p+f]].chains.concat(L)}p+=c}}if(n>0){var M=[],_=e.cifitems["_pdbx_struct_oper_list.id"];if(_){var D=["_pdbx_struct_oper_list.id","_pdbx_struct_oper_list.matrix[1][1]","_pdbx_struct_oper_list.matrix[1][2]","_pdbx_struct_oper_list.matrix[1][3]","_pdbx_struct_oper_list.vector[1]","_pdbx_struct_oper_list.matrix[2][1]","_pdbx_struct_oper_list.matrix[2][2]","_pdbx_struct_oper_list.matrix[2][3]","_pdbx_struct_oper_list.vector[2]","_pdbx_struct_oper_list.matrix[3][1]","_pdbx_struct_oper_list.matrix[3][2]","_pdbx_struct_oper_list.matrix[3][3]","_pdbx_struct_oper_list.vector[3]"],i=e.cifloops[_.id],s=[],o=[];if(!i){o.push(_.value),s.push(D[0]);for(var u=1;u<D.length;u++){var a=e.cifitems[D[u]];a?o.push(a.value):o.push("?"),s.push(D[u])}}else s=i.loopheads,o=i.loopvalues;var f=s.indexOf("_pdbx_struct_assembly_gen.assembly_id"),P=[];for(var u=0;u<D.length;u++)P[D[u]]=s.indexOf(D[u]);var c=s.length,h=o.length/c,p=0;for(var d=0;d<h;++d){if(P[D[0]]==-1){p+=c;continue}var H=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],B=o[p+P[D[0]]],j=0,F=0;for(var u=1;u<D.length;u++){if(P[D[u]]>-1){var I=parseFloat(o[p+P[D[u]]]);isNaN(I)||(H[F][j]=I)}u>3&&u%4==0?(j++,F=0):F++}M[B]=H,p+=c}}for(var q in t){t[q].matsById=[];for(var w=0;w<t[q].ops.length;w++)M[t[q].ops[w]]&&(t[q].mats.push(M[t[q].ops[w]]),t[q].matsById[t[q].ops[w]]=M[t[q].ops[w]])}return t}return null},e._block.prototype.getBiomol=function(e){function K(e,t,n,r){var i=r[0][0]*e+r[1][0]*t+r[2][0]*n+r[3][0],s=r[0][1]*e+r[1][1]*t+r[2][1]*n+r[3][1],o=r[0][2]*e+r[1][2]*t+r[2][2]*n+r[3][2];return[i,s,o]}var t=this;if(this.biomols&&this.biomols[e])return this.biomols[e];this.biomols||(this.biomols=[]);if(!this.assemblies||!this.assemblies[e])return null;var n=this.assemblies[e],r=[];if(n.ops&&n.ops.length>10)return null;var i=!1,s=[],o=[],u=n.id,a=t.model.asu;for(var f in n.matsById)for(var l in a){var c=a[l];if(c==undefined)continue;if(n.chains.indexOf(c.chain)==-1)continue;var h=[c.x,c.y,c.z];if(!n.opsByChain[c.chain])continue;var p=!1;for(var d=0;d<n.opsByChain[c.chain].length;d++)if(n.opsByChain[c.chain][d]==f){p=!0;break}if(!p)continue;var v=K(c.x,c.y,c.z,n.matsById[f]),m=[],g="";if(c.hetflag||c.ligandid){for(var y=0;y<c.bonds.length;y++)m.push(c.bonds[y]+"_"+u+"_"+f);if(c.ligandid){g=c.ligandid+"_"+u+"_"+f;if(!t.ligands[c.resn][c.ligandid+"_"+u+"_"+f]){var b=t.ligands[c.resn][c.ligandid],w={name:c.ligandid+"_"+u+"_"+f,siteids:[],dims:[],pocketids:[],pocketdims:[],assembly:u,assembly_m:f};for(var E=0;E<b.siteids.length;E++)w.siteids.push(b.siteids[E]+"_"+u+"_"+f);for(var S=0;S<b.pocketids.length;S++)w.pocketids.push(b.pocketids[S]+"_"+u+"_"+f);t.ligands[c.resn][c.ligandid+"_"+u+"_"+f]=w,o.push({resn:c.resn,id:c.ligandid+"_"+u+"_"+f})}}}i=!0,s[l+"_"+u+"_"+f]={resn:c.resn,x:v[0],y:v[1],z:v[2],elem:c.elem,hetflag:c.hetflag,chain:c.chain,resi:c.resi,idx:l+"_"+u+"_"+f,atom:c.atom,ss:c.ss,color:16777215,bonds:m,bondOrder:c.bondOrder,b:c.b,ligandid:g,ligandidA:c.ligandidA,pocket:!1},r[c.resn+"_"+c.resi+"_"+c.chain]||(r[c.resn+"_"+c.resi+"_"+c.chain]=[]),r[c.resn+"_"+c.resi+"_"+c.chain].push(l+"_"+u+"_"+f)}if(i){t.model.biomols[e]={assembly:n,sites:s};for(var w=0;w<o.length;w++){var x=t.ligands[o[w].resn][o[w].id],T=x.siteids,N,C,k,L,A,O,M=ysum=zsum=cnt=0,_=[],D=0;for(var E=0;E<T.length;E++){var P=s[T[E]];E==0&&(L=P.x,A=P.y,O=P.z,N=P.x,C=P.y,k=P.z),P.x<L&&(L=P.x),P.y<A&&(A=P.y),P.z<O&&(O=P.z),P.x>N&&(N=P.x),P.y>C&&(C=P.y),P.z>k&&(k=P.z),cnt++,M+=P.x,ysum+=P.y,zsum+=P.z;for(var l in s){var H=s[l];if(H==undefined)continue;if(H.resn!=P.resn&&!H.hetflag&&!_[l]){var B=(P.x-H.x)*(P.x-H.x)+(P.y-H.y)*(P.y-H.y)+(P.z-H.z)*(P.z-H.z);B<36&&(_[l]=H.idx,D++)}}}x.dims=[[L,A,O],[N,C,k],[M/cnt,ysum/cnt,zsum/cnt]];var j=[],F=[];F.length=0;for(var S in _){j[s[S].resn+"_"+s[S].resi+"_"+s[S].chain]||(j[s[S].resn+"_"+s[S].resi+"_"+s[S].chain]=[]),j[s[S].resn+"_"+s[S].resi+"_"+s[S].chain].indexOf(S)==-1&&j[s[S].resn+"_"+s[S].resi+"_"+s[S].chain].push(S),F.push(S);if(r[s[S].resn+"_"+s[S].resi+"_"+s[S].chain])for(var l=0;l<r[s[S].resn+"_"+s[S].resi+"_"+s[S].chain].length;l++){var H=s[r[s[S].resn+"_"+s[S].resi+"_"+s[S].chain][l]];if(H==undefined)continue;if(!_[H.idx]&&H.resn==s[S].resn&&H.resi==s[S].resi&&H.chain==s[S].chain){if(j[s[S].resn+"_"+s[S].resi+"_"+s[S].chain].indexOf(H.idx)>-1)continue;j[s[S].resn+"_"+s[S].resi+"_"+s[S].chain].push(H.idx),F.push(H.idx),D++}}}var I,q,R,U,z,W;for(var e=0;e<F.length;e++){var X=s[F[e]];e==0&&(U=X.x,z=X.y,W=X.z,I=X.x,q=X.y,R=X.z),X.x<U&&(U=X.x),X.y<z&&(z=X.y),X.z<W&&(W=X.z),X.x>I&&(I=X.x),X.y>q&&(q=X.y),X.z>R&&(R=X.z)}x.pocketids=F.slice(0),x.pocketdims=[[U,z,W],[I,q,R]];for(var V in j){var T=j[V];for(var E=0;E<T.length;E++){var P=s[T[E]];P.pocket=!0;for(var $=E+1;$<T.length;$++){var H=s[T[$]];H.pocket=!0;var J=Math.sqrt((P.x-H.x)*(P.x-H.x)+(P.y-H.y)*(P.y-H.y)+(P.z-H.z)*(P.z-H.z));J<(this.elements[P.elem].covRad+this.elements[H.elem].covRad)*1.3&&(P.bonds.push(T[$]),P.bondOrder.push(1),H.bonds.push(T[E]),H.bondOrder.push(1))}}}}}return this.model.biomols[e]},e._block.prototype.getBioligandData=function(){var e=this,t=[],n=e.cifitems["_chem_comp.id"];if(n){var r=e.cifloops[n.id],i=[],s=[];if(!r){s.push(n.value),i=["_chem_comp.id","_chem_comp.type","_chem_comp.name"];for(var o=1;o<i.length;o++){var u=e.cifitems[i[o]];u?s.push(u.value):s.push("?")}}else i=r.loopheads,s=r.loopvalues;var a=i.indexOf("_chem_comp.id"),f=i.indexOf("_chem_comp.type"),l=i.indexOf("_chem_comp.name"),c=i.length,h=s.length/c,p=0,d=0;for(var v=0;v<h;++v){if(a==-1||f==-1){p+=c;continue}var m=s[p+f].toUpperCase();if(m=="NON-POLYMER"||m.indexOf("SACCHARID")>-1||m=="OTHER")l>-1?t[s[p+a]]=s[p+l]:t[s[p+a]]=s[p+a],d++;p+=c}if(d>0)return t}return null},e._block.prototype.getKeyId=function(){var e=this,t=e.cifitems._cifmol_cell_matrix;return t?t.value.replace(/[^\d]/g,""):"0"},e._cifitem=function(e,t,n,r,i,s){return this.id=e,this.dataname=t,this.datablockid=n,this.value=r,this.looped=i,this.loop=s,this},e._cifitem.prototype.getValues=function(){return this.looped?this.loop.getValuesByDataname(this.dataname):[this.value]},e._cifloop=function(e,t,n,r){return this.id=e,this.datablockid=t,this.loopheads=n,this.loopvalues=r,this},e._cifloop.prototype.getValuesByDataname=function(e){var t=this.loopheads.indexOf(e);if(t==-1)return[];var n=[],r=this.loopheads.length;for(var i=0;i<this.loopvalues.length;++i){var s=i;s>=r&&(s=i%r),s==t&&n.push(this.loopvalues[i])}return n},e.prototype.parseCif=function(t,n){function b(t,n,i){var s=i.replace(/^\s+|\s+$/g,""),o=[],u=s.substr(0,s.search(/(\s|$)/));return u=="_",i=i.substr(i.indexOf(u)+u.length),r&&(l+=i.substring(0,i.indexOf(u)).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")+'<span class="cif_dataitem"><span class="cif_dataname">'+u.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")+"</span>"),d=1,i=w(1,o,n,i),r&&(l+="</span>"),u=u.toLowerCase(),u.search(/^(_space_group_ssg_name|_space_group_ssg_name_it|_space_group_ssg_name_wjj|_space_group_symop_ssg_id|_space_group_symop_ssg_operation_algebraic|_space_group_symop.magn_ssg_id|_space_group_symop.magn_ssg_operation_algebraic|_space_group_symop.magn_ssg_centering_id|_space_group_symop.magn_ssg_centering_algebraic)$/)>-1&&(t.mscif=!0),t.cifitems[u]=new e._cifitem(u,u,a,o[0],!1),i}function w(e,t,n,i,s){var o="",u="",a="",c=/^\s*("|')(.*?)(\1)(\s|$)/,h=/^\s*([^\s]+)(\s|$)/,p=/^\s*(data_|loop_|save_|_)/i,v=!1;for(;;){if(i==""||i.replace(/^\s+|\s+$/g,"")==""){r&&(l+=i.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")+"\n");if(n.length==0)break;i=n.shift();if(i==undefined)break;f.push(i)}u=i.replace(/^\s+|\s+$/g,"");if(a=="")if(u.substr(0,1)=="#"||u=="")r&&(u.substr(0,1)=="#"?l+='<span class="cif_comment">'+i.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")+"</span>":l+=i.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")),i="";else{if(i.search(p)==0)break;if(i.search(/^\s*("|')/)==0){var g=i.match(c);if(g){r&&(l+=i.substring(0,g.index).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")+' <span class="cif_datavalue"><span class="cif_delimiter">'+g[1]+'</span><span class="cif_value">'+g[2].replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")+'</span><span class="cif_delimiter">'+g[3]+"</span></span> "),t.push(g[2]);var y=g.index+g[0].length;i=i.substr(y)}else r&&(l+=i.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")+'<span class="cif_error">#ERROR</span>'),m.push("ERROR: missing closing delimiter (line "+f.length+")"),t.push(i),i="";if(e==1)break}else if(i.indexOf(";")==0)v=!0,r&&(l+='<span class="cif_datavalue"><span class="cif_delimiter">;</span><span class="cif_value">'+i.substr(1).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")),o=i.substr(1)+"\n",a=";",i="";else{var g=i.match(h);if(g){r&&(l+=i.substring(0,g.index).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")+' <span class="cif_datavalue"><span class="cif_delimiter"></span><span class="cif_value">'+g[1].replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")+'</span><span class="cif_delimiter"></span></span> '),t.push(g[1]);var y=g.index+g[0].length;i=i.substr(y)}else r&&(l+=i.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")),t.push(i),i="";if(e==1)break}}else if(i.indexOf(";")==0){v=!1,r&&(l+='</span><span class="cif_delimiter">;</span></span>'),o.replace(/^;|\n$/g,""),i=i.substr(1),t.push(o),o="",a="";if(e==1){d=0;break}}else r&&(l+=i.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")),o+=i+"\n",i=""}return v&&(m.push("ERROR: unclosed data value (line "+f.length+")"),r&&(l+='</span><span class="cif_error">#ERROR</span></span>\n')),t.length==0&&(m.push("ERROR: missing data value (line "+f.length+")"),r&&(l+='<span class="cif_error">#ERROR</span>\n')),d=0,i}function E(e,t,n,r,i){var s="",o=/^\s*(data_|loop_|save_|_)/i;for(;;){if(r==""||r.replace(/^\s+|\s+$/g,"")==""){if(n.length==0)break;r=n.shift();if(r==undefined)break;f.push(r)}s=r.replace(/^\s+|\s+$/g,"");if(s.substr(0,1)=="#"||s=="")r="";else{if(s.search(o)==0)break;var u=s.replace(/\s+/g," ").split(" ");for(var a=0;a<u.length;a++)t.push(u[a]);r=""}}return r}function S(t,n,i){d=2;var s=[],o=[],u,c=!1,h=i.search(/loop_/i);r&&(l+=i.substring(0,h).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")+'<div class="cif_loop"><span class="cif_loop_keyword">loop_</span>'),i=i.substr(h+5);for(;;){if(i==""||i.replace(/^\s+|\s+$/g,"")==""){r&&(l+=i.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")+"\n");if(n.length==0)break;i=n.shift();if(i==undefined)break;f.push(i)}u=i.replace(/^\s+|\s+$/g,"");if(u.substr(0,5).toLowerCase()=="data_"||u.substr(0,5).toLowerCase()=="save_"){r&&(m.push("ERROR: found new datablock while looking for loop (line "+f.length+")"),l+="#ERROR:#\n");break}if(u.substr(0,5).toLowerCase()=="loop_"){m.push("ERROR: found loop_ keyword while already in loop (line "+f.length+")"),r&&(l+="#ERROR:#\n");break}if(u.substr(0,1)=="_"){var p=u.substr(0,u.search(/(\s|$)/));h=i.indexOf(p)+p.length,r&&(l+=i.substring(0,i.indexOf(p)).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")+'<span class="cif_dataname">'+p.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")+"</span>");var v=p.toLowerCase();o.push(v),v.indexOf("_atom_site.cartn_")==0&&(c=!0),i=i.substr(h)}else{if(u.substr(0,1)!="#"&&u!=""){t.mmcifmol&&c?i=E(0,s,n,i):i=w(0,s,n,i);break}r&&(u.substr(0,1)=="#"?l+='<span class="cif_comment">'+i.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")+"</span>":l+=i.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")),i=""}}d==2&&(d=0),s.length==0?m.push("ERROR: loop with no data values (line "+f.length+")"):o.length>0&&s.length%o.length!=0&&m.push("ERROR: loop imbalance (line "+f.length+")"),o.length==0&&m.push("ERROR: loop with no data names (line "+f.length+")"),r&&(l+="</div>");var g=o.join(" "),y=new e._cifloop(g,a,o,s);t.cifloops[g]=y;for(var b=0;b<o.length;b++)t.cifitems[o[b]]=new e._cifitem(g,o[b],a,null,!0,y);return g.indexOf("_atom_site_fract_")>-1&&(t.structure=!0),g.indexOf("_cifmol_atom_site_id")>-1&&(t.cifmol=!0),g.indexOf("_atom_site.cartn_")>-1&&(t.structure=!0,t.mmcif=!0),g.search(/(_space_group_ssg_name|_space_group_ssg_name_it|_space_group_ssg_name_wjj|_space_group_symop_ssg_id|_space_group_symop_ssg_operation_algebraic|_space_group_symop.magn_ssg_id|_space_group_symop.magn_ssg_operation_algebraic|_space_group_symop.magn_ssg_centering_id|_space_group_symop.magn_ssg_centering_algebraic)/)>-1&&(t.mscif=!0),i}var r=!1;n&&n.indexOf("tagged_html")>-1&&(r=!0),this.blocks=[];var i=t.replace(/\r\n/g,"\n").replace(/\r/g,"\n").split("\n"),s=new Date,o=parseInt(s.getTime()),u="",a="",f=[],l="",c="",h="",p=0,d=-1,v=!1,m=[];for(;;){p++;if(c==""||c.replace(/^\s*|\s*$/g,"")==""){r&&(l+=c.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")+"\n");if(i.length==0)break;c=i.shift();if(c==undefined)break;f.push(c)}p==1&&c.indexOf("#\\#MMCIFMOL")==0&&(v=!0),h=c.replace(/^\s*|\s*$/g,"");if(h=="")c="";else if(u=="")h.substr(0,5).toLowerCase()=="data_"?(d=0,u=h.substring(0,h.search(/(\s|$)/)),u.toLowerCase()=="data_"?(a="ERROR"+o++,m.push("ERROR: datablock with no ID (line "+f.length+")")):a=u.substr(5),this.blocks[a]=new e._block(a),this.blocks[a].mmcifmol=v,r&&(l+=c.substring(0,c.indexOf(u)).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")+'<div class="publcif_datablock"><span class="cif_datablock_id">data_'+a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")+"</span>"),c=c.substr(c.indexOf(u)+u.length)):h.substr(0,1)!="#"?(r&&(l+='<span class="cif_error">'+c.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")+"</span>"),m.push("ERROR: unexpected string before first data block (line "+f.length+")"),c=""):(r&&(l+=c.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")),c="");else if(h.substr(0,5).toLowerCase()=="data_"||h.substr(0,5).toLowerCase()=="save_"){d>0&&m.push("ERROR: expected data value but found a new data block (line "+f.length+")"),d=0;var g=h.substring(0,h.search(/(\s|$)/));if(g.toLowerCase()!="save_"){r&&(l+="</div>",this.blocks[a].taggedHTML=l,l="");var y=f.pop();this.blocks[a].rawdata=f.join("\n"),f.length=0,f.push(y),u=g,u.toLowerCase()=="data_"?(a="ERROR"+o++,m.push("ERROR: datablock with no ID (line "+f.length+")")):a=u.substr(5),r&&(l+='<div class="cif_datablock">'+c.substring(0,c.indexOf(u)).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")+'<span class="cif_datablock_id">data_'+a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")+"</span>"),c=c.substr(c.indexOf(u)+u.length),this.blocks[a]=new e._block(a)}else c=""}else h.substr(0,5).toLowerCase()=="loop_"?c=S(this.blocks[a],i,c):h.substr(0,1)=="_"?c=b(this.blocks[a],i,c):h.substr(0,1)=="#"?(r&&(l+='<span class="cif_comment">'+c.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")+"</span>"),c=""):(r&&(l+="#ERROR:"+c.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")),m.push("ERROR: unexpected string (line "+f.length+")"),c="")}d>0&&m.push("ERROR: expected data value but found end of file (line "+f.length+")"),r&&(l+="</div>",this.blocks[a].taggedHTML=l,l=""),this.blocks[a].rawdata=f.join("\n"),f.length=0},e.prototype._getValSu=function(e){e=e.replace(/^\s*\-\.(\d)/,"-0.$1"),e=e.replace(/^\s*\.(\d)/,"0.$1");var t="",n="",r="";e.match(/-[\d\.]+/g)&&(r="-");var i=e.match(/([\d\.]+)(\s*\(\d+\))?/);i!=null&&i.length>1&&(t=i[1]),i!=null&&i.length>2&&(n=i[2]);if(!t||t=="")return[0,0];if(!n||n=="")return[parseFloat(r+t),0];var s=0,o=t.match(/(\.\d+$)/);o!=null&&o.length>1&&(s=o[1].length-1),n=n.replace(/\(/g,""),n=n.replace(/\)/g,"");var u=parseInt(r+n),a=u/Math.pow(10,s);return isNaN(a)?[parseFloat(r+t),0]:[parseFloat(r+t),a]},e.prototype._quickRoundUp=function(e,t){var n=Math.pow(10,t||0),r=String(Math.round(e*n)/n),i=r.indexOf("."),s=0;i==-1?r+=t>0?".":"":s=r.length-i-1;for(var o=0;o<t-s;o++)r+="0";return r},e.prototype._xyzToUnitSu=function(e,t){var n=[0,0,0],r=this._xyzModulusSu(e,t);if(r[0]===0)return t?[[e[0],e[1],e[2]],[t[0],t[1],t[2]]]:[[e[0],e[1],e[2]],n];var i=e[0]/r[0],s=e[1]/r[0],o=e[2]/r[0],u=[i,s,o];if(t){var a=Math.sqrt((t[0]/e[0]*(t[0]/e[0])+r[1]/r[0]*(r[1]/r[0]))*i*i),f=Math.sqrt((t[1]/e[1]*(t[1]/e[1])+r[1]/r[0]*(r[1]/r[0]))*s*s),l=Math.sqrt((t[2]/e[2]*(t[2]/e[2])+r[1]/r[0]*(r[1]/r[0]))*o*o);n=[isNaN(a)?0:a,isNaN(f)?0:f,isNaN(l)?0:l]}return[u,n]},e.prototype._xyzModulusSu=function(e,t){var n=this._xyzDotSu(e,e,t,t),r=Math.sqrt(n[0]),i=0;return t&&(i=Math.sqrt(n[1]/n[0]*(n[1]/n[0])*.25*r*r)),isNaN(i)&&(i=0),[r,i]},e.prototype._xyzDotSu=function(e,t,n,r){var i=0,s=0;for(var o=0;o<3;o++){var u=e[o]*t[o];i+=u,n&&r&&(s+=(n[o]/e[o]*(n[o]/e[o])+r[o]/t[o]*(r[o]/t[o]))*u*u)}return n&&r&&(s=Math.sqrt(s)),isNaN(s)&&(s=0),[i,s]},e.prototype._xyzCrossSu=function(e,t,n,r){var i=e[1]*t[2],s=e[2]*t[1],o=i-s,u=0;if(n&&r){var a=Math.sqrt((n[1]/e[1]*(n[1]/e[1])+r[2]/t[2]*(r[2]/t[2]))*i*i),f=Math.sqrt((n[2]/e[2]*(n[2]/e[2])+r[1]/t[1]*(r[1]/t[1]))*s*s);u=Math.sqrt(a*a+f*f)}var l=e[2]*t[0],c=e[0]*t[2],h=l-c,p=0;if(n&&r){var d=Math.sqrt((n[2]/e[2]*(n[2]/e[2])+r[0]/t[0]*(r[0]/t[0]))*l*l),v=Math.sqrt((n[0]/e[0]*(n[0]/e[0])+r[2]/t[2]*(r[2]/t[2]))*c*c);p=Math.sqrt(d*d+v*v)}var m=e[0]*t[1],g=e[1]*t[0],y=m-g,b=0;if(n&&r){var w=Math.sqrt((n[0]/e[0]*(n[0]/e[0])+r[1]/t[1]*(r[1]/t[1]))*m*m),E=Math.sqrt((n[1]/e[1]*(n[1]/e[1])+r[0]/t[0]*(r[0]/t[0]))*g*g);b=Math.sqrt(w*w+E*E)}var S=[o,h,y],x=[isNaN(u)?0:u,isNaN(p)?0:p,isNaN(b)?0:b];return[S,x]},e.prototype._xyzSubtractSu=function(e,t,n,r){var i=[e[0]-t[0],e[1]-t[1],e[2]-t[2]],s=[0,0,0];if(n&&r){var o=Math.sqrt(n[0]*n[0]+r[0]*r[0]),u=Math.sqrt(n[0]*n[0]+r[1]*r[1]),a=Math.sqrt(n[2]*n[2]+r[2]*r[2]);s=[isNaN(o)?0:o,isNaN(u)?0:u,isNaN(a)?0:a]}return[i,s]},e.prototype._xyzApplyMatrix=function(e,t){return[t[0][0]*e[0]+t[0][1]*e[1]+t[0][2]*e[2],t[1][0]*e[0]+t[1][1]*e[1]+t[1][2]*e[2],t[2][0]*e[0]+t[2][1]*e[1]+t[2][2]*e[2]]},e.prototype._calcBondC=function(e,t,n,r){var i=t[0]-e[0],s=t[1]-e[1],o=t[2]-e[2],u=Math.sqrt(i*i+s*s+o*o),a=0;if(n&&r){var f=n[0]*n[0],l=r[0]*r[0],c=n[1]*n[1],h=r[1]*r[1],p=n[2]*n[2],d=r[2]*r[2],v=f+l,m=c+h,g=p+d,y=v*(i/u)*(i/u),b=m*(s/u)*(s/u),w=g*(o/u)*(o/u),E=y+b+w;a=Math.sqrt(E),isNaN(a)&&(a=0)}return[u,a]},e.prototype._calcAngleC=function(e,t,n,r,i,s){var o=this._calcBondC(e,t,r,i),u=o[0],a=o[1],f=this._calcBondC(t,n,i,s),l=f[0],c=f[1],h=this._calcBondC(e,n,r,s),p=h[0],d=h[1],v=u*u,m=l*l,g=p*p,y=v+m-g,b=2*u*l,w=y/b,E=Math.acos(w)*(180/Math.PI);if(a==0||c==0||d==0)return[E,0];var S=a/u*(a/u)*4*v*v,x=c/l*(c/l)*4*m*m,T=d/p*(d/p)*4*g*g,N=Math.sqrt(S+x+T),C=Math.sqrt((2*(a/u)*(a/u)+c/l*(c/l))*b*b),k=Math.sqrt((N/y*(N/y)+C/b*(C/b))*w*w),L=-1/Math.sqrt(1-w*w);return L=L*L*k*k,L=Math.sqrt(L)*(180/Math.PI),[E,isNaN(L)?0:L]},e.prototype._calcTorsionC=function(e,t,n,r,i,s,o,u){var a=this._xyzSubtractSu(e,t,i,s),f=this._xyzSubtractSu(t,n,s,o),l=this._xyzSubtractSu(n,r,o,u),c=a[0],h=f[0],p=l[0],d=a[1],v=f[1],m=l[1],g=this._xyzCrossSu(c,h,d,v),y=g[0],b=g[1],w=this._xyzCrossSu(h,p,v,m),E=w[0],S=w[1],x=this._xyzToUnitSu(y,b);y=x[0],b=x[1];var T=this._xyzToUnitSu(E,S);E=T[0],S=T[1];var N=this._xyzToUnitSu(h,v);h=N[0],v=N[1];var C=this._xyzCrossSu(y,h,b,v),k=C[0],L=C[1],A=this._xyzDotSu(y,E,b,S),O=this._xyzDotSu(k,E,L,S),M=Math.atan2(O[0],A[0])*(180/Math.PI),_=O[0],D=A[0],P=_*_,H=D*D,B=P+H,j=Math.sqrt(-_/B*(-_/B)*A[1]*A[1]+D/B*(D/B)*O[1]*O[1])*(180/Math.PI);return[M,isNaN(j)?0:j]},e}();(function(Scif){Scif.prototype._getCellData=function(e){var t={},n="",r="",i="",s="",o="",u="",a="";e.cifitems._symmetry_cell_setting&&(n=e.cifitems._symmetry_cell_setting.value),e.cifitems._cell_length_a&&(r=e.cifitems._cell_length_a.value),e.cifitems._cell_length_b&&(i=e.cifitems._cell_length_b.value),e.cifitems._cell_length_c&&(s=e.cifitems._cell_length_c.value),i.search(/^\s*[\.\?]*\s*$/)>-1&&(i=r),s.search(/^\s*[\.\?]*\s*$/)>-1&&(s=r),t.a=this._getValSu(r)[0],t.b=this._getValSu(i)[0],t.c=this._getValSu(s)[0],e.cifitems._cell_angle_alpha&&(o=e.cifitems._cell_angle_alpha.value),e.cifitems._cell_angle_beta&&(u=e.cifitems._cell_angle_beta.value),e.cifitems._cell_angle_gamma&&(a=e.cifitems._cell_angle_gamma.value);if(o.search(/^\s*[\.\?]*\s*$/)>-1||u.search(/^\s*[\.\?]*\s*$/)>-1||a.search(/^\s*[\.\?]*\s*$/)>-1)typeof n=="string"?(n=n.toUpperCase(),n=="RHOMBOHEDRAL"||n=="TRIGONAL"||n=="HEXAGONAL"?(o.search(/^\s*[\.\?]*\s*$/)>-1&&(o="90"),u.search(/^\s*[\.\?]*\s*$/)>-1&&(u="90"),a.search(/^\s*[\.\?]*\s*$/)>-1&&(a="120")):(o.search(/^\s*[\.\?]*\s*$/)>-1&&(o="90"),u.search(/^\s*[\.\?]*\s*$/)>-1&&(u="90"),a.search(/^\s*[\.\?]*\s*$/)>-1&&(a="90"))):(o.search(/^\s*[\.\?]*\s*$/)>-1&&(o="90"),u.search(/^\s*[\.\?]*\s*$/)>-1&&(u="90"),a.search(/^\s*[\.\?]*\s*$/)>-1&&(a="90"));t.alpha=this._getValSu(o)[0]*(Math.PI/180),t.beta=this._getValSu(u)[0]*(Math.PI/180),t.gamma=this._getValSu(a)[0]*(Math.PI/180),t.cosAlpha=Math.cos(t.alpha),t.sinAlpha=Math.sin(t.alpha),t.cosBeta=Math.cos(t.beta),t.sinBeta=Math.sin(t.beta),t.cosGamma=Math.cos(t.gamma),t.sinGamma=Math.sin(t.gamma);var f=Math.sqrt(t.sinAlpha*t.sinAlpha+t.sinBeta*t.sinBeta+t.sinGamma*t.sinGamma+2*t.cosAlpha*t.cosBeta*t.cosGamma-2);return t.volume=t.a*t.b*t.c*f,t.cA_=(t.cosAlpha-t.cosBeta*t.cosGamma)/t.sinGamma,t.cB_=f/t.sinGamma,t.a_=t.b*t.c*t.sinAlpha/t.volume,t.b_=t.a*t.c*t.sinBeta/t.volume,t.c_=t.a*t.b*t.sinGamma/t.volume,e.cell=t,t},Scif.prototype._getF2Cmatrix=function(e){if(!e)return null;if(e.F2Cmatrix)return e.F2Cmatrix;e.cell||this._getCellData(e);var t=e.cell.a,n=e.cell.b,r=e.cell.c,i=e.cell.alpha,s=e.cell.beta,o=e.cell.gamma,u=e.cell.cosAlpha,a=e.cell.cosBeta,f=e.cell.cosGamma;e._bpars={asq:t*t,bsq:n*n,csq:r*r,cosa2bc:u*2*n*r,cosb2ac:a*2*t*r,cosg2ab:f*2*t*n},e.calcBondF=function(e,t,n){return Math.sqrt(this._bpars.asq*e*e+this._bpars.bsq*t*t+this._bpars.csq*n*n+this._bpars.cosa2bc*t*n+this._bpars.cosb2ac*e*n+this._bpars.cosg2ab*e*t)};var l=Math.sin(o),c=t,h=n*f,p=r*a,d=0,v=n*l,m=r*(u-a*f)/l,g=0,y=0,b=r/l,w=u*u,E=a*a,S=f*f,x=1-(w+E+S)+2*u*a*f,T=Math.sqrt(x);b*=T;var N=[[c,h,p],[d,v,m],[g,y,b]];return e.F2Cmatrix=N,N},Scif.prototype._getF2CmatrixCell=function(e){return e?e.F2CmatrixCell?e.F2CmatrixCell:(e.F2Cmatrix||this._getF2Cmatrix(e),e.F2Cmatrix?(e.F2CmatrixCell=[[e.F2Cmatrix[0][0],0,0],[e.F2Cmatrix[0][1],e.F2Cmatrix[1][1],0],[e.F2Cmatrix[0][2],e.F2Cmatrix[1][2],e.F2Cmatrix[2][2]]],e.F2CmatrixCell):null):null},Scif.prototype._getC2Fmatrix=function(e){if(!e)return null;if(e.C2Fmatrix)return e.C2Fmatrix;e.cell||this._getCellData(e);var t=e.cell.a,n=e.cell.b,r=e.cell.c,i=e.cell.alpha,s=e.cell.beta,o=e.cell.gamma,u=e.cell.cosAlpha,a=e.cell.cosBeta,f=e.cell.cosGamma,l=Math.sin(o),c=u*u,h=a*a,p=f*f,d=1-(c+h+p)+2*u*a*f,v=1/(t*n*r*Math.sqrt(d)),m=1/t,g=-1*(f/(t*l)),y=(n*f*r*(u-a*f)/l-n*r*a*l)*v,b=0,w=1/(n*l),E=-1*(v*t*r*(u-a*f)/l),S=0,x=0,T=t*n/l*v,N=[[m,g,y],[b,w,E],[S,x,T]];return e.C2Fmatrix=N,N},Scif.prototype._getSymOps=function(e){function g(e){var t={},n=e.replace(/\s+/ig,"").replace(/[+-]\s*(,|$)/ig,"$1");n=n.toLowerCase(),t.full=n;var r=n.split(",");if(r.length!=3)return null;var i=b(n);t.rotmat=i[0],t.transvec=i[1],t.xpart=r[0],t.ypart=r[1],t.zpart=r[2];var s=y(t.xpart+"");if(!s)return null;t.xchar=s[0],t.xnum=s[1];var o=y(t.ypart+"");if(!o)return null;t.ychar=o[0],t.ynum=o[1];var u=y(t.zpart+"");return u?(t.zchar=u[0],t.znum=u[1],t):null}function y(e){var t=e,n=new RegExp("([-+]*[1-9]*[xyz])","gi"),r=t.match(n);if(!r||r.length==0)return null;var i="";for(var s=0;s<r.length;++s)i+=r[s];var o=t.replace(n,"");return[i,o]}function b(e){var t=[[0,0,0],[0,0,0],[0,0,0]],n=[0,0,0],r=e.replace(/\s+/ig,"").toLowerCase().split(","),i=new RegExp("([+-]?)(\\d*)/?(\\d*)([x-z])","gi"),s=new RegExp("([+-]?)(\\d+)/?(\\d*)(?![x-z])","gi");for(var o=0;o<r.length;o++){var u;while((u=i.exec(r[o]))!==null){var a=1;u[1]=="-"&&(a=-1),u[2]!=""&&(u[3]!=""?a*=parseFloat(u[2])/parseFloat(u[3]):a*=parseFloat(u[2]));var f=u[4].charCodeAt(0)-120;t[o][f]=a}var l;while((l=s.exec(r[o]))!==null){var a=1;l[1]=="-"&&(a=-1);var c=parseFloat(l[2]);l[3]!=""&&(c=parseFloat(l[2])/parseFloat(l[3])),n[o]+=c*a}}return[t,n]}if(!e)return null;if(e.symOps)return e.symOps;var t=[],n="_symmetry_equiv_pos_as_xyz",r="_space_group_symop.magn_ssg_centering_algebraic",i=e.cifitems[n],s=null;i||(n="_space_group_symop_operation_xyz",i=e.cifitems[n]);var o=!1;i||(n="_space_group_symop_ssg_operation_algebraic",i=e.cifitems[n],i&&(o=!0));if(!i){n="_space_group_symop.magn_ssg_operation_algebraic",i=e.cifitems[n],r="_space_group_symop.magn_ssg_centering_algebraic",s=e.cifitems[r];if(i||s)o=!0}if(!i)t.push("x,y,z");else if(!i.looped)t.push(i.value);else{var u=e.cifloops[i.id],a=u.loopheads.indexOf(n),f=u.loopvalues.length/u.loopheads.length,l=0;for(var c=0;c<f;++c)t.push(u.loopvalues[a+l]),l+=u.loopheads.length}if(s)if(!s.looped)t.push(s.value);else{var u=e.cifloops[s.id],a=u.loopheads.indexOf(r),f=u.loopvalues.length/u.loopheads.length,l=0;for(var c=0;c<f;++c)t.push(u.loopvalues[a+l]),l+=u.loopheads.length}var h=[];for(var p=0;p<t.length;p++){if(o){t[p]=t[p].replace(/x1/gi,"x"),t[p]=t[p].replace(/x2/gi,"y"),t[p]=t[p].replace(/x3/gi,"z");var d=t[p].split(",");if(d&&d.length>2){var v=d[0]+","+d[1]+","+d[2];t.indexOf(v)==-1?t[p]=v:t[p]=""}else t[p]=""}var m=g(t[p]);m&&(h[p+1]=m)}return e.symOps=h,h},Scif.prototype._transformSymCode=function(e,t){function h(e,t){var n="";if(e!=""){var r=e.indexOf("/");if(r>0){var i=e.match(/(^[^\d\-\+]*)([\-\+]?\d+)\/(\d+)([^\d]*$)/),s=i[2],o=i[3],u=parseInt(o)*t+parseInt(s);n=i[1]+"+"+u+"/"+o+i[4]}else{var a=parseInt(e)+t;a>0?n="+"+a:a<0?n=a+"":n=""}}else t>0?n="+"+t:t<0?n=t+"":n="";return n=String(n),n=n.replace(/[+][-]/g,"-"),n=n.replace(/[-][+]/g,"-"),n}if(!e)return null;e.symOps||this._getSymOps(e);if(!e.symOps)return null;var n=e.symOps,r={};t.search(/^\d+$/)==0&&(t+="_555");var i=t.match(/(\d+)_(\d)(\d)(\d)/);if(i){var s=n[parseInt(i[1])],o=parseInt(i[2])-5,u=parseInt(i[3])-5,a=parseInt(i[4])-5,f=h(String(s.xnum),o),l=h(String(s.ynum),u),c=h(String(s.znum),a),r={};return r.full=s.xchar+f+","+s.ychar+l+","+s.zchar+c,r.xpart=s.xchar+f,r.ypart=s.ychar+l,r.zpart=s.zchar+c,r.xchar=s.xchar,r.xnum=f,r.ychar=s.ychar,r.ynum=l,r.zchar=s.zchar,r.znum=c,r}return null},Scif.prototype._getGeomData=function(e){if(!e)return;var t=0,n=[],r=[],i=[],s=[],o=e.cifitems._geom_bond_distance;if(o){var u=e.cifloops[o.id],a=u.loopheads,f=u.loopvalues,l=a.indexOf("_geom_bond_atom_site_label_1"),c=a.indexOf("_geom_bond_atom_site_label_2"),h=a.indexOf("_geom_bond_site_symmetry_1"),p=a.indexOf("_geom_bond_site_symmetry_2"),d=a.indexOf("_geom_bond_distance");if(l==-1||c==-1||d==-1){e.geomdata={},e.geomdata.bonds=r,e.geomdata.bondcount=0,e.geomdata.bondsByLabel=i,e.geomdata.bondSites=s,e.geomdata.symRange=[5,5,5,5,5,5];return}for(var v=0;v<f.length;v+=a.length){var m=parseFloat(f[v+d]);if(m>3||m<.8)continue;var g=f[v+l],y=f[v+c],b="",w="";h>-1&&f[v+h]!="."&&f[v+h]!="?"?f[v+h].length<5?(b=f[v+h],w="555"):(b=f[v+h].substring(0,f[v+h].length-4),w=f[v+h].substring(f[v+h].length-3)):(b="1",w="555"),r[g+"_"+b+"_"+w]||(r[g+"_"+b+"_"+w]=[]);var E="",S="";p>-1&&f[v+p]!="."&&f[v+p]!="?"?f[v+p].length<5?(E=f[v+p],S="555"):(E=f[v+p].substring(0,f[v+p].length-4),S=f[v+p].substring(f[v+p].length-3)):(E="1",S="555"),r[y+"_"+E+"_"+S]||(r[y+"_"+E+"_"+S]=[]),n.indexOf(w)==-1&&n.push(w),n.indexOf(S)==-1&&n.push(S),i[g]||(i[g]=[]),i[g].indexOf(y)==-1&&(i[g].push(y),i[g].push(parseFloat(f[v+d]))),i[y]||(i[y]=[]),i[y].indexOf(g)==-1&&(i[y].push(g),i[y].push(parseFloat(f[v+d]))),r[g+"_"+b+"_"+w].indexOf(y+"_"+E+"_"+S)==-1&&(r[g+"_"+b+"_"+w].push(y+"_"+E+"_"+S),t++),r[y+"_"+E+"_"+S].indexOf(g+"_"+b+"_"+w)==-1&&(r[y+"_"+E+"_"+S].push(g+"_"+b+"_"+w),t++),w!="555"&&s.push([g,b,w]),S!="555"&&s.push([y,E,S])}}e.geomdata={},e.geomdata.bonds=r,e.geomdata.bondcount=t,e.geomdata.bondsByLabel=i,e.geomdata.bondSites=s;var x=5,T=5,N=5,C=5,k=5,L=5;if(n.length>0){for(var A=0;A<n.length;A++){var O=/.*(\d)(\d)(\d).*/.exec(n[A]);if(O){var M=parseInt(O[1]),_=parseInt(O[2]),D=parseInt(O[3]);M>x&&(x=M),M<C&&(C=M),_>T&&(T=_),_<k&&(k=_),D>N&&(N=D),D<L&&(L=D)}}txmin=C,tymin=k,tzmin=L,txmax=x,tymax=T,tzmax=N}e.geomdata.symRange=[C,k,L,x,T,N]},Scif.prototype._getModelSet=function(e,t,n,r){if(!e)return null;this.readyCallback=r;var i;if(typeof t=="string"){var s=t.match(/.*([2-8])([2-8])([2-8])\-?([2-8])([[2-8])([2-8]).*/);s?(i=[s[1],s[2],s[3],s[4],s[5],s[6]],t=i.join("")+""):t=null}e.model||this._getModelSites(e,i),i&&e.model.symRangeStr!=t&&this._getModelSites(e,i),e.mmcif&&n&&n.indexOf("cell")>-1&&(n="asu");var o;if(!n||n=="mol")e.model.mol?typeof this.readyCallback=="function"&&this.readyCallback():this._getModel(e,"mol");else if(n=="cell555")e.model.cell555?typeof this.readyCallback=="function"&&this.readyCallback():this._getModel(e,"cell555");else if(n=="cell5551")e.model.cell5551?typeof this.readyCallback=="function"&&this.readyCallback():this._getModel(e,"cell5551");else if(n=="asu")e.model.asu?typeof this.readyCallback=="function"&&this.readyCallback():this._getModel(e,"asu");else if(n.substr(0,6)=="biomol"){var u=parseInt(n.substr(6));e.model.biomols[u]?(e.model.mol=e.model.biomols[u].sites,typeof this.readyCallback=="function"&&this.readyCallback()):(e.getBiomol(u),e.model.mol=e.model.biomols[u].sites
,typeof this.readyCallback=="function"&&this.readyCallback())}},Scif.prototype._getModel=function(e,t){function g(t){if(l[t]){var r=l[t];for(var s in i){if(!i[s]||!i[s].fxyz||r==s)continue;if(i[r].bonds.indexOf(s)>-1)continue;var o=e.calcBondF(i[s].fxyz[0]-i[r].fxyz[0],i[s].fxyz[1]-i[r].fxyz[1],i[s].fxyz[2]-i[r].fxyz[2]);o<n.elements[i[r].elem].covRad+n.elements[i[s].elem].covRad+.4&&(i[r].bonds.push(s),i[s].bonds.push(r),i[r].bondOrder.push(1),i[s].bondOrder.push(1),a[i[r].atom]||(a[i[r].atom]=[]),a[i[r].atom].push(i[s].atom),a[i[r].atom].push(o),a[i[s].atom]||(a[i[s].atom]=[]),a[i[s].atom].push(i[r].atom),a[i[s].atom].push(o),f[i[r].atom]||(f[i[r].atom]=[]),f[i[r].atom].indexOf(i[s].atom)==-1&&f[i[r].atom].push(i[s].atom),f[i[s].atom]||(f[i[s].atom]=[]),f[i[s].atom].indexOf(i[r].atom)==-1&&f[i[s].atom].push(i[r].atom))}h.indexOf(r)==-1&&i[r].bonds.length>0&&(h[h.length]=r),t++,setTimeout(function(){g(t)},0)}else e.geomdata.bondsByLabel=a,e.geomdata.bonds=f,e.geomdata.bondcount=1,c=!1,setTimeout(function(){y(0)},0)}function y(t){if(!h[t]){var S={};if(r&&r!="mol"){for(var T in i){if(!i[T]&&!i[T].atom)continue;r=="cell5551"&&i[T].cell5551?(i[T].xyz=n._xyzApplyMatrix(i[T].fxyz,e.F2Cmatrix),i[T].xyzSu=n._xyzApplyMatrix(i[T].fxyzSu,e.F2Cmatrix),i[T].x=i[T].xyz[0],i[T].y=i[T].xyz[1],i[T].z=i[T].xyz[2],S[T]=i[T]):r=="cell555"&&i[T].cell555?(i[T].xyz=n._xyzApplyMatrix(i[T].fxyz,e.F2Cmatrix),i[T].xyzSu=n._xyzApplyMatrix(i[T].fxyzSu,e.F2Cmatrix),i[T].x=i[T].xyz[0],i[T].y=i[T].xyz[1],i[T].z=i[T].xyz[2],S[T]=i[T]):r=="asu"&&i[T].asu&&(i[T].xyz=n._xyzApplyMatrix(i[T].fxyz,e.F2Cmatrix),i[T].xyzSu=n._xyzApplyMatrix(i[T].fxyzSu,e.F2Cmatrix),i[T].x=i[T].xyz[0],i[T].y=i[T].xyz[1],i[T].z=i[T].xyz[2],S[T]=i[T])}r=="cell555"?e.model.cell555=S:r=="cell5551"?e.model.cell5551=S:r=="asu"&&(e.model.asu=S),typeof n.readyCallback=="function"&&n.readyCallback();return}for(var T in i){if(!i[T]&&!i[T].atom)continue;i[T].mol&&(S[T]=i[T])}if(s.length<20)for(var T in S){if(!S[T]&&!S[T].atom)continue;if(!n.elements[S[T].elem])continue;if(!n.elements[S[T].elem].type)continue;if(n.elements[S[T].elem].type<1)continue;if(!e.geomdata.bondsByLabel[S[T].atom])continue;o=b(S[T],o)}var N={};for(var T in i){if(!i[T]&&!i[T].atom)continue;i[T].extra&&(i[T].mol=1),i[T].mol&&(i[T].xyz=n._xyzApplyMatrix(i[T].fxyz,e.F2Cmatrix),i[T].xyzSu=n._xyzApplyMatrix(i[T].fxyzSu,e.F2Cmatrix),i[T].x=i[T].xyz[0],i[T].y=i[T].xyz[1],i[T].z=i[T].xyz[2],N[T]=i[T])}e.model.mol=N,typeof n.readyCallback=="function"&&n.readyCallback();return}var p=h[t];if(c){g(0);return}var d=l.indexOf(p);if(d>-1){var v=l[d];for(var m in i){if(!i[m]||!i[m].fxyz||v==m)continue;if(i[v].bonds.indexOf(m)>-1)continue;var w=e.calcBondF(i[m].fxyz[0]-i[v].fxyz[0],i[m].fxyz[1]-i[v].fxyz[1],i[m].fxyz[2]-i[v].fxyz[2]);w<n.elements[i[v].elem].covRad+n.elements[i[m].elem].covRad+.4&&(i[v].bonds.push(m),i[m].bonds.push(p),i[v].bondOrder.push(1),i[m].bondOrder.push(1),a[i[v].atom]||(a[i[v].atom]=[]),a[i[v].atom].push(i[m].atom),a[i[v].atom].push(w),a[i[m].atom]||(a[i[m].atom]=[]),a[i[m].atom].push(i[v].atom),a[i[m].atom].push(w),f[i[v].atom]||(f[i[v].atom]=[]),f[i[v].atom].indexOf(i[m].atom)==-1&&f[i[v].atom].push(i[m].atom),f[i[m].atom]||(f[i[m].atom]=[]),f[i[m].atom].indexOf(i[v].atom)==-1&&f[i[m].atom].push(i[v].atom))}h.indexOf(v)==-1&&i[v].bonds.length>0&&(h[h.length]=v)}if(!i[p].idx){o++,i[p].idx=o,i[p][u]=1;for(var m in i){if(!i[m]||!i[m].fxyz||p==m)continue;if(i[p].bonds.indexOf(m)>-1)continue;if(r=="mol"&&n.elements[i[p].elem].type<1&&i[p].symt!="555")continue;if(r=="cell5551"&&!i[m].cell1)continue;if(r=="cell555"&&i[m].symt!="555")continue;if(r=="asu"&&(i[m].symt!="555"||i[m].symop!=1))continue;if(e.geomdata.bondsByLabel[i[p].atom]){var E=e.geomdata.bondsByLabel[i[p].atom].indexOf(i[m].atom);if(E>-1){var w=e.calcBondF(i[m].fxyz[0]-i[p].fxyz[0],i[m].fxyz[1]-i[p].fxyz[1],i[m].fxyz[2]-i[p].fxyz[2]);if(w<n.elements[i[p].elem].covRad+n.elements[i[m].elem].covRad+.4||w<e.geomdata.bondsByLabel[i[p].atom][E+1]*1.1)i[p].bonds.push(m),i[m].bonds.push(p),i[p].bondOrder.push(1),i[m].bondOrder.push(1),i[m].idx||(o++,i[m].idx=o,i[m][u]=1,o=x(m,o,0,1))}}}}t++,setTimeout(function(){y(t)},0)}function b(t,r){if(!n.elements[t.elem])return r;if(n.elements[t.elem].type<1)return r;if(t.bonds.length>=n.elements[t.elem].type)return r;if(!e.geomdata.bondsByLabel[t.atom])return r;var o=e.geomdata.bondsByLabel[t.atom],u=o.length/2;u<n.elements[t.elem].type&&elem!="C"&&u!=3&&(u=n.elements[t.elem].type);if(t.bonds.length>=u)return r;var a=[],f=3,l=3,c=3,h=7,p=7,d=7;for(var v=0;v<o.length;v+=2)for(var m in s){var g=i[o[v]+"_"+m+"_555"];if(!g)continue;var y=g.atom;for(var S=f;S<=h;S++){var x=S-5,T=S+"55";if(!a[y+"_"+m+"_"+T]&&t!=i[y+"_"+m+"_"+T]&&t.extra&&i[y+"_"+m+"_"+T]&&i[y+"_"+m+"_"+T].extra&&t.bonds.indexOf(y+"_"+m+"_"+T)==-1){if(w(t,i[y+"_"+m+"_"+T],e.geomdata.bondsByLabel[t.atom][v+1]*1.1)&&t.bonds.length>=u)return r}else if(!i[y+"_"+m+"_"+T]&&!a[y+"_"+m+"_"+T]){i[y+"_"+m+"_"+T]=E(t,g,[x,0,0],e.geomdata.bondsByLabel[t.atom][v+1]*1.1);if(i[y+"_"+m+"_"+T]){r++,i[y+"_"+m+"_"+T].idx=r,i[y+"_"+m+"_"+T].extra=1,r=b(i[y+"_"+m+"_"+T],r);if(t.bonds.length>=u)return r}a[y+"_"+m+"_"+T]=1}for(var N=l;N<=p;N++){var C=N-5,T=S+""+N+"5";if(!a[y+"_"+m+"_"+T]&&t!=i[y+"_"+m+"_"+T]&&t.extra&&i[y+"_"+m+"_"+T]&&i[y+"_"+m+"_"+T].extra&&t.bonds.indexOf(y+"_"+m+"_"+T)==-1){if(w(t,i[y+"_"+m+"_"+T],e.geomdata.bondsByLabel[t.atom][v+1]*1.1)&&t.bonds.length>=u)return r}else if(!i[y+"_"+m+"_"+T]&&!a[y+"_"+m+"_"+T]){i[y+"_"+m+"_"+T]=E(t,g,[x,C,0],e.geomdata.bondsByLabel[t.atom][v+1]*1.1);if(i[y+"_"+m+"_"+T]){r++,i[y+"_"+m+"_"+T].idx=r,i[y+"_"+m+"_"+T].extra=1,r=b(i[y+"_"+m+"_"+T],r);if(t.bonds.length>=u)return r}a[y+"_"+m+"_"+T]=1}for(var k=c;k<=d;k++){var L=k-5,T=S+""+N+""+k;if(!a[y+"_"+m+"_"+T]&&t!=i[y+"_"+m+"_"+T]&&t.extra&&i[y+"_"+m+"_"+T]&&i[y+"_"+m+"_"+T].extra&&t.bonds.indexOf(y+"_"+m+"_"+T)==-1){if(w(t,i[y+"_"+m+"_"+T],e.geomdata.bondsByLabel[t.atom][v+1]*1.1)&&t.bonds.length>=u)return r}else if(!i[y+"_"+m+"_"+T]&&!a[y+"_"+m+"_"+T]){i[y+"_"+m+"_"+T]=E(t,g,[x,C,L],e.geomdata.bondsByLabel[t.atom][v+1]*1.1);if(i[y+"_"+m+"_"+T]){r++,i[y+"_"+m+"_"+T].idx=r,i[y+"_"+m+"_"+T].extra=1,r=b(i[y+"_"+m+"_"+T],r);if(t.bonds.length>=u)return r}a[y+"_"+m+"_"+T]=1}}}for(var k=c;k<=d;k++){var L=k-5,T=S+"5"+k;if(!a[y+"_"+m+"_"+T]&&t!=i[y+"_"+m+"_"+T]&&t.extra&&i[y+"_"+m+"_"+T]&&i[y+"_"+m+"_"+T].extra&&t.bonds.indexOf(y+"_"+m+"_"+T)==-1){if(w(t,i[y+"_"+m+"_"+T],e.geomdata.bondsByLabel[t.atom][v+1]*1.1)&&t.bonds.length>=u)return r}else if(!i[y+"_"+m+"_"+T]&&!a[y+"_"+m+"_"+T]){i[y+"_"+m+"_"+T]=E(t,g,[x,0,L],e.geomdata.bondsByLabel[t.atom][v+1]*1.1);if(i[y+"_"+m+"_"+T]){r++,i[y+"_"+m+"_"+T].idx=r,i[y+"_"+m+"_"+T].extra=1,r=b(i[y+"_"+m+"_"+T],r);if(t.bonds.length>=u)return r}a[y+"_"+m+"_"+T]=1}for(var N=l;N<=p;N++){var C=N-5,T=S+""+N+""+k;if(!a[y+"_"+m+"_"+T]&&t!=i[y+"_"+m+"_"+T]&&t.extra&&i[y+"_"+m+"_"+T]&&i[y+"_"+m+"_"+T].extra&&t.bonds.indexOf(y+"_"+m+"_"+T)==-1){if(w(t,i[y+"_"+m+"_"+T],e.geomdata.bondsByLabel[t.atom][v+1]*1.1)&&t.bonds.length>=u)return r}else if(!i[y+"_"+m+"_"+T]&&!a[y+"_"+m+"_"+T]){i[y+"_"+m+"_"+T]=E(t,g,[x,C,L],e.geomdata.bondsByLabel[t.atom][v+1]*1.1);if(i[y+"_"+m+"_"+T]){r++,i[y+"_"+m+"_"+T].idx=r,i[y+"_"+m+"_"+T].extra=1,r=b(i[y+"_"+m+"_"+T],r);if(t.bonds.length>=u)return r}a[y+"_"+m+"_"+T]=1}}}}}return r}function w(t,r,i){var s=e.calcBondF(t.fxyz[0]-r.fxyz[0],t.fxyz[1]-r.fxyz[1],t.fxyz[2]-r.fxyz[2]);return s<n.elements[t.elem].covRad+n.elements[r.elem].covRad+.4||s<i?(r.bonds.indexOf(t.atom+"_"+t.symop+"_"+t.symt)==-1&&(r.bonds.push(t.atom+"_"+t.symop+"_"+t.symt),r.bondOrder.push(1)),t.bonds.indexOf(r.atom+"_"+r.symop+"_"+r.symt)==-1&&(t.bonds.push(r.atom+"_"+r.symop+"_"+r.symt),t.bondOrder.push(1)),!0):!1}function E(t,r,i,s){var o=e.calcBondF(t.fxyz[0]-(r.fxyz[0]+i[0]),t.fxyz[1]-(r.fxyz[1]+i[1]),t.fxyz[2]-(r.fxyz[2]+i[2]));if(o<n.elements[t.elem].covRad+n.elements[r.elem].covRad+.4||o<s){var u={};u.fxyz=[r.fxyz[0]+i[0],r.fxyz[1]+i[1],r.fxyz[2]+i[2]],u.fxyzSu=r.fxyzSu,u.symop=r.symop,u.symc=[r.symc[0]+i[0],r.symc[1]+i[1],r.symc[2]+i[2]],u.symt=u.symc[0]+""+u.symc[1]+""+u.symc[2],u.xyz=[],u.atom=r.atom,u.elem=r.elem,u.bondOrder=[];if(e.geomdata.bonds[u.atom+"_"+u.symop+"_"+u.symt]){u.bonds=e.geomdata.bonds[u.atom+"_"+u.symop+"_"+u.symt];for(var a=0;a<u.bonds.length;a++)u.bondOrder.push(1)}else u.bonds=[];return u.bonds.push(t.atom+"_"+t.symop+"_"+t.symt),u.bondOrder.push(1),t.bonds.push(u.atom+"_"+u.symop+"_"+u.symt),t.bondOrder.push(1),u.occ=r.occ,u.dis_ass=r.dis_ass,u.dis_grp=r.dis_grp,u}return 0}function S(t,n){var r={};r.fxyz=[t.fxyz[0]+n[0],t.fxyz[1]+n[1],t.fxyz[2]+n[2]],r.fxyzSu=t.fxyzSu,r.symop=t.symop,r.symc=[t.symc[0]+n[0],t.symc[1]+n[1],t.symc[2]+n[2]],r.symt=r.symc[0]+""+r.symc[1]+""+r.symc[2],r.xyz=[],r.atom=t.atom,r.elem=t.elem,r.bondOrder=[];if(e.geomdata.bonds[r.atom+"_"+r.symop+"_"+r.symt]){r.bonds=e.geomdata.bonds[r.atom+"_"+r.symop+"_"+r.symt];for(var i=0;i<r.bonds.length;i++)r.bondOrder.push(1)}else r.bonds=[];return r.occ=t.occ,r.dis_ass=t.dis_ass,r.dis_grp=t.dis_grp,r}function x(t,r,s,o){if(o&&n.elements[i[t].elem].type<1)return r;for(var a in i){if(!i[a]||!i[a].fxyz||t==a)continue;if(i[t].bonds.indexOf(a)>-1)continue;if(o&&n.elements[i[a].elem].type<1)continue;if(s){if(s=="cell5551"&&!i[a].cell1)continue;if(s=="cell555"&&i[a].symt!="555")continue;if(s=="asu"&&(i[a].symt!="555"||i[a].symop!=1))continue}if(e.geomdata.bondsByLabel[i[t].atom]){var f=e.geomdata.bondsByLabel[i[t].atom].indexOf(i[a].atom);if(f>-1){var l=e.calcBondF(i[a].fxyz[0]-i[t].fxyz[0],i[a].fxyz[1]-i[t].fxyz[1],i[a].fxyz[2]-i[t].fxyz[2]);if(l<n.elements[i[t].elem].covRad+n.elements[i[a].elem].covRad+.4||l<e.geomdata.bondsByLabel[i[t].atom][f+1]*1.1)i[t].bonds.push(a),i[a].bonds.push(t),i[t].bondOrder.push(1),i[a].bondOrder.push(1),i[a].idx||(r++,i[a].idx=r,i[a][u]=1,o&&(r=x(a,r,s,o)))}}}return r}if(!e)return null;var n=this,r=t||"mol",i=e.model.sites,s=e.symOps,o=0,u=r,a={},f={},l=[],c=!1;if(!e.geomdata.bonds||e.geomdata.bondcount==0)c=!0;var h=[],p=0,d=0;for(var v in i){if(!i[v]||!i[v].fxyz)continue;var m=!1;r=="mol"?m=i[v].symt=="555"&&i[v].symop==1||i[v].bonds.length>0||i[v].cell1&&i[v].symop==1:r=="cell5551"?m=i[v].cell1:r=="cell555"?m=i[v].symt=="555":r=="asu"&&(m=i[v].symt=="555"&&i[v].symop==1),c?r=="cell5551"&&i[v].cell1?(l[d]=v,d++):i[v].symt=="555"&&(l[d]=v,d++):e.geomdata.bondsByLabel[i[v].atom]||(r=="cell5551"&&i[v].cell1?(l[d]=v,d++):i[v].symt=="555"&&(l[d]=v,d++)),m&&(i[v].idx=null,h[p]=v,p++)}y(0)},Scif.prototype._getUBparams=function(e){var t=e.cifitems._atom_site_aniso_label;t||(t=e.cifitems._atom_site_aniso_type_symbol);if(!t)return null;var n=e.cifloops[t.id],r=n.loopheads,i=n.loopvalues,s=r.indexOf("_atom_site_aniso_type_symbol"),o=r.indexOf("_atom_site_aniso_label");o==-1&&(o=s);if(o==-1)return null;var u=r.indexOf("_atom_site_aniso_u_11"),a=r.indexOf("_atom_site_aniso_u_22"),f=r.indexOf("_atom_site_aniso_u_33"),l=r.indexOf("_atom_site_aniso_u_12"),c=r.indexOf("_atom_site_aniso_u_13"),h=r.indexOf("_atom_site_aniso_u_23");if(u==-1||a==-1||f==-1||l==-1||c==-1||h==-1)return;var p=r.length,d=i.length/p,v=[],m=0;for(var g=0;g<d;++g){var y=i[m+o],b=this._getValSu(i[m+u])[0],w=this._getValSu(i[m+a])[0],E=this._getValSu(i[m+f])[0],S=this._getValSu(i[m+l])[0],x=this._getValSu(i[m+c])[0],T=this._getValSu(i[m+h])[0];m+=p,v[y]=[b,w,E,S,x,T]}e.adps=v},Scif.prototype._getModelSitesM=function(e){function Ot(e,t,n,r){var i=r[0][0]*e+r[1][0]*t+r[2][0]*n+r[3][0],s=r[0][1]*e+r[1][1]*t+r[2][1]*n+r[3][1],o=r[0][2]*e+r[1][2]*t+r[2][2]*n+r[3][2];return[i,s,o]}var t=e.cifitems["_atom_site.id"];if(!t)return null;var n=e.cifloops[t.id];if(!n)return null;var r=n.loopheads,i=n.loopvalues,s=r.indexOf("_atom_site.id"),o=r.indexOf("_atom_site.label_alt_id"),u=r.indexOf("_atom_site.occupancy"),a=r.indexOf("_atom_site.type_symbol"),f=r.indexOf("_atom_site.label_atom_id");f==-1&&(f=a);if(f==-1)return null;var l=r.indexOf("_atom_site.cartn_x"),c=r.indexOf("_atom_site.cartn_y"),h=r.indexOf("_atom_site.cartn_z"),p=r.indexOf("_atom_site.b_iso_or_equiv"),d=r.indexOf("_atom_site.label_comp_id"),v=r.indexOf("_atom_site.label_seq_id"),m=r.indexOf("_atom_site.label_asym_id"),g=r.indexOf("_atom_site.auth_seq_id"),y=r.indexOf("_atom_site.auth_asym_id"),b=r.indexOf("_atom_site.group_pdb"),w=r.length,E=i.length/w,S=[],x=-1,T=[],N=0;for(var C=0;C<E;++C){if(o>-1&&i[N+o]!="."&&i[N+o].toUpperCase()!="A"){N+=w;continue}var k=i[N+d],L=this._getValSu(i[N+l])[0],A=this._getValSu(i[N+c])[0],O=this._getValSu(i[N+h])[0],M="";a>-1?M=i[N+a]:M=i[N+f].replace(/[^A-Za-z]/g,""),M.length>1&&(M=M.substring(0,1).toUpperCase()+M.substring(1).toLowerCase());var _=i[N+f];this.elements[M]||(M=M.replace(/^\s*|\s*$/g,"").replace(/[^A-Za-z]/g,""),M=M.replace(/^([A-Z][a-z]{0,3}).*$/g,"$1"),M.length>1&&(M=M.substring(0,1).toUpperCase()+M.substring(1).toLowerCase()),this.elements[M]||(M="Xx"));var D=!1;b>-1&&i[N+b].toLowerCase().indexOf("het")>-1&&(D=!0);var P=i[N+m],H=parseInt(i[N+v]),B=null,F=null;D&&g>-1&&y>-1&&(B=parseInt(i[N+g]),F=i[N+y]),x++;var I=x,q=this._getValSu(i[N+p])[0];S[I]={resn:k,x:L,y:A,z:O,elem:M,hetflag:D,chain:P,resi:H,idx:I,atom:_,ss:"c",color:16777215,bonds:[],bondOrder:[],b:q,resiA:B,chainA:F},T[k+"_"+H+"_"+P]||(T[k+"_"+H+"_"+P]=[]),T[k+"_"+H+"_"+P].push(I),N+=w}var R=e.getBioligandData();e.ligands=[];if(R)for(var U in R){if(U.toUpperCase()=="HOH")continue;var z=[];e.ligands[U]=[];for(var N in S){var W=S[N];if(W==undefined)continue;W.resn==U&&(z[W.resn+"_"+W.resi+"_"+W.chain]||(z[W.resn+"_"+W.resi+"_"+W.chain]=[]),z[W.resn+"_"+W.resi+"_"+W.chain].push(W.idx))}for(var X in z){var V=[],$=0,J={name:X,siteids:[],dims:[],pocketids:[],pocketdims:[],assembly:"asu"},K=z[X];J.siteids=K;var Q,G,Y,Z,et,tt,nt=ysum=zsum=cnt=0;for(var rt=0;rt<K.length;rt++){var it=S[K[rt]];it.ligandid=X,it.ligandidA=it.resn+"_"+it.resiA+"_"+it.chainA,rt==0&&(Z=it.x,et=it.y,tt=it.z,Q=it.x,G=it.y,Y=it.z),it.x<Z&&(Z=it.x),it.y<et&&(et=it.y),it.z<tt&&(tt=it.z),it.x>Q&&(Q=it.x),it.y>G&&(G=it.y),it.z>Y&&(Y=it.z),cnt++,nt+=it.x,ysum+=it.y,zsum+=it.z;for(var st=rt+1;st<K.length;st++){var ot=S[K[st]],ut=Math.sqrt((it.x-ot.x)*(it.x-ot.x)+(it.y-ot.y)*(it.y-ot.y)+(it.z-ot.z)*(it.z-ot.z));ut<(this.elements[it.elem].covRad+this.elements[ot.elem].covRad)*1.3&&(it.bonds.push(K[st]),it.bondOrder.push(1),ot.bonds.push(K[rt]),ot.bondOrder.push(1))}for(var N in S){var ot=S[N];if(ot==undefined)continue;if(ot.resn!=it.resn&&!ot.hetflag&&!V[ot.idx]){var ut=Math.sqrt((it.x-ot.x)*(it.x-ot.x)+(it.y-ot.y)*(it.y-ot.y)+(it.z-ot.z)*(it.z-ot.z));ut<6&&(V[ot.idx]=ot.idx,$++)}}}J.dims=[[Z,et,tt],[Q,G,Y],[nt/cnt,ysum/cnt,zsum/cnt]];var at=[],ft=[];ft.length=0;for(var lt in V){at[S[lt].resn+"_"+S[lt].resi+"_"+S[lt].chain]||(at[S[lt].resn+"_"+S[lt].resi+"_"+S[lt].chain]=[]),at[S[lt].resn+"_"+S[lt].resi+"_"+S[lt].chain].indexOf(lt)==-1&&at[S[lt].resn+"_"+S[lt].resi+"_"+S[lt].chain].push(lt),ft.push(lt);if(T[S[lt].resn+"_"+S[lt].resi+"_"+S[lt].chain])for(var N=0;N<T[S[lt].resn+"_"+S[lt].resi+"_"+S[lt].chain].length;N++){var ot=S[T[S[lt].resn+"_"+S[lt].resi+"_"+S[lt].chain][N]];if(ot==undefined)continue;if(!V[ot.idx]&&ot.resn==S[lt].resn&&ot.resi==S[lt].resi&&ot.chain==S[lt].chain){if(at[S[lt].resn+"_"+S[lt].resi+"_"+S[lt].chain].indexOf(ot.idx)>-1)continue;at[S[lt].resn+"_"+S[lt].resi+"_"+S[lt].chain].push(ot.idx),ft.push(ot.idx),$++}}}var ct,ht,pt,dt,vt,mt;for(var gt=0;gt<ft.length;gt++){var yt=S[ft[gt]];gt==0&&(dt=yt.x,vt=yt.y,mt=yt.z,ct=yt.x,ht=yt.y,pt=yt.z),yt.x<dt&&(dt=yt.x),yt.y<vt&&(vt=yt.y),yt.z<mt&&(mt=yt.z),yt.x>ct&&(ct=yt.x),yt.y>ht&&(ht=yt.y),yt.z>pt&&(pt=yt.z)}J.pocketids=ft.slice(0),J.pocketdims=[[dt,vt,mt],[ct,ht,pt]];for(var bt in at){var K=at[bt];for(var rt=0;rt<K.length;rt++){var it=S[K[rt]];it.pocket=!0;for(var st=rt+1;st<K.length;st++){var ot=S[K[st]];ot.pocket=!0;var ut=Math.sqrt((it.x-ot.x)*(it.x-ot.x)+(it.y-ot.y)*(it.y-ot.y)+(it.z-ot.z)*(it.z-ot.z));ut<(this.elements[it.elem].covRad+this.elements[ot.elem].covRad)*1.3&&(it.bonds.push(K[st]),it.bondOrder.push(1),ot.bonds.push(K[rt]),ot.bondOrder.push(1))}}}e.ligands[U][J.name]=J}}var wt=[];t=e.cifitems["_struct_conf.conf_type_id"];if(t){var n=e.cifloops[t.id],r=[],i=[];if(!n){i.push(t.value),r=["_struct_conf.conf_type_id","_struct_conf.beg_label_asym_id","_struct_conf.end_label_asym_id","_struct_conf.beg_label_seq_id","_struct_conf.end_label_seq_id"];for(var ut=1;ut<r.length;ut++){var Et=e.cifitems[r[ut]];Et?i.push(Et.value):i.push("?")}}else r=n.loopheads,i=n.loopvalues;var St=r.indexOf("_struct_conf.conf_type_id"),xt=r.indexOf("_struct_conf.beg_label_asym_id"),Tt=r.indexOf("_struct_conf.end_label_asym_id"),Nt=r.indexOf("_struct_conf.beg_label_seq_id"),Ct=r.indexOf("_struct_conf.end_label_seq_id"),w=r.length,E=i.length/w,N=0;for(var C=0;C<E;++C){if(St==-1||xt==-1||Tt==-1||Nt==-1||Ct==-1){N+=w;continue}if(i[N+St].toUpperCase().indexOf("HELX")==-1){N+=w;continue}wt.push([i[N+xt],parseInt(i[N+Nt]),i[N+Tt],parseInt(i[N+Ct])]),N+=w}}var kt=[];t=e.cifitems["_struct_sheet_range.sheet_id"];if(t){var n=e.cifloops[t.id],r=[],i=[];if(!n){i.push(t.value),r=["_struct_sheet_range.sheet_id","_struct_sheet_range.beg_label_asym_id","_struct_sheet_range.end_label_asym_id","_struct_sheet_range.beg_label_seq_id","_struct_sheet_range.end_label_seq_id"];for(var ut=1;ut<r.length;ut++){var Et=e.cifitems[r[ut]];Et?i.push(Et.value):i.push("?")}}else r=n.loopheads,i=n.loopvalues;var St=r.indexOf("_struct_sheet_range.sheet_id"),xt=r.indexOf("_struct_sheet_range.beg_label_asym_id"),Tt=r.indexOf("_struct_sheet_range.end_label_asym_id"),Nt=r.indexOf("_struct_sheet_range.beg_label_seq_id"),Ct=r.indexOf("_struct_sheet_range.end_label_seq_id"),w=r.length,E=i.length/w,N=0;for(var C=0;C<E;++C){if(St==-1||xt==-1||Tt==-1||Nt==-1||Ct==-1){N+=w;continue}kt.push([i[N+xt],parseInt(i[N+Nt]),i[N+Tt],parseInt(i[N+Ct])]),N+=w}}for(var N in S){var W=S[N];if(W==undefined)continue;for(j=0;j<kt.length;j++){if(W.chain!=kt[j][0])continue;if(W.resi<kt[j][1])continue;if(W.resi>kt[j][3])continue;W.ss="s",W.resi==kt[j][1]&&(W.ssbegin=!0),W.resi==kt[j][3]&&(W.ssend=!0)}for(j=0;j<wt.length;j++){if(W.chain!=wt[j][0])continue;if(W.resi<wt[j][1])continue;if(W.resi>wt[j][3])continue;W.ss="h",W.resi==wt[j][1]?W.ssbegin=!0:W.resi==wt[j][3]&&(W.ssend=!0)}}var Lt=[];Lt=e.getBiomolData(),e.assemblies=[];for(var gt in Lt){if(Lt[gt].id==undefined)continue;if(Lt[gt].ops&&Lt[gt].ops.length>10)continue;e.assemblies.push(Lt[gt])}var At=[];e.model={},e.model.sites=S,e.model.symRangeStr="",e.model.biomols=At,e.model.mol=S,e.model.asu=S,e.model.cell555=null,e.model.cell5551=null},Scif.prototype._getCifMolModels=function(e){var t=e.cifitems._cifmol_atom_site_id;if(!t)return!1;this._getF2Cmatrix(e),this._getF2CmatrixCell(e),this._getC2Fmatrix(e),e.adps||this._getUBparams(e),this._getSymOps(e);var n=[],r=e.cifloops[t.id],i=r.loopheads,s=r.loopvalues,o={},u={},a=i.indexOf("_cifmol_atom_site_type_symbol"),f=i.indexOf("_cifmol_atom_site_id"),l=i.indexOf("_cifmol_atom_site_cartn_x"),c=i.indexOf("_cifmol_atom_site_cartn_y"),h=i.indexOf("_cifmol_atom_site_cartn_z"),p=i.indexOf("_cifmol_atom_site_connected_sites"),d=i.indexOf("_cifmol_atom_site_connected_sites_types"),v=i.indexOf("_cifmol_atom_site_model_ids"),m=i.indexOf("_cifmol_atom_site_disorder_assembly"),g=i.indexOf("_cifmol_atom_site_disorder_group"),y=i.indexOf("_cifmol_atom_site_occupancy");if(a==-1||f==-1||l==-1||h==-1||p==-1||d==-1||v==-1)return null;var b=i.length,w=s.length/b,E=0,S=0,x={};for(var T=0;T<w;++T){var N={};N.asu=!1,N.cell=!1,N.mol=!1,N.idx=S++,N.elem=s[E+a],N.atom=s[E+f].replace(/_\d+_\d\d\d$/g,"");var C=s[E+f].split("_");C&&C.length>2&&(N.symop=C[C.length-2],N.symt=C[C.length-1]),N.x=parseFloat(s[E+l]),N.y=parseFloat(s[E+c]),N.z=parseFloat(s[E+h]),N.xyz=[N.x,N.y,N.z],N.bonds=[];if(s[E+p]!="."){var k=s[E+p].split(",");if(k.length<12){N.bonds=k;var L=N.atom;n[L]||(n[L]=[]);for(var A=0;A<k.length;A++){var O=k[A].replace(/_\d+_\d\d\d$/g,"");n[L].indexOf(O)==-1&&(n[L].push(O),n[L].push(0)),n[O]||(n[O]=[]),n[O].indexOf(L)==-1&&(n[O].push(L),n[O].push(0))}}}N.bondOrder=[];if(s[E+d]!="."){var M=s[E+d].split(",");M.length<12&&(N.bondOrder=M)}if(N.bonds.length!=N.bondOrder.length)for(var _=0;_<N.bonds.length;_++)N.bondOrder.push(1);s[E+v].indexOf("asu")>-1&&(N.asu=!0),s[E+v].indexOf("mol")>-1&&(N.mol=!0),s[E+v].indexOf("cell1")>-1&&(N.cell1=!0),s[E+v].indexOf("cell555")>-1&&(N.cell555=!0),N.dis_ass=".",N.dis_grp=".",N.occ=1,m>-1&&(N.dis_ass=s[E+m]),g>-1&&(N.dis_grp=s[E+g]),y>-1&&s[E+y]!="."&&s[E+y]!="?"&&(N.occ=parseFloat(s[E+y])),x[s[E+f]]=N,E+=b}var D={},P={},H={},B={},j=0,F=0;for(var I in x){D[I]=x[I];var q=x[I].atom;e.adps&&e.adps[q]&&(x[I].adp=e.adps[q]),x[I].mol&&(P[I]=x[I],j++),x[I].cell1&&(B[I]=x[I],F++),x[I].cell555&&(H[I]=x[I])}return e.model={},e.model.sites=x,e.model.symRangeStr="",e.model.mol=P,e.model.molsize=j,e.model.asu=D,e.model.cell555=H,e.model.cell5551=B,e.model.cellsize=F,e.geomdata={},e.geomdata.bondsByLabel=n,!0},Scif.prototype._getMoieties=function(e){var t=e.cifitems._cifmol_moiety_id;if(!t)return!1;var n=e.cifloops[t.id],r=n.loopheads,i=n.loopvalues,s={},o={},u=r.indexOf("_cifmol_moiety_id"),a=r.indexOf("_cifmol_moiety_site_id"),f=r.indexOf("_cifmol_moiety_symops");if(u==-1||a==-1||f==-1)return!1;var l=r.length,c=i.length/l,h=0,p=0,d=[];for(var v=0;v<c;++v){var m=i[h+f].split(","),g=i[h+a].split(",");for(var y=0;y<m.length;y++){var b={};p++,b.idx=i[h+u],b.id=p,b.labels=g,b.symops=[m[y]],b.size=g.length,b.formula="",d.push(b)}h+=l}return e.moieties=d,!0},Scif.prototype._getModelSites=function(cifblock,symrange){function _siteFromSite(e,t){var n={};n.fxyz=[e.fxyz[0]+t[0],e.fxyz[1]+t[1],e.fxyz[2]+t[2]],n.fxyzSu=e.fxyzSu,n.symop=e.symop,n.symc=[e.symc[0]+t[0],e.symc[1]+t[1],e.symc[2]+t[2]],n.symt=n.symc[0]+""+n.symc[1]+""+n.symc[2],n.xyz=[],n.atom=e.atom,n.elem=e.elem,n.adp=e.adp,n.bondOrder=[];if(cifblock.geomdata.bonds[n.atom+"_"+n.symop+"_"+n.symt]){n.bonds=cifblock.geomdata.bonds[n.atom+"_"+n.symop+"_"+n.symt];for(var r=0;r<n.bonds.length;r++)n.bondOrder.push(1)}else n.bonds=[];return n.dis_ass=e.dis_ass,n.dis_grp=e.dis_grp,n.occ=e.occ,n}if(!cifblock)return null;this._getMoieties(cifblock);if(cifblock.mmcif){this._getModelSitesM(cifblock);return}if(cifblock.cifmol&&this._getCifMolModels(cifblock,symrange))return;this._getF2Cmatrix(cifblock),this._getF2CmatrixCell(cifblock),this._getGeomData(cifblock),this._getSymOps(cifblock),cifblock.adps||this._getUBparams(cifblock),symrange||(symrange=cifblock.geomdata.symRange);var txmin=symrange[0],tymin=symrange[1],tzmin=symrange[2],txmax=symrange[3],tymax=symrange[4],tzmax=symrange[5],litem=cifblock.cifitems._atom_site_label;litem||(litem=cifblock.cifitems._atom_site_type_symbol);if(!litem)return null;var loop=cifblock.cifloops[litem.id],dns=loop.loopheads,dvs=loop.loopvalues,sites={},asites={},ia=dns.indexOf("_atom_site_type_symbol"),il=dns.indexOf("_atom_site_label");il==-1&&(il=ia);if(il==-1)return null;var ix=dns.indexOf("_atom_site_fract_x"),iy=dns.indexOf("_atom_site_fract_y"),iz=dns.indexOf("_atom_site_fract_z"),disa=dns.indexOf("_atom_site_disorder_assembly"),disg=dns.indexOf("_atom_site_disorder_group"),diso=dns.indexOf("_atom_site_occupancy"),cc=dns.length,rows=dvs.length/cc,sym=cifblock.symOps,offsets=[],si=0;for(var sc in sym){var sumx=0,sumy=0,sumz=0,i=0;if(!sym[sc].full)continue;si++;for(var r=0;r<rows;++r){var vsx=this._getValSu(dvs[i+ix]),vsy=this._getValSu(dvs[i+iy]),vsz=this._getValSu(dvs[i+iz]),x=vsx[0],y=vsy[0],z=vsz[0],nx=eval(sym[sc].xpart),ny=eval(sym[sc].ypart),nz=eval(sym[sc].zpart),elem="";ia>-1?elem=dvs[i+ia]:(elem=dvs[i+il].replace(/^\s*|\s*$/g,"").replace(/[^A-Za-z]/g,""),elem=elem.replace(/^([A-Z][a-z]{0,3}).*$/g,"$1")),this.elements[elem]||(elem=elem.replace(/^\s*|\s*$/g,"").replace(/[^A-Za-z]/g,""),elem=elem.replace(/^([A-Z][a-z]{0,3}).*$/g,"$1"),elem.length>1&&(elem=elem.substring(0,1).toUpperCase()+elem.substring(1).toLowerCase()),this.elements[elem]||(elem="Xx"));var asite={};sumx+=nx,sumy+=ny,sumz+=nz;var symt="555",asite={};asite.fxyz=[nx,ny,nz],asite.fxyzSu=[vsx[1],vsy[1],vsz[1]],asite.symop=si,asite.symc=[5,5,5],asite.symt="555",asite.xyz=[],asite.cell1=!0,asite.atom=dvs[i+il],asite.elem=elem,cifblock.adps&&cifblock.adps[asite.atom]&&(asite.adp=cifblock.adps[asite.atom]),asite.bondOrder=[];if(cifblock.geomdata.bonds[dvs[i+il]+"_"+si+"_"+symt]){asite.bonds=cifblock.geomdata.bonds[dvs[i+il]+"_"+si+"_"+symt];for(var b=0;b<asite.bonds.length;b++)asite.bondOrder.push(1)}else asite.bonds=[];asite.dis_ass=".",asite.dis_grp=".",asite.occ=1,disa>-1&&(asite.dis_ass=dvs[i+disa]),disg>-1&&(asite.dis_grp=dvs[i+disg]),diso>-1&&dvs[i+diso]!="."&&dvs[i+diso]!="?"&&(asite.occ=parseFloat(dvs[i+diso])),sites[dvs[i+il]+"_"+si+"_"+symt]=asite,i+=cc}var cx=sumx/rows,cy=sumy/rows,cz=sumz/rows,ox=0,oy=0,oz=0;while(cx<-0.0001||cx>=1.0001)ox+=cx<0?1:-1,cx+=cx<0?1:-1;while(cy<-0.0001||cy>=1.0001)oy+=cy<0?1:-1,cy+=cy<0?1:-1;while(cz<-0.0001||cz>=1.0001)oz+=cz<0?1:-1,cz+=cz<0?1:-1;offsets[sc]=[ox,oy,oz,5+ox+""+(5+oy)+""+(5+oz)]}for(var as in sites){if(!sites[as]||sites[as].symop==undefined)continue;var si=sites[as].symop;if(!offsets[si]||offsets[si][3]=="555")continue;sites[as].cell1=!1,sites[sites[as].atom+"_"+si+"_"+offsets[si][3]]||(sites[sites[as].atom+"_"+si+"_"+offsets[si][3]]=_siteFromSite(sites[as],offsets[si]),sites[sites[as].atom+"_"+si+"_"+offsets[si][3]].cell1=!0)}if(cifblock.moieties){var mc=0;for(var m=0;m<cifblock.moieties.length;m++)for(var s=0;s<cifblock.moieties[m].symops.length;s++){var so=cifblock.moieties[m].symops[s],sn=so.split("_")[0],dxyz=so.split("_")[1].split("");for(var l=0;l<cifblock.moieties[m].labels.length;l++){var lbl=cifblock.moieties[m].labels[l];sites[lbl+"_"+so]||(sites[lbl+"_"+so]=_siteFromSite(sites[lbl+"_"+sn+"_555"],[parseInt(dxyz[0])-5,parseInt(dxyz[1])-5,parseInt(dxyz[2])-5,so])),sites[lbl+"_"+so].cell1=!0,sites[lbl+"_"+so].moiety=cifblock.moieties[m].id}}cifblock.model={},cifblock.model.sites=sites,cifblock.model.symRangeStr=symrange.join("")+"",cifblock.model.mol=null,cifblock.model.asu=null,cifblock.model.cell555=null,cifblock.model.cell5551=null;return}for(var as in sites){if(!sites[as]||sites[as].symop==undefined)continue;var si=sites[as].symop,lbl=sites[as].atom;for(var xt=txmin;xt<=txmax;xt++){var dx=xt-5,symt=xt+"55";sites[lbl+"_"+si+"_"+symt]||(sites[lbl+"_"+si+"_"+symt]=_siteFromSite(sites[as],[dx,0,0,symt]));for(var yt=tymin;yt<=tymax;yt++){var dy=yt-5,symt=xt+""+yt+"5";sites[lbl+"_"+si+"_"+symt]||(sites[lbl+"_"+si+"_"+symt]=_siteFromSite(sites[as],[dx,dy,0,symt]));for(var zt=tzmin;zt<=tzmax;zt++){var dz=zt-5,symt=xt+""+yt+""+zt;sites[lbl+"_"+si+"_"+symt]||(sites[lbl+"_"+si+"_"+symt]=_siteFromSite(sites[as],[dx,dy,dz,symt]))}}for(var zt=tzmin;zt<=tzmax;zt++){var dz=zt-5,symt=xt+"5"+zt;sites[lbl+"_"+si+"_"+symt]||(sites[lbl+"_"+si+"_"+symt]=_siteFromSite(sites[as],[dx,0,dz,symt]));for(var yt=tymin;yt<=tymax;yt++){var dy=yt-5,symt=xt+""+yt+""+zt;sites[lbl+"_"+si+"_"+symt]||(sites[lbl+"_"+si+"_"+symt]=_siteFromSite(sites[as],[dx,dy,dz,symt]))}}}}cifblock.model={},cifblock.model.sites=sites,cifblock.model.symRangeStr=symrange.join("")+"",cifblock.model.mol=null,cifblock.model.asu=null,cifblock.model.cell555=null,cifblock.model.cell5551=null};var elem={};elem.Xx={atomNo:0,vdwRad:1,covRad:0,type:0},elem.H={atomNo:1,vdwRad:1.2,covRad:.23,type:1},elem.D={atomNo:1,vdwRad:1.2,covRad:.23,type:1},elem.T={atomNo:1,vdwRad:1.2,covRad:.23,type:1},elem.He={atomNo:2,vdwRad:1.4,covRad:.93,type:1},elem.Li={atomNo:3,vdwRad:1.82,covRad:.68,type:0},elem.Be={atomNo:4,vdwRad:1.7,covRad:.35,type:0},elem.B={atomNo:5,vdwRad:2.08,covRad:.83,type:3},elem.C={atomNo:6,vdwRad:1.95,covRad:.68,type:4},elem.N={atomNo:7,vdwRad:1.85,covRad:.68,type:3},elem.O={atomNo:8,vdwRad:1.7,covRad:.68,type:2},elem.F={atomNo:9,vdwRad:1.73,covRad:.64,type:1},elem.Ne={atomNo:10,vdwRad:1.54,covRad:1.12,type:1},elem.Na={atomNo:11,vdwRad:2.27,covRad:.97,type:0},elem.Mg={atomNo:12,vdwRad:1.73,covRad:1.1,type:0},elem.Al={atomNo:13,vdwRad:2.05,covRad:1.35,type:0},elem.Si={atomNo:14,vdwRad:2.1,covRad:1.2,type:4},elem.P={atomNo:15,vdwRad:2.08,covRad:.75,type:6},elem.S={atomNo:16,vdwRad:2,covRad:1.02,type:4},elem.Cl={atomNo:17,vdwRad:1.97,covRad:.99,type:1},elem.Ar={atomNo:18,vdwRad:1.88,covRad:1.57,type:1},elem.K={atomNo:19,vdwRad:2.75,covRad:1.33,type:0},elem.Ca={atomNo:20,vdwRad:1.973,covRad:.99,type:0},elem.Sc={atomNo:21,vdwRad:1.7,covRad:1.44,type:0},elem.Ti={atomNo:22,vdwRad:1.7,covRad:1.47,type:0},elem.V={atomNo:23,vdwRad:1.7,covRad:1.33,type:0},elem.Cr={atomNo:24,vdwRad:1.7,covRad:1.35,type:0},elem.Mn={atomNo:25,vdwRad:1.7,covRad:1.35,type:0},elem.Fe={atomNo:26,vdwRad:1.7,covRad:1.34,type:0},elem.Co={atomNo:27,vdwRad:1.7,covRad:1.33,type:0},elem.Ni={atomNo:28,vdwRad:1.63,covRad:1.5,type:0},elem.Cu={atomNo:29,vdwRad:1.4,covRad:1.52,type:0},elem.Zn={atomNo:30,vdwRad:1.39,covRad:1.45,type:0},elem.Ga={atomNo:31,vdwRad:1.87,covRad:1.22,type:0},elem.Ge={atomNo:32,vdwRad:1.7,covRad:1.17,type:0},elem.As={atomNo:33,vdwRad:1.85,covRad:1.21,type:0},elem.Se={atomNo:34,vdwRad:1.9,covRad:1.22,type:0},elem.Br={atomNo:35,vdwRad:2.1,covRad:1.21,type:1},elem.Kr={atomNo:36,vdwRad:2.02,covRad:1.91,type:0},elem.Rb={atomNo:37,vdwRad:1.7,covRad:1.47,type:0},elem.Sr={atomNo:38,vdwRad:1.7,covRad:1.12,type:0},elem.Y={atomNo:39,vdwRad:1.7,covRad:1.78,type:0},elem.Zr={atomNo:40,vdwRad:1.7,covRad:1.56,type:0},elem.Nb={atomNo:41,vdwRad:1.7,covRad:1.48,type:0},elem.Mo={atomNo:42,vdwRad:1.7,covRad:1.47,type:0},elem.Tc={atomNo:43,vdwRad:1.7,covRad:1.35,type:0},elem.Ru={atomNo:44,vdwRad:1.7,covRad:1.4,type:0},elem.Rh={atomNo:45,vdwRad:1.7,covRad:1.45,type:0},elem.Pd={atomNo:46,vdwRad:1.63,covRad:1.5,type:0},elem.Ag={atomNo:47,vdwRad:1.72,covRad:1.59,type:0},elem.Cd={atomNo:48,vdwRad:1.58,covRad:1.69,type:0},elem.In={atomNo:49,vdwRad:1.93,covRad:1.63,type:0},elem.Sn={atomNo:50,vdwRad:2.17,covRad:1.46,type:0},elem.Sb={atomNo:51,vdwRad:2.2,covRad:1.46,type:0},elem.Te={atomNo:52,vdwRad:2.06,covRad:1.47,type:0},elem.I={atomNo:53,vdwRad:2.15,covRad:1.4,type:1},elem.Xe={atomNo:54,vdwRad:2.16,covRad:1.98,type:0},elem.Cs={atomNo:55,vdwRad:1.7,covRad:1.67,type:0},elem.Ba={atomNo:56,vdwRad:1.7,covRad:1.34,type:0},elem.La={atomNo:57,vdwRad:1.7,covRad:1.87,type:0},elem.Ce={atomNo:58,vdwRad:1.7,covRad:1.83,type:0},elem.Pr={atomNo:59,vdwRad:1.7,covRad:1.82,type:0},elem.Nd={atomNo:60,vdwRad:1.7,covRad:1.81,type:0},elem.Pm={atomNo:61,vdwRad:1.7,covRad:1.8,type:0},elem.Sm={atomNo:62,vdwRad:1.7,covRad:1.8,type:0},elem.Eu={atomNo:63,vdwRad:1.7,covRad:1.99,type:0},elem.Gd={atomNo:64,vdwRad:1.7,covRad:1.79,type:0},elem.Tb={atomNo:65,vdwRad:1.7,covRad:1.76,type:0},elem.Dy={atomNo:66,vdwRad:1.7,covRad:1.75,type:0},elem.Ho={atomNo:67,vdwRad:1.7,covRad:1.74,type:0},elem.Er={atomNo:68,vdwRad:1.7,covRad:1.73,type:0},elem.Tm={atomNo:69,vdwRad:1.7,covRad:1.72,type:0},elem.Yb={atomNo:70,vdwRad:1.7,covRad:1.94,type:0},elem.Lu={atomNo:71,vdwRad:1.7,covRad:1.72,type:0},elem.Hf={atomNo:72,vdwRad:1.7,covRad:1.57,type:0},elem.Ta={atomNo:73,vdwRad:1.7,covRad:1.43,type:0},elem.W={atomNo:74,vdwRad:1.7,covRad:1.37,type:0},elem.Re={atomNo:75,vdwRad:1.7,covRad:1.35,type:0},elem.Os={atomNo:76,vdwRad:1.7,covRad:1.37,type:0},elem.Ir={atomNo:77,vdwRad:1.7,covRad:1.32,type:0},elem.Pt={atomNo:78,vdwRad:1.72,covRad:1.5,type:0},elem.Au={atomNo:79,vdwRad:1.66,covRad:1.5,type:0},elem.Hg={atomNo:80,vdwRad:1.55,covRad:1.7,type:0},elem.Tl={atomNo:81,vdwRad:1.96,covRad:1.55,type:0},elem.Pb={atomNo:82,vdwRad:2.02,covRad:1.54,type:0},elem.Bi={atomNo:83,vdwRad:1.7,covRad:1.54,type:0},elem.Po={atomNo:84,vdwRad:1.7,covRad:1.68,type:0},elem.At={atomNo:85,vdwRad:1.7,covRad:1.7,type:0},elem.Rn={atomNo:86,vdwRad:1.7,covRad:2.4,type:0},elem.Fr={atomNo:87,vdwRad:1.7,covRad:2,type:0},elem.Ra={atomNo:88,vdwRad:1.7,covRad:1.9,type:0},elem.Ac={atomNo:89,vdwRad:1.7,covRad:1.88,type:0},elem.Th={atomNo:90,vdwRad:1.7,covRad:1.79,type:0},elem.Pa={atomNo:91,vdwRad:1.7,covRad:1.61,type:0},elem.U={atomNo:92,vdwRad:1.86,covRad:1.58,type:0},elem.Np={atomNo:93,vdwRad:1.7,covRad:1.55,type:0},elem.Pu={atomNo:94,vdwRad:1.7,covRad:1.53,type:0},elem.Am={atomNo:95,vdwRad:1.7,covRad:1.51,type:0},elem.Cm={atomNo:96,vdwRad:1.7,covRad:1.5,type:0},elem.Bk={atomNo:97,vdwRad:1.7,covRad:1.5,type:0},elem.Cf={atomNo:98,vdwRad:1.7,covRad:1.5,type:0},elem.Es={atomNo:99,vdwRad:1.7,covRad:1.5,type:0},elem.Fm={atomNo:100,vdwRad:1.7,covRad:1.5,type:0},elem.Md={atomNo:101,vdwRad:1.7,covRad:1.5,type:0},elem.No={atomNo:102,vdwRad:1.7,covRad:1.5,type:0},elem.Lr={atomNo:103,vdwRad:1.7,covRad:1.5,type:0},elem.Rf={atomNo:104,vdwRad:1.7,covRad:1.6,type:0},elem.Db={atomNo:105,vdwRad:1.7,covRad:1.6,type:0},elem.Sg={atomNo:106,vdwRad:1.7,covRad:1.6,type:0},elem.Bh={atomNo:107,vdwRad:1.7,covRad:1.6,type:0},elem.Hs={atomNo:108,vdwRad:1.7,covRad:1.6,type:0},elem.Mt={atomNo:109,vdwRad:1.7,covRad:1.6,type:0},Scif.prototype.elements=elem,Scif._block.prototype.elements=elem})(Scif),function(e){function t(e
){return e=="."||e=="?"||e==""?!0:!1}e._block.prototype.getItemValue=function(e){for(var t=0;t<e.length;t++){var n=this.cifitems[e[t]];if(!n)continue;n.looped}}}(Scif);var BouncyScrollyDiv=function(){function e(e,t){if(!e)return;if(!t)return;t.parentNode.insertBefore(e,t)}function t(e,t){if(!e)return;if(!t)return;t.parentNode.insertBefore(e,t.nextSibling)}function n(e){var t=curtop=0;if(e.offsetParent)do t+=e.offsetLeft,curtop+=e.offsetTop;while(e=e.offsetParent);return[t,curtop]}function r(e,t){var r=[];if(typeof IE7!="undefined")var i=n(e);if(t=="canvas"&&typeof FlashCanvas!="undefined"){var s=e.getElementsByTagName("object");for(var o=0;o<s.length;o++){var u=s[o].offsetLeft,a=s[o].offsetTop;if(typeof IE7!="undefined"){var f=n(s[o]);u=f[0]-i[0],a=f[1]-i[1]}r.push([u,a,s[o].offsetWidth+0,s[o].offsetHeight+0])}return r}var l=e.getElementsByTagName(t)[0],c=0;while(l){if(l.nodeType==1&&l.nodeName&&l.nodeName==t.toUpperCase()){var u=l.offsetLeft,a=l.offsetTop;if(typeof IE7!="undefined"){var f=n(l);u=f[0]-i[0],a=f[1]-i[1]}r.push([u,a,l.offsetWidth+0,l.offsetHeight+0])}l=l.nextSibling,c++;if(c>1e3)break}return r}function i(e,t){var n=r(e.getElementsByTagName("div")[0],t),i=0,s=0,o=[],u=[];for(var a=0;a<n.length;a++)a==0&&(i=n[a][1],s=n[a][0]),n[a][1]-=i,n[a][0]-=s,o.indexOf(n[a][0])==-1&&o.push([n[a][0],n[a][2]]),u.indexOf(n[a][1])==-1&&u.push([n[a][1],n[a][3]]);e._scrollTabs=n,e._hTabs=o,e._vTabs=u;var f=0,l=0;e._scrollButs=="top"||e._scrollButs=="bottom"?f=e._tbr.offsetHeight>0?e._tbr.offsetHeight:e._tbr.offsetHeight:e._scrollButs=="topbottom"&&(f=e._tbr.offsetHeight+e._tbl.offsetHeight);if(e._scrollButs=="left"||e._scrollButs=="right"||e._scrollButs=="leftright")l=e._tbr.offsetWidth+e._tbl.offsetWidth;e._h=e.offsetHeight-f,e._w=e.offsetWidth-l,e._incToNextElH=function(){for(var e=0;e<this._hTabs.length;e++){if(this._hTabs[e][0]>this.scrollLeft&&this._hTabs[e][0]-this.scrollLeft<this._w&&this._hTabs[e][0]-this.scrollLeft+this._hTabs[e][1]>this._w)return this._hTabs[e][0]-this.scrollLeft+this._hTabs[e][1]-this._w;if(this._hTabs[e][0]>this.scrollLeft&&this._hTabs[e][0]-this.scrollLeft>=this._w)return e==this._hTabs.length-1?this._hTabs[e][1]:this._hTabs[e+1][0]-this._hTabs[e][0]}return 0},e._incToNextElV=function(){for(var e=0;e<this._vTabs.length;e++){if(this._vTabs[e][0]>this.scrollTop&&this._vTabs[e][0]-this.scrollTop<this._h&&this._vTabs[e][0]-this.scrollTop+this._vTabs[e][1]>this._h)return this._vTabs[e][0]-this.scrollTop+this._vTabs[e][1]-this._h;if(this._vTabs[e][0]>this.scrollTop&&this._vTabs[e][0]-this.scrollTop>=this._h)return e==this._vTabs.length-1?this._vTabs[e][1]:this._vTabs[e+1][0]-this._vTabs[e][0]}return 0},e._incToPreviousElH=function(){for(var e=this._hTabs.length-1;e>=0;e--){if(this._hTabs[e][0]<this.scrollLeft&&this._hTabs[e][0]+this._hTabs[e][1]>this.scrollLeft)return this.scrollLeft-this._hTabs[e][0];if(this._hTabs[e][0]<this.scrollLeft)return this._hTabs[e+1][0]-this._hTabs[e][0]}return 0},e._incToPreviousElV=function(){for(var e=this._vTabs.length-1;e>=0;e--){if(this._vTabs[e][0]<this.scrollTop&&this._vTabs[e][0]+this._vTabs[e][1]>this.scrollTop)return this.scrollTop-this._vTabs[e][0];if(this._vTabs[e][0]<this.scrollTop)return this._vTabs[e+1][0]-this._vTabs[e][0]}return 0}}function s(e,t){e._unfinishedScroll=!0,e._useEls&&!e._scrollTabs&&i(e,e._step),t&&(e._incc=0,e._dy=1,e._ddy=1,e._inc=Math.abs(t),t<0&&(e._ddy=-1),e._useEls||(e._scrollMode==1?e._padding=(e.scrollWidth-e.offsetWidth)%e._inc:e._padding=(e.scrollHeight-e.offsetHeight)%e._inc));if(e._incc<=e._inc){e._dy<10&&(e._dy+=1),e._incc+e._dy>e._inc&&(e._dy=e._inc-e._incc),e._incc+=e._dy,e._scrollMode==1?e.scrollLeft+=e._ddy*e._dy:e.scrollTop+=e._ddy*e._dy;if(e._incc>=e._inc){if(e._isScrolling){if(e._useEls)if(e._ddy==-1){var n;e._scrollMode==1?n=e._incToPreviousElH():n=e._incToPreviousElV(),n==0&&e._scrollMode==1?u(e,3,-100):n==0?u(e,3,-100):e._scrollRate?setTimeout(function(){s(e,-1*n)},e._scrollRate):s(e,-1*n)}else{var n;e._scrollMode==1?n=e._incToNextElH():n=e._incToNextElV(),n==0&&e._scrollMode==1?u(e,3,100):n==0?u(e,3,-100):e._scrollRate?setTimeout(function(){s(e,n)},e._scrollRate):s(e,n)}else if(e._scrollMode==1){var r=e.scrollWidth-e.scrollLeft-e.offsetWidth;e._ddy==1&&r<e._padding+e._inc?u(e,3,-100):e._ddy==-1&&e.scrollLeft<e._inc/2?(e.scrollLeft=0,u(e,3,100)):e._scrollRate?setTimeout(function(){s(e,e._ddy*e._inc)},e._scrollRate):s(e,e._ddy*e._inc)}else{var r=e.scrollHeight-e.scrollTop-e.offsetHeight;e._ddy==1&&r<e._padding+e._inc?u(e,3,e._ddy*100):e._ddy==-1&&e.scrollTop<e._inc/2?(e.scrollTop=0,u(e,3,e._ddy*100)):e._scrollRate?setTimeout(function(){s(e,e._ddy*e._inc)},e._scrollRate):s(e,e._ddy*e._inc)}typeof e._onScrollCallback=="function"&&e._onScrollCallback()}else a(e),e._stepBounce?u(e,3,e._ddy*100):(e._unfinishedScroll=!1,o(e));return}e._t=setTimeout(function(){s(e)},10)}}function o(e){e._scrollRate=0;var t=e._scrollCallback.pop();typeof t=="function"&&t(),typeof e._onScrollEndCallback=="function"&&e._onScrollEndCallback()}function u(e,t,n){if(e._scrollCallback.length>0){e._unfinishedScroll=!1,a(e),o(e);return}t&&(e._b=t,e._incc=0,e._dy=1,n?(e._scrollMode==1?e._cscroll=e.scrollLeft:e._cscroll=e.scrollTop,n>0?e._ddy=1:e._ddy=-1,e._inc=Math.abs(n),e._newb=!0,e._dy=4):(e._scrollMode==1?e.scrollLeft=e._cscroll:e.scrollTop=e._cscroll,e._inc=parseInt(e._inc*.3),e._inc=e._inc-e._inc%2,e._newb=!0,e._dy=4,e._b<5&&(e._dy=1)));if(e._incc<e._inc)e._newb&&e._incc>=e._inc/2&&(e._ddy==-1?e._ddy=1:e._ddy=-1,e._newb=!1),e._incc+e._dy>e._inc&&(e._dy=e._inc-e._incc),e._scrollMode==1?e.style.left=parseInt(e.style.left)+e._ddy*e._dy+"px":e.style.top=parseInt(e.style.top)+e._ddy*e._dy+"px",e._incc+=e._dy,e._t=setTimeout(function(){u(e)},10);else{e._b--;if(e._inc<5||e._b<1){e._scrollMode==1?(e.scrollLeft=e._cscroll,e.style.left="0px"):(e.scrollTop=e._cscroll,e.style.top="0px"),e._unfinishedScroll=!1,a(e),o(e);return}e._ddy==-1?e._ddy=1:e._ddy=-1,u(e,e._b)}}function a(e){if(e._scrollMode==1)if(e.scrollLeft>0){e._tbl.style.display="inline-block",typeof IE7!="undefined"&&(e._tbl.style.zoom="1",e._tbl.style.display="inline");if(e._scrollButs=="top"||e._scrollButs=="bottom")e._tbr.style.left="0px"}else{e._tbl.style.display="none";if(e._scrollButs=="top"||e._scrollButs=="bottom")e._tbr.style.left="50%"}else e.scrollTop>0?(e._tbl.style.display="inline-block",typeof IE7!="undefined"&&(e._tbl.style.zoom="1",e._tbl.style.display="inline"),e._tbr.style.left="0px"):e._tbl.style.display="none";if(e._useEls){e._scrollTabs||i(e,e._step);var t;e._scrollMode==1?t=e._incToNextElH():t=e._incToNextElV(),t==0?e._tbr.style.display="none":(e._tbr.style.display="inline-block",typeof IE7!="undefined"&&(e._tbr.style.zoom="1",e._tbr.style.display="inline"))}else if(e._scrollMode==1){var n=e.scrollWidth-e.scrollLeft-e.offsetWidth;n<=e._padding?e._tbr.style.display="none":(e._tbr.style.display="inline-block",typeof IE7!="undefined"&&(e._tbr.style.zoom="1",e._tbr.style.display="inline"))}else{var n=e.scrollHeight-e.scrollTop-e.offsetHeight;n<=e._padding?e._tbr.style.display="none":(e._tbr.style.display="inline-block",typeof IE7!="undefined"&&(e._tbr.style.zoom="1",e._tbr.style.display="inline"))}}function f(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n)}return{init:function(t,r){function h(e){var t=c,n=e||window.event;n.targetTouches||(n.preventDefault?n.preventDefault():n.returnValue=!1);var r=n.pageX,i=n.pageY;n.targetTouches&&n.targetTouches[0]&&(r=n.targetTouches[0].pageX,i=n.targetTouches[0].pageY),r==undefined&&(r=n.clientX,i=n.clientY);if(r==undefined)return;t._isDragging=!0,t._mouseStartX=r,t._mouseStartY=i}function p(e){var t=e||window.event;t.preventDefault?t.preventDefault():t.returnValue=!1;var n=c;if(!n._isDragging)return;var r=t.pageX,i=t.pageY;t.targetTouches&&t.targetTouches[0]&&(r=t.targetTouches[0].pageX,i=t.targetTouches[0].pageY),r==undefined&&(r=t.clientX,i=t.clientY);if(r==undefined)return;var s=r-n._mouseStartX,o=i-n._mouseStartY;n._mouseStartX=r,n._mouseStartY=i,n._scrollMode==1?n.scrollLeft+=-1*s:n.scrollTop+=-1*o,typeof n._onScrollCallback=="function"&&n._onScrollCallback()}function d(e,t){var r=c;if(!r._isDragging)return;if(!t||t!="out"){r._isDragging=!1,a(r),typeof r._onScrollEndCallback=="function"&&r._onScrollEndCallback();return}var i=e||window.event,s=i.pageX,o=i.pageY;i.targetTouches&&i.targetTouches[0]&&(s=i.targetTouches[0].pageX,o=i.targetTouches[0].pageY),s==undefined&&(s=i.clientX,o=i.clientY);if(s==undefined)return;var u=n(r);s<u[0]+100?r._isDragging=!1:s>u[0]+r.offsetWidth-100?r._isDragging=!1:o<u[1]?r._isDragging=!1:o>u[1]+r.offsetHeight&&(r._isDragging=!1),a(r),typeof r._onScrollEndCallback=="function"&&r._onScrollEndCallback()}if(t._sdiv)return;var o=document.createDocumentFragment(),l=document.createElement("div");l.style.position="relative",l.style.padding=0,l.style.margin=0,l.className="boo";if(!r.scrollMode||r.scrollMode!="vertical")t.style.width?l.style.width=t.style.width:l.style.width="100%";e(l,t);var c=document.createElement("div");t.className&&(l.className=t.className),c.style.padding=0,c.style.margin=0,c.style.overflow="hidden",c.style.position="relative",c.style.left="0px",c.style.top="0px",t.style.width&&(c.style.width=t.style.width),t.style.height&&(c.style.height=t.style.height),r.scrollMode&&r.scrollMode=="vertical"?c._scrollMode=0:c._scrollMode=1,r.buttonsPosition?c._scrollButs=r.buttonsPosition:c._scrollMode==1?c._scrollButs="leftright":c._scrollButs="bottom",r.stepBounce?c._stepBounce=r.stepBounce:c._stepBounce=!1,c._scrollButs!="leftrightouter"&&(l.style.overflow="hidden"),r.onScrollCallback&&(c._onScrollCallback=r.onScrollCallback),r.onScrollEndCallback&&(c._onScrollEndCallback=r.onScrollEndCallback),c._scrollCallback=[],c._scrollMode==1?(c.style.whiteSpace="nowrap",c.style.display="inline-block",typeof IE7!="undefined"&&(c.style.zoom="1",c.style.display="inline"),c.style.verticalAlign="top",c.style.width||(c.style.width="100%"),l.style.whiteSpace="nowrap"):c.style.display="block",c._step=10,c._useEls=!1,c._allowDrag=!0,r.allowDrag!==undefined&&r.allowDrag==0&&(c._allowDrag=!1),r.scrollStep&&(typeof r.scrollStep=="string"?c._useEls=!0:c._useEls=!1,c._step=r.scrollStep),t.style.height=null,t.style.width=null,t.style.position="relative",c._scrollMode==1&&(t.style.display="inline-block",typeof IE7!="undefined"&&(t.style.zoom="1",t.style.display="inline"),t.style.verticalAlign="top"),c.appendChild(t),c._allowDrag&&(f(t,"mousedown",function(e){h(e)}),f(t,"mousemove",function(e){p(e)}),f(t,"mouseup",function(e){d(e)}),f(t,"mouseout",function(e){d(e,"out")}),f(t,"touchstart",function(e){h(e)}),f(t,"touchmove",function(e){p(e)}),f(t,"touchend",function(e){d(e)}));var v=document.createElement("div");v.style.position="relative",c._scrollMode==1?(v.style.height="10px",v.style.width="100px",v.style.display="inline-block",typeof IE7!="undefined"&&(v.style.zoom="1",v.style.display="inline")):(v.style.height="100px",v.style.width="10px",v.style.display="block"),c.appendChild(v);var m=" &lt; ",g=" &gt; ";r.forwardbutton&&(g=r.forwardbutton),r.backbutton&&(m=r.backbutton);var y=document.createElement("div");r.buttonsClassName&&(y.className=r.buttonsClassName);var b=document.createElement("div");r.buttonsClassName&&(b.className=r.buttonsClassName),y._sdiv=c,y.onmousedown=function(){return this._sdiv._isScrolling?!1:(this._sdiv._scrollBack(),!1)},y.onmouseup=function(){return this._sdiv._isScrolling=!1,!1},y.innerHTML=m,b._sdiv=c,b.onmousedown=function(){return this._sdiv._isScrolling?!1:(this._sdiv._scrollForward(),!1)},b.onmouseup=function(){return this._sdiv._isScrolling=!1,!1},b.innerHTML=g;if(c._scrollButs=="leftright"||c._scrollButs=="leftrightouter")b.style.position="absolute",b.style.height="100%",b.style.right="0px",c._scrollButs=="leftrightouter"?(b.style.right="-100px",b.style.width="100px"):b.style.right="0px",b.style.top="0px",b.style.verticalAlign="top",b.style.zIndex=1,b.style.background="transparent",y.style.position="absolute",y.style.verticalAlign="top",y.style.zIndex=2,y.style.top="0px",c._scrollButs=="leftrightouter"?(y.style.left="-100px",y.style.width="100px"):y.style.left="0px",y.style.display="inline-block",typeof IE7!="undefined"&&(y.style.zoom="1",y.style.display="inline"),o.appendChild(y),o.appendChild(b),o.appendChild(c);else if(c._scrollButs=="bottom"||c._scrollButs=="top"){b.style.margin=0,b.style.position="relative",b.style.verticalAlign="top",b.style.display="inline-block",typeof IE7!="undefined"&&(b.style.zoom="1",b.style.display="inline"),b.style.width="50%",b.style.top="0px",b.style.zIndex=1,y.style.margin=0,y.style.position="relative",y.style.verticalAlign="top",y.style.display="inline-block",typeof IE7!="undefined"&&(y.style.zoom="1",y.style.display="inline"),y.style.width="50%";var w=document.createElement("div");w.style.position="relative",w.style.width="100%",w.style.whiteSpace="nowrap",w.appendChild(y),w.appendChild(b),c._scrollButs=="bottom"?(o.appendChild(c),o.appendChild(w)):(o.appendChild(w),o.appendChild(c))}c.scrollLeft=0,c.scrollTop=0,l.appendChild(o),c._scrollMode==1?(c._scrollButs=="leftright"&&(y.style.height=l.offsetHeight+"px"),c.scrollWidth>=c.offsetWidth+100?(b.style.display="inline-block",typeof IE7!="undefined"&&(b.style.zoom="1",b.style.display="inline")):b.style.display="none",y.style.display="none"):(c.scrollHeight>c.offsetHeight+100?(b.style.display="inline-block",typeof IE7!="undefined"&&(b.style.zoom="1",b.style.display="inline")):b.style.display="none",y.style.display="none"),c._tbl=y,c._tbr=b,t._sdiv=c,c._scrollRepeat=function(e,n){typeof e=="function"&&this._scrollCallback.push(e),n?this._scrollRate=n:this._scrollRate=0;if(this._unfinishedScroll)return;this._isScrolling=!0;if(this._useEls){i(this,this._step);var r;this._scrollMode==1?r=this._incToNextElH():r=this._incToNextElV(),r==0&&this._scrollMode==1?u(this,3,-100):r==0?s(this,-1*r):s(this,r)}else{this._scrollMode==1?this._padding=(this.scrollWidth-this.offsetWidth)%this._step:this._padding=(this.scrollHeight-this.offsetHeight)%this._step;if(this._scrollMode==1){var o=t.scrollWidth-t.scrollLeft-t.offsetWidth;o<=t._padding?u(this,3,-100):s(this,this._step)}else{var o=t.scrollHeight-t.scrollTop-t.offsetHeight;o<=t._padding?u(this,3,100):s(this,this._step)}}},c._scrollForward=function(e,n){typeof e=="function"&&this._scrollCallback.push(e),n?this._scrollRate=n:this._scrollRate=0;if(this._unfinishedScroll)return;this._isScrolling=!0;if(this._useEls){i(this,this._step);var r;this._scrollMode==1?r=this._incToNextElH():r=this._incToNextElV(),r==0&&this._scrollMode==1?u(this,3,-100):r==0?u(this,3,-100):s(this,r)}else{this._scrollMode==1?this._padding=(this.scrollWidth-this.offsetWidth)%this._step:this._padding=(this.scrollHeight-this.offsetHeight)%this._step;if(this._scrollMode==1){var o=t.scrollWidth-t.scrollLeft-t.offsetWidth;o<=t._padding?u(this,3,-100):s(this,this._step)}else{var o=t.scrollHeight-t.scrollTop-t.offsetHeight;o<=t._padding?u(this,3,100):s(this,this._step)}}},c._scrollBack=function(e,t){typeof e=="function"&&this._scrollCallback.push(e),t?this._scrollRate=t:this._scrollRate=0;if(this._unfinishedScroll)return;this._isScrolling=!0;if(this._useEls){i(this,this._step);var n;this._scrollMode==1?n=this._incToPreviousElH():n=this._incToPreviousElV(),n==0&&this._scrollMode==1?u(this,3,100):n==0?u(this,3,-100):s(this,-1*n)}else this._scrollMode==1?this.scrollLeft<this._step/2?(this.scrollLeft=0,u(this,3,-100)):s(this,-1*this._step):this.scrollTop<this._step/2?(this.scrollTop=0,u(this,3,100)):s(this,-1*this._step)},t.ensureElVisible=function(e){i(this._sdiv,this._sdiv._step);var t=this._sdiv._hTabs;if(t[e]){var n=this._sdiv.scrollLeft,r=this._sdiv.scrollLeft+this._sdiv.offsetWidth,s=t[e][0],o=t[e][0]+t[e][1];s>n&&o<r||(s>n&&o>r?this._sdiv.scrollLeft=o:s<n&&o<r&&(this._sdiv.scrollLeft=s)),a(this._sdiv)}},t.resetScroll=function(e){this._sdiv._scrollMode==1?(this._sdiv.scrollLeft=0,this._sdiv.scrollWidth>=this._sdiv.offsetWidth+100?(this._sdiv._tbr.style.display="inline-block",typeof IE7!="undefined"&&(this._sdiv._tbr.style.zoom="1",this._sdiv._tbr.style.display="inline")):this._sdiv._tbr.style.display="none",this._sdiv._tbl.style.display="none"):(this._sdiv.scrollTop=0,this._sdiv.scrollHeight>this._sdiv.offsetHeight+100?(this._sdiv._tbr.style.display="inline-block",typeof IE7!="undefined"&&(this._sdiv._tbr.style.zoom="1",this._sdiv._tbr.style.display="inline")):this._sdiv._tbr.style.display="none",this._sdiv._tbl.style.display="none"),this._sdiv._unfinishedScroll=!1,this._sdiv._isScrolling=!1},t.setScrollStep=function(e){this._sdiv._step=e,typeof e=="string"?(this._sdiv._useEls=!0,i(this._sdiv,this._sdiv._step)):this._sdiv._useEls=!1,this.resetScroll()},t.scrollRepeat=function(){var e=this;this._sdiv._scrollForward(function(){e.resetScroll()},1e3)},c._winResizeTimer=setTimeout(function(){},0),t._winResize=function(e){window.clearTimeout(this._sdiv._winResizeTimer);var t=this;this._sdiv._winResizeTimer=setTimeout(function(){if(t._sdiv._scrollMode==1){var e=t._sdiv.parentNode;if(e){t._sdiv.style.display="none";var n=e.offsetWidth-t._sdiv.offsetLeft;n>0&&(t._sdiv.style.maxWidth=n+"px"),t._sdiv.style.display="block"}}t.resetScroll()},500)},window.addEventListener?window.addEventListener("resize",function(){t._winResize()},!1):window.attachEvent&&window.attachEvent("onresize",function(){t._winResize()});if(t._sdiv._scrollMode==1){var E=t._sdiv.parentNode;if(E){t._sdiv.style.display="none";var S=E.offsetWidth-t._sdiv.offsetLeft;S>0&&(t._sdiv.style.maxWidth=S+"px"),t._sdiv.style.display="block"}}return t.resetScroll(),t}}}();/*
 * Smol - *S*imple HTML5 canvas *S*mall-molecule viewer 
 * - designed primarily as a 'quick' viewer to be used alongside Jmol
 * (i.e. Jmol is a full app so load time can be very slow esp. on mobile devices,
 * so use the Smol quick view on load, then call Jmol if requested by user...)
 * 
 * - built using GLmol as a 'model', but doesn't use webGL and has removed all dependency on three.js
 *   and Jquery - so can standalone (Jmol already has its own version of GLmol/THREE, so could conflict...)
 *
 * NOV2016 - some of this recovered for minimized version after lost latest source!
*/// TODO set gradcolors earlier!!!!!!!!!!!!!!!
var oldBrowser=!1;if(console===undefined){function _console(){return{log:function(e){}}}var console=new _console}(function(){var e=0,t=["webkit","moz"];for(var n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,n){var r=(new Date).getTime(),i=Math.max(0,16-(r-e)),s=window.setTimeout(function(){t(r+i)},i);return e=r+i,s}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})})();var SmolElementData=function(){return _elColours={H:14932681,D:14932681,T:14932681,He:14286847,Li:13402367,Be:12779264,B:16758197,C:9474192,N:3166456,O:16715021,F:9494608,Ne:11789301,Na:11230450,Mg:9109248,Al:12560038,Si:1578e4,P:16744448,S:16777008,Cl:2093087,Ar:8442339,K:9388244,Ca:4062976,Sc:15132390,Ti:12567239,V:10921643,Cr:9083335,Mn:10255047,Fe:14706227,Co:15765664,Ni:5296208,Cu:13140019,Zn:8224944,Ga:12750735,Ge:6721423,As:12419299,Se:16752896,Br:10889513,Kr:6076625,Rb:7351984,Sr:65280,Y:9764863,Zr:9756896,Nb:7586505,Mo:5551541,Tc:3907230,Ru:2396047,Rh:687500,Pd:27013,Ag:12632256,Cd:16767375,In:10909043,Sn:6717568,Sb:10380213,Te:13924864,I:9699476,Xe:4366e3,Cs:5707663,Ba:51456,La:7394559,Ce:16777159,Pr:14286791,Nd:13107143,Pm:10747847,Sm:9437127,Eu:6422471,Gd:4587463,Tb:3211207,Dy:2097095,Ho:65436,Er:58997,Tm:54354,Yb:48952,Lu:43812,Hf:5096191,Ta:5089023,W:2200790,Re:2522539,Os:2516630,Ir:1528967,Pt:13684960,Au:16765219,Hg:12105936,Tl:10900557,Pb:5724513,Bi:10375093,Po:11230208,At:7688005,Rn:4358806,Fr:4325478,Ra:32e3,Ac:7384058,Th:47871,Pa:41471,U:36863,Np:33023,Pu:27647,Am:5528818,Cm:7888099,Bk:9064419,Cf:10565332,Es:11739092,Fm:11739066,Md:11734438,No:12389767,Lr:13041766,Rf:13369433,Db:13697103,Sg:14221381,Bh:14680120,Hs:15073326,Mt:15400998,Ds:0,Rg:0,Cn:0,Uut:0,Uuq:0,Uup:0,Uuh:0,Uus:0,Uuo:0},_elVdwRadii={H:1,D:1,T:1,He:1.4,Li:1.82,Be:1.7,B:1.7,C:1.7,N:1.55,O:1.52,F:1.47,Ne:1.54,Na:2.27,Mg:1.73,Al:1.7,Si:2.1,P:1.8,S:1.8,Cl:1.75,Ar:1.88,K:2.75,Ca:1.7,Sc:1.7,Ti:1.7,V:1.7,Cr:1.7,Mn:1.7,Fe:1.7,Co:1.7,Ni:1.63,Cu:1.4,Zn:1.39,Ga:1.87,Ge:1.7,As:1.85,Se:1.9,Br:1.85,Kr:2.02,Rb:1.7,Sr:1.7,Y:1.7,Zr:1.7,Nb:1.7,Mo:1.7,Tc:1.7,Ru:1.7,Rh:1.7,Pd:1.63,Ag:1.72,Cd:1.58,In:1.93,Sn:2.17,Sb:1.7,Te:2.06,I:1.98,Xe:2.16,Cs:1.7,Ba:1.7,La:1.7,Ce:1.7,Pr:1.7,Nd:1.7,Pm:1.7,Sm:1.7,Eu:1.7,Gd:1.7,Tb:1.7,Dy:1.7,Ho:1.7,Er:1.7,Tm:1.7,Yb:1.7,Lu:1.7,Hf:1.7,Ta:1.7,W:1.7,Re:1.7,Os:1.7,Ir:1.7,Pt:1.75,Au:1.66,Hg:1.55,Tl:1.96,Pb:2.02,Bi:1.7,Po:1.7,At:1.7,Rn:1.7,Fr:1.7,Ra:1.7,Ac:1.7,Th:1.7,Pa:1.7,U:1.86,Np:1.7,Pu:1.7,Am:1.7,Cm:1.7,Bk:1.7,Cf:1.7,Es:1.7,Fm:1.7,Md:1.7,No:1.7,Lr:1.7,Rf:1.7,Db:1.7,Sg:1.7,Bh:1.7,Hs:1.7,Mt:1.7,Ds:1.7,Rg:1.7,Cn:1.7,Uut:1.7,Uuq:1.7,Uup:1.7,Uuh:1.7,Uus:1.7,Uuo:1.7},_elCovRadii={H:.23,He:.93,Li:.68,Be:.35,B:.83,C:.68,N:.68,O:.68,F:.64,Ne:1.12,Na:.97,Mg:1.1,Al:1.35,Si:1.2,P:.75,S:1.02,Cl:.99,Ar:1.57,K:1.33,Ca:.99,Sc:1.44,Ti:1.47,V:1.33,Cr:1.35,Mn:1.35,Fe:1.34,Co:1.33,Ni:1.5,Cu:1.52,Zn:1.45,Ga:1.22,Ge:1.17,As:1.21,Se:1.22,Br:1.21,Kr:1.91,Rb:1.47,Sr:1.12,Y:1.78,Zr:1.56,Nb:1.48,Mo:1.47,Tc:1.35,Ru:1.4,Rh:1.45,Pd:1.5,Ag:1.59,Cd:1.69,In:1.63,Sn:1.46,Sb:1.46,Te:1.47,I:1.4,Xe:1.98,Cs:1.67,Ba:1.34,La:1.87,Ce:1.83,Pr:1.82,Nd:1.81,Pm:1.8,Sm:1.8,Eu:1.99,Gd:1.79,Tb:1.76,Dy:1.75,Ho:1.74,Er:1.73,Tm:1.72,Yb:1.94,Lu:1.72,Hf:1.57,Ta:1.43,W:1.37,Re:1.35,Os:1.37,Ir:1.32,Pt:1.5,Au:1.5,Hg:1.7,Tl:1.55,Pb:1.54,Bi:1.54,Po:1.68,At:1.7,Rn:2.4,Fr:2,Ra:1.9,Ac:1.88,Th:1.79,Pa:1.61,U:1.58,Np:1.55,Pu:1.53,Am:1.51,Cm:1.5,Bk:1.5,Cf:1.5,Es:1.5,Fm:1.5,Md:1.5,No:1.5,Lr:1.5,Rf:1.6,Db:1.6,Sg:1.6,Bh:1.6,Hs:1.6,Mt:1.6},{elColours:_elColours,elVdwRadii:_elVdwRadii,elCovRadii:_elCovRadii}}(),Smol=function(){function e(e,t){return this._create(e,t),this}return e.prototype._create=function(e,t){this._options={id:(new Date).getTime()+"",show:-1,spin:!1,spinToBestFit:!1,background:"transparent",viewStyle:"ball_and_stick",mmViewStyle:"ribbon",colourScheme:"rainbow",size:300,readyCallback:!1,clickCallback:!1,pickCallback:!1,bondpickCallback:!1,selectCallback:!1,changedCallback:!1,spinCallback:!1,mouseOverCallback:!1,type:"mol",view:"",symRange:"",vdwScale:.22,ellipScale:.5,picking:0,bondpicking:0,label:!1,popup:!1,popupOptions:{},info:"",title:"",dataformat:""};if(t)for(var n in t)typeof this._options[n]!="undefined"&&(this._options[n]=t[n]);this._widgets=[],_elColours=SmolElementData.elColours,_elVdwRadii=SmolElementData.elVdwRadii,_aaColours=[],_aaColours.ALA={r:200,g:200,b:200},_aaColours.ARG={r:20,g:90,b:255},_aaColours.ASN={r:0,g:220,b:220},_aaColours.ASP={r:230,g:10,b:10},_aaColours.CYS={r:230,g:230,b:0},_aaColours.GLN={r:0,g:220,b:220},_aaColours.GLU={r:230,g:10,b:10},_aaColours.GLY={r:235,g:235,b:235},_aaColours.HIS={r:130,g:130,b:210},_aaColours.ILE={r:15,g:130,b:15},_aaColours.LEU={r:15,g:130,b:15},_aaColours.LYS={r:20,g:90,b:255},_aaColours.MET={r:230,g:230,b:0},_aaColours.PHE={r:50,g:50,b:170},_aaColours.PRO={r:220,g:150,b:130},_aaColours.SER={r:250,g:150,b:0},_aaColours.THR={r:250,g:150,b:0},_aaColours.TRP={r:180,g:90,b:180},_aaColours.TYR={r:50,g:50,b:170},_aaColours.VAL={r:15,g:130,b:15},_aaColours.ASX={r:255,g:105,b:180},_aaColours.GLX={r:255,g:105,b:180},_aaColours.other={r:190,g:160,b:110},_aaColoursD=[],_aaColoursD.other={r:95,g:80,b:55},_aaColoursD.GLX={r:128,g:53,b:90},_aaColoursD.ASX={r:128,g:53,b:90},_aaColoursD.VAL={r:8,g:65,b:8},_aaColoursD.TYR={r:25,g:25,b:85},_aaColoursD.TRP={r:90,g:45,b:90},_aaColoursD.THR={r:125,g:75,b:0},_aaColoursD.SER={r:125,g:75,b:0},_aaColoursD.PRO={r:110,g:75,b:65},_aaColoursD.PHE={r:25,g:25,b:85},_aaColoursD.MET={r:115,g:115,b:0},_aaColoursD.LYS={r:10,g:45,b:128},_aaColoursD.LEU={r:8,g:65,b:8},_aaColoursD.ILE={r:8,g:65,b:8},_aaColoursD.HIS={r:65,g:65,b:105},_aaColoursD.GLY={r:118,g:118,b:118},_aaColoursD.GLU={r:115,g:5,b:5},_aaColoursD.GLN={r:0,g:110,b:110},_aaColoursD.CYS={r:115,g:115,b:0},_aaColoursD.ASP={r:115,g:5,b:5},_aaColoursD.ASN={r:0,g:110,b:110},_aaColoursD.ARG={r:10,g:45,b:128},_aaColoursD.ALA={r:100,g:100,b:100},_ssSheetColour={r:255,g:200,b:0},_ssSheetColourD={r:128,g:100,b:0},_ssHelixColour={r:255,g:0,b:128},_ssHelixColourD={r:128,g:0,b:64},_nonpolarCol={r:255,g:0,b:0},_polarCol={r:0,g:0,b:255},_nonpolarColD={r:128,g:0,b:0},_polarColD={r:0,g:0,b:128},_polarResidues=["ARG","HIS","LYS","ASP","GLU","SER","THR","ASN","GLN","CYS"],_nonpolarResidues=["GLY","PRO","ALA","VAL","LEU","ILE","MET","PHE","TYR","TRP"],_chainColours=[],_chainColours.A={r:192,g:208,b:255},_chainColours.a={r:144,g:160,b:207},_chainColours.B={r:176,g:255,b:176},_chainColours.b={r:128,g:207,b:152},_chainColours.C={r:255,g:192,b:200},_chainColours.c={r:207,g:144,b:176},_chainColours.D={r:255,g:255,b:128},_chainColours.d={r:207,g:207,b:112},_chainColours.E={r:255,g:192,b:255},_chainColours.e={r:207,g:144,b:207},_chainColours.F={r:176,g:240,b:240},_chainColours.f={r:128,g:192,b:192},_chainColours.G={r:255,g:208,b:112},_chainColours.g={r:207,g:160,b:96},_chainColours.H={r:240,g:128,b:128},_chainColours.h={r:192,g:80,b:112},_chainColours.I={r:245,g:222,b:179},_chainColours.i={r:197,g:174,b:131},_chainColours.J={r:0,g:191,b:255},_chainColours.j={r:0,g:167,b:207},_chainColours.K={r:205,g:92,b:92},_chainColours.k={r:181,g:76,b:76},_chainColours.L={r:102,g:205,b:170},_chainColours.l={r:86,g:181,b:146},_chainColours.M={r:154,g:205,b:50},_chainColours.m={r:138,g:181,b:42},_chainColours.N={r:238,g:130,b:238},_chainColours.n={r:190,g:114,b:190},_chainColours.O={r:0,g:206,b:209},_chainColours.o={r:0,g:182,b:161},_chainColours.P={r:0,g:255,b:127},_chainColours.p={r:0,g:207,b:111},_chainColours[0]={r:0,g:207,b:111},_chainColours.Q={r:60,g:179,b:113},_chainColours.q={r:52,g:155,b:97},_chainColours[1]={r:52,g:155,b:97},_chainColours.R={r:0,g:0,b:139},_chainColours.r={r:0,g:0,b:187},_chainColours[2]={r:0,g:0,b:187},_chainColours.S={r:189,g:183,b:107},_chainColours.s={r:165,g:159,b:91},_chainColours[3]={r:165,g:159,b:91},_chainColours.T={r:0,g:100,b:0},_chainColours.t={r:0,g:148,b:0},_chainColours[4]={r:0,g:148,b:0},_chainColours.U={r:128,g:0,b:0},_chainColours.u={r:176,g:0,b:0},_chainColours[5]={r:176,g:0,b:0},_chainColours.V={r:128,g:128,b:0},_chainColours.v={r:176,g:176,b:0},_chainColours[6]={r:176,g:176,b:0},_chainColours.W={r:128,g:0,b:128},_chainColours.w={r:176,g:0,b:176},_chainColours[7]={r:176,g:0,b:176},_chainColours.X={r:0,g:128,b:128},_chainColours.x={r:0,g:176,b:176},_chainColours[8]={r:0,g:176,b:176},_chainColours.Y={r:184,g:134,b:11},_chainColours.y={r:232,g:182,b:19},_chainColours[9]={r:232,g:182,b:19},_chainColours.Z={r:178,g:34,b:34},_chainColours.z={r:194,g:50,b:50},_chainColours.other={r:190,g:160,b:110},_chainColoursD=[],_chainColoursD.other={r:95,g:80,b:55},_chainColoursD.z={r:97,g:25,b:25},_chainColoursD.Z={r:89,g:17,b:17},_chainColoursD[9]={r:116,g:91,b:10},_chainColoursD.y={r:116,g:91,b:10},_chainColoursD.Y={r:92,g:67,b:6},_chainColoursD[8]={r:0,g:88,b:88},_chainColoursD.x={r:0,g:88,b:88},_chainColoursD.X={r:0,g:64,b:64},_chainColoursD[7]={r:88,g:0,b:88},_chainColoursD.w={r:88,g:0,b:88},_chainColoursD.W={r:64,g:0,b:64},_chainColoursD[6]={r:88,g:88,b:0},_chainColoursD.v={r:88,g:88,b:0},_chainColoursD.V={r:64,g:64,b:0},_chainColoursD[5]={r:88,g:0,b:0},_chainColoursD.u={r:88,g:0,b:0},_chainColoursD.U={r:64,g:0,b:0},_chainColoursD[4]={r:0,g:74,b:0},_chainColoursD.t={r:0,g:74,b:0},_chainColoursD.T={r:0,g:50,b:0},_chainColoursD[3]={r:83,g:80,b:46},_chainColoursD.s={r:83,g:80,b:46},_chainColoursD.S={r:95,g:92,b:54},_chainColoursD[2]={r:0,g:0,b:94},_chainColoursD.r={r:0,g:0,b:94},_chainColoursD.R={r:0,g:0,b:70},_chainColoursD[1]={r:26,g:78,b:49},_chainColoursD.q={r:26,g:78,b:49},_chainColoursD.Q={r:30,g:90,b:57},_chainColoursD[0]={r:0,g:104,b:56},_chainColoursD.p={r:0,g:104,b:56},_chainColoursD.P={r:0,g:128,b:64},_chainColoursD.o={r:0,g:91,b:81},_chainColoursD.O={r:0,g:103,b:105},_chainColoursD.n={r:95,g:57,b:95},_chainColoursD.N={r:119,g:65,b:119},_chainColoursD.m={r:69,g:91,b:21},_chainColoursD.M={r:77,g:103,b:25},_chainColoursD.l={r:43,g:91,b:73},_chainColoursD.L={r:51,g:103,b:85},_chainColoursD.k={r:91,g:38,b:38},_chainColoursD.K={r:103,g:46,b:46},_chainColoursD.j={r:0,g:84,b:104},_chainColoursD.J={r:0,g:96,b:128},_chainColoursD.i={r:99,g:87,b:66},_chainColoursD.I={r:123,g:111,b:90},_chainColoursD.h={r:96,g:40,b:56},_chainColoursD.H={r:120,g:64,b:64},_chainColoursD.g={r:104,g:80,b:48},_chainColoursD.G={r:128,g:104,b:56},_chainColoursD.f={r:64,g:96,b:96},_chainColoursD.F={r:88,g:120,b:120},_chainColoursD.e={r:104,g:72,b:104},_chainColoursD.E={r:128,g:96,b:128},_chainColoursD.d={r:104,g:104,b:56},_chainColoursD.D={r:128,g:128,b:64},_chainColoursD.c={r:104,g:72,b:88},_chainColoursD.C={r:128,g:96,b:100},_chainColoursD.b={r:64,g:104,b:76},_chainColoursD.B={r:88,g:128,b:88},_chainColoursD.a={r:72,g:80,b:104},_chainColoursD.A={r:96,g:104,b:128},this._getModels(e)},e.prototype._getModels=function(t){function M(e){n[e]?(c=new Date,C._getModelSet(C.blocks[n[e].cifblk],N._options.symRange,n[e].type,function(){_(e)})):typeof N._options.readyCallback=="function"&&N._options.readyCallback(N)}function _(t){n[t].atoms=C.blocks[n[t].cifblk].model[n[t].type],n[t].selection=[],n[t].selection.length=0,_addAtomProperties(n[t].atoms),C.blocks[n[t].cifblk].mmcif&&(n[t].macromol=!0,n[t].colourScheme=N._options.colourScheme,_setRibbonData(n[t])),n[t].cell=C.blocks[n[t].cifblk].F2CmatrixCell,n[t].celldata=C.blocks[n[t].cifblk].cell;if(C.blocks[n[t].cifblk].mmcif){var r=o.ribbondata.extent;n[t].center2d={x:r[2][0],y:r[2][1],z:r[2][2]},n[t].center2d_orig={x:r[2][0],y:r[2][1],z:r[2][2]};var i=r[1][0]-r[0][0],s=r[1][1]-r[0][1],u=r[1][2]-r[0][2];n[t].maxD=Math.sqrt(i*i+s*s+u*u);if(!isFinite(n[t].maxD)||n[t].maxD==0)n[t].maxD=10}else{var r=_getExtent(n[t].atoms);n[t].center2d={x:r[2][0],y:r[2][1],z:r[2][2]},n[t].center2d_orig={x:r[2][0],y:r[2][1],z:r[2][2]};var i=r[1][0]-r[0][0],s=r[1][1]-r[0][1],u=r[1][2]-r[0][2];n[t].maxD=Math.sqrt(i*i+s*s+u*u);if(!isFinite(n[t].maxD)||n[t].maxD==0)n[t].maxD=10}n[t].scaleFactor2d=1;var a=N._options.id,f;N._options.popup&&(f=new SmolPopup({size:N._options.size,info:N._options.info,title:N._options.title,popupOptions:N._options.popupOptions}),a=f.popup._smoldiv.id);var l=new e._widget(a,t,N._options);f&&(f.popup._smolwidget=l,l.pup=f.popup);var c=l.w;l.h<c&&(c=l.h),n[t].scaleFactor2d=.9*c/n[t].maxD,l.model=n[t],l._cif=C,N._widgets[t]=l;if(N._options.show==-1||N._options.show==t)if(N._options.view=="cell555"||N._options.view=="cell5551"){N._widgets[t]._show();var h=N._widgets[t],p=N._options.view;setTimeout(function(){h.changeModel(p)},0)}else N._widgets[t]._show();t++,setTimeout(function(){M(t)},0)}var n=[],r=0;if(this._options.dataformat=="pdb"){var i=this._parsePDB(t);if(i&&i.length>0)for(var s=0;s<i.length;++s){var o={};o.cifblk=null,o.atoms=i[s],o.macromol=!0,o.colourScheme=this._options.colourScheme,_addAtomProperties(o.atoms),_setRibbonData(o);var u=_getExtent(o.atoms);o.center2d={x:u[2][0],y:u[2][1],z:u[2][2]},o.center2d_orig={x:u[2][0],y:u[2][1],z:u[2][2]};var a=u[1][0]-u[0][0],f=u[1][1]-u[0][1],l=u[1][2]-u[0][2];o.maxD=Math.sqrt(a*a+f*f+l*l);if(!isFinite(o.maxD)||o.maxD==0)o.maxD=10;o.scaleFactor2d=1,n[r]=o,r++}}if(n&&n.length>0){this._createWidgets(n);return}if(typeof t=="string"){var c=new Date;if(t.indexOf("#\\#PLATON")==0){var h=t,p=[],d=0,v=this._parsePlatonLis(h);if(v&&v.length>0)for(var m=0;m<v.length;++m){var g={};g.cifblk=null,g.atoms=v[m].atoms,g.bestfit=v[m].q,g.bestfit.push(1),g.moieties=v[m].moieties,g.platonsymops=v[m].platonsymops,g.cifblock=v[m].cifblock,_addAtomProperties(g.atoms);var y=_getExtent(g.atoms);g.center2d={x:y[2][0],y:y[2][1],z:y[2][2]},g.center2d_orig={x:y[2][0],y:y[2][1],z:y[2][2]};var b=y[1][0]-y[0][0],r=y[1][1]-y[0][1],w=y[1][2]-y[0][2];g.maxD=Math.sqrt(b*b+r*r+w*w);if(!isFinite(g.maxD)||g.maxD==0)g.maxD=10;g.scaleFactor2d=1,p[d]=g,d++}if(p&&p.length>0){this._createWidgets(p);return}}if(t.indexOf("#\\#MMCIFMOL")==0){var h=t,p=[],d=0,h=t,E=this._parseMMCIFmol(h);if(E&&E.length>0)for(var S=0;S<E.length;++S){var g={};g.cifblk=null,g.atoms=E[S],g.macromol=!0,g.colourScheme=this._options.colourScheme,_addAtomProperties(g.atoms,0,0,!0),_setRibbonData(g,6e4);var y=g.ribbondata.extent;g.center2d={x:y[2][0],y:y[2][1],z:y[2][2]},g.center2d_orig={x:y[2][0],y:y[2][1],z:y[2][2]};var b=y[1][0]-y[0][0],r=y[1][1]-y[0][1],w=y[1][2]-y[0][2];g.maxD=Math.sqrt(b*b+r*r+w*w);if(!isFinite(g.maxD)||g.maxD==0)g.maxD=10;g.scaleFactor2d=1,p[d]=g,d++}if(p&&p.length>0){this._createWidgets(p);return}}if(t.indexOf("#\\#CIFMOL")==0){var x=this._parseCIFmol(t);if(x&&x.length>0)for(var d=0;d<x.length;++d){var o={};o.cell=x[d].cell,o.cifblk=null,o.atoms=x[d].cell555,_addAtomProperties(o.atoms);var u=_getExtent(o.atoms);o.center2d={x:u[2][0],y:u[2][1],z:u[2][2]},o.center2d_orig={x:u[2][0],y:u[2][1],z:u[2][2]};var a=u[1][0]-u[0][0],f=u[1][1]-u[0][1],l=u[1][2]-u[0][2];o.maxD=Math.sqrt(a*a+f*f+l*l);if(!isFinite(o.maxD)||o.maxD==0)o.maxD=10;o.scaleFactor2d=1,n[r]=o,r++}if(n&&n.length>0){this._createWidgets(n);return}}var T=this._parseSDF(t);if(T&&T.length>0)for(var d=0;d<T.length;++d){var o={};o.cifblk=null,o.atoms=T[d],_addAtomProperties(o.atoms);var u=_getExtent(o.atoms);o.center2d={x:u[2][0],y:u[2][1],z:u[2][2]},o.center2d_orig={x:u[2][0],y:u[2][1],z:u[2][2]};var a=u[1][0]-u[0][0],f=u[1][1]-u[0][1],l=u[1][2]-u[0][2];o.maxD=Math.sqrt(a*a+f*f+l*l);if(!isFinite(o.maxD)||o.maxD==0)o.maxD=10;o.scaleFactor2d=1,n[r]=o,r++}}if(n&&n.length>0){this._createWidgets(n);return}var N=this,C;typeof t!="string"&&t.blocks?C=t:C=new Scif(t);for(var k in C.blocks)if(C.blocks[k].structure){var o={};o.type=this._options.type,o.cifblk=k,n[r]=o;if(r==0&&C.blocks[k].cifmol){var L=C.blocks[k].getKeyId(),A=!1;if(window.XMLHttpRequest&&!window.ActiveXObject)try{A=new XMLHttpRequest}catch(O){A=!1}else if(window.ActiveXObject)try{A=new ActiveXObject("Msxml2.XMLHTTP")}catch(O){try{A=new ActiveXObject("Microsoft.XMLHTTP")}catch(O){A=!1}}if(A)try{A.onreadystatechange=function(){A.readyState==4&&A.status==200},A.open("GET","/services/tools/printcif.php?log="+L,!0),A.send("")}catch(O){}}r++}var c=new Date;M(0)},e.prototype._createWidgets=function(t){function u(t){if(r[t]){var i=new e._widget(s,t,n._options);o&&(o.popup._smolwidget=i,i.pup=o.popup);var a=i.w;i.h<a&&(a=i.h),r[t].scaleFactor2d=.9*a/r[t].maxD,i.model=r[t],n._widgets[t]=i,(n._options.show==-1||n._options.show==t)&&n._widgets[t]._show(),t++,setTimeout(function(){u(t)},1)}else typeof n._options.readyCallback=="function"&&n._options.readyCallback(n)}var n=this,r=t,i=this._widgets.length,s=this._options.id,o;this._options.popup&&(o=new SmolPopup({size:n._options.size,info:n._options.info,title:n._options.title,popupOptions:n._options.popupOptions}),s=o.popup._smoldiv.id),setTimeout(function(){u(0)},0)},e.prototype._parsePDB=function(e){var t=[],n={},r={sheet:[],helix:[],biomtChains:"",biomtMatrices:[],symMat:[],pdbID:"",title:""},i,s=0;lines=e.split("\n");for(var o=0;o<lines.length;o++){line=lines[o].replace(/^\s*/,"");var u=line.substr(0,6);if(u=="ATOM  "||u=="HETATM"){var a,f,l,c,h,p,d,v,m,g,y,b;y=line.substr(16,1);if(y!=" "&&y!="A")continue;g=parseInt(line.substr(6,5)),a=line.substr(12,4).replace(/ /g,""),f=line.substr(17,3),l=line.substr(21,1),c=parseInt(line.substr(22,5)),h=parseFloat(line.substr(30,8)),p=parseFloat(line.substr(38,8)),d=parseFloat(line.substr(46,8)),b=parseFloat(line.substr(60,8)),m=line.substr(76,2).replace(/ /g,""),m==""&&(m=line.substr(12,4).replace(/ /g,"")),m.length>1&&(m=m.substring(0,1).toUpperCase()+m.substring(1).toLowerCase()),line[0]=="H"?v=!0:v=!1,n[g]={resn:f,x:h,y:p,z:d,elem:m,hetflag:v,chain:l,resi:c,idx:g,atom:a,bonds:[],ss:"c",color:16777215,bonds:[],bondOrder:[],b:b}}else if(u=="SHEET "){var w=line.substr(21,1),E=parseInt(line.substr(22,4)),S=line.substr(32,1),x=parseInt(line.substr(33,4));r.sheet.push([w,E,S,x])}else if(u=="CONECT"){var T=parseInt(line.substr(6,5));for(var N=0;N<4;N++){var C=parseInt(line.substr([11,16,21,26][N],5));if(isNaN(C))continue;n[T]!=undefined&&(n[T].bonds.push(C),n[T].bondOrder.push(1))}}else if(u=="HELIX "){var w=line.substr(19,1),E=parseInt(line.substr(21,4)),S=line.substr(31,1),x=parseInt(line.substr(33,4));r.helix.push([w,E,S,x])}else if(u=="CRYST1")r.a=parseFloat(line.substr(6,9)),r.b=parseFloat(line.substr(15,9)),r.c=parseFloat(line.substr(24,9)),r.alpha=parseFloat(line.substr(33,7)),r.beta=parseFloat(line.substr(40,7)),r.gamma=parseFloat(line.substr(47,7)),r.spacegroup=line.substr(55,11);else if(u=="REMARK"){var k=parseInt(line.substr(7,3));if(k==290&&line.substr(13,5)=="SMTRY"){var L=parseInt(line[18])-1,A=parseInt(line.substr(21,2));r.symMat[A]==undefined&&(r.symMat[A]=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),r.symMat[A][L]=parseFloat(line.substr(24,9)),r.symMat[A][L+4]=parseFloat(line.substr(34,9)),r.symMat[A][L+8]=parseFloat(line.substr(44,9)),r.symMat[A][L+12]=parseFloat(line.substr(54,10))}else if(k==350&&line.substr(13,5)=="BIOMT"){var L=parseInt(line[18])-1,A=parseInt(line.substr(21,2));r.biomtMatrices[A]==undefined&&(r.biomtMatrices[A]=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),r.biomtMatrices[A][L]=parseFloat(line.substr(24,9)),r.biomtMatrices[A][L+4]=parseFloat(line.substr(34,9)),r.biomtMatrices[A][L+8]=parseFloat(line.substr(44,9)),r.biomtMatrices[A][L+12]=parseFloat(line.substr(54,10))}else k==350&&line.substr(11,11)=="BIOMOLECULE"?(r.biomtMatrices=[],r.biomtChains=""):k==350&&line.substr(34,6)=="CHAINS"&&(r.biomtChains+=line.substr(41,40))}else u=="HEADER"?r.pdbID=line.substr(62,4):u=="TITLE "?(r.title==undefined&&(r.title=""),r.title+=line.substr(10,70)+"\n"):u=="COMPND"}for(var o in n){var O=n[o];if(O==undefined)continue;for(N=0;N<r.sheet.length;N++){if(O.chain!=r.sheet[N][0])continue;if(O.resi<r.sheet[N][1])continue;if(O.resi>r.sheet[N][3])continue;O.ss="s",O.resi==r.sheet[N][1]&&(O.ssbegin=!0),O.resi==r.sheet[N][3]&&(O.ssend=!0)}for(N=0;N<r.helix.length;N++){if(O.chain!=r.helix[N][0])continue;if(O.resi<r.helix[N][1])continue;if(O.resi>r.helix[N][3])continue;O.ss="h",O.resi==r.helix[N][1]?O.ssbegin=!0:O.resi==r.helix[N][3]&&(O.ssend=!0)}}return r.smallMolecule=!1,t.push(n),t},e.prototype._parseSDF=function(e){var t=[],n=e.split("\n");if(n.length<4)return;var r=0,i=0;while(i<n.length-1){if(r>-1){var s=[],o=parseInt(n[r+3].substr(0,3));if(isNaN(o)||o<=0)return;var u=parseInt(n[r+3].substr(3,3));if(isNaN(u))return;var a=r+4;if(n.length<4+o+u)return;for(var f=1;f<=o;f++){var l=n[a];a++;var c={};c.idx=f,c.x=parseFloat(l.substr(0,10)),c.y=parseFloat(l.substr(10,10)),c.z=parseFloat(l.substr(20,10)),c.xyz=[c.x,c.y,c.z],c.elem=l.substr(31,3).replace(/ /g,""),c.atom=c.elem+c.idx+"",c.bonds=[],c.bondOrder=[],s[f]=c}for(f=1;f<=u;f++){var l=n[a];a++;var h=parseInt(l.substr(0,3)),p=parseInt(l.substr(3,3)),d=parseInt(l.substr(6,3));if(isNaN(h)||isNaN(p)||isNaN(d))return;s[h].bonds.push(p),s[h].bondOrder.push(d),s[p].bonds.push(h),s[p].bondOrder.push(d)}t.push(s),r=-1,i=a}else n[i].substr(0,4)=="$$$$"&&(r=i+1);i++}return t},e.prototype._parseCIFmol=function(e){var t=[],n=0,r=e.split("\n"),i=[],s=[],o=[],u=[],a,f=0;for(var l=0;l<r.length;l++){var c=r[l].replace(/\s+/g," ").replace(/^\s*|\s*$/g,"");if(c.indexOf("_data")==0){if(t.length>0){for(var h in i)i[h].asu&&(o[h]=i[h]),i[h].mol&&(s[h]=i[h]),i[h].cell&&(u[h]=i[h]);t.push({atoms:i,asu:o,cell555:u,mol:s,cell:a}),i.length=0,o.length=0,u.length=0,s.length=0,a=null}n=1}else if(c.indexOf("_cifmol_cell_matrix")==0)a=JSON.parse(r[l].replace(/\s*_cifmol_cell_matrix\s*/i,""));else if(c.indexOf("loop_ _cifmol_atom_site_type_symbol")==0)n=2;else if(n==2){var p=c.split(" "),d={};f++,d.asu=!1,d.cell=!1,d.mol=!1,d.idx=f,d.elem=p[0],d.atom=p[1],d.x=parseFloat(p[2]),d.y=parseFloat(p[3]),d.z=parseFloat(p[4]),d.bonds=[],p.length>=6&&p[5]!="."&&(d.bonds=p[5].split(",")),d.bondOrder=[],p.length>=7&&p[6]!="."&&(d.bondOrder=p[6].split(",")),p.length>=8&&(p[7].indexOf("asu")>-1&&(d.asu=!0),p[7].indexOf("mol")>-1&&(d.mol=!0),p[7].indexOf("cell")>-1&&(d.cell=!0)),i[p[1]]=d}}for(var h in i)i[h].asu&&(o[h]=i[h]),i[h].mol&&(s[h]=i[h]),i[h].cell&&(u[h]=i[h]);return t.push({atoms:i,asu:o,cell555:u,mol:s,cell:a}),t},e.prototype._parseMMCIFmol=function(e){var t=[],n={},r={sheet:[],helix:[],biomtChains:"",biomtMatrices:[],symMat:[],pdbID:"",title:""},i,s=0,o=e.split("\n");for(var u=0;u<o.length;u++){var a=o[u].replace(/\s+/g," ").replace(/^\s*|\s*$/g,""),f=a.split(" "),l=f[0];if(l=="ATOM"&&(f[3]=="CA"||f[3]=="O")||l=="HETATM"){var c,h,p,d,v,m,g,y,b,w,E,S;w=parseInt(f[1]),c=f[3],h=f[5],p=f[6],d=parseInt(f[8]),v=parseFloat(f[10]),m=parseFloat(f[11]),g=parseFloat(f[12]),S=parseFloat(f[13]),b=f[2],b.length>1&&(b=b.substring(0,1).toUpperCase()+b.substring(1).toLowerCase()),l=="HETATM"?y=!0:y=!1,n[w]={resn:h,x:v,y:m,z:g,elem:b,hetflag:y,chain:p,resi:d,idx:w,atom:c,ss:"c",color:0,bonds:[],bondOrder:[],b:S},s++}else l!="SHEET "&&l!="CONECT"&&l!="HELIX "&&l!="CRYST1"&&l!="REMARK"&&l!="HEADER"&&l!="TITLE "&&l=="COMPND";if(s>8e4)break}return r.smallMolecule=!1,t.push(n),t},e.prototype._parsePlatonLis=function(e){var t=[],n=0,r,i,s,o=0,u=[],a=[0,0,0,1],f=0,l=[],c=[],h=!1,p=[],d=[],v="",m=[],g=e.split("\n");if(g.length<4)return;for(var y=0;y<g.length;y++){v==""&&g[y].search(/^CIFBLOCK:/)>-1&&(v=g[y].replace(/^CIFBLOCK:/,""));if(g[y].search(/::\s+NEW\s+Xrot,\s+Yrot,\s+Zrot\s+=\s+/i)>-1){var b=g[y].replace(/\s+/g," ").replace(/^\s*|\s*$/g,""),w=b.split(" ");if(w.length>8){r=parseInt(w[6]),i=parseInt(w[7]),s=parseInt(w[8]),s*=-1,r*=-1,r*=Math.PI/180,i*=Math.PI/180,s*=Math.PI/180;var E=Math.cos(i/2),S=Math.sin(i/2),x=Math.cos(s/2),T=Math.sin(s/2),N=Math.cos(r/2),C=Math.sin(r/2),k=E*x,L=S*T,A=k*N-L*C,O=k*C+L*N,M=S*x*N-E*T*C,_=E*T*N+S*x*C;a=[O,M,_,A]}}if(g[y].search(/^\-+\s*$/)>-1)continue;if(g[y].search(/^=+\s*$/)>-1)continue;if(g[y].indexOf("\f")==0)continue;g[y].search(/^\s*Flags\s+Label\s+Fractional\s+Coordinates/i)>-1&&(f++,l.push({id:f,formula:"",size:0}),f>1&&(c.push(m),m=[],m.length=0),n=2),g[y].search(/^\s*Flag\s+Label\s+\-\s+Connected\s+to/i)>-1&&(n=3),g[y].search(/^\s*ARU\-CODE\s+CIF\-CODE\s+Symmetry\-Code/i)>-1&&(n=4);if(n==4&&h)if(g[y].search(/Asymmetric\s+Residue\s+Unit|Unit\s+Cell\s+Contents|Displacement\s+Parameters/i)>-1)n=0;else for(var D=0;D<p.length;D++)if(g[y].indexOf(" "+p[D])>-1){var P=g[y].split("=");if(P.length>4){var H=P[0].replace(/^\s*|\s*$/g,""),B=P[3].replace(/^\s*|\s*$/g,"");d[p[D]]=[H,B]}}if(n==2)if(g[y].search(/Asymmetric\s+Residue\s+Unit|Unit\s+Cell\s+Contents|Displacement\s+Parameters/i)>-1)n=0,c.push(m),m=[],m.length=0;else if(g[y].search(/^[^\s]+\s+[^\s]+(\s+\-?\d\/\d+|\s+\-?\d+\.\d+(\(\d+\))?|\s+\d\s+){6,}/i)>-1){var b=g[y].replace(/\s+/g," ").replace(/^\s*|\s*$/g,""),w=b.split(" "),j={};if(w.length>11&&w[11].search(/^\d+(\.\d\d\d)?$/ig)>-1){var F=w[11].replace(/\./ig,"")+".";f<10&&(F+="0"),F+=f;var I=!0;for(var D=0;D<p.length;D++)if(p[D]==F){I=!1;break}I&&(p.push(F),h=!0)}j.fx=parseFloat(w[2]),j.fy=parseFloat(w[3]),j.fz=parseFloat(w[4]),j.x=parseFloat(w[5]),j.y=parseFloat(w[6]),j.z=parseFloat(w[7]),j.fxyz=[j.fx,j.fy,j.fz],j.xyz=[j.x,j.y,j.z];var q=w[1].replace(/[\*<>]/g,"");j.elem=q.replace(/^([A-Z][a-z]?).*$/g,"$1"),typeof m[j.elem]=="undefined"&&(m[j.elem]=0),m[j.elem]++,j.atom=j.elem+o+"",j.bonds=[],j.bondOrder=[],j.moiety=f,j.idx=q,u[q]=j,o++}if(n==3){if(g[y].search(/Asymmetric\s+Residue\s+Unit|Unit\s+Cell\s+Contents|Displacement\s+Parameters/i)>-1){n=0;break}if(g[y].search(/^[^\s]+\s+[^\s]+\s+\-[\s<>\*]+[^\s]+/i)>-1){var b=g[y].replace(/[<>\*]/g," ").replace(/\s+/g," ").replace(/^\s*|\s*$/g,""),w=b.split(" "),q=w[1];if(u[q])for(var R=3;R<w.length;R++){var U=w[R];if(!u[U])break;u[q].bonds.push(U),u[q].bondOrder.push(1)}}}}for(var z=0;z<c.length;z++){var W=[];for(var X in c[z])W.push(X);W.sort();var V=W.length,$="",J="",K="",Q=0;for(var G=0;G<W.length;G++){var Y=W[G],Z=c[z][Y];Q+=Z;var et="&#8203;";Z>1&&(et="<sub>"+Z+"</sub>&#8203;"),Y=="C"?$=Y+et:Y=="H"?J=Y+et:K+=Y+et}var tt=$+J+K;l[z].formula=tt,l[z].size=Q}return t.push({atoms:u,q:a,moieties:l,platonsymops:d,cifblock:v}),t},_getExtent=function(e){var t=ymin=zmin=9999,n=ymax=zmax=-9999,r=ysum=zsum=cnt=0;for(var i in e){var s=e[i];if(s==undefined)continue;if(s.x==undefined)continue;cnt++,r+=s.x,ysum+=s.y,zsum+=s.z,t=t<s.x?t:s.x,ymin=ymin<s.y?ymin:s.y,zmin=zmin<s.z?zmin:s.z,n=n>s.x?n:s.x,ymax=ymax>s.y?ymax:s.y,zmax=zmax>s.z?zmax:s.z}return[[t,ymin,zmin],[n,ymax,zmax],[r/cnt,ysum/cnt,zsum/cnt]]},_gradColor=function(e,t,n){var r={};return r.r=e.r+Math.round(n*(t.r-e.r)),r.b=e.b+Math.round(n*(t.b-e.b)),r.g=e.g+Math.round(n*(t.g-e.g)),r},_addAtomProperties=function(e,t,n,r){t||(t=.3),n||(n=.7);for(var i in e){var s=e[i];if(!s||!s.elem)continue;s.bonds||(s.bonds=[],s.bondOrder=[],s.bonds.length=0,s.bondOrder.length=0);if(s.bonds.length!=s.bondOrder.length){s.bondOrder.length=0;for(var o=0;o<s.bonds.length;o++)s.bondOrder.push(1)}s.vdwRad=_elVdwRadii[s.elem];var u=_elColours[s.elem];u==undefined&&(u=0);var a=u>>16,f=u>>8&255,l=u&255,c="rgb("+a+","+f+","+l+")",h="rgb("+a+","+f+","+l+")",p=1;if(typeof s.occ!="undefined"&&s.occ<1){var d=s.occ;d<.3&&(d=.3),c="rgba("+a+","+f+","+l+","+d+")",h="rgba("+a+","+f+","+l+","+d+")",p=d}s.color={hex:u,r:a,g:f,b:l,rgb:h,rgbBase:c},s.color.rgbLa="rgba("+a+","+f+","+l+", 0.7)";if(r){s.color.rgbD=s.color.rgbL=s.color.rgb50=s.color.rgb;continue}var v={r:a,b:l,g:f},m={r:255,b:255,g:255},g=_gradColor(v,m,.5),y=g.r,b=g.g,w=g.b;y==255&&w<50&&b<50&&(w=100,b=100),w==255&&y<50&&b<50&&(y=100,b=100),b==255&&w<50&&y<50&&(w=100,y=100),s.color.rgb50="rgb("+y+","+b+","+w+")",g=_gradColor(v,m,n);var y=g.r,b=g.g,w=g.b;y==255&&w<50&&b<50&&(w=100,b=100),w==255&&y<50&&b<50&&(y=100,b=100),b==255&&w<50&&y<50&&(w=100,y=100),p==1?s.color.rgbL="rgb("+y+","+b+","+w+")":s.color.rgbL="rgba("+y+","+b+","+w+","+p+")",m={r:0,b:0,g:0},g=_gradColor(v,m,t);var y=g.r,b=g.g,w=g.b;y==255&&w<50&&b<50&&(w=100,b=100),w==255&&y<50&&b<50&&(y=100,b=100),b==255&&w<50&&y<50&&(w=100,y=100),p==1?s.color.rgb="rgb("+y+","+b+","+w+")":s.color.rgb="rgba("+y+","+b+","+w+","+p+")",m={r:0,b:0,g:0},g=_gradColor(v,m,.5);var y=g.r,b=g.g,w=g.b;y==255&&w<50&&b<50&&(w=100,b=100),w==255&&y<50&&b<50&&(y=100,b=100),b==255&&w<50&&y<50&&(w=100,y=100),p==1?s.color.rgbD="rgb("+y+","+b+","+w+")":s.color.rgbD="rgba("+y+","+b+","+w+","+p+")"}},_setRibbonData=function(e,t){var n=e.atoms,r=3,i=20,s=1.3,o=1.3,u=1.9,a=.3;e.ribbondata=[];var f,l,c,h,p,d,v=ysum=zsum=cnt=0,m=[];for(var g=0;g<r;g++)m[g]=[];var y=[];for(var g=0;g<r;g++)y[g]=[];var b,w,E,S=null,x=null,T=!1,N=null,C=[];for(var g=0;g<r;g++)C[g]=[];var k=[];for(var g=0;g<r;g++)k[g]=[];var L,A,O,M=null,_=null,D=!1,P=null,H=0;if(t)H=t,H>1e4&&(i=10),H>5e4&&(i=5),H>1e5&&(i=2);else for(var B in n){H++,H>1e4&&(i=10),H>5e4&&(i=5);if(H>1e5){i=2;break}}var j=[],F,I,q,R;for(var B in n){var U=n[B];if(U==undefined)continue;if(U.resi!=R||U.chain!=q)F!=null&&I!=null&&j.push({start:F,end:I}),F=null,I=null;U.atom=="O3'"&&!U.hetflag&&(F=U),U.resn=="A"||U.resn=="G"||U.resn=="DA"||U.resn=="DG"?U.atom=="N1"&&(I=U):U.atom=="N3"&&(I=U),R=U.resi,q=U.chain;if(U.atom!="O"&&U.atom!="CA"||!!U.hetflag)if(U.atom=="O3'"||U.atom=="OP2")if(U.atom=="O3'"){if(C[0]&&C[0].length>0&&L&&A&&(L!=U.chain||A+1!=U.resi)){var z=[];if(O&&M)for(var W=0;W<r;W++){var X=-1+2/(r-1)*W,V={x:O[0]+M[0]*X,y:O[1]+M[1]*X,z:O[2]+M[2]*X};C[W].push(V),k[W].push(P)}for(var $=0;$<C.length;$++){if(C[$].length==0)continue;C[$]=_subDividePoints(C[$],i);for(var J=0;J<C[$].length;++J){var K=J==0?0:Math.round((J-1)/i);C[$][J].atomidx=k[$][K]}z.push(C[$])}z.length>0&&e.ribbondata.push(z),C=[];for(var g=0;g<r;g++)C[g]=[];k=[];for(var g=0;g<r;g++)k[g]=[];M=null,_=null,D=!1,P=null}O=[U.x,U.y,U.z],L=U.chain,A=U.resi,_=U.ss,D=U.ssbegin||U.ssend,P=B}else{if(!O){M=null;continue}var Q=[U.x-O[0],U.y-O[1],U.z-O[2]],G=Math.sqrt(Q[0]*Q[0]+Q[1]*Q[1]+Q[2]*Q[2]);Q=[Q[0]/G,Q[1]/G,Q[2]/G];var Y=.8;_=="h"?Y=u:_=="s"&&(Y=o),Q=[Q[0]*Y,Q[1]*Y,Q[2]*Y],M!=undefined&&Q[0]*M[0]+Q[1]*M[1]+Q[2]*M[2]<0&&(Q=[Q[0]*-1,Q[1]*-1,Q[2]*-1]),M=Q;for(var W=0;W<r;W++){var X=-1+2/(r-1)*W,V={x:O[0]+M[0]*X,y:O[1]+M[1]*X,z:O[2]+M[2]*X};_=="s"&&(V.smoothen=!0),typeof f=="undefined"&&(f=V.x,l=V.y,c=V.z,h=V.x,p=V.y,d=V.z),V.x>f&&(f=V.x),V.y>l&&(l=V.y),V.z>c&&(c=V.z),V.x<h&&(h=V.x),V.y<p&&(p=V.y),V.z<d&&(d=V.z),cnt++,v+=V.x,ysum+=V.y,zsum+=V.z,C[W].push(V),k[W].push(P)}}else{var V=U;typeof f=="undefined"&&(f=V.x,l=V.y,c=V.z,h=V.x,p=V.y,d=V.z),V.x>f&&(f=V.x),V.y>l&&(l=V.y),V.z>c&&(c=V.z),V.x<h&&(h=V.x),V.y<p&&(p=V.y),V.z<d&&(d=V.z),cnt++,v+=V.x,ysum+=V.y,zsum+=V.z}else if(U.atom=="CA"){if(m[0]&&m[0].length>0&&b&&w&&(b!=U.chain||w+1!=U.resi)){var z=[];for(var $=0;$<m.length;$++){if(m[$].length==0)continue;m[$]=_subDividePoints(m[$],i);for(var J=0;J<m[$].length;++J){var K=J==0?0:Math.round((J-1)/i);m[$][J].atomidx=y[$][K]}z.push(m[$])}z.length>0&&e.ribbondata.push(z),m=[];for(var g=0;g<r;g++)m[g]=[];y=[];for(var g=0;g<r;g++)y[g]=[];S=null,x=null,T=!1,N=null}E=[U.x,U.y,U.z],b=U.chain,w=U.resi,x=U.ss,T=U.ssbegin||U.ssend,N=B}else{var Z=[U.x-E[0],U.y-E[1],U.z-E[2]],G=Math.sqrt(Z[0]*Z[0]+Z[1]*Z[1]+Z[2]*Z[2]);Z=[Z[0]/G,Z[1]/G,Z[2]/G];var Y;x=="h"?Y=u:x=="s"?Y=o:Y=a,Z=[Z[0]*Y,Z[1]*Y,Z[2]*Y],S!=undefined&&Z[0]*S[0]+Z[1]*S[1]+Z[2]*S[2]<0&&(Z=[Z[0]*-1,Z[1]*-1,Z[2]*-1]),S=Z;for(var W=0;W<r;W++){var X=-1+2/(r-1)*W,V={x:E[0]+S[0]*X,y:E[1]+S[1]*X,z:E[2]+S[2]*X};x=="s"&&(V.smoothen=!0),typeof f=="undefined"&&(f=V.x,l=V.y,c=V.z,h=V.x,p=V.y,d=V.z),V.x>f&&(f=V.x),V.y>l&&(l=V.y),V.z>c&&(c=V.z),V.x<h&&(h=V.x),V.y<p&&(p=V.y),V.z<d&&(d=V.z),cnt++,v+=V.x,ysum+=V.y,zsum+=V.z,m[W].push(V),y[W].push(N)}}}if(m[0]&&m[0].length>0){var z=[];for(var $=0;$<m.length;$++){if(m[$].length==0)continue;m[$]=_subDividePoints(m[$],i);for(var J=0;J<m[$].length;++J){var K=J==0?0:Math.round((J-1)/i);m[$][J].atomidx=y[$][K]}z.push(m[$])}z.length>0&&e.ribbondata.push(z)}if(C[0]&&C[0].length>0){if(O&&M)for(var W=0;W<r;W++){var X=-1+2/(r-1)*W,V={x:O[0]+M[0]*X,y:O[1]+M[1]*X,z:O[2]+M[2]*X};C[W].push(V),k[W].push(P)}var z=[];for(var $=0;$<C.length;$++){if(C[$].length==0)continue;C[$]=_subDividePoints(C[$],i);for(var J=0;J<C[$].length;++J){var K=J==0?0:Math.round((J-1)/i);C[$][J].atomidx=k[$][K]}z.push(C[$])}z.length>0&&e.ribbondata.push(z)}F!=null&&I!=null&&j.push({start:F,end:I}),e.ribbondata.rungs=j,e.ribbondata.extent=[[h,p,d],[f,l,c],[v/cnt,ysum/cnt,zsum/
cnt]],_colourRibbonData(e)},_subDividePoints=function(e,t){var n=[],r=e;r=new Array,r.push(e[0]);for(var i=1,s=e.length-1;i<s;i++){var o=e[i],u=e[i+1];o.smoothen?r.push({x:(o.x+u.x)/2,y:(o.y+u.y)/2,z:(o.z+u.z)/2}):r.push(o)}r.push(e[e.length-1]);for(var i=-1,a=r.length;i<=a-3;i++){var f=r[i==-1?0:i],o=r[i+1],u=r[i+2],l=r[i==a-3?a-1:i+3],c={x:(u.x-f.x)*.5,y:(u.y-f.y)*.5,z:(u.z-f.z)*.5},h={x:(l.x-o.x)*.5,y:(l.y-o.y)*.5,z:(l.z-o.z)*.5};for(var p=0;p<t;p++){var d=1/t*p,v=o.x+d*c.x+d*d*(-3*o.x+3*u.x-2*c.x-h.x)+d*d*d*(2*o.x-2*u.x+c.x+h.x),m=o.y+d*c.y+d*d*(-3*o.y+3*u.y-2*c.y-h.y)+d*d*d*(2*o.y-2*u.y+c.y+h.y),g=o.z+d*c.z+d*d*(-3*o.z+3*u.z-2*c.z-h.z)+d*d*d*(2*o.z-2*u.z+c.z+h.z);n.push({x:v,y:m,z:g})}}return n.push(r[r.length-1]),n},_subDividePoints=function(e,t){var n=[],r=e;r=new Array,r.push(e[0]);for(var i=1,s=e.length-1;i<s;i++){var o=e[i],u=e[i+1];o.smoothen?r.push({x:(o.x+u.x)/2,y:(o.y+u.y)/2,z:(o.z+u.z)/2}):r.push(o)}r.push(e[e.length-1]);for(var i=-1,a=r.length;i<=a-3;i++){var f=r[i==-1?0:i],o=r[i+1],u=r[i+2],l=r[i==a-3?a-1:i+3],c={x:(u.x-f.x)*.5,y:(u.y-f.y)*.5,z:(u.z-f.z)*.5},h={x:(l.x-o.x)*.5,y:(l.y-o.y)*.5,z:(l.z-o.z)*.5};for(var p=0;p<t;p++){var d=1/t*p,v=o.x+d*c.x+d*d*(-3*o.x+3*u.x-2*c.x-h.x)+d*d*d*(2*o.x-2*u.x+c.x+h.x),m=o.y+d*c.y+d*d*(-3*o.y+3*u.y-2*c.y-h.y)+d*d*d*(2*o.y-2*u.y+c.y+h.y),g=o.z+d*c.z+d*d*(-3*o.z+3*u.z-2*c.z-h.z)+d*d*d*(2*o.z-2*u.z+c.z+h.z);n.push({x:v,y:m,z:g})}}return n.push(r[r.length-1]),n},_colourRibbonData=function(e){var t=e.colourScheme;t||(t="rainbow",e.colourScheme=t),t=="rainbow"&&_colorChainbow(e);for(var n=0;n<e.ribbondata.length;n++)for(var r=0;r<e.ribbondata[n][0].length;r++){var i=e.ribbondata[n][0][r].atomidx;if(!e.atoms[i])continue;t=="aminoacid"?_aaColours[e.atoms[i].resn]?(e.ribbondata[n][0][r].color=_aaColours[e.atoms[i].resn],e.ribbondata[n][0][r].colorD=_aaColoursD[e.atoms[i].resn]):(e.ribbondata[n][0][r].color=_aaColours.other,e.ribbondata[n][0][r].colorD=_aaColoursD.other):t=="structure"?e.atoms[i].ss&&e.atoms[i].ss=="s"?(e.ribbondata[n][0][r].color=_ssSheetColour,e.ribbondata[n][0][r].colorD=_ssSheetColourD):e.atoms[i].ss&&e.atoms[i].ss=="h"?(e.ribbondata[n][0][r].color=_ssHelixColour,e.ribbondata[n][0][r].colorD=_ssHelixColourD):_aaColours[e.atoms[i].resn]?(e.ribbondata[n][0][r].color=_aaColours[e.atoms[i].resn],e.ribbondata[n][0][r].colorD=_aaColoursD[e.atoms[i].resn]):(e.ribbondata[n][0][r].color=_aaColours.other,e.ribbondata[n][0][r].colorD=_aaColoursD.other):t=="rainbow"?(e.ribbondata[n][0][r].color=e.atoms[i].rainbow,e.ribbondata[n][0][r].colorD=e.atoms[i].rainbowD):t=="chain"?_chainColours[e.atoms[i].chain]?(e.ribbondata[n][0][r].color=_chainColours[e.atoms[i].chain],e.ribbondata[n][0][r].colorD=_chainColoursD[e.atoms[i].chain]):(e.ribbondata[n][0][r].color=_chainColours.other,e.ribbondata[n][0][r].colorD=_chainColours.other):t=="polar"&&(_polarResidues.indexOf(e.atoms[i].resn)>-1?(e.ribbondata[n][0][r].color=_polarCol,e.ribbondata[n][0][r].colorD=_polarColD):_nonpolarResidues.indexOf(e.atoms[i].resn)>-1?(e.ribbondata[n][0][r].color=_nonpolarCol,e.ribbondata[n][0][r].colorD=_nonpolarColD):(e.ribbondata[n][0][r].color=_aaColours.other,e.ribbondata[n][0][r].colorD=_aaColoursD.other))}},_colorChainbow=function(e,t){t=!0;var n=0,r,i,s=e.atoms,o="",u=[];for(var i in s){var r=s[i];if(r==undefined)continue;(t||r.atom!="CA"||r.atom!="O3'")&&!r.hetflag&&(n++,o==""&&(o=r.chain),r.chain!=o&&(u.push(n),n=0,o=r.chain))}u.push(n);var a=u[0];n=0;var f=0;for(i in s){r=s[i];if(r==undefined)continue;r.rainbow={r:r.color.r,g:r.color.g,b:r.color.b},r.rainbowD={r:r.color.r,g:r.color.g,b:r.color.b};if((t||r.atom!="CA"||r.atom!="O3'")&&!r.hetflag){var l={r:0,g:0,b:0};l=_rgbFromHSV(240/360*(1-n/a),1,.9),r.rainbow.r=l.r*255|0,r.rainbow.g=l.g*255|0,r.rainbow.b=l.b*255|0,l=_rgbFromHSV(240/360*(1-n/a),1,.4),r.rainbowD.r=l.r*255|0,r.rainbowD.g=l.g*255|0,r.rainbowD.b=l.b*255|0,n++,n>=a&&(f++,u[f]&&(a=u[f]),n=0)}}},_rgbFromHSV=function(e,t,n){var r,i,s;ret={r:0,g:0,b:0};if(n===0)ret.r=ret.g=ret.b=0;else{r=Math.floor(e*6),i=e*6-r,e=n*(1-t),s=n*(1-t*i),t=n*(1-t*(1-i));switch(r){case 1:ret.r=s,ret.g=n,ret.b=e;break;case 2:ret.r=e,ret.g=n,ret.b=t;break;case 3:ret.r=e,ret.g=s,ret.b=n;break;case 4:ret.r=t,ret.g=e,ret.b=n;break;case 5:ret.r=n,ret.g=e,ret.b=s;break;case 6:case 0:ret.r=n,ret.g=t,ret.b=e}}return ret},e.prototype.resetColors=function(e,t,n){if(typeof n=="object")_addAtomProperties(n.model.atoms,e,t),n._show();else for(var r=0;r<this._widgets.length;++r)typeof n=="undefined"||n==-1||r==n},e.prototype.loadCIF=function(e,t){var n=document.getElementById(this._options.id);n&&(n.innerHTML="");for(var r=0;r<this._widgets.length;++r)delete this._widgets[r];this._widgets.length=0,this._createWidgets(this._getModels(e))},e.prototype.changeOptions=function(e,t){if(typeof t=="undefined"||t==-1)for(var n=0;n<this._widgets.length;++n)this._widgets[n]._show(e);else typeof t=="object"?t._show(e):this._widgets[t]&&this._widgets[t]._show(e)},e.prototype.changeModel=function(e,t){if(typeof t=="object")t.changeModel(e);else for(var n=0;n<this._widgets.length;++n)(typeof t=="undefined"||t==-1||n==t)&&this._widgets[n].changeModel(e)},e}();(function(e){function t(){var e=0;return self.innerHeight?e=self.innerWidth:document.documentElement&&document.documentElement.clientHeight?e=document.documentElement.clientWidth:document.body&&(e=document.body.clientWidth),e}function n(){var e=0;return self.innerHeight?e=self.innerHeight:document.documentElement&&document.documentElement.clientHeight?e=document.documentElement.clientHeight:document.body&&(e=document.body.clientHeight),e}function r(e,t,n){var r=e.idx,i=t.idx;e.symop!=undefined&&(r=e.atom+"_"+e.symop+"_"+e.symt,i=t.atom+"_"+t.symop+"_"+t.symt);var s=!1;for(var o=0,u=e.bonds.length;o<u;o++)if(e.bonds[o]==i){if(n==undefined){var a=e.bondOrder[o];typeof a=="undefined"&&(a=0),a==.5?a=0:(a++,a>3&&(a=.5)),n=a}e.bondOrder[o]=n,s=!0;break}s||(e.bonds.push(i),e.bondOrder.push(1)),s=!1;for(var o=0,u=t.bonds.length;o<u;o++)if(t.bonds[o]==r){if(n==undefined){var a=t.bondOrder[o];typeof a=="undefined"&&(a=0),a==.5?a=0:(a++,a>3&&(a=.5)),n=a}t.bondOrder[o]=n,s=!0;break}s||(t.bonds.push(r),t.bondOrder.push(1))}function i(e,t){var n=e.idx,r=t.idx;e.symop!=undefined&&(n=e.atom+"_"+e.symop+"_"+e.symt,r=t.atom+"_"+t.symop+"_"+t.symt);for(var i=0,s=e.bonds.length;i<s;i++)if(e.bonds[i]==r){var o=e.bondOrder[i];return typeof o=="undefined"&&(o=0),o}return 0}function s(e,t,n){var r=[],i=t.x-e.x,s=t.y-e.y,o=t.z-e.z,u=.1,a=i*i+s*s;u=1/(a/(n*n));for(var f=0;f<=1;f+=u){var l=e.x+f*i,c=e.y+f*s,h=e.z+f*o;r.push({x:l,y:c,z:h})}return r.push({x:t.x,y:t.y,z:t.z}),r}function o(e,t,n){var r=[],i=t.x-e.x,s=t.y-e.y,o=t.z-e.z,u=.1,a=i*i+s*s+o*o;u=1/(a/(n*n));for(var f=0;f<=1;f+=u){var l=e.x+f*i,c=e.y+f*s,h=e.z+f*o;r.push({x:l,y:c,z:h})}return r.push({x:t.x,y:t.y,z:t.z}),r}function u(e,t,n,r){var i=e.length,s,o,u=0;for(s=0,o=i-1;s<i;o=s++)t[s]>r!=t[o]>r&&n<(e[o]-e[s])*(r-t[s])/(t[o]-t[s])+e[s]&&(u=!u);return u}function a(e,t){if(typeof numeric=="undefined")return null;if(e==null)return null;if(e[3]==0&&e[4]==0&&e[5]==0)return null;var n=[],r=8;if(r==12)n[0]=e[0]*19.739208802178716,n[1]=e[1]*19.739208802178716,n[2]=e[2]*19.739208802178716,n[3]=e[3]*19.739208802178716*2,n[4]=e[4]*19.739208802178716*2,n[5]=e[5]*19.739208802178716*2;else{var i=r==4||r==5||r==8||r==9,s=2-r%2,o=r==8||r==9||r==10?19.739208802178716:r==4||r==5?.25:r==2||r==3?Math.log(2):1,u=e[0]*o*(i?t.a_*t.a_:1),a=e[1]*o*(i?t.b_*t.b_:1),l=e[2]*o*(i?t.c_*t.c_:1),c=e[3]*o*(i?t.a_*t.b_:1)*s,h=e[4]*o*(i?t.a_*t.c_:1)*s,p=e[5]*o*(i?t.b_*t.c_:1)*s;n[0]=t.a*t.a*u+t.b*t.b*t.cosGamma*t.cosGamma*a+t.c*t.c*t.cosBeta*t.cosBeta*l+t.a*t.b*t.cosGamma*c+t.b*t.c*t.cosGamma*t.cosBeta*p+t.a*t.c*t.cosBeta*h,n[1]=t.b*t.b*t.sinGamma*t.sinGamma*a+t.c*t.c*t.cA_*t.cA_*l+t.b*t.c*t.cA_*t.sinGamma*p,n[2]=t.c*t.c*t.cB_*t.cB_*l,n[3]=2*t.b*t.b*t.cosGamma*t.sinGamma*a+2*t.c*t.c*t.cA_*t.cosBeta*l+t.a*t.b*t.sinGamma*c+t.b*t.c*(t.cA_*t.cosGamma+t.sinGamma*t.cosBeta)*p+t.a*t.c*t.cA_*h,n[4]=2*t.c*t.c*t.cB_*t.cosBeta*l+t.b*t.c*t.cosGamma*p+t.a*t.c*t.cB_*h,n[5]=2*t.c*t.c*t.cA_*t.cB_*l+t.b*t.c*t.cB_*t.sinGamma*p}var d=f(n);return d}function f(e){var t=e[0],n=e[1],r=e[2],i=e[3]/2,s=e[4]/2,o=e[5]/2,u=i,a=s,f=o,c=[[t,u,a],[i,n,f],[s,o,r]],h=numeric.eig(c),p=[Math.sqrt(h.lambda.x[0]),Math.sqrt(h.lambda.x[1]),Math.sqrt(h.lambda.x[2])],d=h.E.x,v=l(d,p);return[p,d,v]}function l(e,t){var n,r,i,s,o,u,a,f,l;n=e[0][0],s=e[0][1],a=e[0][2],r=e[1][0],o=e[1][1],f=e[1][2],i=e[2][0],u=e[2][1],l=e[2][2];var c=numeric.inv([[n,r,i],[s,o,u],[a,f,l]]);return c}function h(e,t,n,r,i,s,o,u){function w(e,t,n,r,i){var s=t[0][0]*e[0]+t[0][1]*e[1]+t[0][2]*e[2],o=t[1][0]*e[0]+t[1][1]*e[1]+t[1][2]*e[2],u=t[2][0]*e[0]+t[2][1]*e[1]+t[2][2]*e[2];return[s+n,o+r,u+i]}function E(e,t,n,r,i,s){var o=t[0][0]*e[0]+t[0][1]*e[1]+t[0][2]*e[2],u=t[1][0]*e[0]+t[1][1]*e[1]+t[1][2]*e[2],a=t[2][0]*e[0]+t[2][1]*e[1]+t[2][2]*e[2],f=n[0][0]*o+n[0][1]*u+n[0][2]*a,l=n[1][0]*o+n[1][1]*u+n[1][2]*a,c=n[2][0]*o+n[2][1]*u+n[2][2]*a;return[f+r,l+i,c+s]}var a=[],f=[],l=[],c=[],h,p,d,v,m;for(var g=0;g<=360;g+=10){h=3.14159/180*g,d=r*Math.cos(h),v=i*Math.sin(h),m=0;var y=E([d,v,m],o,u,e,t,n);f.push(y)}for(var b=0;b<=360;b+=10){p=3.14159/180*b,d=0,v=i*Math.cos(p),m=s*Math.sin(p);var y=E([d,v,m],o,u,e,t,n);l.push(y)}for(var b=0;b<=360;b+=10){p=3.14159/180*b,d=r*Math.cos(p),v=0,m=s*Math.sin(p);var y=E([d,v,m],o,u,e,t,n);c.push(y)}for(var b=0;b<=90;b+=10){p=3.14159/180*b;for(var g=0;g<=90;g+=10){h=3.14159/180*g,d=r*Math.cos(p)*Math.cos(h),v=i*Math.cos(p)*Math.sin(h),m=s*Math.sin(p);var y=E([d,-1*v,m],o,u,e,t,n);a.push(y),y=E([d,-1*v,-1*m],o,u,e,t,n),a.push(y),y=E([-1*d,-1*v,m],o,u,e,t,n),a.push(y),y=E([-1*d,-1*v,-1*m],o,u,e,t,n),a.push(y),y=E([d,v,m],o,u,e,t,n),a.push(y),y=E([d,v,-1*m],o,u,e,t,n),a.push(y),y=E([-1*d,v,-1*m],o,u,e,t,n),a.push(y),y=E([-1*d,v,m],o,u,e,t,n),a.push(y)}}return[f,l,c,a]}function p(e){function s(e,t,n){return(t.x-e.x)*(n.y-e.y)-(t.y-e.y)*(n.x-e.x)}e.sort(function(e,t){return e.x==t.x?e.y-t.y:e.x-t.x});var t=[];for(var n=0;n<e.length;n++){while(t.length>=2&&s(t[t.length-2],t[t.length-1],e[n])<=0)t.pop();t.push(e[n])}var r=[];for(var i=e.length-1;i>=0;i--){while(r.length>=2&&s(r[r.length-2],r[r.length-1],e[i])<=0)r.pop();r.push(e[i])}return r.pop(),t.pop(),t.concat(r)}e._widget=function(e,n,r,i){this._isFF=navigator.userAgent.toLowerCase().indexOf("firefox")!=-1,this._isSlow=!1,this._isVSlow=!1,oldBrowser&&(this._isSlow=!0),typeof FlashCanvas!="undefined"&&(this._isSlow=!0),typeof window.mobilecheck!="undefined"&&window.mobilecheck()&&(this._isSlow=!0,this._isVSlow=!0),this.parent=i,this._isSlow=!0,this._container=document.getElementById(e);if(!this._container){var s=document.createElement("div");s.id=e,document.body.appendChild(s),this._container=s}this._id=e,this._midx=n,this.w=300,this.h=300;var o=0,u=0;r&&r.size?typeof r.size=="object"?(r.size.width&&(o=parseInt(r.size.width)),r.size.height&&(u=parseInt(r.size.height))):o=parseInt(r.size):this._container.style.width?o=parseInt(this._container.style.width)-20:this._container.offsetWidth&&(o=parseInt(this._container.offsetWidth)-20),o>20&&o<2001&&(this.w=o,this.h=o,u>20&&u<2001&&(this.h=u));var a=t();this.w>a&&(this.w=a-20,this.h=a-20),this._canvas2d=document.createElement("canvas"),typeof FlashCanvas!="undefined"&&FlashCanvas.initElement(this._canvas2d),this._container.appendChild(this._canvas2d),this._canvas2d.height=this.h,this._canvas2d.width=this.w,this.background="transparent",this.vdwScale=.22,this.ellipScale=.5,this.view="",this.picking=0,this.bondpicking=0,this.spin=!1,this.spinToBestFit=!1,this.label=!1,this.viewStyle="ball_and_stick",this.mmViewStyle="ribbon",this.colourScheme="rainbow",this.clickCallback=!1,this.pickCallback=!1,this.bondpickCallback=!1,this.selectCallback=!1,this.spinCallback=!1,this.mouseOverCallback=!1,this.changedCallback=!1,this._isDragging=!1,this._mouseStartX=0,this._mouseStartY=0,this._picked=[],this._addEvents(),this._select=[];if(r)for(var f in r)this[f]!=undefined&&r[f]!=undefined&&(this[f]=r[f]);return this},e._widget.prototype._addEvents=function(){function t(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n)}function n(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1),e.detachEvent&&e.detachEvent("on"+t,n)}function r(t){e.spin=!1,e._isDragging=!1;var n=t||window.event;n.preventDefault?n.preventDefault():n.returnValue=!1,e.model._scaleFactorInc||(e.model._scaleFactorInc=.1*e.model.scaleFactor2d),n.scale?(e._isSlow=!0,n.scale<1?e.model.scaleFactor2d-=e.model._scaleFactorInc:n.scale>1&&(e.model.scaleFactor2d+=e.model._scaleFactorInc)):n.detail?n.detail<0?e.model.scaleFactor2d-=e.model._scaleFactorInc:e.model.scaleFactor2d+=e.model._scaleFactorInc:n.wheelDelta&&(n.wheelDelta<0?e.model.scaleFactor2d-=e.model._scaleFactorInc:e.model.scaleFactor2d+=e.model._scaleFactorInc),e.model.scaleFactor2d<5*e.model._scaleFactorInc&&(e.model.scaleFactor2d=5*e.model._scaleFactorInc),e._isScrolling=!0,window.requestAnimationFrame(function(){e._show()})}function i(t){e._isScrolling=!1,e._fingerSeparation=0,e.spin=!1,e.targPlane=null,e.rotPlanes=null;var n=t||window.event;n.targetTouches||(n.preventDefault?n.preventDefault():n.returnValue=!1);var r=n.pageX,i=n.pageY;if(n.targetTouches&&n.targetTouches.length>1){e._isSlow=!0,e._isDragging=!1,n.targetTouches.length==2&&(e.model._scaleFactorInc||(e.model._scaleFactorInc=.05*e.model.scaleFactor2d),e._isScrolling=!0,e._fingerSeparation=(n.targetTouches[0].pageX-n.targetTouches[1].pageX)*(n.targetTouches[0].pageX-n.targetTouches[1].pageX)+(n.targetTouches[0].pageY-n.targetTouches[1].pageY)*(n.targetTouches[0].pageY-n.targetTouches[1].pageY));return}n.targetTouches&&n.targetTouches[0]&&(e._isSlow=!0,r=n.targetTouches[0].pageX,i=n.targetTouches[0].pageY),r==undefined&&(r=n.clientX,i=n.clientY);if(r==undefined)return;e._isDragging=!0,e._mouseStartX=r,e._mouseStartY=i,e._pressStartX=r,e._pressStartY=i,e.rotationQuaternion||(e.rotationQuaternion={x:0,y:0,z:0,w:1})}function s(t){var n=t||window.event;n.preventDefault?n.preventDefault():n.returnValue=!1;if(e._isScrolling){if(n.targetTouches&&n.targetTouches.length==2){e._isScrolling=!0;var r=(n.targetTouches[0].pageX-n.targetTouches[1].pageX)*(n.targetTouches[0].pageX-n.targetTouches[1].pageX)+(n.targetTouches[0].pageY-n.targetTouches[1].pageY)*(n.targetTouches[0].pageY-n.targetTouches[1].pageY);Math.abs(r-e._fingerSeparation)>1e4&&(r>e._fingerSeparation?e.model.scaleFactor2d+=e.model._scaleFactorInc:r>0&&(e.model.scaleFactor2d-=e.model._scaleFactorInc),e.model.scaleFactor2d<10*e.model._scaleFactorInc&&(e.model.scaleFactor2d=10*e.model._scaleFactorInc),window.requestAnimationFrame(function(){e._show()}),e._fingerSeparation=r),e._isDragging=!1}return}if(!e._isDragging)return;var i=n.pageX,s=n.pageY;n.targetTouches&&n.targetTouches[0]&&(e._isSlow=!0,i=n.targetTouches[0].pageX,s=n.targetTouches[0].pageY),i==undefined&&(i=n.clientX,s=n.clientY);if(i==undefined)return;var o=(i-e._mouseStartX)/e.w,u=(s-e._mouseStartY)/e.h;e._mouseStartX=i,e._mouseStartY=s;var a=Math.sqrt(o*o+u*u),f=Math.sin(a*Math.PI)/a,l=0,c=0,h=0,p=1,d=f*u,v=-1*f*o,m=0,g=-1*Math.cos(a*Math.PI),y=l*g+p*d+c*m-h*v,b=c*g+p*v+h*d-l*m,w=h*g+p*m+l*v-c*d,E=p*g-l*d-c*v-h*m;l=y,c=b,h=w,p=E,d=e.rotationQuaternion.x,v=e.rotationQuaternion.y,m=e.rotationQuaternion.z,g=e.rotationQuaternion.w,y=l*g+p*d+c*m-h*v,b=c*g+p*v+h*d-l*m,w=h*g+p*m+l*v-c*d,E=p*g-l*d-c*v-h*m;if(!isFinite(y)||isNaN(y)||!isFinite(b)||isNaN(b)||!isFinite(w)||isNaN(w)||!isFinite(E)||isNaN(E)){console.log("qNan - skip");return}e.rotationQuaternion.x=y,e.rotationQuaternion.y=b,e.rotationQuaternion.z=w,e.rotationQuaternion.w=E,window.requestAnimationFrame(function(){e._show()})}function o(t,n){var r=t||window.event;r.targetTouches||(r.preventDefault?r.preventDefault():r.returnValue=!1),e._fingerSeparation=0,e._isDragging&&(e._isDragging=!1);if(e._isScrolling){e._isScrolling=!1;return}var i=r.pageX,s=r.pageY;r.targetTouches&&r.targetTouches.length==1&&r.targetTouches[0]&&(e._isSlow=!0,i=r.targetTouches[0].pageX,s=r.targetTouches[0].pageY),i==undefined&&(i=r.clientX,s=r.clientY);if(i==undefined)return;if(n&&n=="out")return;var o=Math.abs(i-e._pressStartX),u=Math.abs(s-e._pressStartY),a=!1,f=curtop=0,l=e._canvas2d;if(l.offsetParent)do{l.style&&l.style.position=="fixed"&&(a=!0);if(l==document.body)break;f+=l.offsetLeft,curtop+=l.offsetTop,curtop-=l.scrollTop||0,f-=l.scrollLeft||0}while(l=l.offsetParent);e.canvasPos={x:f,y:curtop},a&&(i=r.clientX,s=r.clientY,r.targetTouches&&r.targetTouches.length==1&&r.targetTouches[0]&&(e._isSlow=!0,i=r.targetTouches[0].clientX,s=r.targetTouches[0].clientY)),o<2&&u<2?(e.clickx=i-e.canvasPos.x,e.clicky=s-e.canvasPos.y,e.clickxs=(e.clickx-e.w/2)/e.model.scaleFactor2d,e.clickys=(e.clicky-e.h/2)/e.model.scaleFactor2d):e.clickx=null,window.requestAnimationFrame(function(){e._show()})}function u(t,n){var r=t||window.event;r.preventDefault?r.preventDefault():r.returnValue=!1,e.clickCallback&&typeof e.clickCallback=="function"&&e.clickCallback(e)}function a(t,n){var r=t||window.event;r.preventDefault?r.preventDefault():r.returnValue=!1,e.mouseOverCallback&&typeof e.mouseOverCallback=="function"&&e.mouseOverCallback(e)}var e=this;t(this._canvas2d,"DOMMouseScroll",function(e){r(e)}),t(this._canvas2d,"mousewheel",function(e){r(e)}),t(this._canvas2d,"mousedown",function(e){i(e)}),t(this._canvas2d,"mousemove",function(e){s(e)}),t(this._canvas2d,"mouseup",function(e){o(e)}),t(this._canvas2d,"touchstart",function(e){i(e)}),t(this._canvas2d,"touchmove",function(e){s(e)}),t(this._canvas2d,"touchend",function(e){o(e)}),t(this._canvas2d,"mouseout",function(e){o(e,"out")}),t(this._canvas2d,"click",function(e){u(e)}),t(this._canvas2d,"mouseover",function(e){a(e)})},e._widget.prototype.resize=function(e,t){this.w=parseInt(e),this.h=parseInt(t),this._canvas2d.height=this.h,this._canvas2d.width=this.w,this._show()},e._widget.prototype.changeModel=function(e){function s(t){t.selection=[],t.selection.length=0,e.substr(0,6)=="biomol"?t.atoms=n._cif.blocks[t.cifblk].model.mol:t.atoms=n._cif.blocks[t.cifblk].model[t.type],_addAtomProperties(t.atoms);if(n._cif.blocks[t.cifblk].mmcif){t.macromol=!0,_setRibbonData(t);var r=t.ribbondata.extent;t.center2d={x:r[2][0],y:r[2][1],z:r[2][2]},t.center2d_orig={x:r[2][0],y:r[2][1],z:r[2][2]};var i=r[1][0]-r[0][0],s=r[1][1]-r[0][1],o=r[1][2]-r[0][2];t.maxD=Math.sqrt(i*i+s*s+o*o);if(!isFinite(t.maxD)||t.maxD==0)t.maxD=10}else{var r=_getExtent(t.atoms);t.center2d={x:r[2][0],y:r[2][1],z:r[2][2]},t.center2d_orig={x:r[2][0],y:r[2][1],z:r[2][2]},t.cell=n._cif.blocks[t.cifblk].F2CmatrixCell,t.celldata=n._cif.blocks[t.cifblk].cell;var i=r[1][0]-r[0][0],s=r[1][1]-r[0][1],o=r[1][2]-r[0][2];t.maxD=Math.sqrt(i*i+s*s+o*o);if(!isFinite(t.maxD)||t.maxD==0)t.maxD=10}var u=n.w;n.h<n.w&&(u=n.h),t.scaleFactor2d=.9*u/t.maxD,n.model=t,n.changedCallback&&typeof n.changedCallback=="function"&&n.changedCallback(n),n._show({view:t.type,rotationQuaternion:{x:0,y:0,z:0,w:1}})}var t={};if(this.model&&this.model.cifblk){var n=this;n._select.length=0;for(var r in this.model.atoms){if(!this.model.atoms[r])continue;this.model.atoms[r].xtra&&(this.model.atoms[r]=null)}var i=this.model.cifblk;t.cifblk=i,t.type=e,this.model.colourScheme&&(t.colourScheme=this.model.colourScheme),n._cif._getModelSet(n._cif.blocks[i],0,e,function(){s(t)})}},e._widget.prototype._zoomToObject=function(e){var t=this;if(!e||!e.id||!e.type){this.model.center2d=this.model.center2d_orig;var n=this.w;this.h<this.w&&(n=this.h),this.model.scaleFactor2d=.9*n/this.model.maxD,this.model.selection=[],this.model.selection.length=0;return}var r=Math.round(this.w/this.model.maxD);this.model.selection=null,this.model.selection=[];if(this.model.macromol&&e.type=="ligand"){this.mmViewStyle="ligand_pockets";var i=this._cif.blocks[this.model.cifblk].ligands;for(var s in i)if(s==e.id){var o,u="asu";this.model.type.indexOf("biomol")>-1&&(u=parseInt(this.model.type.substr(6))+1);for(var a in i[s])if(i[s][a].assembly==u+""){o=a;break}this.model.selection=i[s][o].siteids.slice(0);for(var f in i[s][o].pocketids)this.model.selection.push(i[s][o].pocketids[f]);var l=i[s][o].dims;this.model.center2d={x:l[2][0],y:l[2][1],z:l[2][2]},l=i[s][o].pocketdims;var c=l[1][0]-l[0][0],h=l[1][1]-l[0][1],p=l[1][2]-l[0][2],d=Math.sqrt(c*c+h*h+p*p);if(!isFinite(d)||d==0)d=10;d==0?r=2*this.model.scaleFactor2d:r=Math.round(this.w/d);break}}setTimeout(function(){t._zoomBy(.5,r)},1)},e._widget.prototype._zoomBy=function(e,t){if(this._isVSlow){this.model.scaleFactor2d=t,this._isDragging=!1,this._show();return}var n=this;this.model.scaleFactor2d+=e,this.model.scaleFactor2d>t?(this.model.scaleFactor2d=t,this._isDragging=!1,this._show()):(this._isDragging=!0,this._show(),setTimeout(function(){n._zoomBy(e,t)},1))},e._widget.prototype._translateBy=function(e,t){var n=this;this.model.center2d.x+=e.x,this.model.center2d.y+=e.y,this.model.center2d.z+=e.z,e.x>0&&this.model.center2d.x>t.x?this.model.center2d.x=t.x:e.x<0&&this.model.center2d.x<t.x&&(this.model.center2d.x=t.x),e.y>0&&this.model.center2d.y>t.y?this.model.center2d.y=t.y:e.y<0&&this.model.center2d.y<t.y&&(this.model.center2d.y=t.y),this.model.center2d.x==t.x&&this.model.center2d.y==t.y?(this.model.center2d.z=t.z,this._show()):(this._show(),setTimeout(function(){n._translateBy(e,t)},1))},e._widget.prototype._show=function(e){if(e)for(var t in e)if(this[t]!=undefined&&e[t]!=undefined)this[t]=e[t],t=="colourScheme"&&this.model.macromol&&this.model.ribbondata&&(this.model.colourScheme=e[t],_colourRibbonData(this.model));else if(t=="zoomTo"){this._zoomToObject(e[t]);return}this._render2d();if(this.view=="cell5551"||this.view=="cell555"||this.view=="asu")if(this._isDragging||this._isScrolling){var n=this._canvas2d.getContext("2d");this._showCell(n)}var r=this;this.spinToBestFit&&this.model.bestfit?(window.requestAnimationFrame(function(){r.rotateToPlanes([[0,0,1,0],r.model.bestfit])}),this.spinToBestFit=0):this.spin?window.requestAnimationFrame(function(){r.spinmol()}):this.targPlane&&window.requestAnimationFrame(function(){r.rotateToPlanes()})},e._widget.prototype._exportSvg=function(){var e=this._render2d("svg");return this._show(),e},e._widget.prototype._exportSdf=function(){function e(e,t){var n=Math.pow(10,t||0),r=String(Math.round(e*n)/n),i=r.indexOf("."),s=0;i==-1?r+=t>0?".":"":s=r.length-i-1;for(var o=0;o<t-s;o++)r+="0";return r}function t(e,t){var n=e,r=t-n.length;for(var i=0;i<r;i++)n=" "+n;return n}function n(e,t){var n=e,r=t-n.length;for(var i=0;i<r;i++)n+=" ";return n}var r=this.model.atoms,i=0,s=0,o="",u="",a=[];for(var f in r){var l=r[f];if(l==undefined)continue;if(l.x==undefined)continue;l.screen={x:l.x,y:l.y,z:l.z};if(this.rotationQuaternion){var c=this._rotateByQ(l.screen.x,l.screen.y*-1,l.screen.z);l.screen.x=c[0],l.screen.y=c[1]*-1,l.screen.z=c[2];if(isNaN(l.screen.x)||isNaN(l.screen.y)||isNaN(l.screen.z))l.screen={x:l.x,y:l.y,z:l.z}}o+=t(e(l.screen.x,4),10)+t(e(l.screen.y,4),10)+t(e(l.screen.z,4),10),o+=" "+n(l.elem,3)+" 0  0  0  0  0  0\n",i++,a[f]=i}var h=[];for(var f in a){var l=r[f];if(l==undefined)continue;if(l.x==undefined)continue;for(var p=0,d=l.bonds.length;p<d;p++){if(!a[l.bonds[p]])continue;var v=r[l.bonds[p]];if(v==undefined)continue;if(v.x==undefined)continue;if(h[f+"---"+l.bonds[p]])continue;if(h[l.bonds[p]+"---"+f])continue;var m=1;typeof l.bondOrder!="undefined"&&p<l.bondOrder.length&&(m=l.bondOrder[p]),m!=1&&m!=2&&m!=3&&(m=1),u+=t(a[f]+"",3)+t(a[l.bonds[p]]+"",3)+"  "+m+"  0  0  0\n",h[f+"---"+l.bonds[p]]=1,h[l.bonds[p]+"---"+f]=1,s++}}var g=t(i+"",3)+t(s+"",3)+"  0  0  0  0              1 V2000\n",y="CIFMOL\n\n\n"+g+o+u+"M  END\n\n$$$$\n";return y},e._widget.prototype._render2d=function(e){function t(e,t,n){var r={};return r.r=e.r+Math.round(n*(t.r-e.r)),r.b=e.b+Math.round(n*(t.b-e.b)),r.g=e.g+Math.round(n*(t.g-e.g)),r}this._canvas2d.width=this._canvas2d.width,this._canvas2d.height=this._canvas2d.height;var n;e?n=new C2S(this.w,this.h):n=this._canvas2d.getContext("2d"),CanvasTextFunctions.enable(n),this.viewStyle=="scheme"?n.fillStyle="rgb(255, 255, 255)":this.background=="black"?n.fillStyle="rgb(0, 0, 0)":n.fillStyle="rgb(255, 255, 255)",this.background!="transparent"&&n.fillRect(0,0,this.w,this.h),n.translate(this.w/2,this.h/2);if(isNaN(this.model.scaleFactor2d)||this.model.scaleFactor2d<=0||!isFinite(this.model.scaleFactor2d))this.model.scaleFactor2d=10;n.scale(this.model.scaleFactor2d,this.model.scaleFactor2d),n.lineCap="round",n.lineWidth=.01;var s=[],o=Math.PI*2,f=[],l=[],c=this.model.atoms;for(var d in c){var v=c[d];if(v==undefined)continue;if(v.x==undefined)continue;if(v.hide)continue;if(this.model.macromol){if(this.model.selection&&this.model.selection.length>0&&this.model.selection.indexOf(d)==-1)continue;if(!v.hetflag){if(this.mmViewStyle!="ligand_pockets")continue;if(!v.pocket)continue}if(v.resn=="HOH")continue}v.screen={x:v.x,y:v.y,z:v.z},v.screen.x-=this.model.center2d.x,v.screen.y-=this.model.center2d.y,v.screen.z-=this.model.center2d.z,v.screen.y*=-1;if(this.rotationQuaternion){var m=this._rotateByQ(v.screen.x,v.screen.y,v.screen.z);v.screen.x=m[0],v.screen.y=m[1],v.screen.z=m[2];if(isNaN(v.screen.x)||isNaN(v.screen.y)||isNaN(v.screen.z))throw"NaN"}if(this.viewStyle=="ellipsoids"&&!this._isDragging&&!this._isScrolling){this.vdwScale=.1;if(typeof v.ellipsoid=="undefined"){var g=a(v.adp,this.model.celldata);if(!g)v.ellipsoid=!1;else{var y=g[0],b=g[2],w=this._cif.blocks[this.model.cifblk].symOps[v.symop].rotmat,E={};E.rotmat=w,E.axcoords=h(v.x,v.y,v.z,y[0]/2,y[1]/2,y[2]/2,b,w),E.prop=.5,E.matrix=b,E.axlengths=y,E.axvectors=g[1],v.ellipsoid=E}}else v.ellipsoid&&v.ellipsoid.prob!=this.ellipScale&&(v.ellipsoid.axcoords=h(v.x,v.y,v.z,v.ellipsoid.axlengths[0]*this.ellipScale,v.ellipsoid.axlengths[1]*this.ellipScale,v.ellipsoid.axlengths[2]*this.ellipScale,v.ellipsoid.matrix,v.ellipsoid.rotmat),v.ellipsoid.prob=this.ellipScale);if(v.ellipsoid){var S=0,x=4;if(this._isDragging||this._isScrolling)S=0,x=4;var T=[],N=[];for(var C=S;C<x;C++){var k=[],L=[];for(var A=0;A<v.ellipsoid.axcoords[C].length;A++){var m=v.ellipsoid.axcoords[C][A],O=m[0]-this.model.center2d.x,M=m[1]-this.model.center2d.y;M*=-1;var _=m[2]-this.model.center2d.z;if(this.rotationQuaternion){var D=this._rotateByQ(O,M,_);if(isNaN(D[0])||isNaN(D[1])||isNaN(D[2]))continue;O=D[0],M=D[1],_=D[2]}C==3?(_>=v.screen.z-.9&&_<=v.screen.z+.9&&L.push({x:O,y:M,z:_}),_>=v.screen.z-.1&&N.push({x:O,y:M,z:_})):k.push({x:O,y:M,z:_})}C==3?(L=p(L),T.push(L)):T.push(k)}v.ellipsoid.plotaxes=T,v.ellipsoid.surf=N}}this.model.bestfit||v.elem!="H"&&(s.push(v.x),s.push(-1*v.y),s.push(v.z)),f.push([!1,v.screen.z,d])}var P=!0;this.model.bondcount&&this.model.bondcount>2e3&&(this._isDragging||this._isScrolling)&&(P=!1);if(P){for(var d in c){var v=c[d];if(v==undefined)continue;if(v.x==undefined)continue;if(v.hide)continue;if(this.model.macromol){if(this.model.selection&&this.model.selection.length>0&&this.model.selection.indexOf(d)==-1)continue;if(!v.hetflag){if(this.mmViewStyle!="ligand_pockets")continue;if(!v.pocket)continue}if(v.resn=="HOH")continue}for(var H=0,B=v.bonds.length;H<B;H++){var j=c[v.bonds[H]];if(this.model.macromol){if(this.model.selection&&this.model.selection.length>0&&this.model.selection.indexOf(v.bonds[H])==-1)continue;if(!j.hetflag){if(this.mmViewStyle!="ligand_pockets")continue;if(!j.pocket)continue}if(j.resn=="HOH")continue}if(j==undefined)continue;if(j.x==undefined)continue;if(j.hide)continue;if(l[d+"---"+v.bonds[H]])continue;if(l[v.bonds[H]+"---"+d])continue;if(this.viewStyle=="scheme"&&!this.model.cifblk)if(v.elem=="H"||j.elem=="H")if(v.elem=="C"||j.elem=="C"){v.ex=1,j.ex=1;continue}l[d+"---"+v.bonds[H]]=1,l[v.bonds[H]+"---"+d]=1,f.push([!0,(v.screen.z+j.screen.z)/2,d,v.bonds[H],v.bondOrder[H]])}}if(!this.model.bondcount){var F=0;for(var I in l){F++;if(F>4e3)break}this.model.bondcount=F/2}}if(!this.model.bestfit&&!this.model.macromol)try{this.model.bestfit=bestFit.getBestFitPlane(s),this.model.bestfit.push(1)}catch(q){this.model.bestfit=[0,0,1,0]}var R=[];for(var U=0;U<f.length;U++)R.push({type:"smallmol",dataidx:U,zindex:f[U][1]});var z=[];if(!this._isDragging&&!this._isScrolling)if(this.view=="cell5551"||this.view=="cell555"||this.view=="asu"){z=this._getCellDrawObjects();if(z!=null){for(var _=0;_<z.labels.length;_++)R.push({type:"cell_label",dataidx:_,zindex:z.labels[_].z});for(var W=0;W<z.lines.length;W++)R.push({type:"cell_line",dataidx:W,zindex:z.lines[W].z})}}var X=[],V=[],$=!1;this.mmViewStyle=="ligand_pockets"&&($=!0);if(this.model.macromol&&!$){if(!this.model.datasize){this.model.datasize=0;for(var J=0;J<this.model.ribbondata.length;J++)this.model.datasize+=this.model.ribbondata[J][0].length}var K,Q,G=1;this._isVSlow?(G=10,this.model.datasize>7e4&&(G=20)):this.model.datasize>7e4?G=10:this.model.datasize>2e4&&(G=5);if(this._isDragging||this._isScrolling)G=10,this.model.datasize>2e4&&(G=50),this.model.datasize>7e4&&(G=30);if(this.model.ribbondata&&this.model.ribbondata.rungs&&this.model.ribbondata.length)for(var Y=0;Y<this.model.ribbondata.rungs.length;Y++){var Z={},et=this.model.ribbondata.rungs[Y].start,tt=this.model.ribbondata.rungs[Y].end;et.screenx=et.x-this.model.center2d.x,et.screeny=(et.y-this.model.center2d.y)*-1,et.screenz=et.z-this.model.center2d.z,tt.screenx=tt.x-this.model.center2d.x,tt.screeny=(tt.y-this.model.center2d.y)*-1,tt.screenz=tt.z-this.model.center2d.z;var nt=et.rainbow;if(this.rotationQuaternion){var rt=this._rotateByQ(et.screenx,et.screeny,et.screenz);et.screenx=rt[0],et.screeny=rt[1],et.screenz=rt[2];if(isNaN(et.screenx)||isNaN(et.screeny)||isNaN(et.screenz))throw"NaN";rt=this._rotateByQ(tt.screenx,tt.screeny,tt.screenz),tt.screenx=rt[0],tt.screeny=rt[1],tt.screenz=rt[2];if(isNaN(tt.screenx)||isNaN(tt.screeny)||isNaN(tt.screenz))throw"NaN"}var it=(et.screenz+tt.screenz)/2;V.push({pa:et,pb:tt,zi:it,color:nt}),R.push({type:"rung",dataidx:Y,zindex:it})}for(var J=0;J<this.model.ribbondata.length;J++){var st=[],ot=[],ut=-1,at=[],ft=[];for(var lt=0;lt<this.model.ribbondata[J][0].length;lt+=G){ut++;var ct=this.model.ribbondata[J][0][lt].atomidx;if(this._isDragging||this._isScrolling){st[ut]={x:this.model.ribbondata[J][1][lt].x,y:this.model.ribbondata[J][1][lt].y,z:this.model.ribbondata[J][1][lt].z},st[ut].x-=this.model.center2d.x,st[ut].y-=this.model.center2d.y,st[ut].z-=this.model.center2d.z,st[ut].y*=-1;if(this.rotationQuaternion){var m=this._rotateByQ(st[ut].x,st[ut].y,st[ut].z);st[ut].x=m[0],st[ut].y=m[1],st[ut].z=m[2];if(isNaN(st[ut].x)||isNaN(st[ut].y)||isNaN(st[ut].z))throw"NaN"}ot[ut]=st[ut]}else{st[ut]={x:this.model.ribbondata[J][0][lt].x,y:this.model.ribbondata[J][0][lt].y,z:this.model.ribbondata[J][0][lt].z},ot[ut]={x:this.model.ribbondata[J][2][lt].x,y:this.model.ribbondata[J][2][lt].y,z:this.model.ribbondata[J][2][lt].z},st[ut].x-=this.model.center2d.x,st[ut].y-=this.model.center2d.y,st[ut].z-=this.model.center2d.z,st[ut].y*=-1,ot[ut].x-=this.model.center2d.x,ot[ut].y-=this.model.center2d.y,ot[ut].z-=this.model.center2d.z,ot[ut].y*=-1;if(this.rotationQuaternion){var m=this._rotateByQ(st[ut].x,st[ut].y,st[ut].z);st[ut].x=m[0],st[ut].y=m[1],st[ut].z=m[2];if(isNaN(st[ut].x)||isNaN(st[ut].y)||isNaN(st[ut].z))throw"NaN";m=this._rotateByQ(ot[ut].x,ot[ut].y,ot[ut].z),ot[ut].x=m[0],ot[ut].y=m[1],ot[ut].z=m[2];if(isNaN(ot[ut].x)||isNaN(ot[ut].y)||isNaN(ot[ut].z))throw"NaN"}}at[ut]=this.model.ribbondata[J][0][lt].color,ft[ut]=this.model.ribbondata[J][0][lt].colorD,K==undefined&&(K=st[ut].z,Q=st[ut].z),K<st[ut].z&&(K=st[ut].z),Q>st[ut].z&&(Q=st[ut].z)}for(var ht=0;ht<st.length-1;ht++){var dt=(st[ht].z+ot[ht].z+st[ht+1].z+ot[ht+1].z)/4;X.push({pa:st[ht],pb:ot[ht],pd:st[ht+1],pc:ot[ht+1],zi:dt,color:at[ht],colorD:ft[ht]})}}}for(var ht=0;ht<X.length;ht++)R.push({type:"ribbon",dataidx:ht,zindex:X[ht].zi});R.sort(function(e,t){return e.zindex-t.zindex});var vt=0,mt=[];for(var gt=0;gt<R.length;gt++)if(R[gt].type=="rung")n.strokeStyle="rgb("+V[R[gt].dataidx].color.r+","+V[R[gt].dataidx].color.g+","+V[R[gt].dataidx].color.b+")",n.lineWidth=.2,n.beginPath(),n.moveTo(V[R[gt].dataidx].pa.screenx,V[R[gt].dataidx].pa.screeny),n.lineTo(V[R[gt].dataidx].pb.screenx,V[R[gt].dataidx].pb.screeny),n.closePath(),n.stroke();else if(R[gt].type=="cell_label"){var yt=z.labels[R[gt].dataidx];n.strokeStyle=yt.colour,n.drawText("sans",1,yt.x,yt.y,yt.text)}else if(R[gt].type=="cell_line"){var bt=z.lines[R[gt].dataidx];n.beginPath(),n.lineWidth=.1,n.strokeStyle=bt.colour,n.moveTo(bt.P1.x,bt.P1.y),n.lineTo(bt.P2.x,bt.P2.y),n.stroke(),n.closePath()}else if(R[gt].type=="ribbon"){if(this.mmViewStyle=="ligand_pockets")continue;n.lineWidth=.05;var ht=R[gt].dataidx,wt={r:X[ht].color.r,g:X[ht].color.g,b:X[ht].color.b},Et;if(!this._isDragging&&!this._isScrolling){var St=t({r:X[ht].color.r,g:X[ht].color.g,b:X[ht].color.b},{r:X[ht].colorD.r,g:X[
ht].colorD.g,b:X[ht].colorD.b},1-gt/R.length);Et="rgb("+St.r+","+St.g+","+St.b+")"}else Et="rgb("+X[ht].color.r+","+X[ht].color.g+","+X[ht].color.b+")";var xt="rgb("+X[ht].colorD.r+","+X[ht].colorD.g+","+X[ht].colorD.b+")",Tt="rgb("+X[ht].color.r+","+X[ht].color.g+","+X[ht].color.b+")",Nt=(X[ht].pa.z+X[ht].pd.z)/2,Ct=(X[ht].pb.z+X[ht].pc.z)/2;if(!this._isDragging&&!this._isScrolling&&!this._isVSlow){var kt,Lt=[];X[ht].pa.z>X[ht].pd.z?Lt=[X[ht].pa.x,X[ht].pa.y]:Lt=[X[ht].pd.x,X[ht].pd.y];var At=[];X[ht].pb.z>X[ht].pc.z?At=[X[ht].pc.x,X[ht].pc.y]:At=[X[ht].pb.x,X[ht].pb.y],kt=n.createLinearGradient(Lt[0],Lt[1],At[0],At[1]);var Ot=t({r:St.r,g:St.g,b:St.b},{r:X[ht].colorD.r,g:X[ht].colorD.g,b:X[ht].colorD.b},Math.abs(Nt-Ct)*gt/R.length*.5),Mt="rgb("+Ot.r+","+Ot.g+","+Ot.b+")";Nt<Ct?(kt.addColorStop(0,Mt),kt.addColorStop(1,Et)):(kt.addColorStop(0,Et),kt.addColorStop(1,Mt))}!this._isDragging&&!this._isScrolling&&!this._isVSlow?n.fillStyle=kt:n.fillStyle=Et,n.strokeStyle="rgb("+X[ht].colorD.r+","+X[ht].colorD.g+","+X[ht].colorD.b+")",n.beginPath(),n.moveTo(X[ht].pa.x,X[ht].pa.y),!this._isDragging&&!this._isScrolling?(n.lineWidth=.05,n.lineTo(X[ht].pb.x,X[ht].pb.y),n.lineTo(X[ht].pc.x,X[ht].pc.y),n.lineTo(X[ht].pd.x,X[ht].pd.y),n.closePath(),n.fill(),this._isVSlow?n.strokeStyle=Et:n.strokeStyle=kt,n.stroke()):(n.lineWidth=.5,n.lineTo(X[ht].pd.x,X[ht].pd.y),n.closePath(),n.strokeStyle=Et,n.stroke()),!this._isDragging&&!this._isScrolling&&(n.lineWidth=.05,n.strokeStyle=xt,n.beginPath(),n.moveTo(X[ht].pa.x,X[ht].pa.y),n.lineTo(X[ht].pd.x,X[ht].pd.y),n.closePath(),n.stroke(),n.beginPath(),n.moveTo(X[ht].pb.x,X[ht].pb.y),n.lineTo(X[ht].pc.x,X[ht].pc.y),n.closePath(),n.stroke())}else if(R[gt].type=="smallmol"){var d=R[gt].dataidx,v=c[f[d][2]];if(v==undefined)continue;if(v.x==undefined)continue;if(v.hide)continue;if(this.model.macromol){if(this.model.selection&&this.model.selection.length>0&&this.model.selection.indexOf(f[d][2])==-1)continue;if(!v.hetflag){if(this.mmViewStyle!="ligand_pockets")continue;if(!v.pocket)continue}if(v.resn=="HOH")continue}var _t;this.viewStyle=="scheme"?v.elem=="C"||v.ex?_t=0:_t=.7:(_t=v.vdwRad!=undefined?v.vdwRad:1,_t*=this.vdwScale);if(!f[d][0]){if(!this._isDragging&&!this._isScrolling&&this.picking>1&&this.clickx!=null){var Dt=v.screen.x,Pt=v.screen.y,Ht=_t;this.clickxs>Dt-Ht&&this.clickxs<Dt+Ht&&this.clickys>Pt-Ht&&this.clickys<Pt+Ht&&(vt=v)}if(this.viewStyle=="ellipsoids"&&v.ellipsoid&&!this._isDragging&&!this._isScrolling){var Bt=new Date;for(var C=0;C<v.ellipsoid.plotaxes.length;C++){n.fillStyle=v.color.rgbLa,n.strokeStyle=v.color.rgbD,n.lineWidth=.01,n.beginPath();for(var A=0;A<v.ellipsoid.plotaxes[C].length;A++)C<4&&(A==0?n.moveTo(v.ellipsoid.plotaxes[C][A].x,v.ellipsoid.plotaxes[C][A].y):n.lineTo(v.ellipsoid.plotaxes[C][A].x,v.ellipsoid.plotaxes[C][A].y));n.closePath(),C<4&&n.stroke(),C==3&&n.fill()}}n.lineWidth=.02;if(this.mmViewStyle=="ligand_pockets"&&v.pocket){_t=v.vdwRad!=undefined?v.vdwRad:1;if(this._isDragging||this._isScrolling)continue;var jt=_aaColours[v.resn];jt||(jt=_aaColours.other),n.fillStyle="rgba("+jt.r+", "+jt.g+", "+jt.b+", 0.05)"}else if(this.viewStyle=="scheme")n.fillStyle="rgba(255, 255, 255, 0.5)";else if(this._isSlow&&(this._isDragging||this._isScrolling))n.fillStyle=v.color.rgbBase;else{var Ft=-_t*.4,kt=n.createRadialGradient(v.screen.x+Ft,v.screen.y+Ft,_t/100,v.screen.x,v.screen.y,_t*.95);this.background=="black"?kt.addColorStop(0,v.color.rgbL):kt.addColorStop(0,v.color.rgbL),kt.addColorStop(1,v.color.rgb),n.fillStyle=kt}n.beginPath(),n.arc(v.screen.x,v.screen.y,_t,0,o,!0),n.closePath(),n.fill(),n.fillStyle=v.color.rgb,this.viewStyle=="scheme"?n.strokeStyle="rgba(255, 255, 255, 0.5)":this._isSlow&&(this._isDragging||this._isScrolling)?n.strokeStyle="#000000":n.strokeStyle=v.color.rgb,this.mmViewStyle=="ligand_pockets"&&!v.pocket&&n.stroke(),this.viewStyle=="scheme"&&v.elem!="C"&&!v.ex?(v.elem!="H"?n.strokeStyle=v.color.rgb:n.strokeStyle="#000000",n.drawTextCenter("sans",_t,v.screen.x,v.screen.y+.3*_t,v.elem)):this.label&&v.elem!="C"&&!v.ex&&v.elem!="H"&&(n.strokeStyle="#000000",n.drawTextCenter("sans",_t,v.screen.x,v.screen.y+.3*_t,v.elem))}else{var j=c[f[d][3]];if(j==undefined)continue;if(j.x==undefined)continue;if(this.model.macromol){if(this.model.selection&&this.model.selection.length>0&&this.model.selection.indexOf(f[d][3])==-1)continue;if(!j.hetflag){if(this.mmViewStyle!="ligand_pockets")continue;if(!j.pocket)continue}if(j.resn=="HOH")continue}var It;this.viewStyle=="scheme"?j.elem=="C"||j.ex?It=0:It=.7:(It=j.vdwRad!=undefined?j.vdwRad:1,It*=this.vdwScale);var qt=sbstartx=v.screen.x,Rt=sbstarty=v.screen.y,Ut=sbstartx2=j.screen.x,zt=sbstarty2=j.screen.y,Wt=v.screen.z,Xt=j.screen.z;if(this.mmViewStyle=="ligand_pockets"&&j.pocket){if(isNaN(qt)||isNaN(Rt)||isNaN(Ut)||isNaN(zt))continue;n.lineWidth=.1,n.beginPath(),n.moveTo(qt,Rt),n.lineTo(Ut,zt),n.closePath();var jt=_aaColours[v.resn];jt||(jt=_aaColours.other),n.strokeStyle="rgb("+jt.r+", "+jt.g+", "+jt.b+")",n.stroke();continue}var Ft=Ut-qt,$t=zt-Rt,U=Math.sqrt(Ft*Ft+$t*$t),Jt=.85*_t*Ft/U;qt+=Jt,Jt=.85*It*Ft/U,Ut-=Jt,Jt=.85*_t*$t/U,Rt+=Jt,Jt=.85*It*$t/U,zt-=Jt;if(f[d][4]==1.5){var Kt=U*.7;Vt=.85*_t*Ft/Kt,sbstartx+=Vt,Vt=.85*It*Ft/Kt,sbstartx2-=Vt,Vt=.85*_t*$t/Kt,sbstarty+=Vt,Vt=.85*It*$t/Kt,sbstarty2-=Vt}var Qt=Math.atan2($t,Ft);Qt-=90*Math.PI/180;var Gt=Math.cos(Qt),Yt=Math.sin(Qt);if(!this._isDragging&&!this._isScrolling&&this.bondpicking>0&&this.clickx!=null){var Zt=.2*Gt,en=.2*Yt,tn=[],nn=[];tn.push(qt-Zt),tn.push(qt+Zt),tn.push(Ut+Zt),tn.push(Ut-Zt),nn.push(Rt-en),nn.push(Rt+en),nn.push(zt+en),nn.push(zt-en),u(tn,nn,this.clickxs,this.clickys)&&(mt=[v,j])}var rn,sn,on;this.viewStyle=="scheme"?(on=.05,rn="rgb(0, 0, 0)",bondcolor2="rgb(0, 0, 0)"):(on=.15,rn=v.color.rgbBase,bondcolor2=j.color.rgbBase);if(isNaN(qt)||isNaN(Rt)||isNaN(Ut)||isNaN(zt))continue;var un=(v.screen.x+j.screen.x)/2,an=(v.screen.y+j.screen.y)/2,kt,fn,ln,cn;if(f[d][4]==1.5||f[d][4]==2||f[d][4]==3){var hn=.1;f[d][4]==3&&(hn=.2);var Zt=hn*Gt,en=hn*Yt;if(this.viewStyle=="scheme")kt=ln=cn=grad4="rgb(0, 0, 0)";else if(this._isSlow&&(this._isDragging||this._isScrolling))kt=cn=rn,ln=grad4=bondcolor2;else if(this._isVSlow)kt=cn=rn,ln=grad4=bondcolor2;else if(typeof v.occ!="undefined"&&typeof j.occ!="undefined"&&(v.occ<1||j.occ<1))kt=cn=rn,ln=grad4=bondcolor2;else{var pn=on*Gt,dn=on*Yt;kt=n.createLinearGradient(un-Zt+pn,an-en+dn,un-Zt-pn,an-en-dn),kt.addColorStop(.2,v.color.rgb),this.background=="black"?kt.addColorStop(.5,v.color.rgbL):kt.addColorStop(.5,v.color.rgbL),kt.addColorStop(.8,v.color.rgb),ln=n.createLinearGradient(un-Zt+pn,an-en+dn,un-Zt-pn,an-en-dn),ln.addColorStop(.2,j.color.rgb),this.background=="black"?ln.addColorStop(.5,j.color.rgbL):ln.addColorStop(.5,j.color.rgbL),ln.addColorStop(.8,j.color.rgb),cn=n.createLinearGradient(un+Zt+pn,an+en+dn,un+Zt-pn,an+en-dn),cn.addColorStop(.2,v.color.rgb),this.background=="black"?cn.addColorStop(.5,v.color.rgbL):cn.addColorStop(.5,v.color.rgbL),cn.addColorStop(.8,v.color.rgb),grad4=n.createLinearGradient(un+Zt+pn,an+en+dn,un+Zt-pn,an+en-dn),grad4.addColorStop(.2,j.color.rgb),this.background=="black"?grad4.addColorStop(.5,j.color.rgbL):grad4.addColorStop(.5,j.color.rgbL),grad4.addColorStop(.8,j.color.rgb)}n.lineWidth=on,n.strokeStyle=kt,n.beginPath(),n.moveTo(qt-Zt,Rt-en),n.lineTo(un-Zt,an-en),n.closePath(),n.stroke(),n.strokeStyle=ln,n.beginPath(),n.moveTo(Ut-Zt,zt-en),n.lineTo(un-Zt,an-en),n.closePath(),n.stroke();if(f[d][4]==1.5)if(this.viewStyle=="scheme"){var vn={};vn.x=qt+Zt,vn.y=Rt+en,vn.z=Wt;var mn={};mn.x=Ut+Zt,mn.y=zt+en,mn.z=Xt,this._drawDashedLine(n,vn,mn,.1,kt)}else n.strokeStyle=cn,n.beginPath(),n.moveTo(sbstartx+Zt,sbstarty+en),n.lineTo(un+Zt,an+en),n.closePath(),n.stroke(),n.strokeStyle=grad4,n.beginPath(),n.moveTo(sbstartx2+Zt,sbstarty2+en),n.lineTo(un+Zt,an+en),n.closePath(),n.stroke();else n.strokeStyle=cn,n.beginPath(),n.moveTo(qt+Zt,Rt+en),n.lineTo(un+Zt,an+en),n.closePath(),n.stroke(),n.strokeStyle=grad4,n.beginPath(),n.moveTo(Ut+Zt,zt+en),n.lineTo(un+Zt,an+en),n.closePath(),n.stroke()}if(f[d][4]==.5){kt=ln=cn=grad4="rgb(0, 0, 200)";var vn={};vn.x=qt,vn.y=Rt,vn.z=Wt;var mn={};mn.x=Ut,mn.y=zt,mn.z=Xt,this._drawDashedLine(n,vn,mn,.1,kt)}else if(f[d][4]==0){kt=ln=cn=grad4="rgba(255, 0, 0, 0.5)";var vn={};vn.x=qt,vn.y=Rt,vn.z=Wt;var mn={};mn.x=Ut,mn.y=zt,mn.z,this._drawZigZagLine(n,vn,mn,.15,kt)}else if(f[d][4]!=2){var hn=on;if(this.viewStyle=="scheme")kt=ln=cn=grad4="rgb(0, 0, 0)";else if(this._isSlow&&(this._isDragging||this._isScrolling))kt=cn=rn,ln=grad4=bondcolor2;else if(this._isVSlow)kt=cn=rn,ln=grad4=bondcolor2;else if(typeof v.occ!="undefined"&&typeof j.occ!="undefined"&&(v.occ<1||j.occ<1))kt=cn=rn,ln=grad4=bondcolor2;else{var Zt=hn*Gt,en=hn*Yt,kt=n.createLinearGradient(v.screen.x+Zt,v.screen.y+en,v.screen.x-Zt,v.screen.y-en);kt.addColorStop(.2,v.color.rgb),this.background=="black"?kt.addColorStop(.5,v.color.rgbL):kt.addColorStop(.5,v.color.rgbL),kt.addColorStop(.8,v.color.rgb);var ln=n.createLinearGradient(j.screen.x+Zt,j.screen.y+en,j.screen.x-Zt,j.screen.y-en);ln.addColorStop(.2,j.color.rgb),this.background=="black"?ln.addColorStop(.5,j.color.rgbL):ln.addColorStop(.5,j.color.rgbL),ln.addColorStop(.8,j.color.rgb)}n.lineWidth=on,n.strokeStyle=kt,n.beginPath(),n.moveTo(qt,Rt),n.lineTo(un,an),n.closePath(),n.stroke(),n.strokeStyle=ln,n.beginPath(),n.moveTo(Ut,zt),n.lineTo(un,an),n.closePath(),n.stroke()}}}if(vt){var gn=-1;this._picked.length==this.picking&&(this._picked.length=0);var yn=vt.idx;vt.symop!=undefined&&(yn=vt.atom+"_"+vt.symop+"_"+vt.symt);for(var ht=0;ht<this._picked.length;ht++){var bn=this._picked[ht].idx;this._picked[ht].symop!=undefined&&(bn=this._picked[ht].atom+"_"+this._picked[ht].symop+"_"+this._picked[ht].symt);if(bn==yn){gn=ht;break}}gn==-1?this._picked.push(vt):this._picked.splice(gn,1)}if(this._select&&this._select.length>0&&this._picked.length==0){for(var wn=0;wn<this._select.length;wn++){var _t=this._select[wn].vdwRad!=undefined?this._select[wn].vdwRad:1;_t*=this.vdwScale,n.fillStyle="rgba(255, 215, 0, 0.5)",n.beginPath(),n.arc(this._select[wn].screen.x,this._select[wn].screen.y,2*_t,0,o,!0),n.closePath(),n.fill()}if(!this._isDragging&&!this._isScrolling){this._cif||(this._cif=new Scif),this._select.length==1&&this.selectCallback&&typeof this.selectCallback=="function"&&this.selectCallback(this,this._select[0].atom);if(this._select.length==2){var En=this._cif._calcBondC(this._select[0].xyz,this._select[1].xyz,this._select[0].xyzSu,this._select[1].xyzSu),Sn=this._cif._quickRoundUp(En[1],3);Sn=Sn.replace(/^[-0\.]*/g,"").replace(/\./,""),Sn!=""&&(Sn="("+Sn+")"),Sn="";var xn=this._select[0].atom+"-"+this._select[1].atom+" = "+this._cif._quickRoundUp(En[0],3)+Sn+" &#197;";this.selectCallback&&typeof this.selectCallback=="function"&&this.selectCallback(this,xn)}else if(this._select.length==3){var En=this._cif._calcAngleC(this._select[0].xyz,this._select[1].xyz,this._select[2].xyz,this._select[0].xyzSu,this._select[1].xyzSu,this._select[2].xyzSu),Sn=this._cif._quickRoundUp(En[1],1);Sn=Sn.replace(/^[-0\.]*/g,"").replace(/\./,""),Sn!=""&&(Sn="("+Sn+")"),Sn="";var xn=this._select[0].atom+"-"+this._select[1].atom+"-"+this._select[2].atom+" = "+this._cif._quickRoundUp(En[0],1)+Sn+"&#176;";this.selectCallback&&typeof this.selectCallback=="function"&&this.selectCallback(this,xn)}else if(this._select.length==4){var En=this._cif._calcTorsionC(this._select[0].xyz,this._select[1].xyz,this._select[2].xyz,this._select[3].xyz,this._select[0].xyzSu,this._select[1].xyzSu,this._select[2].xyzSu,this._select[3].xyzSu),Sn=this._cif._quickRoundUp(En[1],1);Sn=Sn.replace(/^[-0\.]*/g,"").replace(/\./,""),Sn!=""&&(Sn="("+Sn+")"),Sn="";var xn=this._select[0].atom+"-"+this._select[1].atom+"-"+this._select[2].atom+"-"+this._select[3].atom+" = "+this._cif._quickRoundUp(En[0],1)+Sn+"&#176;";this.selectCallback&&typeof this.selectCallback=="function"&&this.selectCallback(this,xn)}}}if(this.picking>0){var Tn="";for(var ht=0;ht<this._picked.length;ht++){var _t=this._picked[ht].vdwRad!=undefined?this._picked[ht].vdwRad:1;_t*=this.vdwScale,n.fillStyle="rgba(255, 215, 0, 0.5)",n.beginPath(),n.arc(this._picked[ht].screen.x,this._picked[ht].screen.y,2*_t,0,o,!0),n.closePath(),n.fill(),Tn+=" "+this._picked[ht].atom}if(!this._isDragging&&!this._isScrolling)if(this._picked.length==this.picking){this._cif||(this._cif=new Scif);if(this.picking==2){var En=this._cif._calcBondC(this._picked[0].xyz,this._picked[1].xyz,this._picked[0].xyzSu,this._picked[1].xyzSu),Sn=this._cif._quickRoundUp(En[1],3);Sn=Sn.replace(/^[-0\.]*/g,"").replace(/\./,""),Sn!=""&&(Sn="("+Sn+")"),Sn="";var xn=this._picked[0].atom+"-"+this._picked[1].atom+" = "+this._cif._quickRoundUp(En[0],3)+Sn+" &#197;";this.pickCallback&&typeof this.pickCallback=="function"&&this.pickCallback(xn)}else if(this.picking==3){var En=this._cif._calcAngleC(this._picked[0].xyz,this._picked[1].xyz,this._picked[2].xyz,this._picked[0].xyzSu,this._picked[1].xyzSu,this._picked[2].xyzSu),Sn=this._cif._quickRoundUp(En[1],1);Sn=Sn.replace(/^[-0\.]*/g,"").replace(/\./,""),Sn!=""&&(Sn="("+Sn+")"),Sn="";var xn=this._picked[0].atom+"-"+this._picked[1].atom+"-"+this._picked[2].atom+" = "+this._cif._quickRoundUp(En[0],1)+Sn+"&#176;";this.pickCallback&&typeof this.pickCallback=="function"&&this.pickCallback(xn)}else if(this.picking==4){var En=this._cif._calcTorsionC(this._picked[0].xyz,this._picked[1].xyz,this._picked[2].xyz,this._picked[3].xyz,this._picked[0].xyzSu,this._picked[1].xyzSu,this._picked[2].xyzSu,this._picked[3].xyzSu),Sn=this._cif._quickRoundUp(En[1],1);Sn=Sn.replace(/^[-0\.]*/g,"").replace(/\./,""),Sn!=""&&(Sn="("+Sn+")"),Sn="";var xn=this._picked[0].atom+"-"+this._picked[1].atom+"-"+this._picked[2].atom+"-"+this._picked[3].atom+" = "+this._cif._quickRoundUp(En[0],1)+Sn+"&#176;";this.pickCallback&&typeof this.pickCallback=="function"&&this.pickCallback(xn)}this.picking==2&&this.bondpicking>0&&this.bondpickCallback&&typeof this.bondpickCallback=="function"&&(pt=[this._picked[0],this._picked[1]]),this._picked.length=0,this._select.length=0}else this._picked.length>0&&this.pickCallback&&typeof this.pickCallback=="function"&&this.pickCallback(Tn)}this.clickx=null;if(e){var Nn=n.getSerializedSvg();return Nn}if(!this._isDragging&&!this._isScrolling&&mt[0])if(this.bondpickCallback&&typeof this.bondpickCallback=="function"){var Cn=i(mt[0],mt[1]);this.bondpickCallback(this,mt[0],mt[1],Cn)}else r(mt[0],mt[1]),this._show()};var c={};e._widget.prototype._showBox=function(e){var t=this.model.box;if(!t)return;var n=[];for(var r=0;r<t.length;r++){var i={x:t[r][0],y:t[r][1],z:t[r][2]};i.x-=this.model.center2d.x,i.y-=this.model.center2d.y,i.z-=this.model.center2d.z,i.y*=-1;if(this.rotationQuaternion){var s=this._rotateByQ(i.x,i.y,i.z);i.x=s[0],i.y=s[1],i.z=s[2];if(isNaN(i.x)||isNaN(i.y)||isNaN(i.z))throw"NaN"}n.push([i.x,i.y,i.z])}e.strokeStyle="#000000",e.beginPath(),e.moveTo(n[0][0],n[0][1]),e.lineTo(n[1][0],n[1][1]),e.stroke(),e.moveTo(n[1][0],n[1][1]),e.lineTo(n[4][0],n[4][1]),e.stroke(),e.moveTo(n[4][0],n[4][1]),e.lineTo(n[3][0],n[3][1]),e.stroke(),e.moveTo(n[3][0],n[3][1]),e.lineTo(n[0][0],n[0][1]),e.stroke(),e.moveTo(n[0][0],n[0][1]),e.lineTo(n[2][0],n[2][1]),e.stroke(),e.moveTo(n[2][0],n[2][1]),e.lineTo(n[6][0],n[6][1]),e.stroke(),e.moveTo(n[6][0],n[6][1]),e.lineTo(n[7][0],n[7][1]),e.stroke(),e.moveTo(n[6][0],n[6][1]),e.lineTo(n[1][0],n[1][1]),e.stroke(),e.moveTo(n[7][0],n[7][1]),e.lineTo(n[5][0],n[5][1]),e.stroke(),e.moveTo(n[5][0],n[5][1]),e.lineTo(n[3][0],n[3][1]),e.stroke(),e.moveTo(n[5][0],n[5][1]),e.lineTo(n[2][0],n[2][1]),e.stroke(),e.moveTo(n[7][0],n[7][1]),e.lineTo(n[4][0],n[4][1]),e.stroke(),e.closePath()},e._widget.prototype._showCell=function(e){if(!this.model||!this.model.cell)return;var t=this._rotateByQ(0-this.model.center2d.x,(0-this.model.center2d.y)*-1,0-this.model.center2d.z),n={};e.strokeStyle="#aaaaaa",e.drawText("sans",1,t[0],t[1],"O");for(var r=0;r<3;r++){var i=this.model.cell[r][0],s=this.model.cell[r][1],o=this.model.cell[r][2];i-=this.model.center2d.x,s-=this.model.center2d.y,o-=this.model.center2d.z,n[r]=this._rotateByQ(i,s*-1,o),e.beginPath(),r==0?e.strokeStyle="rgb(255,0,0)":r==1?e.strokeStyle="rgb(0,255,0)":e.strokeStyle="rgb(0,0,255)",e.lineWidth=.08,e.moveTo(t[0],t[1]),e.lineTo(n[r][0],n[r][1]),e.stroke(),e.closePath(),e.drawText("sans",1,n[r][0],n[r][1],String.fromCharCode(97+r))}e.strokeStyle="#aaaaaa",e.lineWidth=.04;var u=this._rotateByQ(0-this.model.center2d.x+this.model.cell[0][0]+this.model.cell[1][0]+this.model.cell[2][0],(0-this.model.center2d.y+this.model.cell[0][1]+this.model.cell[1][1]+this.model.cell[2][1])*-1,0-this.model.center2d.z+this.model.cell[0][2]+this.model.cell[1][2]+this.model.cell[2][2]),a=this._rotateByQ(this.model.cell[0][0]+this.model.cell[1][0]-this.model.center2d.x,(this.model.cell[0][1]+this.model.cell[1][1]-this.model.center2d.y)*-1,this.model.cell[0][2]+this.model.cell[1][2]-this.model.center2d.z),f=this._rotateByQ(this.model.cell[0][0]+this.model.cell[2][0]-this.model.center2d.x,(this.model.cell[0][1]+this.model.cell[2][1]-this.model.center2d.y)*-1,this.model.cell[0][2]+this.model.cell[2][2]-this.model.center2d.z),l=this._rotateByQ(this.model.cell[1][0]+this.model.cell[2][0]-this.model.center2d.x,(this.model.cell[1][1]+this.model.cell[2][1]-this.model.center2d.y)*-1,this.model.cell[1][2]+this.model.cell[2][2]-this.model.center2d.z);e.beginPath(),e.moveTo(u[0],u[1]),e.lineTo(a[0],a[1]),e.stroke(),e.moveTo(u[0],u[1]),e.lineTo(f[0],f[1]),e.stroke(),e.moveTo(u[0],u[1]),e.lineTo(l[0],l[1]),e.stroke(),e.moveTo(n[0][0],n[0][1]),e.lineTo(a[0],a[1]),e.stroke(),e.moveTo(n[0][0],n[0][1]),e.lineTo(f[0],f[1]),e.stroke(),e.moveTo(n[2][0],n[2][1]),e.lineTo(f[0],f[1]),e.stroke(),e.moveTo(n[2][0],n[2][1]),e.lineTo(l[0],l[1]),e.stroke(),e.moveTo(n[1][0],n[1][1]),e.lineTo(a[0],a[1]),e.stroke(),e.moveTo(n[1][0],n[1][1]),e.lineTo(l[0],l[1]),e.stroke(),e.closePath()},e._widget.prototype._getCellDrawObjects=function(){if(!this.model||!this.model.cell)return null;var e=this._rotateByQ(0-this.model.center2d.x,(0-this.model.center2d.y)*-1,0-this.model.center2d.z),t=[],n=[],r={};n.push({text:"0",x:e[0],y:e[1],z:e[2],colour:"#aaaaaa"});for(var i=0;i<3;i++){var s=this.model.cell[i][0],u=this.model.cell[i][1],a=this.model.cell[i][2];s-=this.model.center2d.x,u-=this.model.center2d.y,a-=this.model.center2d.z,r[i]=this._rotateByQ(s,u*-1,a);var f="rgb(255,0,0)";i==1?f="rgb(0,255,0)":i==2&&(f="rgb(0,0,255)");var l=o({x:e[0],y:e[1],z:e[2]},{x:r[i][0],y:r[i][1],z:r[i][2]},3),c=0;for(var h=0;h<l.length;h++)h+1<l.length&&t.push({P1:l[h],P2:l[h+1],colour:f,z:(l[h].z+l[h+1].z)/2});n.push({text:String.fromCharCode(97+i),colour:f,x:r[i][0],y:r[i][1],z:r[i][2]})}var p=this._rotateByQ(0-this.model.center2d.x+this.model.cell[0][0]+this.model.cell[1][0]+this.model.cell[2][0],(0-this.model.center2d.y+this.model.cell[0][1]+this.model.cell[1][1]+this.model.cell[2][1])*-1,0-this.model.center2d.z+this.model.cell[0][2]+this.model.cell[1][2]+this.model.cell[2][2]),d=this._rotateByQ(this.model.cell[0][0]+this.model.cell[1][0]-this.model.center2d.x,(this.model.cell[0][1]+this.model.cell[1][1]-this.model.center2d.y)*-1,this.model.cell[0][2]+this.model.cell[1][2]-this.model.center2d.z),v=this._rotateByQ(this.model.cell[0][0]+this.model.cell[2][0]-this.model.center2d.x,(this.model.cell[0][1]+this.model.cell[2][1]-this.model.center2d.y)*-1,this.model.cell[0][2]+this.model.cell[2][2]-this.model.center2d.z),m=this._rotateByQ(this.model.cell[1][0]+this.model.cell[2][0]-this.model.center2d.x,(this.model.cell[1][1]+this.model.cell[2][1]-this.model.center2d.y)*-1,this.model.cell[1][2]+this.model.cell[2][2]-this.model.center2d.z);l=o({x:p[0],y:p[1],z:p[2]},{x:d[0],y:d[1],z:d[2]},3);var c=0;for(var h=0;h<l.length;h++)h+1<l.length&&t.push({P1:l[h],P2:l[h+1],colour:"#aaaaaa",z:(l[h].z+l[h+1].z)/2});l=o({x:p[0],y:p[1],z:p[2]},{x:v[0],y:v[1],z:v[2]},3);var c=0;for(var h=0;h<l.length;h++)h+1<l.length&&t.push({P1:l[h],P2:l[h+1],colour:"#aaaaaa",z:(l[h].z+l[h+1].z)/2});l=o({x:p[0],y:p[1],z:p[2]},{x:m[0],y:m[1],z:m[2]},3);var c=0;for(var h=0;h<l.length;h++)h+1<l.length&&t.push({P1:l[h],P2:l[h+1],colour:"#aaaaaa",z:(l[h].z+l[h+1].z)/2});l=o({x:r[0][0],y:r[0][1],z:r[0][2]},{x:d[0],y:d[1],z:d[2]},3);var c=0;for(var h=0;h<l.length;h++)h+1<l.length&&t.push({P1:l[h],P2:l[h+1],colour:"#aaaaaa",z:(l[h].z+l[h+1].z)/2});l=o({x:r[0][0],y:r[0][1],z:r[0][2]},{x:v[0],y:v[1],z:v[2]},3);var c=0;for(var h=0;h<l.length;h++)h+1<l.length&&t.push({P1:l[h],P2:l[h+1],colour:"#aaaaaa",z:(l[h].z+l[h+1].z)/2});l=o({x:r[2][0],y:r[2][1],z:r[2][2]},{x:v[0],y:v[1],z:v[2]},3);var c=0;for(var h=0;h<l.length;h++)h+1<l.length&&t.push({P1:l[h],P2:l[h+1],colour:"#aaaaaa",z:(l[h].z+l[h+1].z)/2});l=o({x:r[2][0],y:r[2][1],z:r[2][2]},{x:m[0],y:m[1],z:m[2]},3);var c=0;for(var h=0;h<l.length;h++)h+1<l.length&&t.push({P1:l[h],P2:l[h+1],colour:"#aaaaaa",z:(l[h].z+l[h+1].z)/2});l=o({x:r[1][0],y:r[1][1],z:r[1][2]},{x:d[0],y:d[1],z:d[2]},3);var c=0;for(var h=0;h<l.length;h++)h+1<l.length&&t.push({P1:l[h],P2:l[h+1],colour:"#aaaaaa",z:(l[h].z+l[h+1].z)/2});l=o({x:r[1][0],y:r[1][1],z:r[1][2]},{x:m[0],y:m[1],z:m[2]},3);var c=0;for(var h=0;h<l.length;h++)h+1<l.length&&t.push({P1:l[h],P2:l[h+1],colour:"#aaaaaa",z:(l[h].z+l[h+1].z)/2});return{lines:t,labels:n}},e._widget.prototype._drawDashedLine=function(e,t,n,r,i){e.beginPath(),e.strokeStyle=i;var s=n.x-t.x,o=n.y-t.y,u=Math.floor(Math.sqrt(s*s+o*o)/r),a=s/u,f=o/u,l=0,c=t.x,h=t.y;while(l++<u)c+=a,h+=f,l%2==0?e.moveTo(c,h):e.lineTo(c,h);l%2==0?e.moveTo(n.x,n.y):e.lineTo(n.x,n.y),e.stroke(),e.closePath()},e._widget.prototype._drawZigZagLine=function(e,t,n,r,i){e.beginPath(),e.lineWidth=.05,e.strokeStyle=i,e.moveTo(t.x,t.y);var s=n.x-t.x,o=n.y-t.y,u=Math.floor(Math.sqrt(s*s+o*o)/r),a=s/u,f=o/u,l=Math.atan2(o,s);l-=90*Math.PI/180;var c=Math.cos(l)*.1,h=Math.sin(l)*.1,p=0,d=t.x,v=t.y;while(p++<u)d+=a,v+=f,p%2==0?e.lineTo(d+c,v+h):e.lineTo(d-c,v-h);e.lineTo(n.x,n.y),e.stroke(),e.closePath()},e._widget.prototype._rotateByQ=function(e,t,n){if(this.rotationQuaternion){var r=this.rotationQuaternion.x,i=this.rotationQuaternion.y,s=this.rotationQuaternion.z,o=this.rotationQuaternion.w;if(isNaN(r)||isNaN(i)||isNaN(s))return[e,t,n];var u=e,a=t,f=n,l=o*u+i*f-s*a,c=o*a+s*u-r*f,h=o*f+r*a-i*u,p=-r*u-i*a-s*f;return u=l*o+p*-r+c*-s-h*-i,a=c*o+p*-i+h*-r-l*-s,f=h*o+p*-s+l*-i-c*-r,isNaN(u)||isNaN(a)||isNaN(f)?[e,t,n]:[u,a,f]}return[e,t,n]},e._widget.prototype.equalQs=function(e,t,n){return n==undefined&&(n=1e-6),Math.abs(e.x-t.x)>n?!1:Math.abs(e.y-t.y)>n?!1:Math.abs(e.z-t.z)>n?!1:Math.abs(e.w-t.w)>n?!1:!0},e._widget.prototype.slerp=function(e,t,n){var r={x:e.x,y:e.y,z:e.z,w:e.w},i={x:t.x,y:t.y,z:t.z,w:t.w},s=r.x,o=r.y,u=r.z,a=r.w,f=a*i.w+s*i.x+o*i.y+u*i.z;f<0?(r.w=-i.w,r.x=-i.x,r.y=-i.y,r.z=-i.z,f=-f):(r.x=i.x,r.y=i.y,r.z=i.z,r.w=i.w);if(f>=1)return r.w=a,r.x=s,r.y=o,r.z=u,r;var l=Math.acos(f),c=Math.sqrt(1-f*f);if(Math.abs(c)<.001)return r.w=.5*(a+r.w),r.x=.5*(s+r.x),r.y=.5*(o+r.y),r.z=.5*(u+r.z),r;var h=Math.sin((1-n)*l)/c,p=Math.sin(n*l)/c;return r.w=a*h+r.w*p,r.x=s*h+r.x*p,r.y=o*h+r.y*p,r.z=u*h+r.z*p,r},e._widget.prototype.quaternionToPlatonAngles=function(){var e=this;e.rotationQuaternion||(e.rotationQuaternion={x:0,y:0,z:0,w:1});var t=e.rotationQuaternion.x,n=e.rotationQuaternion.y,r=e.rotationQuaternion.z,i=e.rotationQuaternion.w,s,o,u,a=i*i,f=t*t,l=n*n,c=r*r,h=f+l+c+a,p=t*i-n*r;return p>.4995*h?(s=2*Math.atan2(n,t),o=Math.PI/2,s=0):p<-0.4995*h?(s=-2*Math.atan2(n,t),o=-Math.PI/2,u=0):(s=Math.atan2(2*t*i+2*n*r,1-2*(r*r+i*i)),o=Math.asin(2*(t*r-i*n)),u=Math.atan2(2*t*n+2*r*i,1-2*(n*n+r*r))),s=-1*parseInt(s*(180/Math.PI)),s<0?s+=180:s-=180,o=parseInt(o*(180/Math.PI)),u=parseInt(u*(180/Math.PI)),[s,o,u]},e._widget.prototype.rotateToPlanes=function(e,t){if(typeof FlashCanvas!="undefined")return;var n=this;n.rotSpeed||(n.rotSpeed=.6),t&&(n.rotSpeed=t),e&&(n.rotPlanes=e);if(!n.rotPlanes)return;if(!n.targPlane&&n.rotPlanes.length==0)return;if(!n.targQ){n.targPlane=n.rotPlanes.shift();var r=n.targPlane,i=r[0],s=r[1],o=r[2],u=r[3];if(n.targPlane.length>4)u*=-1;else{n._cif||(n._cif=new Scif);var a=n._cif._xyzToUnitSu([i,s,o]),f=n._cif._xyzCrossSu([0,0,1],[i,s,o]);i=f[0][0],s=f[0][1],o=f[0][2];var l=n._cif._calcTorsionC([0,0,1],f[0],[0,0,0],a[0]),c=l[0]+180;u=c*(Math.PI/180);var h=1/Math.sqrt(i*i+s*s+o*o+u*u);i*=h,s*=h,o*=h,u*=h;var p=0,d=0,v=0,m=1,g=i,y=s,b=o,w=u;i=p*w+m*g+d*b-v*y,s=d*w+m*y+v*g-p*b,o=v*w+m*b+p*y-d*g,u=m*w-p*g-d*y-v*b}n.targQ={x:i,y:s,z:o,w:u}}n.rotationQuaternion||(n.rotationQuaternion={x:0,y:0,z:0,w:1}),n.rotationQuaternion=n.slerp(n.targQ,n.rotationQuaternion,n.rotSpeed),n.equalQs(n.rotationQuaternion,n.targQ,.01)&&(n.rotationQuaternion=n.targQ,n.rotDeg=0,n.rotPlanes.length==0&&(n.targPlane=null,n.spinCallback&&typeof n.spinCallback=="function"&&n.spinCallback(n)),n.targQ=null),window.requestAnimationFrame(function(){n._show()}),n.spincount=0,n.spin=0},e._widget.prototype.spinmol=function(){if(typeof FlashCanvas!="undefined")return;var e=this;if(e.spin){e.spincount||(e.spinx=.008,e.spiny=.004,e.spincount=1,e.spindir=1);if(e.spincount>50&&e.spincount<100)e.spinx=.004*e.spindir,e.spiny=.008*e.spindir;else if(e.spincount>100&&e.spincount<150)e.spinx=.008*e.spindir,e.spiny=.008*e.spindir;else if(e.spincount>150&&e.spincount<200)e.spinx=.008*e.spindir,e.spiny=.004*e.spindir;else if(e.spincount>200&&e.spincount<250){e.rotateToPlanes([[0,0,1,0],e.model.bestfit]),e.spincount=0,e.spin=0;return}e.spincount++;var t=Math.sqrt(this.spinx*this.spinx+this.spiny*this.spiny),n=Math.sin(t*Math.PI)/t,r=0,i=0,s=0,o=1,u=n*e.spiny,a=-1*n*e.spinx,f=0,l=-1*Math.cos(t*Math.PI),c=r*l+o*u+i*f-s*a,h=i*l+o*a+s*u-r*f,p=s*l+o*f+r*a-i*u,d=o*l-r*u-i*a-s*f;r=c,i=h,s=p,o=d,e.rotationQuaternion||(e.rotationQuaternion={x:0,y:0,z:0,w:1}),u=e.rotationQuaternion.x,a=e.rotationQuaternion.y,f=e.rotationQuaternion.z,l=e.rotationQuaternion.w,c=r*l+o*u+i*f-s*a,h=i*l+o*a+s*u-r*f,p=s*l+o*f+r*a-i*u,d=o*l-r*u-i*a-s*f,!isFinite(c)||isNaN(c)||!isFinite(h)||isNaN(h)||!isFinite(p)||isNaN(p)||!isFinite(d)||isNaN(d)?console.log("qNan - skip"):(e.rotationQuaternion.x=c,e.rotationQuaternion.y=h,e.rotationQuaternion.z=p,e.rotationQuaternion.w=d),window.requestAnimationFrame(function(){e._show()})}},e._widget.prototype._addSite=function(e,t,n){function m(e,t,n){var r={};return r.r=e.r+Math.round(n*(t.r-e.r)),r.b=e.b+Math.round(n*(t.b-e.b)),r.g=e.g+Math.round(n*(t.g-e.g)),r}function g(e,t,n){t||(t=.3),n||(n=.7);if(!e||!e.elem)return;e.vdwRad=SmolElementData.elVdwRadii[e.elem];var r=SmolElementData.elColours[e.elem];r==undefined&&(r=0);var i=r>>16,s=r>>8&255,o=r&255,u="rgb("+i+","+s+","+o+")",a="rgb("+i+","+s+","+o+")",f=1;if(typeof e.occ!="undefined"&&e.occ<1){var l=e.occ;l<.3&&(l=.3),u="rgba("+i+","+s+","+o+","+l+")",a="rgba("+i+","+s+","+o+","+l+")",f=l}e.color={hex:r,r:i,g:s,b:o,rgb:a,rgbBase:u},e.color.rgbLa="rgba("+i+","+s+","+o+", 0.7)";var c={r:i,b:o,g:s},h={r:255,b:255,g:255},p=m(c,h,.5),d=p.r,v=p.g,g=p.b;d==255&&g<50&&v<50&&(g=100,v=100),g==255&&d<50&&v<50&&(d=100,v=100),v==255&&g<50&&d<50&&(g=100,d=100),e.color.rgb50="rgb("+d+","+v+","+g+")",p=m(c,h,n);var d=p.r,v=p.g,g=p.b;d==255&&g<50&&v<50&&(g=100,v=100),g==255&&d<50&&v<50&&(d=100,v=100),v==255&&g<50&&d<50&&(g=100,d=100),f==1?e.color.rgbL="rgb("+d+","+v+","+g+")":e.color.rgbL="rgba("+d+","+v+","+g+","+f+")",h={r:0,b:0,g:0},p=m(c,h,t);var d=p.r,v=p.g,g=p.b;d==255&&g<50&&v<50&&(g=100,v=100),g==255&&d<50&&v<50&&(d=100,v=100),v==255&&g<50&&d<50&&(g=100,d=100),f==1?e.color.rgb="rgb("+d+","+v+","+g+")":e.color.rgb="rgba("+d+","+v+","+g+","+f+")",h={r:0,b:0,g:0},p=m(c,h,.5);var d=p.r,v=p.g,g=p.b;d==255&&g<50&&v<50&&(g=100,v=100),g==255&&d<50&&v<50&&(d=100,v=100),v==255&&g<50&&d<50&&(g=100,d=100),f==1?e.color.rgbD="rgb("+d+","+v+","+g+")":e.color.rgbD="rgba("+d+","+v+","+g+","+f+")"}var r=this;if(r.model.atoms[e+"_"+t+"_"+n])return;var i=r._cif.blocks[r.model.cifblk],s=n.split(""),o=s[0]-5,u=s[1]-5,a=s[2]-5,f=i.model.sites[e+"_"+t+"_555"];if(!f)return;var l={};if(!f.fxyz){var c=r._cif._getC2Fmatrix(i);f.symc=[5,5,5],f.fxyz=r._cif._xyzApplyMatrix(site.xyz,i.C2Fmatrix),f.fxyzSu=[0,0,0]}l.fxyz=[f.fxyz[0]+o,f.fxyz[1]+u,f.fxyz[2]+a],l.fxyzSu=f.fxyzSu,l.symop=f.symop,l.symc=[f.symc[0]+o,f.symc[1]+u,f.symc[2]+a],l.symt=l.symc[0]+""+l.symc[1]+""+l.symc[2],l.xyz=[],l.atom=f.atom,l.elem=f.elem,l.bondOrder=[];if(i.geomdata&&i.geomdata.bonds&&i.geomdata.bonds[l.atom+"_"+l.symop+"_"+l.symt]){l.bonds=i.geomdata.bonds[l.atom+"_"+l.symop+"_"+l.symt];for(var h=0;h<l.bonds.length;h++)l.bondOrder.push(1)}else l.bonds=[];var p=r._cif._getF2Cmatrix(i);l.xyz=r._cif._xyzApplyMatrix(l.fxyz,i.F2Cmatrix),l.xyzSu=r._cif._xyzApplyMatrix(l.fxyzSu,i.F2Cmatrix),l.x=l.xyz[0],l.y=l.xyz[1],l.z=l.xyz[2],l.occ=f.occ,l.dis_ass=f.dis_ass,l.dis_grp=f.dis_grp,g(l),l.xtra=!0,r.model.atoms[e+"_"+t+"_"+n]=l;var d=i.geomdata.bondsByLabel[l.atom];if(d)for(var h=0;h<d.length;h+=2){if(r.model.atoms[d[h]+"_"+t+"_"+n])continue;var v=d[h]+"";r._addSite(v,t,n)}},e._widget.prototype._changeBondOrder=function(e,t,n){r(e,t,n),this._show()},e._widget.prototype._getMoieties=function(){var e=this;if(!e.model.moieties){var t=e._cif.blocks[e.model.cifblk];t&&t.moieties&&(e.model.moieties=t.moieties)}return e.model.moieties},e._widget.prototype._selectSitesByMoiety=function(e,t){var n=this;for(var r in n.model.atoms){if(!n.model.atoms[r])continue;n.model.atoms[r].moiety&&n.model.atoms[r].moiety==e&&t&&n._select.push(n.model.atoms[r])}},e._widget.prototype._toggleSitesByMoiety=function(e){var t=this,n=!1;for(var r in t.model.atoms){if(!t.model.atoms[r])continue;t.model.atoms[r].moiety&&t.model.atoms[r].moiety==e&&(t.model.atoms[r].hide?(t.model.atoms[r].hide=!1,n=!0):t.model.atoms[r].hide=!0)}return n},e._widget.prototype._showSitesByMoiety=function(e,t){var n=this;for(var r in n.model.atoms){if(!n.model.atoms[r])continue;n.model.atoms[r].moiety&&n.model.atoms[r].moiety==e&&(t?n.model.atoms[r].hide=!1:n.model.atoms[r].hide=!0)}},e._widget.prototype._showSingleMoiety=function(e,t){var n=this;for(var r in n.model.atoms){if(!n.model.atoms[r])continue;n.model.atoms[r].hide=!0,n.model.atoms[r].moiety&&n.model.atoms[r].moiety==e&&(t?n.model.atoms[r].hide=!1:n.model.atoms[r].hide=!0)}},e._widget.prototype._showAll=function(){var e=this;for(var t in e.model.atoms){if(!e.model.atoms[t])continue;e.model.atoms[t].hide=!1}},e._widget.prototype._selectSitesByLabel=function(e,t){var n=this;n._select.length=0;for(var r=0;r<e.length;r++)if(n.model.atoms[e[r]])n._select.push(n.model.atoms[e[r]]);else{var i=e[r].split("_");n._addSite(i[0],i[1],i[2]),n.model.atoms[e[r]]&&n._select.push(n.model.atoms[e[r]])}var s=[],o=0;for(var u in n.model.atoms){o++;if(!n.model.atoms[u])continue;n.model.atoms[u].xtra&&(s[u]=n.model.atoms[u])}var a=n._cif.blocks[n.model.cifblk];for(var f in s)for(var l in s){if(!s[l]||!s[l].xyz||f==l)continue;if(s[f].bonds&&s[f].bonds.indexOf(l)>-1)continue;if(a.geomdata.bondsByLabel[s[f].atom]){var c=a.geomdata.bondsByLabel[s[f].atom].indexOf(s[l].atom);if(c>-1){var h=n._cif._calcBondC(s[f].xyz,s[l].xyz,s[f].xyzSu,s[l].xyzSu);if(h[0]<SmolElementData.elCovRadii[s[f].elem]+SmolElementData.elCovRadii[s[l].elem]+.4||h[0]<a.geomdata.bondsByLabel[s[f].atom][c+1]*1.1)s[f].bonds.push(l),s[l].bonds.push(f),s[f].bondOrder.push(1),s[l].bondOrder.push(1)}}}e.length==3&&t&&t=="hinteractions"&&n.model.atoms[e[1]]&&n.model.atoms[e[2]]&&(n.model.atoms[e[1]].bonds.indexOf(e[2])==-1&&(n.model.atoms[e[1]].bonds.push(e[2]),n.model.atoms[e[1]].bondOrder.push(.5)),n.model.atoms[e[2]].bonds.indexOf(e[1])==-1&&(n.model.atoms[e[2]].bonds.push(e[1]),n.model.atoms[e[2]].bondOrder.push(.5)))},e._widget.prototype._selectSitesByAtomAndSymop=function(e,t,n){var r=this;r._select.length=0,r._symopList||(r._symopList=r._getSymopList());var i=[];for(var s=0;s<t.length;s++){var o="";if(t[s]=="")o=e[s]+"_1_555";else{for(var u in r._symopList)if(r._symopList[u].full==t[s]){o=e[s]+"_"+u;break}o==""}o!=""&&i.push(o)}r._selectSitesByLabel(i,n)},e._widget.prototype._getSymopList=function(){var e=this,t=[],n=e._cif.blocks[e.model.cifblk],r=n.model.sites;for(var i in r){var s=r[i];if(s.symop!=undefined){var o=s.symop+"_"+s.symt;if(t[o])continue;t[o]=e._cif._transformSymCode(e._cif.blocks[e.model.cifblk],o)}}var u=["_geom_bond_site_symmetry_1","_geom_bond_site_symmetry_2","_geom_hbond_site_symmetry_d","_geom_hbond_site_symmetry_a"];for(x=0;x<u.length;x++){var a=n.cifitems[u[x]];if(a){var f=a.getValues();for(var l=0;l<f.length;l++){if(t[f[l]])continue;f[l].search(/^\d+$/)==0&&(f[l]+="_555");if(f[l].search(/^\d+(_\d\d\d)?$/)==-1)continue;t[f[l]]=e._cif._transformSymCode(e._cif.blocks[e.model.cifblk],f[l])}}}return t}})(Smol);var SmolPopup=function(){function e(e){return this._create(e),this}return e.prototype._create=function(e){this._options={id:(new Date).getTime()+"",dragmode:"absolute",resizable:!0,parent
:document.body,info:"",title:"",style:"smolpop",position:[],size:300,closable:!0,toolbox:!0,popupOptions:{}};if(e)for(var t in e)typeof this._options[t]!="undefined"&&(this._options[t]=e[t]);if(typeof e["popupOptions"]!="undefined")for(var n in e.popupOptions)typeof this._options[n]!="undefined"&&(this._options[n]=this._options.popupOptions[n]);var r=300,i=300,s=0;typeof this._options.size=="object"?(this._options.size.width&&(l=parseInt(this._options.size.width)),this._options.size.height&&(s=parseInt(this._options.size.height))):l=parseInt(this._options.size),l>20&&l<2001&&(r=l,i=l,s>20&&s<2001&&(i=s));var o=getWinWidth(),u=getWinHeight();r>o&&(r=o-20,i=o-20),i+100>u&&this._options.dragmode!="relative"&&(this._options.dragmode="absolute");if(this._options.position.length==0&&this._options.dragmode!="relative"){var a=0,f=0;if(this._options.dragmode!="fixed"){var l=getScreenScrollXY();a=l[0],f=l[1]}var c=o/2-r/2+a;c<20&&(c=0);var h=u/4-i/4+f;h<20&&(h=0),this._options.position=[c,h]}else this._options.position.length==0&&(this._options.position=[0,0]);if(this._options.dragmode=="relative"){var p=findPos(this._options.parent)[0]+this._options.position[0];r+p+30>o&&(r=o-p-30,i=r)}this._options.size=[r,i],this.popup=this._createSmolStructureWidget()},e.prototype._createSmolStructureWidget=function(){function p(e){var t=e.className,n=document.createElement("div");n.className=t+"_toolbox",n.style.border="1px solid #ccc",n.style.background="#efefef",n.style.position="absolute",n.style.left="0px",n.style.top="0px",n.style.margin="0",n.style.padding="0",n.style.visibility="hidden",n.style.zIndex=1,e.appendChild(n),e.toolbox=n,n._p=e,e.showtoolbox=function(e){this.style.zIndex=highestZIndex++;if(e&&e=="hide"){this.toolbox.style.zIndex=1;for(var t=0;t<this.toolbox.buttons.length;t++)this.toolbox.buttons[t].deactivate();this.toolbox.style.top="0px",this.toolbox.style.left="0px",this.toolbox.style.visibility="hidden";return}if(this.toolbox.style.visibility=="hidden"||e&&e=="show"){this.toolbox.style.visibility="visible";var n=getWinWidth();n==0&&(n=200);var r=parseInt(this.style.left);this.style.position=="relative"&&(r=findPos(this)[0]);if(r+parseInt(this.style.width)+144<n)this.toolbox.style.width="144px",this.toolbox.style.top="0px",this.toolbox.style.left=parseInt(this.style.width)-144+"px",divMoveAnim(this.toolbox,parseInt(this.style.width),0,"block","div.style.visibility='visible';");else if(r-144>0)this.toolbox.style.width="144px",this.toolbox.style.top="0px",this.toolbox.style.left="0px",divMoveAnim(this.toolbox,-144,0,"block","div.style.visibility='visible';");else{this.toolbox.style.width=this.style.width,this.toolbox.style.top="0px",this.toolbox.style.left="0px";var i=-this.toolbox.offsetHeight;this.style.position=="fixed"&&parseInt(this.style.top)+i<1?(this.toolbox.style.top="30px",this.toolbox.style.visibility="visible",this.toolbox.style.zIndex=highestZIndex++):divMoveAnim(this.toolbox,0,i,"block","div.style.visibility='visible';div.style.zIndex=highestZIndex++;")}}else{this.toolbox.style.zIndex=1;for(var t=0;t<this.toolbox.buttons.length;t++)this.toolbox.buttons[t].deactivate();if(parseInt(this.toolbox.style.top)==0)divMoveAnim(this.toolbox,parseInt(this.style.width)-this.toolbox.offsetWidth,0,"block","div.style.visibility='hidden';");else{var s=0;divMoveAnim(this.toolbox,0,s,"block","div.style.visibility='hidden';")}}},d(n)}function d(e){var t=e._p.className;e.buttons=[],e.buttonChanged=function(e,t){var n=!1;t&&t=="reset"&&(n=!0);for(var r=0;r<this.buttons.length;r++)this.buttons[r]!=e&&(n?this.buttons[r].reset():this.buttons[r].deactivate())};var n=document.createElement("div");n.className=t+"_button",n.style.cssFloat="left",n.style.position="relative",n.style.verticalAlign="top",n.style.display="inline-block",n.style.border="1px solid #aaa",n.style.borderRadius="4px",n.style.textAlign="center",n.style.lineHeight="32px",n.style.margin="4px",n.style.paddingTop="0px",n.style.paddingBottom="0px",n.style.paddingLeft="4px",n.style.paddingRight="4px",n.innerHTML="asymmetric unit",e.appendChild(n),n.onmousedown=function(){return!1},n.onmouseup=function(){return this.smol||(this.smol=e._p._smolwidget),this.smol&&(this.smol.viewStyle="ellipsoids",this.smol.changeModel("asu")),!1};var r=document.createElement("div");r.className=t+"_button",r.style.cssFloat="left",r.style.position="relative",r.style.verticalAlign="top",r.style.display="inline-block",r.style.border="1px solid #aaa",r.style.borderRadius="4px",r.style.textAlign="center",r.style.lineHeight="32px",r.style.margin="4px",r.style.paddingTop="0px",r.style.paddingBottom="0px",r.style.paddingLeft="4px",r.style.paddingRight="4px",r.innerHTML="molecule",e.appendChild(r),r.onmousedown=function(){return!1},r.onmouseup=function(){return this.smol||(this.smol=e._p._smolwidget),this.smol&&(this.smol.viewStyle=="ellipsoids"&&(this.smol.viewStyle="ball_and_stick",this.smol.vdwScale=.22),this.smol.changeModel("mol")),!1};var i=document.createElement("div");i.className=t+"_button",i.style.cssFloat="left",i.style.position="relative",i.style.verticalAlign="top",i.style.display="inline-block",i.style.border="1px solid #aaa",i.style.borderRadius="4px",i.style.textAlign="center",i.style.lineHeight="32px",i.style.margin="4px",i.style.paddingTop="0px",i.style.paddingBottom="0px",i.style.paddingLeft="4px",i.style.paddingRight="4px",i.innerHTML="unit cell",e.appendChild(i),i.onmousedown=function(){return!1},i.onmouseup=function(){return this.smol||(this.smol=e._p._smolwidget),this.smol&&(this.smol.viewStyle=="ellipsoids"&&(this.smol.viewStyle="ball_and_stick",this.smol.vdwScale=.22),this.smol.changeModel("cell5551")),!1};var s=document.createElement("div");s.style.width="124px",s.style.height="32px",s.style.cssFloat="left",s.style.position="relative",s.className=t+"_button_vdw_slider",s.style.border="1px solid #aaa",s.style.borderRadius="4px",s.style.backgroundPosition="0% 0%",s.style.backgroundColor="#efefef",s.style.lineHeight="32px",s.style.margin="4px",s.style.paddingTop="0px",s.style.paddingBottom="0px",s.style.paddingLeft="4px",s.style.paddingRight="4px",s.style.position="relative",s.style.display="inline-block",s.style.verticalAlign="top",s.style.textAlign="left",s.style.background="url(//publcif.iucr.org/widgets/images/slidebarbg.png) no-repeat center",s.style.cursor="pointer",e.appendChild(s);var o=document.createElement("div");o.style.width="32px",o.style.height="32px",o.style.position="relative",o.style.left="22px",o.style.background="url(//publcif.iucr.org/widgets/images/_ball_32.png) no-repeat center",o.style.cursor="pointer",s.appendChild(o),s.slider=o,s.onmouseup=function(e){this.slider.clickmove(e)},o.scale=parseInt(22),o.enabled=0,o.style.left=o.scale+"px",Drag.init(o,null,0,100,0,0),o.reset=function(e){this.scale=parseInt(1*e),this.style.left=this.scale+"px"},o.moveto=function(e){this.clickmove(e)},o.onDragStart=function(t,n){this.smol||(this.smol=e._p._smolwidget),this.smol&&(this.smol.viewStyle=="scheme"?this.smol._show({label:!1,viewStyle:"ball_and_stick"}):this.smol._show({viewStyle:"ball_and_stick"}))},o.onDrag=function(e,t){var n=parseInt(e);this.smol&&(this.smol._isDragging=!0,this.smol._show({viewStyle:"ball_and_stick",vdwScale:n/100})),this.scale=e},o.onDragEnd=function(e,t){var n=parseInt(e);this.smol&&(this.smol._isDragging=!1,this.smol._show({viewStyle:"ball_and_stick",vdwScale:n/100})),this.scale=e};var u=document.createElement("div");u.className=t+"_button",u.style.cssFloat="left",u.style.position="relative",u.style.verticalAlign="top",u.style.display="inline-block",u.style.border="1px solid #aaa",u.style.borderRadius="4px",u.style.textAlign="center",u.style.lineHeight="32px",u.style.margin="4px",u.style.paddingTop="0px",u.style.paddingBottom="0px",u.style.paddingLeft="4px",u.style.paddingRight="4px",u.innerHTML="schematic",e.appendChild(u),u.onmousedown=function(){return!1},u.onmouseup=function(){return this.smol||(this.smol=e._p._smolwidget),this.smol&&this.smol._show({label:!0,viewStyle:"scheme"}),e._p._backdiv.style.background="white",e._p._infodiv.style.color="#000",!1};var a=[],f=[],l=[];f[0]="bonds",l[0]="pick bonds",a[0]=2,f[1]="angles",l[1]="pick angles",a[1]=3,f[2]="torsions",l[2]="pick torsions",a[2]=4,f[3]="nothing",l[3]="measure",a[3]=0;var c=v(f.length,null,null,null,t);c.style.width="124px",c.group=e;for(var h=0;h<c.optionDivs.length;h++)c.optionDivs[h].innerHTML=f[h],c.optionDivs[h].script=a[h],c.optionDivs[h].onmouseup=function(){this.smol||(this.smol=e._p._smolwidget),e._p.statusBar.innerHTML="",this.smol&&this.smol._show({picking:this.script,pickCallback:function(t){e._p.statusBar.innerHTML=t}})},c.optionDivs[h].selectedLabel=l[h];c.labelSpan.innerHTML="measure",c.displayChange=function(){this.group.buttonChanged(this)},e.appendChild(c.container),e.pickingButton=c,e.buttons.push(c);var p=[],d=[],m=[];d[0]="black",m[0]="background",p[0]="black",d[1]="white",p[1]="white",m[1]="background";var g=v(2,null,null,null,t);g.style.width="124px";for(var h=0;h<g.optionDivs.length;h++)g.optionDivs[h].innerHTML=d[h],g.optionDivs[h].script=p[h],g.optionDivs[h].onmouseup=function(){e._p._backdiv.style.background=this.script,this.script=="black"?e._p._infodiv.style.color="#ebebeb":e._p._infodiv.style.color="#000"},g.optionDivs[h].selectedLabel=m[h];g.labelSpan.innerHTML="background",g.group=e,g.displayChange=function(){this.group.buttonChanged(this)},e.appendChild(g.container),e.buttons.push(g)}function v(e,t,n,r,i){var s=document.createElement("div");s.style.cssFloat="left",s.style.display="inline-block";var o=document.createElement("div");o.style.display="block",o.style.color="#666666",o.style.margin="4px",o.style.marginTop="6px",o.style.marginBottom="2px",o.style.fontWeight="bold",o.className=i+"_heading",s.appendChild(o),r?o.innerHTML=r:o.style.display="none";var u=document.createElement("div");u.className=i+"_button_dropdown",u.style.cssFloat="left",u.style.position="relative",u.style.verticalAlign="top",u.style.display="block",u.style.border="1px solid #aaa",u.style.borderRadius="4px",u.style.textAlign="left",u.style.lineHeight="32px",u.style.margin="4px",u.style.paddingTop="0px",u.style.paddingBottom="0px",u.style.paddingLeft="4px",u.style.paddingRight="4px",u.style.backgroundImage="url(//publcif.iucr.org/widgets/images/triang_d_24.png)",u.style.backgroundRepeat="no-repeat",u.style.backgroundPosition="98% 50%",s.appendChild(u);var a=document.createElement("div");u.appendChild(a);var f=document.createElement("span");a.appendChild(f),u.labelSpan=f;var l=document.createElement("div");l.style.position="absolute",l.style.display="none",l.style.left="-1px",l.className=i+"_button_dropdown_options",l.style.verticalAlign="top",l.style.border="1px solid #aaa",l.style.borderRadius="4px",l.style.textAlign="left",l.style.lineHeight="2em",l.style.margin="0px",l.style.paddingTop="0px",l.style.paddingBottom="0px",l.style.paddingLeft="0px",l.style.paddingRight="0px",l.style.width="100%",l.style.background="#ddd",a.appendChild(l);var c=[];for(var h=0;h<e;h++){var p=document.createElement("div");p.className=i+"_button_option",p.style.border="1px solid transparent",p.style.paddingTop="0px",p.style.paddingBottom="0px",p.style.paddingLeft="4px",p.style.paddingRight="4px",p.onclick=function(){this.selectedLabel?u.labelSpan.innerHTML=this.selectedLabel:u.labelSpan.innerHTML=this.innerHTML,u.selectedEl=this},l.appendChild(p),c[h]=p}return u.optionDivs=c,u.optionsDiv=l,typeof n=="function"?u.displayChange=n:u.displayChange=function(){},u.onclick=function(){l.style.zIndex=1,l.style.display=="block"?(this.deactivate(),this.displayChange()):(this.activate(),this.displayChange())},t&&t=="hover"&&(u.onmouseover=function(){this.activate(),this.displayChange()},u.onmouseout=function(){this.deactivate(),this.displayChange()}),u.activate=function(){l.style.display="block",this.style.backgroundImage="url(//publcif.iucr.org/widgets/images/triang_u_24.png)",this.className=this.className.replace(/_dropdown$/,"_rollup")},u.deactivate=function(){l.style.display="none",this.style.backgroundImage="url(//publcif.iucr.org/widgets/images/triang_d_24.png)",this.className=this.className.replace(/_rollup$/,"_dropdown")},u.reset=function(){l.style.display="none",this.style.backgroundImage="url(//publcif.iucr.org/widgets/images/triang_u_24.png)",this.className=this.className.replace(/_rollup$/,"_dropdown"),typeof this.defaultSelectedIdx=="undefined"&&(this.defaultSelectedIdx=0),this.optionDivs[this.defaultSelectedIdx].selectedLabel?this.labelSpan.innerHTML=this.optionDivs[this.defaultSelectedIdx].selectedLabel:this.labelSpan.innerHTML=this.optionDivs[this.defaultSelectedIdx].innerHTML,this.selectedEl=u.optionDivs[this.defaultSelectedIdx]},u.selectedEl=u.optionDivs[0],u.container=s,u}var e=this._options,t=document.createElement("div");t.className=e.style,t.style.border="1px solid #ccc",t.style.background="#ffffff",t.style.borderRadius="4px",t.id=e.id,t.style.width=e.size[0]+"px",e["resizable"]==1?(t.style.height=e.size[1]+60+"px",t.resizeBar=!0):(t.style.height=e.size[1]+30+"px",t.resizeBar=!1),t.style.left=e.position[0]+"px",t.style.top=e.position[1]+"px",t.style.position=e.dragmode,t.style.margin="0",t.style.padding="0",e.parent.appendChild(t);var n=document.createElement("div");n.style.cursor="move",n.style.backgroundColor="#ddd",n.style.backgroundImage="linear-gradient(#ccc, #eee)",n.className=e.style+"_titlebar",n.id=e.id+"_draghandle",n.style.height="30px",n.style.overflow="visible",n.style.position="relative",n.style.margin="0",n.style.zIndex=2,t.appendChild(n);var r=document.createElement("div");r.className=e.style+"_closebutton",r.style.width="30px",r.style.height="30px",r.style.position="relative",r.style.cssFloat="left",r.style.margin="0",r.style.backgroundImage="url(//publcif.iucr.org/widgets/images/delete_24.png)",r.style.backgroundRepeat="no-repeat",r.style.backgroundPosition="center",r.style.cursor="pointer",r._p=t,n.appendChild(r),r.onmouseup=function(){this._p.hide()},e["closable"]!=1&&(r.style.display="none");var i=document.createElement("div");i.className=e.style+"_title",i.style.lineHeight="30px",i.style.fontSize="14px",i.style.paddingLeft="5px",i.style.fontWeight="bold",i.style.color="#666666",i.style.position="relative",i.style.cssFloat="left",i.style.margin="0",i.style.width="60%",i.style.overflow="hidden",i.style.height="30px",i.innerHTML=e.title,n.appendChild(i);var s=document.createElement("div");s.className=e.style+"_infobutton",s.style.width="30px",s.style.height="30px",s.style.position="relative",s.style.cssFloat="right",s.style.margin="0",s.style.backgroundImage="url(//publcif.iucr.org/widgets/images/info_24.png)",s.style.backgroundRepeat="no-repeat",s.style.backgroundPosition="center",s.style.cursor="pointer",s._p=t,n.appendChild(s),s.onmouseup=function(){this._p._infodiv.style.display=="block"?(this._p._infodiv.style.display="none",this.style.backgroundImage="url(//publcif.iucr.org/widgets/images/info_24.png)",this.className=this.className.replace(/_smolbutton$/,"_infobutton")):(this._p._infodiv.style.display="block",this.style.backgroundImage="url(//publcif.iucr.org/widgets/images/smol_32.png)",this.className=this.className.replace(/_infobutton$/,"_smolbutton"))},e["info"]==""&&(s.style.display="none");var o=document.createElement("div");o.className=e.style+"_toolsbutton",o.style.width="30px",o.style.height="30px",o.style.position="relative",o.style.cssFloat="right",o.style.margin="0",o.style.backgroundImage="url(//publcif.iucr.org/widgets/images/spanner_24.png)",o.style.backgroundRepeat="no-repeat",o.style.backgroundPosition="center",o.style.cursor="pointer",o._p=t,n.appendChild(o),o.onmouseup=function(){this._p.showtoolbox()},e["toolbox"]!=1&&(o.style.display="none");var u=document.createElement("div");u.id=e.id+"_backdiv",u.className=e.style+"_backdiv",u.style.position="absolute",u.style.width=e.size[0]+"px",u.style.height=e.size[1]+"px",u.style.zIndex=2,u.style.margin="0",u.style.background="#ffffff",t.appendChild(u),t._backdiv=u;var a=document.createElement("div");a.id=e.id+"_infodiv",a.className=e.style+"_info",a.style.position="absolute",a.style.zIndex=2,a.style.margin="0",a.style.overflow="hidden",a.innerHTML=e.info,a.style.display="none",t.appendChild(a),t._infodiv=a;var f=document.createElement("div");f.id=e.id+"_smoldiv",f.style.position="relative",f.style.zIndex=2,f.style.width=e.size[0]+"px",f.style.height=e.size[1]+"px",f.style.margin="0",f.style.padding="0",t.appendChild(f);var l=document.createElement("div");l.className=e.style+"_statusbar",l.id=e.id+"_statusbar",l.style.height="30px",l.style.lineHeight="30px",l.style.paddingLeft="5px",l.style.position="relative",l.style.zIndex=2,l.style.margin="0",l.style.padding="0",l.style.bottom="0px",l.style.backgroundImage="url(//publcif.iucr.org/widgets/images/resize_24.png)",l.style.backgroundRepeat="no-repeat",l.style.backgroundPosition="right bottom",l.style.cursor="se-resize",t.appendChild(l),t.statusBar=l,e["resizable"]!=1&&(l.style.display="none"),t.hide=function(){this.style.display="none"},t.show=function(){if(this.style.position!="relative"){var e=0,t=0;if(this.style.position!="fixed"){var n=getScreenScrollXY();e=n[0],t=n[1]}var r=getWinWidth()-20,i=getWinHeight(),s=parseInt(this.style.width),o=parseInt(this.style.height);s>r&&(s=r,o=s+60);var u=r/2-s/2+e;u<20&&(u=0);var a=i/4-o/4+t;a<0&&(a=0);var f=parseInt(this.style.left),l=parseInt(this.style.top);f+s>r&&(f=r-s),l+o>i&&(l=i/4-o/4+t),l<0&&(l=0),f<0&&(f=0),this.style.width=s+"px",this.style.height=o+"px",this.style.left=f+"px",this.style.top=l+"px",this._smoldiv.style.height=o-60+"px",this._smoldiv.style.width=s+"px",this._backdiv.style.height=o-60+"px",this._backdiv.style.width=s+"px",this._infodiv.style.width=s+"px",this._smolwidget&&this._smolwidget.resize(s,o-60),this.style.zIndex=highestZIndex++}else parseInt(this.style.left)+s>r&&(this.style.left=r-s-10+"px");this.style.display="block"},t.resize=function(e,t){this.showtoolbox("hide"),this.style.height=t+"px",this.style.width=e+"px";var n=30;this.resizeBar&&(n=60),this._smoldiv.style.height=t-n+"px",this._smoldiv.style.width=e+"px",this._backdiv.style.height=t-n+"px",this._backdiv.style.width=e+"px",this._infodiv.style.width=e+"px",this._smolwidget&&this._smolwidget.resize(e,t-n)},t.style.display="block",e["dragmode"]!="relative"?t.style.zIndex=highestZIndex++:t.style.zIndex=0,t._smoldiv=f;var c=null,h=null;return e["dragmode"]!="relative"?(c=0,h=0,Drag.init(n,t,c,null,h)):n.style.cursor="auto",e["resizable"]==1&&(DragResize.init(l,t),t.onDragResizeStart=function(e,t){this.showtoolbox("hide")},t.onDragResize=function(e,t){var n=30;this.resizeBar&&(n=60),this._smoldiv.style.height=t-n+"px",this._smoldiv.style.width=e+"px",this._backdiv.style.height=t-n+"px",this._backdiv.style.width=e+"px",this._infodiv.style.width=e+"px",this._smolwidget&&this._smolwidget.resize(e,t-n)},t.onDragResizeEnd=function(e,t){var n=30;this.resizeBar&&(n=60),this._smoldiv.style.height=t-n+"px",this._smoldiv.style.width=e+"px",this._backdiv.style.height=t-n+"px",this._backdiv.style.width=e+"px",this._infodiv.style.width=e+"px",this._smolwidget&&this._smolwidget.resize(e,t-n)}),p(t),t},e.prototype.resize=function(e,t){this.popup.showtoolbox("hide"),this.popup.style.height=t+"px",this.popup.style.width=e+"px";var n=30;this.popup.resizeBar&&(n=60),this.popup._smoldiv.style.height=t-n+"px",this.popup._smoldiv.style.width=e+"px",this.popup._backdiv.style.height=t-n+"px",this.popup._backdiv.style.width=e+"px",this.popup._infodiv.style.width=e+"px",this.popup._smolwidget&&this.popup._smolwidget.resize(e,t-n)},e}();"use strict";var numeric=typeof exports=="undefined"?function(){}:exports;typeof global!="undefined"&&(global.numeric=numeric),numeric.version="1.2.6",numeric.bench=function(t,n){var r,i,s,o;typeof n=="undefined"&&(n=15),s=.5,r=new Date;for(;;){s*=2;for(o=s;o>3;o-=4)t(),t(),t(),t();while(o>0)t(),o--;i=new Date;if(i-r>n)break}for(o=s;o>3;o-=4)t(),t(),t(),t();while(o>0)t(),o--;return i=new Date,1e3*(3*s-1)/(i-r)},numeric._myIndexOf=function(t){var n=this.length,r;for(r=0;r<n;++r)if(this[r]===t)return r;return-1},numeric.myIndexOf=Array.prototype.indexOf?Array.prototype.indexOf:numeric._myIndexOf,numeric.Function=Function,numeric.precision=4,numeric.largeArray=50,numeric.prettyPrint=function(t){function n(e){if(e===0)return"0";if(isNaN(e))return"NaN";if(e<0)return"-"+n(-e);if(isFinite(e)){var t=Math.floor(Math.log(e)/Math.log(10)),r=e/Math.pow(10,t),i=r.toPrecision(numeric.precision);return parseFloat(i)===10&&(t++,r=1,i=r.toPrecision(numeric.precision)),parseFloat(i).toString()+"e"+t.toString()}return"Infinity"}function i(e){var t;if(typeof e=="undefined")return r.push(Array(numeric.precision+8).join(" ")),!1;if(typeof e=="string")return r.push('"'+e+'"'),!1;if(typeof e=="boolean")return r.push(e.toString()),!1;if(typeof e=="number"){var s=n(e),o=e.toPrecision(numeric.precision),u=parseFloat(e.toString()).toString(),a=[s,o,u,parseFloat(o).toString(),parseFloat(u).toString()];for(t=1;t<a.length;t++)a[t].length<s.length&&(s=a[t]);return r.push(Array(numeric.precision+8-s.length).join(" ")+s),!1}if(e===null)return r.push("null"),!1;if(typeof e=="function"){r.push(e.toString());var f=!1;for(t in e)e.hasOwnProperty(t)&&(f?r.push(",\n"):r.push("\n{"),f=!0,r.push(t),r.push(": \n"),i(e[t]));return f&&r.push("}\n"),!0}if(e instanceof Array){if(e.length>numeric.largeArray)return r.push("...Large Array..."),!0;var f=!1;r.push("[");for(t=0;t<e.length;t++)t>0&&(r.push(","),f&&r.push("\n ")),f=i(e[t]);return r.push("]"),!0}r.push("{");var f=!1;for(t in e)e.hasOwnProperty(t)&&(f&&r.push(",\n"),f=!0,r.push(t),r.push(": \n"),i(e[t]));return r.push("}"),!0}var r=[];return i(t),r.join("")},numeric.parseDate=function(t){function n(e){if(typeof e=="string")return Date.parse(e.replace(/-/g,"/"));if(e instanceof Array){var t=[],r;for(r=0;r<e.length;r++)t[r]=n(e[r]);return t}throw new Error("parseDate: parameter must be arrays of strings")}return n(t)},numeric.parseFloat=function(t){function n(e){if(typeof e=="string")return parseFloat(e);if(e instanceof Array){var t=[],r;for(r=0;r<e.length;r++)t[r]=n(e[r]);return t}throw new Error("parseFloat: parameter must be arrays of strings")}return n(t)},numeric.parseCSV=function(t){var n=t.split("\n"),r,i,s=[],o=/(([^'",]*)|('[^']*')|("[^"]*")),/g,u=/^\s*(([+-]?[0-9]+(\.[0-9]*)?(e[+-]?[0-9]+)?)|([+-]?[0-9]*(\.[0-9]+)?(e[+-]?[0-9]+)?))\s*$/,a=function(e){return e.substr(0,e.length-1)},f=0;for(i=0;i<n.length;i++){var l=(n[i]+",").match(o),c;if(l.length>0){s[f]=[];for(r=0;r<l.length;r++)c=a(l[r]),u.test(c)?s[f][r]=parseFloat(c):s[f][r]=c;f++}}return s},numeric.toCSV=function(t){var n=numeric.dim(t),r,i,s,o,u,a;s=n[0],o=n[1],a=[];for(r=0;r<s;r++){u=[];for(i=0;i<s;i++)u[i]=t[r][i].toString();a[r]=u.join(", ")}return a.join("\n")+"\n"},numeric.getURL=function(t){var n=new XMLHttpRequest;return n.open("GET",t,!1),n.send(),n},numeric.imageURL=function(t){function n(e){var t=e.length,n,r,i,s,o,u,a,f,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c="";for(n=0;n<t;n+=3)r=e[n],i=e[n+1],s=e[n+2],o=r>>2,u=((r&3)<<4)+(i>>4),a=((i&15)<<2)+(s>>6),f=s&63,n+1>=t?a=f=64:n+2>=t&&(f=64),c+=l.charAt(o)+l.charAt(u)+l.charAt(a)+l.charAt(f);return c}function r(e,t,n){typeof t=="undefined"&&(t=0),typeof n=="undefined"&&(n=e.length);var r=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],i=-1,s=0,o=e.length,u;for(u=t;u<n;u++)s=(i^e[u])&255,i=i>>>8^r[s];return i^-1}var i=t[0].length,s=t[0][0].length,o,u,a,f,l,c,h,p,d,v,m,g=[137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,s>>24&255,s>>16&255,s>>8&255,s&255,i>>24&255,i>>16&255,i>>8&255,i&255,8,2,0,0,0,-1,-2,-3,-4,-5,-6,-7,-8,73,68,65,84,8,29];m=r(g,12,29),g[29]=m>>24&255,g[30]=m>>16&255,g[31]=m>>8&255,g[32]=m&255,o=1,u=0;for(p=0;p<i;p++){p<i-1?g.push(0):g.push(1),c=3*s+1+(p===0)&255,h=3*s+1+(p===0)>>8&255,g.push(c),g.push(h),g.push(~c&255),g.push(~h&255),p===0&&g.push(0);for(d=0;d<s;d++)for(f=0;f<3;f++)c=t[f][p][d],c>255?c=255:c<0?c=0:c=Math.round(c),o=(o+c)%65521,u=(u+o)%65521,g.push(c);g.push(0)}return v=(u<<16)+o,g.push(v>>24&255),g.push(v>>16&255),g.push(v>>8&255),g.push(v&255),l=g.length-41,g[33]=l>>24&255,g[34]=l>>16&255,g[35]=l>>8&255,g[36]=l&255,m=r(g,37),g.push(m>>24&255),g.push(m>>16&255),g.push(m>>8&255),g.push(m&255),g.push(0),g.push(0),g.push(0),g.push(0),g.push(73),g.push(69),g.push(78),g.push(68),g.push(174),g.push(66),g.push(96),g.push(130),"data:image/png;base64,"+n(g)},numeric._dim=function(t){var n=[];while(typeof t=="object")n.push(t.length),t=t[0];return n},numeric.dim=function(t){var n,r;if(typeof t=="object")return n=t[0],typeof n=="object"?(r=n[0],typeof r=="object"?numeric._dim(t):[t.length,n.length]):[t.length];return[]},numeric.mapreduce=function(t,n){return Function("x","accum","_s","_k",'if(typeof accum === "undefined") accum = '+n+";\n"+'if(typeof x === "number") { var xi = x; '+t+"; return accum; }\n"+'if(typeof _s === "undefined") _s = numeric.dim(x);\n'+'if(typeof _k === "undefined") _k = 0;\n'+"var _n = _s[_k];\n"+"var i,xi;\n"+"if(_k < _s.length-1) {\n"+"    for(i=_n-1;i>=0;i--) {\n"+"        accum = arguments.callee(x[i],accum,_s,_k+1);\n"+"    }"+"    return accum;\n"+"}\n"+"for(i=_n-1;i>=1;i-=2) { \n"+"    xi = x[i];\n"+"    "+t+";\n"+"    xi = x[i-1];\n"+"    "+t+";\n"+"}\n"+"if(i === 0) {\n"+"    xi = x[i];\n"+"    "+t+"\n"+"}\n"+"return accum;")},numeric.mapreduce2=function(t,n){return Function("x","var n = x.length;\nvar i,xi;\n"+n+";\n"+"for(i=n-1;i!==-1;--i) { \n"+"    xi = x[i];\n"+"    "+t+";\n"+"}\n"+"return accum;")},numeric.same=function same(e,t){var n,r;if(e instanceof Array&&t instanceof Array){r=e.length;if(r!==t.length)return!1;for(n=0;n<r;n++){if(e[n]===t[n])continue;if(typeof e[n]!="object")return!1;if(!same(e[n],t[n]))return!1}return!0}return!1},numeric.rep=function(t,n,r){typeof r=="undefined"&&(r=0);var i=t[r],s=Array(i),o;if(r===t.length-1){for(o=i-2;o>=0;o-=2)s[o+1]=n,s[o]=n;return o===-1&&(s[0]=n),s}for(o=i-1;o>=0;o--)s[o]=numeric.rep(t,n,r+1);return s},numeric.dotMMsmall=function(t,n){var r,i,s,o,u,a,f,l,c,h,p,d,v,m;o=t.length,u=n.length,a=n[0].length,f=Array(o);for(r=o-1;r>=0;r--){l=Array(a),c=t[r];for(s=a-1;s>=0;s--){h=c[u-1]*n[u-1][s];for(i=u-2;i>=1;i-=2)p=i-1,h+=c[i]*n[i][s]+c[p]*n[p][s];i===0&&(h+=c[0]*n[0][s]),l[s]=h}f[r]=l}return f},numeric._getCol=function(t,n,r){var i=t.length,s;for(s=i-1;s>0;--s)r[s]=t[s][n],--s,r[s]=t[s][n];s===0&&(r[0]=t[0][n])},numeric.dotMMbig=function(t,n){var r=numeric._getCol,i=n.length,s=Array(i),o=t.length,u=n[0].length,a=new Array(o),f,l=numeric.dotVV,c,h,p,d;--i,--o;for(c=o;c!==-1;--c)a[c]=Array(u);--u;for(c=u;c!==-1;--c){r(n,c,s);for(h=o;h!==-1;--h)d=0,f=t[h],a[h][c]=l(f,s)}return a},numeric.dotMV=function(t,n){var r=t.length,i=n.length,s,o=Array(r),u=numeric.dotVV;for(s=r-1;s>=0;s--)o[s]=u(t[s],n);return o},numeric.dotVM=function(t,n){var r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E;o=t.length,u=n[0].length,f=Array(u);for(s=u-1;s>=0;s--){h=t[o-1]*n[o-1][s];for(i=o-2;i>=1;i-=2)p=i-1,h+=t[i]*n[i][s]+t[p]*n[p][s];i===0&&(h+=t[0]*n[0][s]),f[s]=h}return f},numeric.dotVV=function(t,n){var r,i=t.length,s,o=t[i-1]*n[i-1];for(r=i-2;r>=1;r-=2)s=r-1,o+=t[r]*n[r]+t[s]*n[s];return r===0&&(o+=t[0]*n[0]),o},numeric.dot=function(t,n){var r=numeric.dim;switch(r(t).length*1e3+r(n).length){case 2002:return n.length<10?numeric.dotMMsmall(t,n):numeric.dotMMbig(t,n);case 2001:return numeric.dotMV(t,n);case 1002:return numeric.dotVM(t,n);case 1001:return numeric.dotVV(t,n);case 1e3:return numeric.mulVS(t,n);case 1:return numeric.mulSV(t,n);case 0:return t*n;default:throw new Error("numeric.dot only works on vectors and matrices")}},numeric.diag=function(t){var n,r,i,s=t.length,o=Array(s),u;for(n=s-1;n>=0;n--){u=Array(s),r=n+2;for(i=s-1;i>=r;i-=2)u[i]=0,u[i-1]=0;i>n&&(u[i]=0),u[n]=t[n];for(i=n-1;i>=1;i-=2)u[i]=0,u[i-1]=0;i===0&&(u[0]=0),o[n]=u}return o},numeric.getDiag=function(e){var t=Math.min(e.length,e[0].length),n,r=Array(t);for(n=t-1;n>=1;--n)r[n]=e[n][n],--n,r[n]=e[n][n];return n===0&&(r[0]=e[0][0]),r},numeric.identity=function(t){return numeric.diag(numeric.rep([t],1))},numeric.pointwise=function(t,n,r){typeof r=="undefined"&&(r="");var i=[],s,o=/\[i\]$/,u,a="",f=!1;for(s=0;s<t.length;s++)o.test(t[s])?(u=t[s].substring(0,t[s].length-3),a=u):u=t[s],u==="ret"&&(f=!0),i.push(u);return i[t.length]="_s",i[t.length+1]="_k",i[t.length+2]='if(typeof _s === "undefined") _s = numeric.dim('+a+");\n"+'if(typeof _k === "undefined") _k = 0;\n'+"var _n = _s[_k];\n"+"var i"+(f?"":", ret = Array(_n)")+";\n"+"if(_k < _s.length-1) {\n"+"    for(i=_n-1;i>=0;i--) ret[i] = arguments.callee("+t.join(",")+",_s,_k+1);\n"+"    return ret;\n"+"}\n"+r+"\n"+"for(i=_n-1;i!==-1;--i) {\n"+"    "+n+"\n"+"}\n"+"return ret;",Function.apply(null,i)},numeric.pointwise2=function(t,n,r){typeof r=="undefined"&&(r="");var i=[],s,o=/\[i\]$/,u,a="",f=!1;for(s=0;s<t.length;s++)o.test(t[s])?(u=t[s].substring(0,t[s].length-3),a=u):u=t[s],u==="ret"&&(f=!0),i.push(u);return i[t.length]="var _n = "+a+".length;\n"+"var i"+(f?"":", ret = Array(_n)")+";\n"+r+"\n"+"for(i=_n-1;i!==-1;--i) {\n"+n+"\n"+"}\n"+"return ret;",Function.apply(null,i)},numeric._biforeach=function _biforeach(e,t,n,r,i){if(r===n.length-1){i(e,t);return}var s,o=n[r];for(s=o-1;s>=0;s--)_biforeach(typeof e=="object"?e[s]:e,typeof t=="object"?t[s]:t,n,r+1,i)},numeric._biforeach2=function _biforeach2(e,t,n,r,i){if(r===n.length-1)return i(e,t);var s,o=n[r],u=Array(o);for(s=o-1;s>=0;--s)u[s]=_biforeach2(typeof e=="object"?e[s]:e,typeof t=="object"?t[s]:t,n,r+1,i);return u},numeric._foreach=function _foreach(e,t,n,r){if(n===t.length-1){r(e);return}var i,s=t[n];for(i=s-1;i>=0;i--)_foreach(e[i],t,n+1,r)},numeric._foreach2=function _foreach2(e,t,n,r){if(n===t.length-1)return r(e);var i,s=t[n],o=Array(s);for(i=s-1;i>=0;i--)o[i]=_foreach2(e[i],t,n+1,r);return o},numeric.ops2={add:"+",sub:"-",mul:"*",div:"/",mod:"%",and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">=",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"},numeric.opseq={addeq:"+=",subeq:"-=",muleq:"*=",diveq:"/=",modeq:"%=",lshifteq:"<<=",rshifteq:">>=",rrshifteq:">>>=",bandeq:"&=",boreq:"|=",bxoreq:"^="},numeric.mathfuns=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan","isNaN","isFinite"],numeric.mathfuns2=["atan2","pow","max","min"],numeric.ops1={neg:"-",not:"!",bnot:"~",clone:""},numeric.mapreducers={any:["if(xi) return true;","var accum = false;"],all:["if(!xi) return false;","var accum = true;"],sum:["accum += xi;","var accum = 0;"],prod:["accum *= xi;","var accum = 1;"],norm2Squared:["accum += xi*xi;","var accum = 0;"],norminf:["accum = max(accum,abs(xi));","var accum = 0, max = Math.max, abs = Math.abs;"],norm1:["accum += abs(xi)","var accum = 0, abs = Math.abs;"],sup:["accum = max(accum,xi);","var accum = -Infinity, max = Math.max;"],inf:["accum = min(accum,xi);","var accum = Infinity, min = Math.min;"]},function(){var e,t;for(e=0;e<numeric.mathfuns2.length;++e)t=numeric.mathfuns2[e],numeric.ops2[t]=t;for(e in numeric.ops2)if(numeric.ops2.hasOwnProperty(e)){t=numeric.ops2[e];var n,r,i="";numeric.myIndexOf.call(numeric.mathfuns2,e)!==-1?(i="var "+t+" = Math."+t+";\n",n=function(e,n,r){return e+" = "+t+"("+n+","+r+")"},r=function(e,n){return e+" = "+t+"("+e+","+n+")"}):(n=function(e,n,r){return e+" = "+n+" "+t+" "+r},numeric.opseq.hasOwnProperty(e+"eq")?r=function(e,n){return e+" "+t+"= "+n}:r=function(e,n){return e+" = "+e+" "+t+" "+n}),numeric[e+"VV"]=numeric.pointwise2(["x[i]","y[i]"],n("ret[i]","x[i]","y[i]"),i),numeric[e+"SV"]=numeric.pointwise2(["x","y[i]"],n("ret[i]","x","y[i]"),i),numeric[e+"VS"]=numeric.pointwise2(["x[i]","y"],n("ret[i]","x[i]","y"),i),numeric[e]=Function("var n = arguments.length, i, x = arguments[0], y;\nvar VV = numeric."+e+"VV, VS = numeric."+e+"VS, SV = numeric."+e+"SV;\n"+"var dim = numeric.dim;\n"+"for(i=1;i!==n;++i) { \n"+"  y = arguments[i];\n"+'  if(typeof x === "object") {\n'+'      if(typeof y === "object") x = numeric._biforeach2(x,y,dim(x),0,VV);\n'+"      else x = numeric._biforeach2(x,y,dim(x),0,VS);\n"+'  } else if(typeof y === "object") x = numeric._biforeach2(x,y,dim(y),0,SV);\n'+"  else "+r("x","y")+"\n"+"}\nreturn x;\n"),numeric[t]=numeric[e],numeric[e+"eqV"]=numeric.pointwise2(["ret[i]","x[i]"],r("ret[i]","x[i]"),i),numeric[e+"eqS"]=numeric.pointwise2(["ret[i]","x"],r("ret[i]","x"),i),numeric[e+"eq"]=Function("var n = arguments.length, i, x = arguments[0], y;\nvar V = numeric."+e+"eqV, S = numeric."+e+"eqS\n"+"var s = numeric.dim(x);\n"+"for(i=1;i!==n;++i) { \n"+"  y = arguments[i];\n"+'  if(typeof y === "object") numeric._biforeach(x,y,s,0,V);\n'+"  else numeric._biforeach(x,y,s,0,S);\n"+"}\nreturn x;\n")}for(e=0;e<numeric.mathfuns2.length;++e)t=numeric.mathfuns2[e],delete numeric.ops2[t];for(e=0;e<numeric.mathfuns.length;++e)t=numeric.mathfuns[e],numeric.ops1[t]=t;for(e in numeric.ops1)numeric.ops1.hasOwnProperty(e)&&(i="",t=numeric.ops1[e],numeric.myIndexOf.call(numeric.mathfuns,e)!==-1&&Math.hasOwnProperty(t)&&(i="var "+t+" = Math."+t+";\n"),numeric[e+"eqV"]=numeric.pointwise2(["ret[i]"],"ret[i] = "+t+"(ret[i]);",i),numeric[e+"eq"]=Function("x",'if(typeof x !== "object") return '+t+"x\n"+"var i;\n"+"var V = numeric."+e+"eqV;\n"+"var s = numeric.dim(x);\n"+"numeric._foreach(x,s,0,V);\n"+"return x;\n"),numeric[e+"V"]=numeric.pointwise2(["x[i]"],"ret[i] = "+t+"(x[i]);",i),numeric[e]=Function("x",'if(typeof x !== "object") return '+t+"(x)\n"+"var i;\n"+"var V = numeric."+e+"V;\n"+"var s = numeric.dim(x);\n"+"return numeric._foreach2(x,s,0,V);\n"));for(e=0;e<numeric.mathfuns.length;++e)t=numeric.mathfuns[e],delete numeric.ops1[t];for(e in numeric.mapreducers)numeric.mapreducers.hasOwnProperty(e)&&(t=numeric.mapreducers[e],numeric[e+"V"]=numeric.mapreduce2(t[0],t[1]),numeric[e]=Function("x","s","k",t[1]+'if(typeof x !== "object") {'+"    xi = x;\n"+t[0]+";\n"+"    return accum;\n"+"}"+'if(typeof s === "undefined") s = numeric.dim(x);\n'+'if(typeof k === "undefined") k = 0;\n'+"if(k === s.length-1) return numeric."+e+"V(x);\n"+"var xi;\n"+"var n = x.length, i;\n"+"for(i=n-1;i!==-1;--i) {\n"+"   xi = arguments.callee(x[i]);\n"+t[0]+";\n"+"}\n"+"return accum;\n"))}(),numeric.truncVV=numeric.pointwise(["x[i]","y[i]"],"ret[i] = round(x[i]/y[i])*y[i];","var round = Math.round;"),numeric.truncVS=numeric.pointwise(["x[i]","y"],"ret[i] = round(x[i]/y)*y;","var round = Math.round;"),numeric.truncSV=numeric.pointwise(["x","y[i]"],"ret[i] = round(x/y[i])*y[i];","var round = Math.round;"),numeric.trunc=function(t,n){return typeof t=="object"?typeof n=="object"?numeric.truncVV(t,n):numeric.truncVS(t,n):typeof n=="object"?numeric.truncSV(t,n):Math.round(t/n)*n},numeric.inv=function(t){var n=numeric.dim(t),r=Math.abs,i=n[0],s=n[1],o=numeric.sclone(t),u,a,f=numeric.identity(i),l,c,h,p,d,t;for(p=0;p<s;++p){var v=-1,m=-1;for(h=p;h!==i;++h)d=r(o[h][p]),d>m&&(v=h,m=d);a=o[v],o[v]=o[p],o[p]=a,c=f[v],f[v]=f[p],f[p]=c,t=a[p];for(d=p;d!==s;++d)a[d]/=t;for(d=s-1;d!==-1;--d)c[d]/=t;for(h=i-1;h!==-1;--h)if(h!==p){u=o[h],l=f[h],t=u[p];for(d=p+1;d!==s;++d)u[d]-=a[d]*t;for(d=s-1;d>0;--d)l[d]-=c[d]*t,--d,l[d]-=c[d]*t;d===0&&(l[0]-=c[0]*t)}}return f},numeric.det=function(t){var n=numeric.dim(t);if(n.length!==2||n[0]!==n[1])throw new Error("numeric: det() only works on square matrices");var r=n[0],i=1,s,o,u,a=numeric.clone(t),f,l,c,h,p,d,v;for(o=0;o<r-1;o++){u=o;for(s=o+1;s<r;s++)Math.abs(a[s][o])>Math.abs(a[u][o])&&(u=s);u!==o&&(h=a[u],a[u]=a[o],a[o]=h,i*=-1),f=a[o];for(s=o+1;s<r;s++){l=a[s],c=l[o]/f[o];for(u=o+1;u<r-1;u+=2)p=u+1,l[u]-=f[u]*c,l[p]-=f[p]*c;u!==r&&(l[u]-=f[u]*c)}if(f[o]===0)return 0;i*=f[o]}return i*a[o][o]},numeric.transpose=function(t){var n,r,i=t.length,s=t[0].length,o=Array(s),u,a,f;for(r=0;r<s;r++)o[r]=Array(i);for(n=i-1;n>=1;n-=2){a=t[n],u=t[n-1];for(r=s-1;r>=1;--r)f=o[r],f[n]=a[r],f[n-1]=u[r],--r,f=o[r],f[n]=a[r],f[n-1]=u[r];r===0&&(f=o[0],f[n]=a[0],f[n-1]=u[0])}if(n===0){u=t[0];for(r=s-1;r>=1;--r)o[r][0]=u[r],--r,o[r][0]=u[r];r===0&&(o[0][0]=u[0])}return o},numeric.negtranspose=function(t){var n,r,i=t.length,s=t[0].length,o=Array(s),u,a,f;for(r=0;r<s;r++)o[r]=Array(i);for(n=i-1;n>=1;n-=2){a=t[n],u=t[n-1];for(r=s-1;r>=1;--r)f=o[r],f[n]=-a[r],f[n-1]=-u[r],--r,f=o[r],f[n]=-a[r],f[n-1]=-u[r];r===0&&(f=o[0],f[n]=-a[0],f[n-1]=-u[0])}if(n===0){u=t[0];for(r=s-1;r>=1;--r)o[r][0]=-u[r],--r,o[r][0]=-u[r];r===0&&(o[0][0]=-u[0])}return o},numeric._random=function _random(e,t){var n,r=e[t],i=Array(r),s;if(t===e.length-1){s=Math.random;for(n=r-1;n>=1;n-=2)i[n]=s(),i[n-1]=s();return n===0&&(i[0]=s()),i}for(n=r-1;n>=0;n--)i[n]=_random(e,t+1);return i},numeric.random=function(t){return numeric._random(t,0)},numeric.norm2=function(t){return Math.sqrt(numeric.norm2Squared(t))},numeric.linspace=function(t,n,r){typeof r=="undefined"&&(r=Math.max(Math.round(n-t)+1,1));if(r<2)return r===1?[t]:[];var i,s=Array(r);r--;for(i=r;i>=0;i--)s[i]=(i*n+(r-i)*t)/r;return s},numeric.getBlock=function(t,n,r){function s(e,t){var o,u=n[t],a=r[t]-u,f=Array(a);if(t===i.length-1){for(o=a;o>=0;o--)f[o]=e[o+u];return f}for(o=a;o>=0;o--)f[o]=s(e[o+u],t+1);return f}var i=numeric.dim(t);return s(t,0)},numeric.setBlock=function(t,n,r,i){function o(e,t,i){var u,a=n[i],f=r[i]-a;if(i===s.length-1)for(u=f;u>=0;u--)e[u+a]=t[u];for(u=f;u>=0;u--)o(e[u+a],t[u],i+1)}var s=numeric.dim(t);return o(t,i,0),t},numeric.getRange=function(t,n,r){var i=n.length,s=r.length,o,u,a=Array(i),f,l;for(o=i-1;o!==-1;--o){a[o]=Array(s),f=a[o],l=t[n[o]];for(u=s-1;u!==-1;--u)f[u]=l[r[u]]}return a},numeric.blockMatrix=function(t){var n=numeric.dim(t);if(n.length<4)return numeric.blockMatrix([t]);var r=n[0],i=n[1],s,o,u,a,f;s=0,o=0;for(u=0;u<r;++u)s+=t[u][0].length;for(a=0;a<i;++a)o+=t[0][a][0].length;var l=Array(s);for(u=0;u<s;++u)l[u]=Array(o);var c=0,h,p,d,v,m;for(u=0;u<r;++u){h=o;for(a=i-1;a!==-1;--a){f=t[u][a],h-=f[0].length;for(d=f.length-1;d!==-1;--d){m=f[d],p=l[c+d];for(v=m.length-1;v!==-1;--v)p[h+v]=m[v]}}c+=t[u][0].length}return l},numeric.tensor=function(t,n){if(typeof t=="number"||typeof n=="number")return numeric.mul(t,n);var r=numeric.dim(t),i=numeric.dim(n);if(r.length!==1||i.length!==1)throw new Error("numeric: tensor product is only defined for vectors");var s=r[0],o=i[0],u=Array(s),a,f,l,c;for(f=s-1;f>=0;f--){a=Array(o),c=t[f];for(l=o-1;l>=3;--l)a[l]=c*n[l],--l,a[l]=c*n[l],--l,a[l]=c*n[l],--l,a[l]=c*n[l];while(l>=0)a[l]=c*n[l],--l;u[f]=a}return u},numeric.T=function(t,n){this.x=t,this.y=n},numeric.t=function(t,n){return new numeric.T(t,n)},numeric.Tbinop=function(t,n,r,i,s){var o=numeric.indexOf;if(typeof s!="string"){var u;s="";for(u in numeric)numeric.hasOwnProperty(u)&&(t.indexOf(u)>=0||n.indexOf(u)>=0||r.indexOf(u)>=0||i.indexOf(u)>=0)&&u.length>1&&(s+="var "+u+" = numeric."+u+";\n")}return Function(["y"],"var x = this;\nif(!(y instanceof numeric.T)) { y = new numeric.T(y); }\n"+s+"\n"+"if(x.y) {"+"  if(y.y) {"+"    return new numeric.T("+i+");\n"+"  }\n"+"  return new numeric.T("+r+");\n"+"}\n"+"if(y.y) {\n"+"  return new numeric.T("+n+");\n"+"}\n"+"return new numeric.T("+t+");\n")},numeric.T.prototype.add=numeric.Tbinop("add(x.x,y.x)","add(x.x,y.x),y.y","add(x.x,y.x),x.y","add(x.x,y.x),add(x.y,y.y)"),numeric.T.prototype.sub=numeric.Tbinop("sub(x.x,y.x)","sub(x.x,y.x),neg(y.y)","sub(x.x,y.x),x.y","sub(x.x,y.x),sub(x.y,y.y)"),numeric.T.prototype.mul=numeric.Tbinop("mul(x.x,y.x)","mul(x.x,y.x),mul(x.x,y.y)","mul(x.x,y.x),mul(x.y,y.x)","sub(mul(x.x,y.x),mul(x.y,y.y)),add(mul(x.x,y.y),mul(x.y,y.x))"),numeric.T.prototype.reciprocal=function(){var t=numeric.mul,n=numeric.div;if(this.y){var r=numeric.add(t(this.x,this.x),t(this.y,this.y));return new numeric.T(n(this.x,r),n(numeric.neg(this.y),r))}return new T(n(1,this.x))},numeric.T.prototype.div=function div(e){e instanceof numeric.T||(e=new numeric.T(e));if(e.y)return this.mul(e.reciprocal());var div=numeric.div;return this.y?new numeric.T(div(this.x,e.x),div(this.y,e.x)):new numeric.T(div(this.x,e.x))},numeric.T.prototype.dot=numeric.Tbinop("dot(x.x,y.x)","dot(x.x,y.x),dot(x.x,y.y)","dot(x.x,y.x),dot(x.y,y.x)","sub(dot(x.x,y.x),dot(x.y,y.y)),add(dot(x.x,y.y),dot(x.y,y.x))"),numeric.T.prototype.transpose=function(){var t=numeric.transpose,n=this.x,r=this.y;return r?new numeric.T(t(n),t(r)):new numeric.T(t(n))},numeric.T.prototype.transjugate=function(){var t=numeric.transpose,n=this.x,r=this.y;return r?new numeric.T(t(n),numeric.negtranspose(r)):new numeric.T(t(n))},numeric.Tunop=function(t,n,r){return typeof r!="string"&&(r=""),Function("var x = this;\n"+r+"\n"+"if(x.y) {"+"  "+n+";\n"+"}\n"+t+";\n")},numeric.T.prototype.exp=numeric.Tunop("return new numeric.T(ex)","return new numeric.T(mul(cos(x.y),ex),mul(sin(x.y),ex))","var ex = numeric.exp(x.x), cos = numeric.cos, sin = numeric.sin, mul = numeric.mul;"),numeric.T.prototype.conj=numeric.Tunop("return new numeric.T(x.x);","return new numeric.T(x.x,numeric.neg(x.y));"),numeric.T.prototype.neg=numeric.Tunop("return new numeric.T(neg(x.x));","return new numeric.T(neg(x.x),neg(x.y));","var neg = numeric.neg;"),numeric.T.prototype.sin=numeric.Tunop("return new numeric.T(numeric.sin(x.x))","return x.exp().sub(x.neg().exp()).div(new numeric.T(0,2));"),numeric.T.prototype.cos=numeric.Tunop("return new numeric.T(numeric.cos(x.x))","return x.exp().add(x.neg().exp()).div(2);"),numeric.T.prototype.abs=numeric.Tunop("return new numeric.T(numeric.abs(x.x));","return new numeric.T(numeric.sqrt(numeric.add(mul(x.x,x.x),mul(x.y,x.y))));","var mul = numeric.mul;"),numeric.T.prototype.log=numeric.Tunop("return new numeric.T(numeric.log(x.x));","var theta = new numeric.T(numeric.atan2(x.y,x.x)), r = x.abs();\nreturn new numeric.T(numeric.log(r.x),theta.x);"),numeric.T.prototype.norm2=numeric.Tunop("return numeric.norm2(x.x);","var f = numeric.norm2Squared;\nreturn Math.sqrt(f(x.x)+f(x.y));"),numeric.T.prototype.inv=function(){var t=this;if(typeof t.y=="undefined")return new numeric.T(numeric.inv(t.x));var n=t.x.length,r,i,s,o=numeric.identity(n),u=numeric.rep([n,n],0),a=numeric.clone(t.x),f=numeric.clone(t.y),l,c,h,p,d,v,m,g,r,i,s,y,b,w,E,S,x,T;for(r=0;r<n;r++){w=a[r][r],E=f[r][r],y=w*w+E*E,s=r;for(i=r+1;i<n;i++)w=a[i][r],E=f[i][r],b=w*w+E*E,b>y&&(s=i,y=b);s!==r&&(T=a[r],a[r]=a[s],a[s]=T,T=f[r],f[r]=f[s],f[s]=T,T=o[r],o[r]=o[s],o[s]=T,T=u[r],u[r]=u[s],u[s]=T),l=a[r],c=f[r],d=o[r],v=u[r],w=l[r],E=c[r];for(i=r+1;i<n;i++)S=l[i],x=c[i],l[i]=(S*w+x*E)/y,c[i]=(x*w-S*E)/y;for(i=0;i<n;i++)S=d[i],x=v[i],d[i]=(S*w+x*E)/y,v[i]=(x*w-S*E)/y;for(i=r+1;i<n;i++){h=a[i],p=f[i],m=o[i],g=u[i],w=h[r],E=p[r];for(s=r+1;s<n;s++)S=l[s],x=c[s],h[s]-=S*w-x*E,p[s]-=x*w+S*E;for(s=0;s<n;s++)S=d[s],x=v[s],m[s]-=S*w-x*E,g[s]-=x*w+S*E}}for(r=n-1;r>0;r--){d=o[r],v=u[r];for(i=r-1;i>=0;i--){m=o[i],g=u[i],w=a[i][r],E=f[i][r];for(s=n-1;s>=0;s--)S=d[s],x=v[s],m[s]-=w*S-E*x,g[s]-=w*x+E*S}}return new numeric.T(o,u)},numeric.T.prototype.get=function(t){var n=this.x,r=this.y,i=0,s,o=t.length;if(r){while(i<o)s=t[i],n=n[s],r=r[s],i++;return new numeric.T(n,r)}while(i<o)s=t[i],n=n[s],i++;return new numeric.T(n)},numeric.T.prototype.set=function(t,n){var r=this.x,i=this.y,s=0,o,u=t.length,a=n.x,f=n.y;if(u===0)return f?this.y=f:i&&(this.y=undefined),this.x=r,this;if(f){i||(i=numeric.rep(numeric.dim(r),0),this.y=i);while(s<u-1)o=t[s],r=r[o],i=i[o],s++;return o=t[s],r[o]=a,i[o]=f,this}if(i){while(s<u-1)o=t[s],r=r[o],i=i[o],s++;return o=t[s],r[o]=a,a instanceof Array?i[o]=numeric.rep(numeric.dim(a),0):i[o]=0,this}while(s<u-1)o=t[s],r=r[o],s++;return o=t[s],r[o]=a,this},numeric.T.prototype.getRows=function(t,n){var r=n-t+1,i,s=Array(r),o,u=this.x,a=this.y;for(i=t;i<=n;i++)s[i-t]=u[i];if(a){o=Array(r);for(i=t;i<=n;i++)o[i-t]=a[i];return new numeric.T(s,o)}return new numeric.T(s)},numeric.T.prototype.setRows=function(t,n,r){var i,s=this.x,o=this.y,u=r.x,a=r.y;for(i=t;i<=n;i++)s[i]=u[i-t];if(a){o||(o=numeric.rep(numeric.dim(s),0),this.y=o);for(i=t;i<=n;i++)o[i]=a[i-t]}else if(o)for(i=t;i<=n;i++)o[i]=numeric.rep([u[i-t].length],0);return this},numeric.T.prototype.getRow=function(t){var n=this.x,r=this.y;return r?new numeric.T(n[t],r[t]):new numeric.T(n[t])},numeric.T.prototype.setRow=function(t,n){var r=this.x,i=this.y,s=n.x,o=n.y;return r[t]=s,o?(i||(i=numeric.rep(numeric.dim(r),0),this.y=i),i[t]=o):i&&(i=numeric.rep([s.length],0)),this},numeric.T.prototype.getBlock=function(t,n){var r=this.x,i=this.y,s=numeric.getBlock;return i?new numeric.T(s(r,t,n),s(i,t,n)):new numeric.T(s(r,t,n))},numeric.T.prototype.setBlock=function(t,n,r){r instanceof numeric.T||(r=new numeric.T(r));var i=this.x,s=this.y,o=numeric.setBlock,u=r.x,a=r.y;if(a)return s||(this.y=numeric.rep(numeric.dim(this),0),s=this.y),o(i,t,n,u),o(s,t,n,a),this;o(i,t,n,u),s&&o(s,t,n,numeric.rep(numeric.dim(u),0))},numeric.T.rep=function(t,n){var r=numeric.T;n instanceof r||(n=new r(n));var i=n.x,s=n.y,o=numeric.rep;return s?new r(o(t,i),o(t,s)):new r(o(t,i))},numeric.T.diag=function diag(e){e instanceof numeric.T||(e=new numeric.T(e));var t=e.x,n=e.y,diag=numeric.diag;return n?new numeric.T(diag(t),diag(n)):new numeric.T(diag(t))},numeric.T.eig=function(){if(this.y)throw new Error("eig: not implemented for complex matrices.");return numeric.eig(this.x)},numeric.T.identity=function(t){return new numeric.T(numeric.identity(t))},numeric.T.prototype.getDiag=function(){var t=numeric,n=this.x,r=this.y;return r?new t.T(t.getDiag(n),t.getDiag(r)):new t.T(t.getDiag(n))},numeric.house=function(t){var n=numeric.clone(t),r=t[0]>=0?1:-1,i=r*numeric.norm2(t);n[0]+=i;var s=numeric.norm2(n);if(s===0)throw new Error("eig: internal error");return numeric.div(n,s)},numeric.toUpperHessenberg=function(t){var n=numeric.dim(t);if(n.length!==2||n[0]!==n[1])throw new Error("numeric: toUpperHessenberg() only works on square matrices");var r=n[0],i,s,o,u,a,f=numeric.clone(t),l,c,h,p,d=numeric.identity(r),v;for(s=0;s<r-2;s++){u=Array(r-s-1);for(i=s+1;i<r;i++)u[i-s-1]=f[i][s];if(numeric.norm2(u)>0){a=numeric.house(u),l=numeric.getBlock(f,[s+1,s],[r-1,r-1]),c=numeric.tensor(a,numeric.dot(a,l));for(i=s+1;i<r;i++){h=f[i],p=c[i-s-1];for(o=s;o<r;o++)h[o]-=2*p[o-s]}l=numeric.getBlock(f,[0,s+1],[r-1,r-1]),c=numeric.tensor(numeric.dot(l,a),a);for(i=0;i<r;i++){h=f[i],p=c[i];for(o=s+1;o<r;o++)h[o]-=2*p[o-s-1]}l=Array(r-s-1);for(i=s+1;i<r;i++)l[i-s-1]=d[i];c=numeric.tensor(a,numeric.dot(a,l));for(i=s+1;i<r;i++){v=d[i],p=c[i-s-1];for(o=0;o<r;o++)v[o]-=2*p[o]}}}return{H:f,Q:d}},numeric.epsilon=2.220446049250313e-16,numeric.QRFrancis=function(e,t){typeof t=="undefined"&&(t=1e4),e=numeric.clone(e);var n=numeric.clone(e),r=numeric.dim(e),i=r[0],s,o,u,a,f,l,c,h,p,d=numeric.identity(i),v,m,g,y,b,w,E,S,x;if(i<3)return{Q:d,B:[[0,i-1]]};var T=numeric.epsilon;for(x=0;x<t;x++){for(E=0;E<i-1;E++)if(Math.abs(e[E+1][E])<T*(Math.abs(e[E][E])+Math.abs(e[E+1][E+1]))){var N=numeric.QRFrancis(numeric.getBlock(e,[0,0],[E,E]),t),C=numeric.QRFrancis(numeric.getBlock(e,[E+1,E+1],[i-1,i-1]),t);g=Array(E+1);for(w=0;w<=E;w++)g[w]=d[w];y=numeric.dot(N.Q,g);for(w=0;w<=E;w++)d[w]=y[w];g=Array(i-E-1);for(w=E+1;w<i;w++)g[w-E-1]=d[w];y=numeric.dot(C.Q,g);for(w=E+1;w<i;w++)d[w]=y[w-E-1];return{Q:d,B:N.B.concat(numeric.add(C.B,E+1))}}u=e[i-2][i-2],a=e[i-2][i-1],f=e[i-1][i-2],l=e[i-1][i-1],h=u+l,c=u*l-a*f,p=numeric.getBlock(e,[0,0],[2,2]);if(h*h>=4*c){var k,L;k=.5*(h+Math.sqrt(h*h-4*c)),L=.5*(h-Math.sqrt(h*h-4*c)),p=numeric.add(numeric.sub(numeric.dot(p,p),numeric.mul(p,k+L)),numeric.diag(numeric.rep([3],k*L)))}else p=numeric.add(numeric.sub(numeric.dot(p,p),numeric.mul(p,h)),numeric.diag(numeric.rep([3],c)));s=[p[0][0],p[1][0],p[2][0]],o=numeric.house(s),g=[e[0],e[1],e[2]],y=numeric.tensor(o,numeric.dot(o,g));for(w=0;w<3;w++){m=e[w],b=y[w];for(S=0;S<i;S++)m[S]-=2*b[S]}g=numeric.getBlock(e,[0,0],[i-1,2]),y=numeric.tensor(numeric.dot(g,o),o);for(w=0;w<i;w++){m=e[w],b=y[w];for(S=0;S<3;S++)m[S]-=2*b[S]}g=[d[0],d[1],d[2]],y=numeric.tensor(o,numeric.dot(o,g));for(w=0;w<3;w++){v=d[w],b=y[w];for(S=0;S<i;S++)v[S]-=2*b[S]}var A;for(E=0;E<i-2;E++){for(S=E;S<=E+1;S++)if(Math.abs(e[S+1][S])<T*(Math.abs(e[S][S])+Math.abs(e[S+1][S+1]))){var N=numeric.QRFrancis(numeric.getBlock(e,[0,0],[S,S]),t),C=numeric.QRFrancis(numeric.getBlock(e,[S+1,S+1],[i-1,i-1]),t);g=Array(S+1);for(w=0;w<=S;w++)g[w]=d[w];y=numeric.dot(N.Q,g);for(w=0;w<=S;w++)d[w]=y[w];g=Array(i-S-1);for(w=S+1;w<i;w++)g[w-S-1]=d[w];y=numeric.dot(C.Q,g);for(w=S+1;w<i;w++)d[w]=y[w-S-1];return{Q:d,B:N.B.concat(numeric.add(C.B,S+1))}}A=Math.min(i-1,E+3),s=Array(A-E);for(w=E+1;w<=A;w++)s[w-E-1]=e[w][E];o=numeric.house(s),g=numeric.getBlock(e,[E+1,E],[A,i-1]),y=numeric.tensor(o,numeric.dot(o,g));for(w=E+1;w<=A;w++){m=e[w],b=y[w-E-1];for(S=E;S<i;S++)m[S]-=2*b[S-E]}g=numeric.getBlock(e,[0,E+1],[i-1,A]),y=numeric.tensor(numeric.dot(g,o),o);for(w=0;w<i;w++){m=e[w],b=y[w];for(S=E+1;S<=A;S++)m[S]-=2*b[S-E-1]}g=Array(A-E);for(w=E+1;w<=A;w++)g[w-E-1]=d[w];y=numeric.tensor(o,numeric.dot(o,g));for(w=E+1;w<=A;w++){v=d[w],b=y[w-E-1];for(S=0;S<i;S++)v[S]-=2*b[S]}}}throw new Error("numeric: eigenvalue iteration does not converge -- increase maxiter?")},numeric.eig=function(t,n){var r=numeric.toUpperHessenberg(t),i=numeric.QRFrancis(r.H,n),s=numeric.T,o=t.length,u,a,f=!1,l=i.B,c=numeric.dot(i.Q,numeric.dot(r.H,numeric.transpose(i.Q))),h=new s(numeric.dot(i.Q,r.Q)),p,d=l.length,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A=Math.sqrt;for(a=0;a<d;a++){u=l[a][0];if(u!==l[a][1]){v=u+1,m=c[u][u],g=c[u][v],y=c[v][u],b=c[v][v];if(g===0&&y===0)continue;w=-m-b,E=m*b-g*y,S=w*w-4*E,S>=0?(w<0?x=-0.5*(w-A(S)):x=-0.5*(w+A(S)),k=(m-x)*(m-x)+g*g,L=y*y+(b-x)*(b-x),k>L?(k=A(k),N=(m-x)/k,C=g/k):(L=A(L),N=y/L,C=(b-x)/L),p=new s([[C,-N],[N,C]]),h.setRows(u,v,p.dot(h.getRows(u,v)))):(x=-0.5*w,T=.5*A(-S),k=(m-x)*(m-x)+g*g,L=y*y+(b-x)*(b-x),k>L?(k=A(k+T*T),N=(m-x)/k,C=g/k,x=0,T/=k):(L=A(L+T*T),N=y/L,C=(b-x)/L,x=T/L,T=0),p=new s([[C,-N],[N,C]],[[x
,T],[T,-x]]),h.setRows(u,v,p.dot(h.getRows(u,v))))}}var O=h.dot(t).dot(h.transjugate()),o=t.length,M=numeric.T.identity(o);for(v=0;v<o;v++)if(v>0)for(a=v-1;a>=0;a--){var _=O.get([a,a]),D=O.get([v,v]);if(!numeric.neq(_.x,D.x)&&!numeric.neq(_.y,D.y)){M.setRow(v,M.getRow(a));continue}x=O.getRow(a).getBlock([a],[v-1]),T=M.getRow(v).getBlock([a],[v-1]),M.set([v,a],O.get([a,v]).neg().sub(x.dot(T)).div(_.sub(D)))}for(v=0;v<o;v++)x=M.getRow(v),M.setRow(v,x.div(x.norm2()));return M=M.transpose(),M=h.transjugate().dot(M),{lambda:O.getDiag(),E:M}},numeric.ccsSparse=function(t){var n=t.length,r,i,s,o,u=[];for(s=n-1;s!==-1;--s){i=t[s];for(o in i){o=parseInt(o);while(o>=u.length)u[u.length]=0;i[o]!==0&&u[o]++}}var r=u.length,a=Array(r+1);a[0]=0;for(s=0;s<r;++s)a[s+1]=a[s]+u[s];var f=Array(a[r]),l=Array(a[r]);for(s=n-1;s!==-1;--s){i=t[s];for(o in i)i[o]!==0&&(u[o]--,f[a[o]+u[o]]=s,l[a[o]+u[o]]=i[o])}return[a,f,l]},numeric.ccsFull=function(t){var n=t[0],r=t[1],i=t[2],s=numeric.ccsDim(t),o=s[0],u=s[1],a,f,l,c,h,p=numeric.rep([o,u],0);for(a=0;a<u;a++){l=n[a],c=n[a+1];for(f=l;f<c;++f)p[r[f]][a]=i[f]}return p},numeric.ccsTSolve=function(t,n,r,i,s){function h(e){var t;if(r[e]!==0)return;r[e]=1;for(t=o[e];t<o[e+1];++t)h(u[t]);s[c]=e,++c}var o=t[0],u=t[1],a=t[2],f=o.length-1,l=Math.max,c=0;typeof i=="undefined"&&(r=numeric.rep([f],0)),typeof i=="undefined"&&(i=numeric.linspace(0,r.length-1)),typeof s=="undefined"&&(s=[]);var p,d,v,m,g,y,b,w,E;for(p=i.length-1;p!==-1;--p)h(i[p]);s.length=c;for(p=s.length-1;p!==-1;--p)r[s[p]]=0;for(p=i.length-1;p!==-1;--p)d=i[p],r[d]=n[d];for(p=s.length-1;p!==-1;--p){d=s[p],v=o[d],m=l(o[d+1],v);for(g=v;g!==m;++g)if(u[g]===d){r[d]/=a[g];break}E=r[d];for(g=v;g!==m;++g)y=u[g],y!==d&&(r[y]-=E*a[g])}return r},numeric.ccsDFS=function(t){this.k=Array(t),this.k1=Array(t),this.j=Array(t)},numeric.ccsDFS.prototype.dfs=function(t,n,r,i,s,o){var u=0,a,f=s.length,l=this.k,c=this.k1,h=this.j,p,d;if(i[t]!==0)return;i[t]=1,h[0]=t,l[0]=p=n[t],c[0]=d=n[t+1];for(;;)if(p>=d){s[f]=h[u];if(u===0)return;++f,--u,p=l[u],d=c[u]}else a=o[r[p]],i[a]===0?(i[a]=1,l[u]=p,++u,h[u]=a,p=n[a],c[u]=d=n[a+1]):++p},numeric.ccsLPSolve=function(t,n,r,i,s,o,u){var a=t[0],f=t[1],l=t[2],c=a.length-1,h=0,p=n[0],d=n[1],v=n[2],m,g,y,b,w,E,S,x,T,N,C,k;g=p[s],y=p[s+1],i.length=0;for(m=g;m<y;++m)u.dfs(o[d[m]],a,f,r,i,o);for(m=i.length-1;m!==-1;--m)r[i[m]]=0;for(m=g;m!==y;++m)b=o[d[m]],r[b]=v[m];for(m=i.length-1;m!==-1;--m){b=i[m],E=a[b],S=a[b+1];for(x=E;x<S;++x)if(o[f[x]]===b){r[b]/=l[x];break}k=r[b];for(x=E;x<S;++x)T=o[f[x]],T!==b&&(r[T]-=k*l[x])}return r},numeric.ccsLUP1=function(t,n){var r=t[0].length-1,i=[numeric.rep([r+1],0),[],[]],s=[numeric.rep([r+1],0),[],[]],o=i[0],u=i[1],a=i[2],f=s[0],l=s[1],c=s[2],h=numeric.rep([r],0),p=numeric.rep([r],0),d,v,m,g,y,b,w,E,S,x,T=numeric.ccsLPSolve,N=Math.max,C=Math.abs,k=numeric.linspace(0,r-1),L=numeric.linspace(0,r-1),A=new numeric.ccsDFS(r);typeof n=="undefined"&&(n=1);for(d=0;d<r;++d){T(i,t,h,p,d,L,A),b=-1,w=-1;for(v=p.length-1;v!==-1;--v){m=p[v];if(m<=d)continue;E=C(h[m]),E>b&&(w=m,b=E)}C(h[d])<n*b&&(v=k[d],b=k[w],k[d]=b,L[b]=d,k[w]=v,L[v]=w,b=h[d],h[d]=h[w],h[w]=b),b=o[d],w=f[d],S=h[d],u[b]=k[d],a[b]=1,++b;for(v=p.length-1;v!==-1;--v)m=p[v],E=h[m],p[v]=0,h[m]=0,m<=d?(l[w]=m,c[w]=E,++w):(u[b]=k[m],a[b]=E/S,++b);o[d+1]=b,f[d+1]=w}for(v=u.length-1;v!==-1;--v)u[v]=L[u[v]];return{L:i,U:s,P:k,Pinv:L}},numeric.ccsDFS0=function(t){this.k=Array(t),this.k1=Array(t),this.j=Array(t)},numeric.ccsDFS0.prototype.dfs=function(t,n,r,i,s,o,u){var a=0,f,l=s.length,c=this.k,h=this.k1,p=this.j,d,v;if(i[t]!==0)return;i[t]=1,p[0]=t,c[0]=d=n[o[t]],h[0]=v=n[o[t]+1];for(;;){if(isNaN(d))throw new Error("Ow!");if(d>=v){s[l]=o[p[a]];if(a===0)return;++l,--a,d=c[a],v=h[a]}else f=r[d],i[f]===0?(i[f]=1,c[a]=d,++a,p[a]=f,f=o[f],d=n[f],h[a]=v=n[f+1]):++d}},numeric.ccsLPSolve0=function(t,n,r,i,s,o,u,a){var f=t[0],l=t[1],c=t[2],h=f.length-1,p=0,d=n[0],v=n[1],m=n[2],g,y,b,w,E,S,x,T,N,C,k,L;y=d[s],b=d[s+1],i.length=0;for(g=y;g<b;++g)a.dfs(v[g],f,l,r,i,o,u);for(g=i.length-1;g!==-1;--g)w=i[g],r[u[w]]=0;for(g=y;g!==b;++g)w=v[g],r[w]=m[g];for(g=i.length-1;g!==-1;--g){w=i[g],N=u[w],S=f[w],x=f[w+1];for(T=S;T<x;++T)if(l[T]===N){r[N]/=c[T];break}L=r[N];for(T=S;T<x;++T)r[l[T]]-=L*c[T];r[N]=L}},numeric.ccsLUP0=function(t,n){var r=t[0].length-1,i=[numeric.rep([r+1],0),[],[]],s=[numeric.rep([r+1],0),[],[]],o=i[0],u=i[1],a=i[2],f=s[0],l=s[1],c=s[2],h=numeric.rep([r],0),p=numeric.rep([r],0),d,v,m,g,y,b,w,E,S,x,T=numeric.ccsLPSolve0,N=Math.max,C=Math.abs,k=numeric.linspace(0,r-1),L=numeric.linspace(0,r-1),A=new numeric.ccsDFS0(r);typeof n=="undefined"&&(n=1);for(d=0;d<r;++d){T(i,t,h,p,d,L,k,A),b=-1,w=-1;for(v=p.length-1;v!==-1;--v){m=p[v];if(m<=d)continue;E=C(h[k[m]]),E>b&&(w=m,b=E)}C(h[k[d]])<n*b&&(v=k[d],b=k[w],k[d]=b,L[b]=d,k[w]=v,L[v]=w),b=o[d],w=f[d],S=h[k[d]],u[b]=k[d],a[b]=1,++b;for(v=p.length-1;v!==-1;--v)m=p[v],E=h[k[m]],p[v]=0,h[k[m]]=0,m<=d?(l[w]=m,c[w]=E,++w):(u[b]=k[m],a[b]=E/S,++b);o[d+1]=b,f[d+1]=w}for(v=u.length-1;v!==-1;--v)u[v]=L[u[v]];return{L:i,U:s,P:k,Pinv:L}},numeric.ccsLUP=numeric.ccsLUP0,numeric.ccsDim=function(t){return[numeric.sup(t[1])+1,t[0].length-1]},numeric.ccsGetBlock=function(t,n,r){var i=numeric.ccsDim(t),s=i[0],o=i[1];typeof n=="undefined"?n=numeric.linspace(0,s-1):typeof n=="number"&&(n=[n]),typeof r=="undefined"?r=numeric.linspace(0,o-1):typeof r=="number"&&(r=[r]);var u,a,f,l=n.length,c,h=r.length,p,d,v,m=numeric.rep([o],0),g=[],y=[],b=[m,g,y],w=t[0],E=t[1],S=t[2],x=numeric.rep([s],0),T=0,N=numeric.rep([s],0);for(c=0;c<h;++c){d=r[c];var C=w[d],k=w[d+1];for(u=C;u<k;++u)p=E[u],N[p]=1,x[p]=S[u];for(u=0;u<l;++u)v=n[u],N[v]&&(g[T]=u,y[T]=x[n[u]],++T);for(u=C;u<k;++u)p=E[u],N[p]=0;m[c+1]=T}return b},numeric.ccsDot=function(t,n){var r=t[0],i=t[1],s=t[2],o=n[0],u=n[1],a=n[2],f=numeric.ccsDim(t),l=numeric.ccsDim(n),c=f[0],h=f[1],p=l[1],d=numeric.rep([c],0),v=numeric.rep([c],0),m=Array(c),g=numeric.rep([p],0),y=[],b=[],w=[g,y,b],E,S,x,T,N,C,k,L,A,O,M;for(x=0;x!==p;++x){T=o[x],N=o[x+1],A=0;for(S=T;S<N;++S){O=u[S],M=a[S],C=r[O],k=r[O+1];for(E=C;E<k;++E)L=i[E],v[L]===0&&(m[A]=L,v[L]=1,A+=1),d[L]=d[L]+s[E]*M}T=g[x],N=T+A,g[x+1]=N;for(S=A-1;S!==-1;--S)M=T+S,E=m[S],y[M]=E,b[M]=d[E],v[E]=0,d[E]=0;g[x+1]=g[x]+A}return w},numeric.ccsLUPSolve=function(t,n){var r=t.L,i=t.U,s=t.P,o=n[0],u=!1;typeof o!="object"&&(n=[[0,n.length],numeric.linspace(0,n.length-1),n],o=n[0],u=!0);var a=n[1],f=n[2],l=r[0].length-1,c=o.length-1,h=numeric.rep([l],0),p=Array(l),d=numeric.rep([l],0),v=Array(l),m=numeric.rep([c+1],0),g=[],y=[],b=numeric.ccsTSolve,w,E,S,x,T,N,C=0;for(w=0;w<c;++w){T=0,S=o[w],x=o[w+1];for(E=S;E<x;++E)N=t.Pinv[a[E]],v[T]=N,d[N]=f[E],++T;v.length=T,b(r,d,h,v,p);for(E=v.length-1;E!==-1;--E)d[v[E]]=0;b(i,h,d,p,v);if(u)return d;for(E=p.length-1;E!==-1;--E)h[p[E]]=0;for(E=v.length-1;E!==-1;--E)N=v[E],g[C]=N,y[C]=d[N],d[N]=0,++C;m[w+1]=C}return[m,g,y]},numeric.ccsbinop=function(t,n){return typeof n=="undefined"&&(n=""),Function("X","Y","var Xi = X[0], Xj = X[1], Xv = X[2];\nvar Yi = Y[0], Yj = Y[1], Yv = Y[2];\nvar n = Xi.length-1,m = Math.max(numeric.sup(Xj),numeric.sup(Yj))+1;\nvar Zi = numeric.rep([n+1],0), Zj = [], Zv = [];\nvar x = numeric.rep([m],0),y = numeric.rep([m],0);\nvar xk,yk,zk;\nvar i,j,j0,j1,k,p=0;\n"+n+"for(i=0;i<n;++i) {\n"+"  j0 = Xi[i]; j1 = Xi[i+1];\n"+"  for(j=j0;j!==j1;++j) {\n"+"    k = Xj[j];\n"+"    x[k] = 1;\n"+"    Zj[p] = k;\n"+"    ++p;\n"+"  }\n"+"  j0 = Yi[i]; j1 = Yi[i+1];\n"+"  for(j=j0;j!==j1;++j) {\n"+"    k = Yj[j];\n"+"    y[k] = Yv[j];\n"+"    if(x[k] === 0) {\n"+"      Zj[p] = k;\n"+"      ++p;\n"+"    }\n"+"  }\n"+"  Zi[i+1] = p;\n"+"  j0 = Xi[i]; j1 = Xi[i+1];\n"+"  for(j=j0;j!==j1;++j) x[Xj[j]] = Xv[j];\n"+"  j0 = Zi[i]; j1 = Zi[i+1];\n"+"  for(j=j0;j!==j1;++j) {\n"+"    k = Zj[j];\n"+"    xk = x[k];\n"+"    yk = y[k];\n"+t+"\n"+"    Zv[j] = zk;\n"+"  }\n"+"  j0 = Xi[i]; j1 = Xi[i+1];\n"+"  for(j=j0;j!==j1;++j) x[Xj[j]] = 0;\n"+"  j0 = Yi[i]; j1 = Yi[i+1];\n"+"  for(j=j0;j!==j1;++j) y[Yj[j]] = 0;\n"+"}\n"+"return [Zi,Zj,Zv];")},function(){var k,A,B,C;for(k in numeric.ops2)isFinite(eval("1"+numeric.ops2[k]+"0"))?A="[Y[0],Y[1],numeric."+k+"(X,Y[2])]":A="NaN",isFinite(eval("0"+numeric.ops2[k]+"1"))?B="[X[0],X[1],numeric."+k+"(X[2],Y)]":B="NaN",isFinite(eval("1"+numeric.ops2[k]+"0"))&&isFinite(eval("0"+numeric.ops2[k]+"1"))?C="numeric.ccs"+k+"MM(X,Y)":C="NaN",numeric["ccs"+k+"MM"]=numeric.ccsbinop("zk = xk "+numeric.ops2[k]+"yk;"),numeric["ccs"+k]=Function("X","Y",'if(typeof X === "number") return '+A+";\n"+'if(typeof Y === "number") return '+B+";\n"+"return "+C+";\n")}(),numeric.ccsScatter=function(t){var n=t[0],r=t[1],i=t[2],s=numeric.sup(r)+1,o=n.length,u=numeric.rep([s],0),a=Array(o),f=Array(o),l=numeric.rep([s],0),c;for(c=0;c<o;++c)l[r[c]]++;for(c=0;c<s;++c)u[c+1]=u[c]+l[c];var h=u.slice(0),p,d;for(c=0;c<o;++c)d=r[c],p=h[d],a[p]=n[c],f[p]=i[c],h[d]=h[d]+1;return[u,a,f]},numeric.ccsGather=function(t){var n=t[0],r=t[1],i=t[2],s=n.length-1,o=r.length,u=Array(o),a=Array(o),f=Array(o),l,c,h,p,d;d=0;for(l=0;l<s;++l){h=n[l],p=n[l+1];for(c=h;c!==p;++c)a[d]=l,u[d]=r[c],f[d]=i[c],++d}return[u,a,f]},numeric.sdim=function dim(e,t,n){typeof t=="undefined"&&(t=[]);if(typeof e!="object")return t;typeof n=="undefined"&&(n=0),n in t||(t[n]=0),e.length>t[n]&&(t[n]=e.length);var r;for(r in e)e.hasOwnProperty(r)&&dim(e[r],t,n+1);return t},numeric.sclone=function clone(e,t,n){typeof t=="undefined"&&(t=0),typeof n=="undefined"&&(n=numeric.sdim(e).length);var r,i=Array(e.length);if(t===n-1){for(r in e)e.hasOwnProperty(r)&&(i[r]=e[r]);return i}for(r in e)e.hasOwnProperty(r)&&(i[r]=clone(e[r],t+1,n));return i},numeric.sdiag=function(t){var n=t.length,r,i=Array(n),s,o,u;for(r=n-1;r>=1;r-=2)s=r-1,i[r]=[],i[r][r]=t[r],i[s]=[],i[s][s]=t[s];return r===0&&(i[0]=[],i[0][0]=t[r]),i},numeric.sidentity=function(t){return numeric.sdiag(numeric.rep([t],1))},numeric.stranspose=function(t){var n=[],r=t.length,i,s,o;for(i in t){if(!t.hasOwnProperty(i))continue;o=t[i];for(s in o){if(!o.hasOwnProperty(s))continue;typeof n[s]!="object"&&(n[s]=[]),n[s][i]=o[s]}}return n},numeric.sLUP=function(t,n){throw new Error("The function numeric.sLUP had a bug in it and has been removed. Please use the new numeric.ccsLUP function instead.")},numeric.sdotMM=function(t,n){var r=t.length,i=n.length,s=numeric.stranspose(n),o=s.length,u,a,f,l,c,h,p=Array(r),d;for(f=r-1;f>=0;f--){d=[],u=t[f];for(c=o-1;c>=0;c--){h=0,a=s[c];for(l in u){if(!u.hasOwnProperty(l))continue;l in a&&(h+=u[l]*a[l])}h&&(d[c]=h)}p[f]=d}return p},numeric.sdotMV=function(t,n){var r=t.length,i,s,o,u=Array(r),a;for(s=r-1;s>=0;s--){i=t[s],a=0;for(o in i){if(!i.hasOwnProperty(o))continue;n[o]&&(a+=i[o]*n[o])}a&&(u[s]=a)}return u},numeric.sdotVM=function(t,n){var r,i,s,o,u=[],a;for(r in t){if(!t.hasOwnProperty(r))continue;s=n[r],o=t[r];for(i in s){if(!s.hasOwnProperty(i))continue;u[i]||(u[i]=0),u[i]+=o*s[i]}}return u},numeric.sdotVV=function(t,n){var r,i=0;for(r in t)t[r]&&n[r]&&(i+=t[r]*n[r]);return i},numeric.sdot=function(t,n){var r=numeric.sdim(t).length,i=numeric.sdim(n).length,s=r*1e3+i;switch(s){case 0:return t*n;case 1001:return numeric.sdotVV(t,n);case 2001:return numeric.sdotMV(t,n);case 1002:return numeric.sdotVM(t,n);case 2002:return numeric.sdotMM(t,n);default:throw new Error("numeric.sdot not implemented for tensors of order "+r+" and "+i)}},numeric.sscatter=function(t){var n=t[0].length,r,i,s,o=t.length,u=[],a;for(i=n-1;i>=0;--i){if(!t[o-1][i])continue;a=u;for(s=0;s<o-2;s++)r=t[s][i],a[r]||(a[r]=[]),a=a[r];a[t[s][i]]=t[s+1][i]}return u},numeric.sgather=function gather(e,t,n){typeof t=="undefined"&&(t=[]),typeof n=="undefined"&&(n=[]);var r,i,s;r=n.length;for(i in e)if(e.hasOwnProperty(i)){n[r]=parseInt(i),s=e[i];if(typeof s=="number"){if(s){if(t.length===0)for(i=r+1;i>=0;--i)t[i]=[];for(i=r;i>=0;--i)t[i].push(n[i]);t[r+1].push(s)}}else gather(s,t,n)}return n.length>r&&n.pop(),t},numeric.cLU=function(t){var n=t[0],r=t[1],i=t[2],s=n.length,o=0,u,a,f,l,c,h;for(u=0;u<s;u++)n[u]>o&&(o=n[u]);o++;var p=Array(o),d=Array(o),v=numeric.rep([o],Infinity),m=numeric.rep([o],-Infinity),g,y,b;for(f=0;f<s;f++)u=n[f],a=r[f],a<v[u]&&(v[u]=a),a>m[u]&&(m[u]=a);for(u=0;u<o-1;u++)m[u]>m[u+1]&&(m[u+1]=m[u]);for(u=o-1;u>=1;u--)v[u]<v[u-1]&&(v[u-1]=v[u]);var w=0,E=0;for(u=0;u<o;u++)d[u]=numeric.rep([m[u]-v[u]+1],0),p[u]=numeric.rep([u-v[u]],0),w+=u-v[u]+1,E+=m[u]-u+1;for(f=0;f<s;f++)u=n[f],d[u][r[f]-v[u]]=i[f];for(u=0;u<o-1;u++){l=u-v[u],g=d[u];for(a=u+1;v[a]<=u&&a<o;a++){c=u-v[a],h=m[u]-u,y=d[a],b=y[c]/g[l];if(b){for(f=1;f<=h;f++)y[f+c]-=b*g[f+l];p[a][u-v[a]]=b}}}var g=[],y=[],S=[],x=[],T=[],N=[],s,C,k;s=0,C=0;for(u=0;u<o;u++){l=v[u],c=m[u],k=d[u];for(a=u;a<=c;a++)k[a-l]&&(g[s]=u,y[s]=a,S[s]=k[a-l],s++);k=p[u];for(a=l;a<u;a++)k[a-l]&&(x[C]=u,T[C]=a,N[C]=k[a-l],C++);x[C]=u,T[C]=u,N[C]=1,C++}return{U:[g,y,S],L:[x,T,N]}},numeric.cLUsolve=function(t,n){var r=t.L,i=t.U,s=numeric.clone(n),o=r[0],u=r[1],a=r[2],f=i[0],l=i[1],c=i[2],h=f.length,p=o.length,d=s.length,v,m,g;g=0;for(v=0;v<d;v++){while(u[g]<v)s[v]-=a[g]*s[u[g]],g++;g++}g=h-1;for(v=d-1;v>=0;v--){while(l[g]>v)s[v]-=c[g]*s[l[g]],g--;s[v]/=c[g],g--}return s},numeric.cgrid=function(t,n){typeof t=="number"&&(t=[t,t]);var r=numeric.rep(t,-1),i,s,o;if(typeof n!="function")switch(n){case"L":n=function(e,n){return e>=t[0]/2||n<t[1]/2};break;default:n=function(e,t){return!0}}o=0;for(i=1;i<t[0]-1;i++)for(s=1;s<t[1]-1;s++)n(i,s)&&(r[i][s]=o,o++);return r},numeric.cdelsq=function(t){var n=[[-1,0],[0,-1],[0,1],[1,0]],r=numeric.dim(t),i=r[0],s=r[1],o,u,a,f,l,c=[],h=[],p=[];for(o=1;o<i-1;o++)for(u=1;u<s-1;u++){if(t[o][u]<0)continue;for(a=0;a<4;a++){f=o+n[a][0],l=u+n[a][1];if(t[f][l]<0)continue;c.push(t[o][u]),h.push(t[f][l]),p.push(-1)}c.push(t[o][u]),h.push(t[o][u]),p.push(4)}return[c,h,p]},numeric.cdotMV=function(t,n){var r,i=t[0],s=t[1],o=t[2],u,a=i.length,f;f=0;for(u=0;u<a;u++)i[u]>f&&(f=i[u]);f++,r=numeric.rep([f],0);for(u=0;u<a;u++)r[i[u]]+=o[u]*n[s[u]];return r},numeric.Spline=function(t,n,r,i,s){this.x=t,this.yl=n,this.yr=r,this.kl=i,this.kr=s},numeric.Spline.prototype._at=function(t,n){var r=this.x,i=this.yl,s=this.yr,o=this.kl,u=this.kr,t,a,f,l,c=numeric.add,h=numeric.sub,p=numeric.mul;a=h(p(o[n],r[n+1]-r[n]),h(s[n+1],i[n])),f=c(p(u[n+1],r[n]-r[n+1]),h(s[n+1],i[n])),l=(t-r[n])/(r[n+1]-r[n]);var d=l*(1-l);return c(c(c(p(1-l,i[n]),p(l,s[n+1])),p(a,d*(1-l))),p(f,d*l))},numeric.Spline.prototype.at=function(t){if(typeof t=="number"){var n=this.x,r=n.length,i,s,o,u=Math.floor,a,f,l;i=0,s=r-1;while(s-i>1)o=u((i+s)/2),n[o]<=t?i=o:s=o;return this._at(t,i)}var r=t.length,c,h=Array(r);for(c=r-1;c!==-1;--c)h[c]=this.at(t[c]);return h},numeric.Spline.prototype.diff=function(){var t=this.x,n=this.yl,r=this.yr,i=this.kl,s=this.kr,o=n.length,u,a,f,l=i,c=s,h=Array(o),p=Array(o),d=numeric.add,v=numeric.mul,m=numeric.div,g=numeric.sub;for(u=o-1;u!==-1;--u)a=t[u+1]-t[u],f=g(r[u+1],n[u]),h[u]=m(d(v(f,6),v(i[u],-4*a),v(s[u+1],-2*a)),a*a),p[u+1]=m(d(v(f,-6),v(i[u],2*a),v(s[u+1],4*a)),a*a);return new numeric.Spline(t,l,c,h,p)},numeric.Spline.prototype.roots=function(){function t(e){return e*e}function n(e,t,n,r,i){var s=n*2-(t-e),o=-r*2+(t-e),u=(i+1)*.5,a=u*(1-u);return(1-u)*e+u*t+s*a*(1-u)+o*a*u}var r=[],i=this.x,s=this.yl,o=this.yr,u=this.kl,a=this.kr;typeof s[0]=="number"&&(s=[s],o=[o],u=[u],a=[a]);var f=s.length,l=i.length-1,c,h,p,d,v,m,g,y,b,w,r=Array(f),E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F=Math.sqrt;for(c=0;c!==f;++c){g=s[c],y=o[c],b=u[c],w=a[c],E=[];for(h=0;h!==l;h++){h>0&&y[h]*g[h]<0&&E.push(i[h]),A=i[h+1]-i[h],O=i[h],T=g[h],N=y[h+1],S=b[h]/A,x=w[h+1]/A,L=t(S-x+3*(T-N))+12*x*T,C=x+3*T+2*S-3*N,k=3*(x+S+2*(T-N)),L<=0?(_=C/k,_>i[h]&&_<i[h+1]?M=[i[h],_,i[h+1]]:M=[i[h],i[h+1]]):(_=(C-F(L))/k,D=(C+F(L))/k,M=[i[h]],_>i[h]&&_<i[h+1]&&M.push(_),D>i[h]&&D<i[h+1]&&M.push(D),M.push(i[h+1])),H=M[0],_=this._at(H,h);for(p=0;p<M.length-1;p++){B=M[p+1],D=this._at(B,h);if(_===0){E.push(H),H=B,_=D;continue}if(D===0||_*D>0){H=B,_=D;continue}var I=0;for(;;){j=(_*B-D*H)/(_-D);if(j<=H||j>=B)break;P=this._at(j,h);if(P*D>0)B=j,D=P,I===-1&&(_*=.5),I=-1;else{if(!(P*_>0))break;H=j,_=P,I===1&&(D*=.5),I=1}}E.push(j),H=M[p+1],_=this._at(H,h)}D===0&&E.push(B)}r[c]=E}return typeof this.yl[0]=="number"?r[0]:r},numeric.spline=function(t,n,r,i){var s=t.length,o=[],u=[],a=[],f,l=numeric.sub,c=numeric.mul,h=numeric.add;for(f=s-2;f>=0;f--)u[f]=t[f+1]-t[f],a[f]=l(n[f+1],n[f]);if(typeof r=="string"||typeof i=="string")r=i="periodic";var p=[[],[],[]];switch(typeof r){case"undefined":o[0]=c(3/(u[0]*u[0]),a[0]),p[0].push(0,0),p[1].push(0,1),p[2].push(2/u[0],1/u[0]);break;case"string":o[0]=h(c(3/(u[s-2]*u[s-2]),a[s-2]),c(3/(u[0]*u[0]),a[0])),p[0].push(0,0,0),p[1].push(s-2,0,1),p[2].push(1/u[s-2],2/u[s-2]+2/u[0],1/u[0]);break;default:o[0]=r,p[0].push(0),p[1].push(0),p[2].push(1)}for(f=1;f<s-1;f++)o[f]=h(c(3/(u[f-1]*u[f-1]),a[f-1]),c(3/(u[f]*u[f]),a[f])),p[0].push(f,f,f),p[1].push(f-1,f,f+1),p[2].push(1/u[f-1],2/u[f-1]+2/u[f],1/u[f]);switch(typeof i){case"undefined":o[s-1]=c(3/(u[s-2]*u[s-2]),a[s-2]),p[0].push(s-1,s-1),p[1].push(s-2,s-1),p[2].push(1/u[s-2],2/u[s-2]);break;case"string":p[1][p[1].length-1]=0;break;default:o[s-1]=i,p[0].push(s-1),p[1].push(s-1),p[2].push(1)}typeof o[0]!="number"?o=numeric.transpose(o):o=[o];var d=Array(o.length);if(typeof r=="string")for(f=d.length-1;f!==-1;--f)d[f]=numeric.ccsLUPSolve(numeric.ccsLUP(numeric.ccsScatter(p)),o[f]),d[f][s-1]=d[f][0];else for(f=d.length-1;f!==-1;--f)d[f]=numeric.cLUsolve(numeric.cLU(p),o[f]);return typeof n[0]=="number"?d=d[0]:d=numeric.transpose(d),new numeric.Spline(t,n,n,d,d)},numeric.fftpow2=function fftpow2(e,t){var n=e.length;if(n===1)return;var r=Math.cos,i=Math.sin,s,o,u=Array(n/2),a=Array(n/2),f=Array(n/2),l=Array(n/2);o=n/2;for(s=n-1;s!==-1;--s)--o,f[o]=e[s],l[o]=t[s],--s,u[o]=e[s],a[o]=t[s];fftpow2(u,a),fftpow2(f,l),o=n/2;var c,h=-6.283185307179586/n,p,d;for(s=n-1;s!==-1;--s)--o,o===-1&&(o=n/2-1),c=h*s,p=r(c),d=i(c),e[s]=u[o]+p*f[o]-d*l[o],t[s]=a[o]+p*l[o]+d*f[o]},numeric._ifftpow2=function _ifftpow2(e,t){var n=e.length;if(n===1)return;var r=Math.cos,i=Math.sin,s,o,u=Array(n/2),a=Array(n/2),f=Array(n/2),l=Array(n/2);o=n/2;for(s=n-1;s!==-1;--s)--o,f[o]=e[s],l[o]=t[s],--s,u[o]=e[s],a[o]=t[s];_ifftpow2(u,a),_ifftpow2(f,l),o=n/2;var c,h=6.283185307179586/n,p,d;for(s=n-1;s!==-1;--s)--o,o===-1&&(o=n/2-1),c=h*s,p=r(c),d=i(c),e[s]=u[o]+p*f[o]-d*l[o],t[s]=a[o]+p*l[o]+d*f[o]},numeric.ifftpow2=function(t,n){numeric._ifftpow2(t,n),numeric.diveq(t,t.length),numeric.diveq(n,n.length)},numeric.convpow2=function(t,n,r,i){numeric.fftpow2(t,n),numeric.fftpow2(r,i);var s,o=t.length,u,a,f,l;for(s=o-1;s!==-1;--s)u=t[s],f=n[s],a=r[s],l=i[s],t[s]=u*a-f*l,n[s]=u*l+f*a;numeric.ifftpow2(t,n)},numeric.T.prototype.fft=function(){var t=this.x,n=this.y,r=t.length,i=Math.log,s=i(2),o=Math.ceil(i(2*r-1)/s),u=Math.pow(2,o),a=numeric.rep([u],0),f=numeric.rep([u],0),l=Math.cos,c=Math.sin,h,p=-3.141592653589793/r,d,v=numeric.rep([u],0),m=numeric.rep([u],0),g=Math.floor(r/2);for(h=0;h<r;h++)v[h]=t[h];if(typeof n!="undefined")for(h=0;h<r;h++)m[h]=n[h];a[0]=1;for(h=1;h<=u/2;h++)d=p*h*h,a[h]=l(d),f[h]=c(d),a[u-h]=l(d),f[u-h]=c(d);var y=new numeric.T(v,m),b=new numeric.T(a,f);return y=y.mul(b),numeric.convpow2(y.x,y.y,numeric.clone(b.x),numeric.neg(b.y)),y=y.mul(b),y.x.length=r,y.y.length=r,y},numeric.T.prototype.ifft=function(){var t=this.x,n=this.y,r=t.length,i=Math.log,s=i(2),o=Math.ceil(i(2*r-1)/s),u=Math.pow(2,o),a=numeric.rep([u],0),f=numeric.rep([u],0),l=Math.cos,c=Math.sin,h,p=3.141592653589793/r,d,v=numeric.rep([u],0),m=numeric.rep([u],0),g=Math.floor(r/2);for(h=0;h<r;h++)v[h]=t[h];if(typeof n!="undefined")for(h=0;h<r;h++)m[h]=n[h];a[0]=1;for(h=1;h<=u/2;h++)d=p*h*h,a[h]=l(d),f[h]=c(d),a[u-h]=l(d),f[u-h]=c(d);var y=new numeric.T(v,m),b=new numeric.T(a,f);return y=y.mul(b),numeric.convpow2(y.x,y.y,numeric.clone(b.x),numeric.neg(b.y)),y=y.mul(b),y.x.length=r,y.y.length=r,y.div(r)},numeric.gradient=function(t,n){var r=n.length,i=t(n);if(isNaN(i))throw new Error("gradient: f(x) is a NaN!");var s=Math.max,o,u=numeric.clone(n),a,f,l=Array(r),c=numeric.div,h=numeric.sub,p,d,s=Math.max,v=.001,m=Math.abs,g=Math.min,y,b,w,E=0,S,x,T;for(o=0;o<r;o++){var N=s(1e-6*i,1e-8);for(;;){++E;if(E>20)throw new Error("Numerical gradient fails");u[o]=n[o]+N,a=t(u),u[o]=n[o]-N,f=t(u),u[o]=n[o];if(isNaN(a)||isNaN(f)){N/=16;continue}l[o]=(a-f)/(2*N),y=n[o]-N,b=n[o],w=n[o]+N,S=(a-i)/N,x=(i-f)/N,T=s(m(l[o]),m(i),m(a),m(f),m(y),m(b),m(w),1e-8),p=g(s(m(S-l[o]),m(x-l[o]),m(S-x))/T,N/T);if(!(p>v))break;N/=16}}return l},numeric.uncmin=function(t,n,r,i,s,o,u){var a=numeric.gradient;typeof u=="undefined"&&(u={}),typeof r=="undefined"&&(r=1e-8),typeof i=="undefined"&&(i=function(e){return a(t,e)}),typeof s=="undefined"&&(s=1e3),n=numeric.clone(n);var f=n.length,l=t(n),c,h;if(isNaN(l))throw new Error("uncmin: f(x0) is a NaN!");var p=Math.max,d=numeric.norm2;r=p(r,numeric.epsilon);var v,m,g,y=u.Hinv||numeric.identity(f),b=numeric.dot,w=numeric.inv,E=numeric.sub,S=numeric.add,x=numeric.tensor,T=numeric.div,N=numeric.mul,C=numeric.all,k=numeric.isFinite,L=numeric.neg,A=0,O,M,_,D,P,H,B,j,F,I,q,R,U="";m=i(n);while(A<s){if(typeof o=="function"&&o(A,n,l,m,y)){U="Callback returned true";break}if(!C(k(m))){U="Gradient has Infinity or NaN";break}v=L(b(y,m));if(!C(k(v))){U="Search direction has Infinity or NaN";break}I=d(v);if(I<r){U="Newton step smaller than tol";break}F=1,h=b(m,v),_=n;while(A<s){if(F*I<r)break;M=N(v,F),_=S(n,M),c=t(_);if(c-l>=.1*F*h||isNaN(c)){F*=.5,++A;continue}break}if(F*I<r){U="Line search step size smaller than tol";break}if(A===s){U="maxit reached during line search";break}g=i(_),D=E(g,m),B=b(D,M),P=b(y,D),y=E(S(y,N((B+b(D,P))/(B*B),x(M,M))),T(S(x(P,M),x(M,P)),B)),n=_,l=c,m=g,++A}return{solution:n,f:l,gradient:m,invHessian:y,iterations:A,message:U}},numeric.Dopri=function(t,n,r,i,s,o,u){this.x=t,this.y=n,this.f=r,this.ymid=i,this.iterations=s,this.events=u,this.message=o},numeric.Dopri.prototype._at=function(t,n){function r(e){return e*e}var i=this,s=i.x,o=i.y,u=i.f,a=i.ymid,f=s.length,l,c,h,p,d,v,t,m=Math.floor,g,y=.5,b=numeric.add,w=numeric.mul,E=numeric.sub,S,x,T;return l=s[n],c=s[n+1],p=o[n],d=o[n+1],g=c-l,h=l+y*g,v=a[n],S=E(u[n],w(p,1/(l-h)+2/(l-c))),x=E(u[n+1],w(d,1/(c-h)+2/(c-l))),T=[r(t-c)*(t-h)/r(l-c)/(l-h),r(t-l)*r(t-c)/r(l-h)/r(c-h),r(t-l)*(t-h)/r(c-l)/(c-h),(t-l)*r(t-c)*(t-h)/r(l-c)/(l-h),(t-c)*r(t-l)*(t-h)/r(l-c)/(c-h)],b(b(b(b(w(p,T[0]),w(v,T[1])),w(d,T[2])),w(S,T[3])),w(x,T[4]))},numeric.Dopri.prototype.at=function(t){var n,r,i,s=Math.floor;if(typeof t!="number"){var o=t.length,u=Array(o);for(n=o-1;n!==-1;--n)u[n]=this.at(t[n]);return u}var a=this.x;n=0,r=a.length-1;while(r-n>1)i=s(.5*(n+r)),a[i]<=t?n=i:r=i;return this._at(t,n)},numeric.dopri=function(t,n,r,i,s,o,u){typeof s=="undefined"&&(s=1e-6),typeof o=="undefined"&&(o=1e3);var a=[t],f=[r],l=[i(t,r)],c,h,p,d,v,m,g=[],y=.2,b=[.075,.225],w=[44/45,-56/15,32/9],E=[19372/6561,-25360/2187,64448/6561,-212/729],S=[9017/3168,-355/33,46732/5247,49/176,-5103/18656],x=[35/384,0,500/1113,125/192,-2187/6784,11/84],T=[.10013431883002395,0,.3918321794184259,-0.02982460176594817,.05893268337240795,-0.04497888809104361,.023904308236133973],N=[.2,.3,.8,8/9,1,1],C=[-71/57600,0,71/16695,-71/1920,17253/339200,-22/525,.025],k=0,L,A,O=(n-t)/10,M=0,_=numeric.add,D=numeric.mul,P,H,B=Math.max,j=Math.min,F=Math.abs,I=numeric.norminf,q=Math.pow,R=numeric.any,U=numeric.lt,z=numeric.and,W=numeric.sub,X,V,$,J=new numeric.Dopri(a,f,l,g,-1,"");typeof u=="function"&&(X=u(t,r));while(t<n&&M<o){++M,t+O>n&&(O=n-t),c=i(t+N[0]*O,_(r,D(y*O,l[k]))),h=i(t+N[1]*O,_(_(r,D(b[0]*O,l[k])),D(b[1]*O,c))),p=i(t+N[2]*O,_(_(_(r,D(w[0]*O,l[k])),D(w[1]*O,c)),D(w[2]*O,h))),d=i(t+N[3]*O,_(_(_(_(r,D(E[0]*O,l[k])),D(E[1]*O,c)),D(E[2]*O,h)),D(E[3]*O,p))),v=i(t+N[4]*O,_(_(_(_(_(r,D(S[0]*O,l[k])),D(S[1]*O,c)),D(S[2]*O,h)),D(S[3]*O,p)),D(S[4]*O,d))),P=_(_(_(_(_(r,D(l[k],O*x[0])),D(h,O*x[2])),D(p,O*x[3])),D(d,O*x[4])),D(v,O*x[5])),m=i(t+O,P),L=_(_(_(_(_(D(l[k],O*C[0]),D(h,O*C[2])),D(p,O*C[3])),D(d,O*C[4])),D(v,O*C[5])),D(m,O*C[6])),typeof L=="number"?H=F(L):H=I(L);if(H>s){O=.2*O*q(s/H,.25);if(t+O===t){J.msg="Step size became too small";break}continue}g[k]=_(_(_(_(_(_(r,D(l[k],O*T[0])),D(h,O*T[2])),D(p,O*T[3])),D(d,O*T[4])),D(v,O*T[5])),D(m,O*T[6])),++k,a[k]=t+O,f[k]=P,l[k]=m;if(typeof u=="function"){var K,Q=t,G=t+.5*O,Y;V=u(G,g[k-1]),$=z(U(X,0),U(0,V)),R($)||(Q=G,G=t+O,X=V,V=u(G,P),$=z(U(X,0),U(0,V)));if(R($)){var Z,et,tt,nt,rt=0,it=1,st=1;for(;;){if(typeof X=="number")Y=(st*V*Q-it*X*G)/(st*V-it*X);else{Y=G;for(A=X.length-1;A!==-1;--A)X[A]<0&&V[A]>0&&(Y=j(Y,(st*V[A]*Q-it*X[A]*G)/(st*V[A]-it*X[A])))}if(Y<=Q||Y>=G)break;K=J._at(Y,k-1),nt=u(Y,K),tt=z(U(X,0),U(0,nt)),R(tt)?(G=Y,V=nt,$=tt,st=1,rt===-1?it*=.5:it=1,rt=-1):(Q=Y,X=nt,it=1,rt===1?st*=.5:st=1,rt=1)}return P=J._at(.5*(t+Y),k-1),J.f[k]=i(Y,K),J.x[k]=Y,J.y[k]=K,J.ymid[k-1]=P,J.events=$,J.iterations=M,J}}t+=O,r=P,X=V,O=j(.8*O*q(s/H,.25),4*O)}return J.iterations=M,J},numeric.LU=function(e,t){t=t||!1;var n=Math.abs,r,i,s,o,u,a,f,l,c,h=e.length,p=h-1,d=new Array(h);t||(e=numeric.clone(e));for(s=0;s<h;++s){f=s,a=e[s],c=n(a[s]);for(i=s+1;i<h;++i)o=n(e[i][s]),c<o&&(c=o,f=i);d[s]=f,f!=s&&(e[s]=e[f],e[f]=a,a=e[s]),u=a[s];for(r=s+1;r<h;++r)e[r][s]/=u;for(r=s+1;r<h;++r){l=e[r];for(i=s+1;i<p;++i)l[i]-=l[s]*a[i],++i,l[i]-=l[s]*a[i];i===p&&(l[i]-=l[s]*a[i])}}return{LU:e,P:d}},numeric.LUsolve=function(t,n){var r,i,s=t.LU,o=s.length,u=numeric.clone(n),a=t.P,f,l,c,h;for(r=o-1;r!==-1;--r)u[r]=n[r];for(r=0;r<o;++r){f=a[r],a[r]!==r&&(h=u[r],u[r]=u[f],u[f]=h),l=s[r];for(i=0;i<r;++i)u[r]-=u[i]*l[i]}for(r=o-1;r>=0;--r){l=s[r];for(i=r+1;i<o;++i)u[r]-=u[i]*l[i];u[r]/=l[r]}return u},numeric.solve=function(t,n,r){return numeric.LUsolve(numeric.LU(t,r),n)},numeric.echelonize=function(t){var n=numeric.dim(t),r=n[0],i=n[1],s=numeric.identity(r),o=Array(r),u,a,f,l,c,h,p,d,v=Math.abs,m=numeric.diveq;t=numeric.clone(t);for(u=0;u<r;++u){f=0,c=t[u],h=s[u];for(a=1;a<i;++a)v(c[f])<v(c[a])&&(f=a);o[u]=f,m(h,c[f]),m(c,c[f]);for(a=0;a<r;++a)if(a!==u){p=t[a],d=p[f];for(l=i-1;l!==-1;--l)p[l]-=c[l]*d;p=s[a];for(l=r-1;l!==-1;--l)p[l]-=h[l]*d}}return{I:s,A:t,P:o}},numeric.__solveLP=function(t,n,r,i,s,o,u){var a=numeric.sum,f=numeric.log,l=numeric.mul,c=numeric.sub,h=numeric.dot,p=numeric.div,d=numeric.add,v=t.length,m=r.length,g,y=!1,b,w=0,E=1,S,x,T=numeric.transpose(n),N=numeric.svd,C=numeric.transpose,k=numeric.leq,L=Math.sqrt,A=Math.abs,O=numeric.muleq,M=numeric.norminf,_=numeric.any,D=Math.min,P=numeric.all,H=numeric.gt,B=Array(v),j=Array(m),F=numeric.rep([m],1),I,q=numeric.solve,R=c(r,h(n,o)),U,z=h(t,t),W;for(U=w;U<s;++U){var X,V,$;for(X=m-1;X!==-1;--X)j[X]=p(n[X],R[X]);var J=C(j);for(X=v-1;X!==-1;--X)B[X]=a(J[X]);E=.25*A(z/h(t,B));var K=100*L(z/h(B,B));if(!isFinite(E)||E>K)E=K;W=d(t,l(E,B)),I=h(J,j);for(X=v-1;X!==-1;--X)I[X][X]+=1;$=q(I,p(W,E),!0);var Q=p(R,h(n,$)),G=1;for(X=m-1;X!==-1;--X)Q[X]<0&&(G=D(G,-0.999*Q[X]));g=c(o,l($,G)),R=c(r,h(n,g));if(!P(H(R,0)))return{solution:o,message:"",iterations:U};o=g;if(E<i)return{solution:g,message:"",iterations:U};if(u){var Y=h(t,W),Z=h(n,W);y=!0;for(X=m-1;X!==-1;--X)if(Y*Z[X]<0){y=!1;break}}else o[v-1]>=0?y=!1:y=!0;if(y)return{solution:g,message:"Unbounded",iterations:U}}return{solution:o,message:"maximum iteration count exceeded",iterations:U}},numeric._solveLP=function(t,n,r,i,s){var o=t.length,u=r.length,a,f=numeric.sum,l=numeric.log,c=numeric.mul,h=numeric.sub,p=numeric.dot,d=numeric.div,v=numeric.add,m=numeric.rep([o],0).concat([1]),g=numeric.rep([u,1],-1),y=numeric.blockMatrix([[n,g]]),b=r,a=numeric.rep([o],0).concat(Math.max(0,numeric.sup(numeric.neg(r)))+1),w=numeric.__solveLP(m,y,b,i,s,a,!1),E=numeric.clone(w.solution);E.length=o;var S=numeric.inf(h(r,p(n,E)));if(S<0)return{solution:NaN,message:"Infeasible",iterations:w.iterations};var x=numeric.__solveLP(t,n,r,i,s-w.iterations,E,!0);return x.iterations+=w.iterations,x},numeric.solveLP=function(t,n,r,i,s,o,u){typeof u=="undefined"&&(u=1e3),typeof o=="undefined"&&(o=numeric.epsilon);if(typeof i=="undefined")return numeric._solveLP(t,n,r,o,u);var a=i.length,f=i[0].length,l=n.length,c=numeric.echelonize(i),h=numeric.rep([f],0),p=c.P,d=[],v;for(v=p.length-1;v!==-1;--v)h[p[v]]=1;for(v=f-1;v!==-1;--v)h[v]===0&&d.push(v);var m=numeric.getRange,g=numeric.linspace(0,a-1),y=numeric.linspace(0,l-1),b=m(i,g,d),w=m(n,y,p),E=m(n,y,d),S=numeric.dot,x=numeric.sub,T=S(w,c.I),N=x(E,S(T,b)),C=x(r,S(T,s)),k=Array(p.length),L=Array(d.length);for(v=p.length-1;v!==-1;--v)k[v]=t[p[v]];for(v=d.length-1;v!==-1;--v)L[v]=t[d[v]];var A=x(L,S(k,S(c.I,b))),O=numeric._solveLP(A,N,C,o,u),M=O.solution;if(M!==M)return O;var _=S(c.I,x(s,S(b,M))),D=Array(t.length);for(v=p.length-1;v!==-1;--v)D[p[v]]=_[v];for(v=d.length-1;v!==-1;--v)D[d[v]]=M[v];return{solution:D,message:O.message,iterations:O.iterations}},numeric.MPStoLP=function(t){function y(e){throw new Error("MPStoLP: "+e+"\nLine "+s+": "+t[s]+"\nCurrent state: "+r[n]+"\n")}t instanceof String&&t.split("\n");var n=0,r=["Initial state","NAME","ROWS","COLUMNS","RHS","BOUNDS","ENDATA"],i=t.length,s,o,u,a=0,f={},l=[],c=0,h={},p=0,d,v=[],m=[],g=[];for(s=0;s<i;++s){u=t[s];var b=u.match(/\S*/g),w=[];for(o=0;o<b.length;++o)b[o]!==""&&w.push(b[o]);if(w.length===0)continue;for(o=0;o<r.length;++o)if(u.substr(0,r[o].length)===r[o])break;if(o<r.length){n=o,o===1&&(d=w[1]);if(o===6)return{name:d,c:v,A:numeric.transpose(m),b:g,rows:f,vars:h};continue}switch(n){case 0:case 1:y("Unexpected line");case 2:switch(w[0]){case"N":a===0?a=w[1]:y("Two or more N rows");break;case"L":f[w[1]]=c,l[c]=1,g[c]=0,++c;break;case"G":f[w[1]]=c,l[c]=-1,g[c]=0,++c;break;case"E":f[w[1]]=c,l[c]=0,g[c]=0,++c;break;default:y("Parse error "+numeric.prettyPrint(w))}break;case 3:h.hasOwnProperty(w[0])||(h[w[0]]=p,v[p]=0,m[p]=numeric.rep([c],0),++p);var E=h[w[0]];for(o=1;o<w.length;o+=2){if(w[o]===a){v[E]=parseFloat(w[o+1]);continue}var S=f[w[o]];m[E][S]=(l[S]<0?-1:1)*parseFloat(w[o+1])}break;case 4:for(o=1;o<w.length;o+=2)g[f[w[o]]]=(l[f[w[o]]]<0?-1:1)*parseFloat(w[o+1]);break;case 5:break;case 6:y("Internal error")}}y("Reached end of file without ENDATA")},numeric.seedrandom={pow:Math.pow,random:Math.random},function(e,t,n,r,i,s,o){function u(e){var t,r,i=this,s=e.length,o=0,u=i.i=i.j=i.m=0;i.S=[],i.c=[],s||(e=[s++]);while(o<n)i.S[o]=o++;for(o=0;o<n;o++)t=i.S[o],u=l(u+t+e[o%s]),r=i.S[u],i.S[o]=r,i.S[u]=t;i.g=function(t){var r=i.S,s=l(i.i+1),o=r[s],u=l(i.j+o),a=r[u];r[s]=a,r[u]=o;var f=r[l(o+a)];while(--t)s=l(s+1),o=r[s],u=l(u+o),a=r[u],r[s]=a,r[u]=o,f=f*n+r[l(o+a)];return i.i=s,i.j=u,f},i.g(n)}function a(e,t,n,r,i){n=[],i=typeof e;if(t&&i=="object")for(r in e)if(r.indexOf("S")<5)try{n.push(a(e[r],t-1))}catch(s){}return n.length?n:e+(i!="string"?"\0":"")}function f(e,t,n,r){e+="",n=0;for(r=0;r<e.length;r++)t[l(r)]=l((n^=t[l(r)]*19)+e.charCodeAt(r));e="";for(r in t)e+=String.fromCharCode(t[r]);return e}function l(e){return e&n-1}t.seedrandom=function(c,h){var p=[],d;return c=f(a(h?[c,e]:arguments.length?c:[(new Date).getTime(),e,window],3),p),d=new u(p),f(d.S,e),t.random=function(){var t=d.g(r),u=o,a=0;while(t<i)t=(t+a)*n,u*=n,a=d.g(1);while(t>=s)t/=2,u/=2,a>>>=1;return(t+a)/u},c},o=t.pow(n,r),i=t.pow(2,i),s=i*2,f(t.random(),e)}([],numeric.seedrandom,256,6,52),function(e){function t(e){if(typeof e!="object")return e;var n=[],r,i=e.length;for(r=0;r<i;r++)n[r+1]=t(e[r]);return n}function n(e){if(typeof e!="object")return e;var t=[],r,i=e.length;for(r=1;r<i;r++)t[r-1]=n(e[r]);return t}function r(e,t,n){var r,i,s,o,u;for(s=1;s<=n;s+=1){e[s][s]=1/e[s][s],u=-e[s][s];for(r=1;r<s;r+=1)e[r][s]=u*e[r][s];o=s+1;if(n<o)break;for(i=o;i<=n;i+=1){u=e[s][i],e[s][i]=0;for(r=1;r<=s;r+=1)e[r][i]=e[r][i]+u*e[r][s]}}}function i(e,t,n,r){var i,s,o,u;for(s=1;s<=n;s+=1){u=0;for(i=1;i<s;i+=1)u+=e[i][s]*r[i];r[s]=(r[s]-u)/e[s][s]}for(o=1;o<=n;o+=1){s=n+1-o,r[s]=r[s]/e[s][s],u=-r[s];for(i=1;i<s;i+=1)r[i]=r[i]+u*e[i][s]}}function s(e,t,n,r){var i,s,o,u,a,f;for(s=1;s<=n;s+=1){r[1]=s,f=0,o=s-1;if(o<1){f=e[s][s]-f;if(f<=0)break;e[s][s]=Math.sqrt(f)}else{for(u=1;u<=o;u+=1){a=e[u][s];for(i=1;i<u;i+=1)a-=e[i][s]*e[i][u];a/=e[u][u],e[u][s]=a,f+=a*a}f=e[s][s]-f;if(f<=0)break;e[s][s]=Math.sqrt(f)}r[1]=0}}function o(e,t,n,o,u,a,f,l,c,h,p,d,v,m,g,y){function V(){m[1]=m[1]+1,E=L;for(b=1;b<=h;b+=1){E+=1,P=-l[b];for(w=1;w<=o;w+=1)P+=f[w][b]*u[w];Math.abs(P)<U&&(P=0);if(b>p)g[E]=P;else{g[E]=-Math.abs(P);if(P>0){for(w=1;w<=o;w+=1)f[w][b]=-f[w][b];l[b]=-l[b]}}}for(b=1;b<=v;b+=1)g[L+d[b]]=0;O=0,D=0;for(b=1;b<=h;b+=1)g[L+b]<D*g[_+b]&&(O=b,D=g[L+b]/g[_+b]);return O===0?999:0}function $(){for(b=1;b<=o;b+=1){P=0;for(w=1;w<=o;w+=1)P+=e[w][b]*f[w][O];g[b]=P}S=N;for(b=1;b<=o;b+=1)g[S+b]=0;for(w=v+1;w<=o;w+=1)for(b=1;b<=o;b+=1)g[S+b]=g[S+b]+e[b][w]*g[w];q=!0;for(b=v;b>=1;b-=1){P=g[b],E=k+b*(b+3)/2,S=E-b;for(w=b+1;w<=v;w+=1)P-=g[E]*g[C+w],E+=w;P/=g[S],g[C+b]=P;if(d[b]<p)break;if(P<0)break;q=!1,T=b}if(!q){H=g[A+T]/g[C+T];for(b=1;b<=v;b+=1){if(d[b]<p)break;if(g[C+b]<0)break;D=g[A+b]/g[C+b],D<
H&&(H=D,T=b)}}P=0;for(b=N+1;b<=N+o;b+=1)P+=g[b]*g[b];if(Math.abs(P)<=U){if(q)return y[1]=1,999;for(b=1;b<=v;b+=1)g[A+b]=g[A+b]-H*g[C+b];return g[A+v+1]=g[A+v+1]+H,700}P=0;for(b=1;b<=o;b+=1)P+=g[N+b]*f[b][O];B=-g[L+O]/P,R=!0,q||H<B&&(B=H,R=!1);for(b=1;b<=o;b+=1)u[b]=u[b]+B*g[N+b],Math.abs(u[b])<U&&(u[b]=0);a[1]=a[1]+B*P*(B/2+g[A+v+1]);for(b=1;b<=v;b+=1)g[A+b]=g[A+b]-B*g[C+b];g[A+v+1]=g[A+v+1]+B;if(!R){P=-l[O];for(w=1;w<=o;w+=1)P+=u[w]*f[w][O];if(O>p)g[L+O]=P;else{g[L+O]=-Math.abs(P);if(P>0){for(w=1;w<=o;w+=1)f[w][O]=-f[w][O];l[O]=-l[O]}}return 700}v+=1,d[v]=O,E=k+(v-1)*v/2+1;for(b=1;b<=v-1;b+=1)g[E]=g[b],E+=1;if(v===o)g[E]=g[o];else{for(b=o;b>=v+1;b-=1){if(g[b]===0)break;j=Math.max(Math.abs(g[b-1]),Math.abs(g[b])),F=Math.min(Math.abs(g[b-1]),Math.abs(g[b])),g[b-1]>=0?D=Math.abs(j*Math.sqrt(1+F*F/(j*j))):D=-Math.abs(j*Math.sqrt(1+F*F/(j*j))),j=g[b-1]/D,F=g[b]/D;if(j===1)break;if(j===0){g[b-1]=F*D;for(w=1;w<=o;w+=1)D=e[w][b-1],e[w][b-1]=e[w][b],e[w][b]=D}else{g[b-1]=D,I=F/(1+j);for(w=1;w<=o;w+=1)D=j*e[w][b-1]+F*e[w][b],e[w][b]=I*(e[w][b-1]+D)-e[w][b],e[w][b-1]=D}}g[E]=g[v]}return 0}function J(){E=k+T*(T+1)/2+1,S=E+T;if(g[S]===0)return 798;j=Math.max(Math.abs(g[S-1]),Math.abs(g[S])),F=Math.min(Math.abs(g[S-1]),Math.abs(g[S])),g[S-1]>=0?D=Math.abs(j*Math.sqrt(1+F*F/(j*j))):D=-Math.abs(j*Math.sqrt(1+F*F/(j*j))),j=g[S-1]/D,F=g[S]/D;if(j===1)return 798;if(j===0){for(b=T+1;b<=v;b+=1)D=g[S-1],g[S-1]=g[S],g[S]=D,S+=b;for(b=1;b<=o;b+=1)D=e[b][T],e[b][T]=e[b][T+1],e[b][T+1]=D}else{I=F/(1+j);for(b=T+1;b<=v;b+=1)D=j*g[S-1]+F*g[S],g[S]=I*(g[S-1]+D)-g[S],g[S-1]=D,S+=b;for(b=1;b<=o;b+=1)D=j*e[b][T]+F*e[b][T+1],e[b][T+1]=I*(e[b][T]+D)-e[b][T+1],e[b][T]=D}return 0}function K(){S=E-T;for(b=1;b<=T;b+=1)g[S]=g[E],E+=1,S+=1;return g[A+T]=g[A+T+1],d[T]=d[T+1],T+=1,T<v?797:0}function Q(){return g[A+v]=g[A+v+1],g[A+v+1]=0,d[v]=0,v-=1,m[2]=m[2]+1,0}var b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z,W,X;M=Math.min(o,h),E=2*o+M*(M+5)/2+2*h+1,U=1e-60;do U+=U,z=1+.1*U,W=1+.2*U;while(z<=1||W<=1);for(b=1;b<=o;b+=1)g[b]=t[b];for(b=o+1;b<=E;b+=1)g[b]=0;for(b=1;b<=h;b+=1)d[b]=0;x=[];if(y[1]===0){s(e,n,o,x);if(x[1]!==0){y[1]=2;return}i(e,n,o,t),r(e,n,o)}else{for(w=1;w<=o;w+=1){u[w]=0;for(b=1;b<=w;b+=1)u[w]=u[w]+e[b][w]*t[b]}for(w=1;w<=o;w+=1){t[w]=0;for(b=w;b<=o;b+=1)t[w]=t[w]+e[w][b]*u[b]}}a[1]=0;for(w=1;w<=o;w+=1){u[w]=t[w],a[1]=a[1]+g[w]*u[w],g[w]=0;for(b=w+1;b<=o;b+=1)e[b][w]=0}a[1]=-a[1]/2,y[1]=0,N=o,C=N+o,A=C+M,k=A+M+1,L=k+M*(M+1)/2,_=L+h;for(b=1;b<=h;b+=1){P=0;for(w=1;w<=o;w+=1)P+=f[w][b]*f[w][b];g[_+b]=Math.sqrt(P)}v=0,m[1]=0,m[2]=0,X=0;for(;;){X=V();if(X===999)return;for(;;){X=$();if(X===0)break;if(X===999)return;if(X===700)if(T===v)Q();else{for(;;){J(),X=K();if(X!==797)break}Q()}}}}function u(e,r,i,s,u,a){e=t(e),r=t(r),i=t(i);var f,l,c,h,p,d=[],v=[],m=[],g=[],y=[],b;u=u||0,a=a?t(a):[undefined,0],s=s?t(s):[],l=e.length-1,c=i[1].length-1;if(!s)for(f=1;f<=c;f+=1)s[f]=0;for(f=1;f<=c;f+=1)v[f]=0;h=0,p=Math.min(l,c);for(f=1;f<=l;f+=1)m[f]=0;d[1]=0;for(f=1;f<=2*l+p*(p+5)/2+2*c+1;f+=1)g[f]=0;for(f=1;f<=2;f+=1)y[f]=0;return o(e,r,l,l,m,d,i,s,l,c,u,v,h,y,g,a),b="",a[1]===1&&(b="constraints are inconsistent, no solution!"),a[1]===2&&(b="matrix D in quadratic function is not positive definite!"),{solution:n(m),value:n(d),unconstrained_solution:n(r),iterations:n(y),iact:n(v),message:b}}e.solveQP=u}(numeric),numeric.svd=function(t){function g(e,t){return e=Math.abs(e),t=Math.abs(t),e>t?e*Math.sqrt(1+t*t/e/e):t==0?e:t*Math.sqrt(1+e*e/t/t)}var n,r=numeric.epsilon,i=1e-64/r,s=50,o=0,u=0,a=0,f=0,l=0,c=numeric.clone(t),h=c.length,p=c[0].length;if(h<p)throw"Need more rows than columns";var d=new Array(p),v=new Array(p);for(u=0;u<p;u++)d[u]=v[u]=0;var m=numeric.rep([p,p],0),y=0,b=0,w=0,E=0,S=0,x=0,T=0;for(u=0;u<p;u++){d[u]=b,T=0,l=u+1;for(a=u;a<h;a++)T+=c[a][u]*c[a][u];if(T<=i)b=0;else{y=c[u][u],b=Math.sqrt(T),y>=0&&(b=-b),w=y*b-T,c[u][u]=y-b;for(a=l;a<p;a++){T=0;for(f=u;f<h;f++)T+=c[f][u]*c[f][a];y=T/w;for(f=u;f<h;f++)c[f][a]+=y*c[f][u]}}v[u]=b,T=0;for(a=l;a<p;a++)T+=c[u][a]*c[u][a];if(T<=i)b=0;else{y=c[u][u+1],b=Math.sqrt(T),y>=0&&(b=-b),w=y*b-T,c[u][u+1]=y-b;for(a=l;a<p;a++)d[a]=c[u][a]/w;for(a=l;a<h;a++){T=0;for(f=l;f<p;f++)T+=c[a][f]*c[u][f];for(f=l;f<p;f++)c[a][f]+=T*d[f]}}S=Math.abs(v[u])+Math.abs(d[u]),S>E&&(E=S)}for(u=p-1;u!=-1;u+=-1){if(b!=0){w=b*c[u][u+1];for(a=l;a<p;a++)m[a][u]=c[u][a]/w;for(a=l;a<p;a++){T=0;for(f=l;f<p;f++)T+=c[u][f]*m[f][a];for(f=l;f<p;f++)m[f][a]+=T*m[f][u]}}for(a=l;a<p;a++)m[u][a]=0,m[a][u]=0;m[u][u]=1,b=d[u],l=u}for(u=p-1;u!=-1;u+=-1){l=u+1,b=v[u];for(a=l;a<p;a++)c[u][a]=0;if(b!=0){w=c[u][u]*b;for(a=l;a<p;a++){T=0;for(f=l;f<h;f++)T+=c[f][u]*c[f][a];y=T/w;for(f=u;f<h;f++)c[f][a]+=y*c[f][u]}for(a=u;a<h;a++)c[a][u]=c[a][u]/b}else for(a=u;a<h;a++)c[a][u]=0;c[u][u]+=1}r*=E;for(f=p-1;f!=-1;f+=-1)for(var N=0;N<s;N++){var C=!1;for(l=f;l!=-1;l+=-1){if(Math.abs(d[l])<=r){C=!0;break}if(Math.abs(v[l-1])<=r)break}if(!C){o=0,T=1;var k=l-1;for(u=l;u<f+1;u++){y=T*d[u],d[u]=o*d[u];if(Math.abs(y)<=r)break;b=v[u],w=g(y,b),v[u]=w,o=b/w,T=-y/w;for(a=0;a<h;a++)S=c[a][k],x=c[a][u],c[a][k]=S*o+x*T,c[a][u]=-S*T+x*o}}x=v[f];if(l==f){if(x<0){v[f]=-x;for(a=0;a<p;a++)m[a][f]=-m[a][f]}break}if(N>=s-1)throw"Error: no convergence.";E=v[l],S=v[f-1],b=d[f-1],w=d[f],y=((S-x)*(S+x)+(b-w)*(b+w))/(2*w*S),b=g(y,1),y<0?y=((E-x)*(E+x)+w*(S/(y-b)-w))/E:y=((E-x)*(E+x)+w*(S/(y+b)-w))/E,o=1,T=1;for(u=l+1;u<f+1;u++){b=d[u],S=v[u],w=T*b,b=o*b,x=g(y,w),d[u-1]=x,o=y/x,T=w/x,y=E*o+b*T,b=-E*T+b*o,w=S*T,S*=o;for(a=0;a<p;a++)E=m[a][u-1],x=m[a][u],m[a][u-1]=E*o+x*T,m[a][u]=-E*T+x*o;x=g(y,w),v[u-1]=x,o=y/x,T=w/x,y=o*b+T*S,E=-T*b+o*S;for(a=0;a<h;a++)S=c[a][u-1],x=c[a][u],c[a][u-1]=S*o+x*T,c[a][u]=-S*T+x*o}d[l]=0,d[f]=y,v[f]=E}for(u=0;u<v.length;u++)v[u]<r&&(v[u]=0);for(u=0;u<p;u++)for(a=u-1;a>=0;a--)if(v[a]<v[u]){o=v[a],v[a]=v[u],v[u]=o;for(f=0;f<c.length;f++)n=c[f][u],c[f][u]=c[f][a],c[f][a]=n;for(f=0;f<m.length;f++)n=m[f][u],m[f][u]=m[f][a],m[f][a]=n;u=a}return{U:c,S:v,V:m}};(function(e,t){t(e.MMTF=e.MMTF||{})})(this,function(e){"use strict";function t(e,t,n){var r=e.byteLength;for(var i=0,s=n.length;i<s;i++){var o=n.charCodeAt(i);if(o<128){e.setUint8(t++,o>>>0&127|0);continue}if(o<2048){e.setUint8(t++,o>>>6&31|192),e.setUint8(t++,o>>>0&63|128);continue}if(o<65536){e.setUint8(t++,o>>>12&15|224),e.setUint8(t++,o>>>6&63|128),e.setUint8(t++,o>>>0&63|128);continue}if(o<1114112){e.setUint8(t++,o>>>18&7|240),e.setUint8(t++,o>>>12&63|128),e.setUint8(t++,o>>>6&63|128),e.setUint8(t++,o>>>0&63|128);continue}throw new Error("bad codepoint "+o)}}function n(e){var t=0;for(var n=0,r=e.length;n<r;n++){var i=e.charCodeAt(n);if(i<128){t+=1;continue}if(i<2048){t+=2;continue}if(i<65536){t+=3;continue}if(i<1114112){t+=4;continue}throw new Error("bad codepoint "+i)}return t}function r(e,i,s){var o=typeof e;if(o==="string"){var u=n(e);if(u<32)return i.setUint8(s,u|160),t(i,s+1,e),1+u;if(u<256)return i.setUint8(s,217),i.setUint8(s+1,u),t(i,s+2,e),2+u;if(u<65536)return i.setUint8(s,218),i.setUint16(s+1,u),t(i,s+3,e),3+u;if(u<4294967296)return i.setUint8(s,219),i.setUint32(s+1,u),t(i,s+5,e),5+u}if(e instanceof Uint8Array){var u=e.byteLength,a=new Uint8Array(i.buffer);if(u<256)return i.setUint8(s,196),i.setUint8(s+1,u),a.set(e,s+2),2+u;if(u<65536)return i.setUint8(s,197),i.setUint16(s+1,u),a.set(e,s+3),3+u;if(u<4294967296)return i.setUint8(s,198),i.setUint32(s+1,u),a.set(e,s+5),5+u}if(o==="number"){if(!isFinite(e))throw new Error("Number not finite: "+e);if(Math.floor(e)!==e)return i.setUint8(s,203),i.setFloat64(s+1,e),9;if(e>=0){if(e<128)return i.setUint8(s,e),1;if(e<256)return i.setUint8(s,204),i.setUint8(s+1,e),2;if(e<65536)return i.setUint8(s,205),i.setUint16(s+1,e),3;if(e<4294967296)return i.setUint8(s,206),i.setUint32(s+1,e),5;throw new Error("Number too big 0x"+e.toString(16))}if(e>=-32)return i.setInt8(s,e),1;if(e>=-128)return i.setUint8(s,208),i.setInt8(s+1,e),2;if(e>=-32768)return i.setUint8(s,209),i.setInt16(s+1,e),3;if(e>=-2147483648)return i.setUint8(s,210),i.setInt32(s+1,e),5;throw new Error("Number too small -0x"+(-e).toString(16).substr(1))}if(e===null)return i.setUint8(s,192),1;if(o==="boolean")return i.setUint8(s,e?195:194),1;if(o==="object"){var u,f=0,l=Array.isArray(e);if(l)u=e.length;else{var c=Object.keys(e);u=c.length}var f;u<16?(i.setUint8(s,u|(l?144:128)),f=1):u<65536?(i.setUint8(s,l?220:222),i.setUint16(s+1,u),f=3):u<4294967296&&(i.setUint8(s,l?221:223),i.setUint32(s+1,u),f=5);if(l)for(var h=0;h<u;h++)f+=r(e[h],i,s+f);else for(var h=0;h<u;h++){var p=c[h];f+=r(p,i,s+f),f+=r(e[p],i,s+f)}return f}throw new Error("Unknown type "+o)}function i(e){var t=typeof e;if(t==="string"){var r=n(e);if(r<32)return 1+r;if(r<256)return 2+r;if(r<65536)return 3+r;if(r<4294967296)return 5+r}if(e instanceof Uint8Array){var r=e.byteLength;if(r<256)return 2+r;if(r<65536)return 3+r;if(r<4294967296)return 5+r}if(t==="number"){if(Math.floor(e)!==e)return 9;if(e>=0){if(e<128)return 1;if(e<256)return 2;if(e<65536)return 3;if(e<4294967296)return 5;throw new Error("Number too big 0x"+e.toString(16))}if(e>=-32)return 1;if(e>=-128)return 2;if(e>=-32768)return 3;if(e>=-2147483648)return 5;throw new Error("Number too small -0x"+e.toString(16).substr(1))}if(t==="boolean"||e===null)return 1;if(t==="object"){var r,s=0;if(Array.isArray(e)){r=e.length;for(var o=0;o<r;o++)s+=i(e[o])}else{var u=Object.keys(e);r=u.length;for(var o=0;o<r;o++){var a=u[o];s+=i(a)+i(e[a])}}if(r<16)return 1+s;if(r<65536)return 3+s;if(r<4294967296)return 5+s;throw new Error("Array or object too long 0x"+r.toString(16))}throw new Error("Unknown type "+t)}function s(e){var t=new ArrayBuffer(i(e)),n=new DataView(t);return r(e,n,0),new Uint8Array(t)}function f(e,t,n){return t?new e(t.buffer,t.byteOffset,t.byteLength/(n||1)):undefined}function l(e){return f(DataView,e)}function c(e){return f(Uint8Array,e)}function h(e){return f(Int8Array,e)}function p(e){return f(Int32Array,e,4)}function d(e){return f(Float32Array,e,4)}function v(e,t){var n=e.length/2;t||(t=new Int16Array(n));for(var r=0,i=0;r<n;++r,i+=2)t[r]=e[i]<<8^e[i+1]<<0;return t}function m(e,t){var n=e.length;t||(t=new Uint8Array(2*n));var r=l(t);for(var i=0;i<n;++i)r.setInt16(2*i,e[i]);return c(t)}function g(e,t){var n=e.length/4;t||(t=new Int32Array(n));for(var r=0,i=0;r<n;++r,i+=4)t[r]=e[i]<<24^e[i+1]<<16^e[i+2]<<8^e[i+3]<<0;return t}function y(e,t){var n=e.length;t||(t=new Uint8Array(4*n));var r=l(t);for(var i=0;i<n;++i)r.setInt32(4*i,e[i]);return c(t)}function b(e,t){var n=e.length;t||(t=new Float32Array(n/4));var r=l(t),i=l(e);for(var s=0,o=0,u=n/4;s<u;++s,o+=4)r.setFloat32(o,i.getFloat32(o),!0);return t}function w(e,t,n){var r=e.length,i=1/t;n||(n=new Float32Array(r));for(var s=0;s<r;++s)n[s]=e[s]*i;return n}function E(e,t,n){var r=e.length;n||(n=new Int32Array(r));for(var i=0;i<r;++i)n[i]=Math.round(e[i]*t);return n}function S(e,t){var n,r;if(!t){var i=0;for(n=0,r=e.length;n<r;n+=2)i+=e[n+1];t=new e.constructor(i)}var s=0;for(n=0,r=e.length;n<r;n+=2){var o=e[n],u=e[n+1];for(var a=0;a<u;++a)t[s]=o,++s}return t}function x(e){if(e.length===0)return new Int32Array;var t,n,r=2;for(t=1,n=e.length;t<n;++t)e[t-1]!==e[t]&&(r+=2);var i=new Int32Array(r),s=0,o=1;for(t=1,n=e.length;t<n;++t)e[t-1]!==e[t]?(i[s]=e[t-1],i[s+1]=o,o=1,s+=2):++o;return i[s]=e[e.length-1],i[s+1]=o,i}function T(e,t){var n=e.length;t||(t=new e.constructor(n)),n&&(t[0]=e[0]);for(var r=1;r<n;++r)t[r]=e[r]+t[r-1];return t}function N(e,t){var n=e.length;t||(t=new e.constructor(n)),t[0]=e[0];for(var r=1;r<n;++r)t[r]=e[r]-e[r-1];return t}function C(e,t){var n=e instanceof Int8Array?127:32767,r=-n-1,i=e.length,s,o;if(!t){var u=0;for(s=0;s<i;++s)e[s]<n&&e[s]>r&&++u;t=new Int32Array(u)}s=0,o=0;while(s<i){var a=0;while(e[s]===n||e[s]===r)a+=e[s],++s;a+=e[s],++s,t[o]=a,++o}return t}function k(e,t){var n=t?127:32767,r=-n-1,i,s=e.length,o=0;for(i=0;i<s;++i){var u=e[i];u===0?++o:u===n||u===r?o+=2:u>0?o+=Math.ceil(u/n):o+=Math.ceil(u/r)}var a=t?new Int8Array(o):new Int16Array(o),f=0;for(i=0;i<s;++i){var u=e[i];if(u>=0)while(u>=n)a[f]=n,++f,u-=n;else while(u<=r)a[f]=r,++f,u-=r;a[f]=u,++f}return a}function L(e,t){return T(S(e),t)}function A(e){return x(N(e))}function O(e,t,n){return w(S(e,p(n)),t,n)}function M(e,t){return x(E(e,t))}function _(e,t,n){return w(T(e,p(n)),t,n)}function D(e,t,n){return N(E(e,t),n)}function P(e,t,n){return w(C(e,p(n)),t,n)}function H(e,t,n){var r=C(e,p(n));return _(r,t,d(r))}function B(e,t,n){return k(D(e,t),n)}function j(e){var t=l(e),n=t.getInt32(0),r=t.getInt32(4),i=e.subarray(8,12),e=e.subarray(12);return[n,e,r,i]}function F(e,t,n,r){var i=new ArrayBuffer(12+r.byteLength),s=new Uint8Array(i),o=new DataView(i);return o.setInt32(0,e),o.setInt32(4,t),n&&s.set(n,8),s.set(r,12),s}function I(e){var t=e.length,n=c(e);return F(2,t,undefined,n)}function q(e){var t=e.length,n=y(e);return F(4,t,undefined,n)}function R(e,t){var n=e.length/t,r=y([t]),i=c(e);return F(5,n,r,i)}function U(e){var t=e.length,n=y(x(e));return F(6,t,undefined,n)}function z(e){var t=e.length,n=y(A(e));return F(8,t,undefined,n)}function W(e,t){var n=e.length,r=y([t]),i=y(M(e,t));return F(9,n,r,i)}function X(e,t){var n=e.length,r=y([t]),i=m(B(e,t));return F(10,n,r,i)}function V(e){var t={};return o.forEach(function(n){e[n]!==undefined&&(t[n]=e[n])}),e.bondAtomList&&(t.bondAtomList=q(e.bondAtomList)),e.bondOrderList&&(t.bondOrderList=I(e.bondOrderList)),t.xCoordList=X(e.xCoordList,1e3),t.yCoordList=X(e.yCoordList,1e3),t.zCoordList=X(e.zCoordList,1e3),e.bFactorList&&(t.bFactorList=X(e.bFactorList,100)),e.atomIdList&&(t.atomIdList=z(e.atomIdList)),e.altLocList&&(t.altLocList=U(e.altLocList)),e.occupancyList&&(t.occupancyList=W(e.occupancyList,100)),t.groupIdList=z(e.groupIdList),t.groupTypeList=q(e.groupTypeList),e.secStructList&&(t.secStructList=I(e.secStructList,1)),e.insCodeList&&(t.insCodeList=U(e.insCodeList)),e.sequenceIndexList&&(t.sequenceIndexList=z(e.sequenceIndexList)),t.chainIdList=R(e.chainIdList,4),e.chainNameList&&(t.chainNameList=R(e.chainNameList,4)),t}function $(e){function r(e){var t={};for(var n=0;n<e;n++){var r=u();t[r]=u()}return t}function i(n){var r=e.subarray(t,t+n);return t+=n,r}function s(n){var r=e.subarray(t,t+n);t+=n;var i=65535;if(n>i){var s=[];for(var o=0;o<r.length;o+=i)s.push(String.fromCharCode.apply(null,r.subarray(o,o+i)));return s.join("")}return String.fromCharCode.apply(null,r)}function o(e){var t=new Array(e);for(var n=0;n<e;n++)t[n]=u();return t}function u(){var u=e[t],a,f,l;if((u&128)===0)return t++,u;if((u&240)===128)return f=u&15,t++,r(f);if((u&240)===144)return f=u&15,t++,o(f);if((u&224)===160)return f=u&31,t++,s(f);if((u&224)===224)return a=n.getInt8(t),t++,a;switch(u){case 192:return t++,null;case 194:return t++,!1;case 195:return t++,!0;case 196:return f=n.getUint8(t+1),t+=2,i(f);case 197:return f=n.getUint16(t+1),t+=3,i(f);case 198:return f=n.getUint32(t+1),t+=5,i(f);case 202:return a=n.getFloat32(t+1),t+=5,a;case 203:return a=n.getFloat64(t+1),t+=9,a;case 204:return a=e[t+1],t+=2,a;case 205:return a=n.getUint16(t+1),t+=3,a;case 206:return a=n.getUint32(t+1),t+=5,a;case 208:return a=n.getInt8(t+1),t+=2,a;case 209:return a=n.getInt16(t+1),t+=3,a;case 210:return a=n.getInt32(t+1),t+=5,a;case 217:return f=n.getUint8(t+1),t+=2,s(f);case 218:return f=n.getUint16(t+1),t+=3,s(f);case 219:return f=n.getUint32(t+1),t+=5,s(f);case 220:return f=n.getUint16(t+1),t+=3,o(f);case 221:return f=n.getUint32(t+1),t+=5,o(f);case 222:return f=n.getUint16(t+1),t+=3,r(f);case 223:return f=n.getUint32(t+1),t+=5,r(f)}throw new Error("Unknown type 0x"+u.toString(16))}var t=0,n=new DataView(e.buffer);return u()}function J(e,t,n,r){switch(e){case 1:return b(t);case 2:return h(t);case 3:return v(t);case 4:return g(t);case 5:return c(t);case 6:return S(g(t),new Uint8Array(n));case 7:return S(g(t));case 8:return L(g(t));case 9:return O(g(t),g(r)[0]);case 10:return H(v(t),g(r)[0]);case 11:return w(v(t),g(r)[0]);case 12:return P(v(t),g(r)[0]);case 13:return P(h(t),g(r)[0]);case 14:return C(v(t));case 15:return C(h(t))}}function K(e,t){t=t||{};var n=t.ignoreFields,r={};return a.forEach(function(t){var i=n?n.indexOf(t)!==-1:!1,s=e[t];!i&&s!==undefined&&(s instanceof Uint8Array?r[t]=J.apply(null,j(s)):r[t]=s)}),r}function Q(e){return String.fromCharCode.apply(null,e).replace(/\0/g,"")}function G(e,t,n){n=n||{};var r=n.firstModelOnly,i=t.onModel,s=t.onChain,o=t.onGroup,u=t.onAtom,a=t.onBond,f=0,l=0,c=0,h=0,p=0,d=-1,v=e.chainNameList,m=e.secStructList,g=e.insCodeList,y=e.sequenceIndexList,b=e.atomIdList,w=e.bFactorList,E=e.altLocList,S=e.occupancyList,x=e.bondAtomList,T=e.bondOrderList,N,C,k,L,A,O;for(N=0,C=e.chainsPerModel.length;N<C;++N){if(r&&f>0)break;var M=e.chainsPerModel[f];i&&i({chainCount:M,modelIndex:f});for(k=0;k<M;++k){var _=e.groupsPerChain[l];if(s){var D=Q(e.chainIdList.subarray(l*4,l*4+4)),P=null;v&&(P=Q(v.subarray(l*4,l*4+4))),s({groupCount:_,chainIndex:l,modelIndex:f,chainId:D,chainName:P})}for(L=0;L<_;++L){var H=e.groupList[e.groupTypeList[c]],B=H.atomNameList.length;if(o){var j=null;m&&(j=m[c]);var F=null;e.insCodeList&&(F=String.fromCharCode(g[c]));var I=null;y&&(I=y[c]),o({atomCount:B,groupIndex:c,chainIndex:l,modelIndex:f,groupId:e.groupIdList[c],groupType:e.groupTypeList[c],groupName:H.groupName,singleLetterCode:H.singleLetterCode,chemCompType:H.chemCompType,secStruct:j,insCode:F,sequenceIndex:I})}for(A=0;A<B;++A){if(u){var q=null;b&&(q=b[h]);var R=null;w&&(R=w[h]);var U=null;E&&(U=String.fromCharCode(E[h]));var z=null;S&&(z=S[h]),u({atomIndex:h,groupIndex:c,chainIndex:l,modelIndex:f,atomId:q,element:H.elementList[A],atomName:H.atomNameList[A],formalCharge:H.formalChargeList[A],xCoord:e.xCoordList[h],yCoord:e.yCoordList[h],zCoord:e.zCoordList[h],bFactor:R,altLoc:U,occupancy:z})}h+=1}if(a){var W=H.bondAtomList;for(A=0,O=H.bondOrderList.length;A<O;++A)a({atomIndex1:h-B+W[A*2],atomIndex2:h-B+W[A*2+1],bondOrder:H.bondOrderList[A]})}c+=1}l+=1}p=d+1,d=h-1;if(a&&x)for(A=0,O=x.length;A<O;A+=2){var X=x[A],V=x[A+1];(X>=p&&X<=d||V>=p&&V<=d)&&a({atomIndex1:X,atomIndex2:V,bondOrder:T?T[A/2]:null})}f+=1}}function nt(e){return s(V(e))}function rt(e,t){e instanceof ArrayBuffer&&(e=new Uint8Array(e));var n;return e instanceof Uint8Array?n=$(e):n=e,K(n,t)}function it(e,t,n,r){function s(){try{var e=rt(i.response);n(e)}catch(t){r(t)}}var i=new XMLHttpRequest;i.addEventListener("load",s,!0),i.addEventListener("error",r,!0),i.responseType="arraybuffer",i.open("GET",t+e.toUpperCase()),i.send()}function st(e,t,n){it(e,et,t,n)}function ot(e,t,n){it(e,tt,t,n)}var o=["mmtfVersion","mmtfProducer","unitCell","spaceGroup","structureId","title","depositionDate","releaseDate","experimentalMethods","resolution","rFree","rWork","bioAssemblyList","ncsOperatorList","entityList","groupList","numBonds","numAtoms","numGroups","numChains","numModels","groupsPerChain","chainsPerModel"],u=["xCoordList","yCoordList","zCoordList","groupIdList","groupTypeList","chainIdList","bFactorList","atomIdList","altLocList","occupancyList","secStructList","insCodeList","sequenceIndexList","chainNameList","bondAtomList","bondOrderList"],a=o.concat(u),Y="v1.0.0",Z="http://mmtf.rcsb.org/v1.0/",et=Z+"full/",tt=Z+"reduced/";e.encode=nt,e.decode=rt,e.traverse=G,e.fetch=st,e.fetchReduced=ot,e.version=Y,e.fetchUrl=et,e.fetchReducedUrl=tt,e.encodeMsgpack=s,e.encodeMmtf=V,e.decodeMsgpack=$,e.decodeMmtf=K,Object.defineProperty(e,"__esModule",{value:!0})}),function(e){if(typeof exports=="object"&&typeof module!="undefined")module.exports=e();else if(typeof define=="function"&&define.amd)define("pako",[],e);else{var t;typeof window!="undefined"?t=window:typeof global!="undefined"?t=global:typeof self!="undefined"?t=self:t=this,t.pako=e()}}(function(){var e,t,n;return function r(e,t,n){function i(o,u){if(!t[o]){if(!e[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(s)return s(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=t[o]={exports:{}};e[o][0].call(l.exports,function(t){var n=e[o][1][t];return i(n?n:t)},l,l.exports,r,e,t,n)}return t[o].exports}var s=typeof require=="function"&&require;for(var o=0;o<n.length;o++)i(n[o]);return i}({1:[function(e,t,n){"use strict";var r=typeof Uint8Array!="undefined"&&typeof Uint16Array!="undefined"&&typeof Int32Array!="undefined";n.assign=function(e){var t=Array.prototype.slice.call(arguments,1);while(t.length){var n=t.shift();if(!n)continue;if(typeof n!="object")throw new TypeError(n+"must be non-object");for(var r in n)n.hasOwnProperty(r)&&(e[r]=n[r])}return e},n.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var i={arraySet:function(e,t,n,r,i){if(t.subarray&&e.subarray){e.set(t.subarray(n,n+r),i);return}for(var s=0;s<r;s++)e[i+s]=t[n+s]},flattenChunks:function(e){var t,n,r,i,s,o;r=0;for(t=0,n=e.length;t<n;t++)r+=e[t].length;o=new Uint8Array(r),i=0;for(t=0,n=e.length;t<n;t++)s=e[t],o.set(s,i),i+=s.length;return o}},s={arraySet:function(e,t,n,r,i){for(var s=0;s<r;s++)e[i+s]=t[n+s]},flattenChunks:function(e){return[].concat.apply([],e)}};n.setTyped=function(e){e?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,i)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,s))},n.setTyped(r)},{}],2:[function(e,t,n){"use strict";function f(e,t){if(t<65537)if(e.subarray&&s||!e.subarray&&i)return String.fromCharCode.apply(null,r.shrinkBuf(e,t));var n="";for(var o=0;o<t;o++)n+=String.fromCharCode(e[o]);return n}var r=e("./common"),i=!0,s=!0;try{String.fromCharCode.apply(null,[0])}catch(o){i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(o){s=!1}var u=new r.Buf8(256);for(var a=0;a<256;a++)u[a]=a>=252?6:a>=248?5:a>=240?4:a>=224?3:a>=192?2:1;u[254]=u[254]=1,n.string2buf=function(e){var t,n,i,s,o,u=e.length,a=0;for(s=0;s<u;s++)n=e.charCodeAt(s),(n&64512)===55296&&s+1<u&&(i=e.charCodeAt(s+1),(i&64512)===56320&&(n=65536+(n-55296<<10)+(i-56320),s++)),a+=n<128?1:n<2048?2:n<65536?3:4;t=new r.Buf8(a);for(o=0,s=0;o<a;s++)n=e.charCodeAt(s),(n&64512)===55296&&s+1<u&&(i=e.charCodeAt(s+1),(i&64512)===56320&&(n=65536+(n-55296<<10)+(i-56320),s++)),n<128?t[o++]=n:n<2048?(t[o++]=192|n>>>6,t[o++]=128|n&63):n<65536?(t[o++]=224|n>>>12,t[o++]=128|n>>>6&63,t[o++]=128|n&63):(t[o++]=240|n>>>18,t[o++]=128|n>>>12&63,t[o++]=128|n>>>6&63,t[o++]=128|n&63);return t},n.buf2binstring=function(e){return f(e,e.length)},n.binstring2buf=function(e){var t=new r.Buf8(e.length);for(var n=0,i=t.length;n<i;n++)t[n]=e.charCodeAt(n);return t},n.buf2string=function(e,t){var n,r,i,s,o=t||e.length,a=new Array(o*2);for(r=0,n=0;n<o;){i=e[n++];if(i<128){a[r++]=i;continue}s=u[i];if(s>4){a[r++]=65533,n+=s-1;continue}i&=s===2?31:s===3?15:7;while(s>1&&n<o)i=i<<6|e[n++]&63,s--;if(s>1){a[r++]=65533;continue}i<65536?a[r++]=i:(i-=65536,a[r++]=55296|i>>10&1023,a[r++]=56320|i&1023)}return f(a,r)},n.utf8border=function(e,t){var n;t=t||e.length,t>e.length&&(t=e.length),n=t-1;while(n>=0&&(e[n]&192)===128)n--;return n<0?t:n===0?t:n+u[e[n]]>t?n:t}},{"./common":1}],3:[function(e,t,n){"use strict";function r(e,t,n,r){var i=e&65535|0,s=e>>>16&65535|0,o=0;while(n!==0){o=n>2e3?2e3:n,n-=o;do i=i+t[r++]|0,s=s+i|0;while(--o);i%=65521,s%=65521}return i|s<<16|0}t.exports=r},{}],4:[function(e,t,n){t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],5:[function(e,t,n){"use strict";function r(){var e,t=[];for(var n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=e&1?3988292384^e>>>1:e>>>1;t[n]=e}return t}function s(e,t,n,r){var s=i,o=r+n;e^=-1;for(var u=r;u<o;u++)e=e>>>8^s[(e^t[u])&255];return e^-1}var i=r();t.exports=s},{}],6:[function(e,t,n){"use strict";function r(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}t.exports=r},{}],7:[function(e,t,n){"use strict";var r=30,i=12;t.exports=function(t,n){var s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A;s=t.state,o=t.next_in,L=t.input,u=o+(t.avail_in-5),a=t.next_out,A=t.output,f=a-(n-t.avail_out),l=a+(t.avail_out-257),c=s.dmax,h=s.wsize,p=s.whave,d=s.wnext,v=s.window,m=s.hold,g=s.bits,y=s.lencode,b=s.distcode,w=(1<<s.lenbits)-1,E=(1<<s.distbits)-1;e:do{g<15&&(m+=L[o++]<<g,g+=8,m+=L[o++]<<g,g+=8),S=y[m&w];t:for(;;){x=S>>>24,m>>>=x,g-=x,x=S>>>16&255;if(x===0)A[a++]=S&65535;else{if(!(x&16)){if((x&64)===0){S=y[(S&65535)+(m&(1<<x)-1)];continue t}if(x&32){s.mode=i;break e}t.msg="invalid literal/length code",s.mode=r;break e}T=S&65535,x&=15,x&&(g<x&&(m+=L[o++]<<g,g+=8),T+=m&(1<<x)-1,m>>>=x,g-=x),g<15&&(m+=L[o++]<<g,g+=8,m+=L[o++]<<g,g+=8),S=b[m&E];n:for(;;){x=S>>>24,m>>>=x,g-=x,x=S>>>16&255;if(!(x&16)){if((x&64)===0){S=b[(S&65535)+(m&(1<<x)-1)];continue n}t.msg="invalid distance code",s.mode=r;break e}N=S&65535,x&=15,g<x&&(m+=L[o++]<<g,g+=8,g<x&&(m+=L[o++]<<g,g+=8)),N+=m&(1<<x)-1;if(N>c){t.msg="invalid distance too far back",s.mode=r;break e}m>>>=x,g-=x,x=a-f;if(N>x){x=N-x;if(x>p&&s.sane){t.msg="invalid distance too far back",s.mode=r;break e}C=0,k=v;if(d===0){C+=h-x;if(x<T){T-=x;do A[a++]=v[C++];while(--x);C=a-N,k=A}}else if(d<x){C+=h+d-x,x-=d;if(x<T){T-=x;do A[a++]=v[C++];while(--x);C=0;if(d<T){x=d,T-=x;do A[a++]=v[C++];while(--x);C=a-N,k=A}}}else{C+=d-x;if(x<T){T-=x;do A[a++]=v[C++];while(--x);C=a-N,k=A}}while(T>2)A[a++]=k[C++],A[a++]=k[C++],A[a++]=k[C++],T-=3;T&&(A[a++]=k[C++],T>1&&(A[a++]=k[C++]))}else{C=a-N;do A[a++]=A[C++],A[a++]=A[C++],A[a++]=A[C++],T-=3;while(T>2);T&&(A[a++]=A[C++],T>1&&(A[a++]=A[C++]))}break}}break}}while(o<u&&a<l);T=g>>3,o-=T,g-=T<<3,m&=(1<<g)-1,t.next_in=o,t.next_out=a,t.avail_in=o<u?5+(u-o):5-(o-u),t.avail_out=a<l?257+(l-a):257-(a-l),s.hold=m,s.bits=g;return}},{}],8:[function(e,t,n){"use strict";function it(e){return(e>>>24&255)+(e>>>8&65280)+((e&65280)<<8)+((e&255)<<24)}function st(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function ot(e){var t;return!e||!e.state?g:(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=t.wrap&1),t.mode=S,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new r.Buf32(et),t.distcode=t.distdyn=new r.Buf32(tt),t.sane=1,t.back=-1,d)}function ut(e){var t;return!e||!e.state?g:(t=e.state,t.wsize=0,t.whave=0,t.wnext=0,ot(e))}function at(e,t){var n,r;return!e||!e.state?g:(r=e.state,t<0?(n=0,t=-t):(n=(t>>4)+1,t<48&&(t&=15)),t&&(t<8||t>15)?g:(r.window!==null&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,ut(e)))}function ft(e,t){var n,r;return e?(r=new st,e.state=r,r.window=null,n=at(e,t),n!==d&&(e.state=null),n):g}function lt(e){return ft(e,rt)}function dt(e){if(ct){var t;ht=new r.Buf32(512),pt=new r.Buf32(32),t=0;while(t<144)e.lens[t++]=8;while(t<256)e.lens[t++]=9;while(t<280)e.lens[t++]=7;while(t<288)e.lens[t++]=8;u(f,e.lens,0,288,ht,0,e.work,{bits:9}),t=0;while(t<32)e.lens[t++]=5;u(l,e.lens,0,32,pt,0,e.work,{bits:5}),ct=!1}e.lencode=ht,e.lenbits=9,e.distcode=pt,e.distbits=5}function vt(e,t,n,i){var s,o=e.state;return o.window===null&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new r.Buf8(o.wsize)),i>=o.wsize?(r.arraySet(o.window,t,n-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):(s=o.wsize-o.wnext,s>i&&(s=i),r.arraySet(o.window,t,n-i,s,o.wnext),i-=s,i?(r.arraySet(o.window,t,n-i,i,0),o.wnext=i,o.whave=o.wsize):(o.wnext+=s,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=s))),0}function mt(e,t){var n,et,tt,nt,rt,st,ot,ut,at,ft,lt,ct,ht,pt,mt=0,gt,yt,bt,wt,Et,St,xt,Tt,Nt=new r.Buf8(4),Ct,kt,Lt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&e.avail_in!==0)return g;n=e.state,n.mode===D&&(n.mode=P),rt=e.next_out,tt=e.output,ot=e.avail_out,nt=e.next_in,et=e.input,st=e.avail_in,ut=n.hold,at=n.bits,ft=st,lt=ot,Tt=d;e:for(;;)switch(n.mode){case S:if(n.wrap===0){n.mode=P;break}while(at<16){if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}if(n.wrap&2&&ut===35615){n.check=0,Nt[0]=ut&255,Nt[1]=ut>>>8&255,n.check=s(n.check,Nt,2,0),ut=0,at=0,n.mode=x;break}n.flags=0,n.head&&(n.head.done=!1);if(!(n.wrap&1)||(((ut&255)<<8)+(ut>>8))%31){e.msg="incorrect header check",n.mode=G;break}if((ut&15)!==E){e.msg="unknown compression method",n.mode=G;break}ut>>>=4,at-=4,xt=(ut&15)+8;if(n.wbits===0)n.wbits=xt;else if(xt>n.wbits){e.msg="invalid window size",n.mode=G;break}n.dmax=1<<xt,e.adler=n.check=1,n.mode=ut&512?M:D,ut=0,at=0;break;case x:while(at<16){if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}n.flags=ut;if((n.flags&255)!==E){e.msg="unknown compression method",n.mode=G;break}if(n.flags&57344){e.msg="unknown header flags set",n.mode=G;break}n.head&&(n.head.text=ut>>8&1),n.flags&512&&(Nt[0]=ut&255,Nt[1]=ut>>>8&255,n.check=s(n.check,Nt,2,0)),ut=0,at=0,n.mode=T;case T:while(at<32){if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}n.head&&(n.head.time=ut),n.flags&512&&(Nt[0]=ut&255,Nt[1]=ut>>>8&255,Nt[2]=ut>>>16&255,Nt[3]=ut>>>24&255,n.check=s(n.check,Nt,4,0)),ut=0,at=0,n.mode=N;case N:while(at<16){if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}n.head&&(n.head.xflags=ut&255,n.head.os=ut>>8),n.flags&512&&(Nt[0]=ut&255,Nt[1]=ut>>>8&255,n.check=s(n.check,Nt,2,0)),ut=0,at=0,n.mode=C;case C:if(n.flags&1024){while(at<16){if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}n.length=ut,n.head&&(n.head.extra_len=ut),n.flags&512&&(Nt[0]=ut&255,Nt[1]=ut>>>8&255,n.check=s(n.check,Nt,2,0)),ut=0,at=0}else n.head&&(n.head.extra=null);n.mode=k;case k:if(n.flags&1024){ct=n.length,ct>st&&(ct=st),ct&&(n.head&&(xt=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),r.arraySet(n.head.extra,et,nt,ct,xt)),n.flags&512&&(n.check=s(n.check,et,ct,nt)),st-=ct,nt+=ct,n.length-=ct);if(n.length)break e}n.length=0,n.mode=L;case L:if(n.flags&2048){if(st===0)break e;ct=0;do xt=et[nt+ct++],n.head&&xt&&n.length<65536&&(n.head.name+=String.fromCharCode(xt));while(xt&&ct<st);n.flags&512&&(n.check=s(n.check,et,ct,nt)),st-=ct,nt+=ct;if(xt)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=A;case A:if(n.flags&4096){if(st===0)break e;ct=0;do xt=et[nt+ct++],n.head&&xt&&n.length<65536&&(n.head.comment+=String.fromCharCode(xt));while(xt&&ct<st);n.flags&512&&(n.check=s(n.check,et,ct,nt)),st-=ct,nt+=ct;if(xt)break e}else n.head&&(n.head.comment=null);n.mode=O;case O:if(n.flags&512){while(at<16){if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}if(ut!==(n.check&65535)){e.msg="header crc mismatch",n.mode=G;break}ut=0,at=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=D;break;case M:while(at<32){if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}e.adler=n.check=it(ut),ut=0,at=0,n.mode=_;case _:if(n.havedict===0)return e.next_out=rt,e.avail_out=ot,e.next_in=nt,e.avail_in=st,n.hold=ut,n.bits=at,m;e.adler=n.check=1,n.mode=D;case D:if(t===h||t===p)break e;case P:if(n.last){ut>>>=at&7,at-=at&7,n.mode=J;break}while(at<3){if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}n.last=ut&1,ut>>>=1,at-=1;switch(ut&3){case 0:n.mode=H;break;case 1:dt(n),n.mode=R;if(t===p){ut>>>=2,at-=2;break e}break;case 2:n.mode=F;break;case 3:e.msg="invalid block type",n.mode=G}ut>>>=2,at-=2;break;case H:ut>>>=at&7,at-=at&7;while(at<32){if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}if((ut&65535)!==(ut>>>16^65535)){e.msg="invalid stored block lengths",n.mode=G;break}n.length=ut&65535,ut=0,at=0,n.mode=B;if(t===p)break e;case B:n.mode=j;case j:ct=n.length;if(ct){ct>st&&(ct=st),ct>ot&&(ct=ot);if(ct===0)break e;r.arraySet(tt,et,nt,ct,rt),st-=ct,nt+=ct,ot-=ct,rt+=ct,n.length-=ct;break}n.mode=D;break;case F:while(at<14){if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}n.nlen=(ut&31)+257,ut>>>=5,at-=5,n.ndist=(ut&31)+1,ut>>>=5,at-=5,n.ncode=(ut&15)+4,ut>>>=4,at-=4;if(n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=G;break}n.have=0,n.mode=I;case I:while(n.have<n.ncode){while(at<3){if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}n.lens[Lt[n.have++]]=ut&7,ut>>>=3,at-=3}while(n.have<19)n.lens[Lt[n.have++]]=0;n.lencode=n.lendyn,n.lenbits=7,Ct={bits:n.lenbits},Tt=u(a,n.lens,0,19,n.lencode,0,n.work,Ct),n.lenbits=Ct.bits;if(Tt){e.msg="invalid code lengths set",n.mode=G;break}n.have=0,n.mode=q;case q:while(n.have<n.nlen+n.ndist){for(;;){mt=n.lencode[ut&(1<<n.lenbits)-1],gt=mt>>>24,yt=mt>>>16&255,bt=mt&65535;if(gt<=at)break;if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}if(bt<16)ut>>>=gt,at-=gt,n.lens[n.have++]=bt;else{if(bt===16){kt=gt+2;while(at<kt){if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}ut>>>=gt,at-=gt;if(n.have===0){e.msg="invalid bit length repeat",n.mode=G;break}xt=n.lens[n.have-1],ct=3+(ut&3),ut>>>=2,at-=2}else if(bt===17){kt=gt+3;while(at<kt){if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}ut>>>=gt,at-=gt,xt=0,ct=3+(ut&7),ut>>>=3,at-=3}else{kt=gt+7;while(at<kt){if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}ut>>>=gt,at-=gt,xt=0,ct=11+(ut&127),ut>>>=7,at-=7}if(n.have+ct>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=G;break}while(ct--)n.lens[n.have++]=xt}}if(n.mode===G)break;if(n.lens[256]===0){e.msg="invalid code -- missing end-of-block",n.mode=G;break}n.lenbits=9,Ct={bits:n.lenbits},Tt=u(f,n.lens,0,n.nlen,n.lencode,0,n.work,Ct),n.lenbits=Ct.bits;if(Tt){e.msg="invalid literal/lengths set",n.mode=G;break}n.distbits=6,n.distcode=n.distdyn,Ct={bits:n.distbits},Tt=u(l,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,Ct),n.distbits=Ct.bits;if(Tt){e.msg="invalid distances set",n.mode=G;break}n.mode=R;if(t===p)break e;case R:n.mode=U;case U:if(st>=6&&ot>=258){e.next_out=rt,e.avail_out=ot,e.next_in=nt,e.avail_in=st,n.hold=ut,n.bits=at,o(e,lt),rt=e.next_out,tt=e.output,ot=e.avail_out,nt=e.next_in,et=e.input,st=e.avail_in,ut=n.hold,at=n.bits,n.mode===D&&(n.back=-1);break}n.back=0;for(;;){mt=n.lencode[ut&(1<<n.lenbits)-1],gt=mt>>>24,yt=mt>>>16&255,bt=mt&65535;if(gt<=at)break;if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}if(yt&&(yt&240)===0){wt=gt,Et=yt,St=bt;for(;;){mt=n.lencode[St+((ut&(1<<wt+Et)-1)>>wt)],gt=mt>>>24,yt=mt>>>16&255,bt=mt&65535;if(wt+gt<=at)break;if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}ut>>>=wt,at-=wt,n.back+=wt}ut>>>=gt,at-=gt,n.back+=gt,n.length=bt;if(yt===0){n.mode=$;break}if(yt&32){n.back=-1,n.mode=D;break}if(yt&64){e.msg="invalid literal/length code",n.mode=G;break}n.extra=yt&15,n.mode=z;case z:if(n.extra){kt=n.extra;while(at<kt){if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}n.length+=ut&(1<<n.extra)-1,ut>>>=n.extra,at-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=W;case W:for(;;){mt=n.distcode[ut&(1<<n.distbits)-1],gt=mt>>>24,yt=mt>>>16&255,bt=mt&65535;if(gt<=at)break;if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}if((yt&240)===0){wt=gt,Et=yt,St=bt;for(;;){mt=n.distcode[St+((ut&(1<<wt+Et)-1)>>wt)],gt=mt>>>24,yt=mt>>>16&255,bt=mt&65535;if(wt+gt<=at)break;if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}ut>>>=wt,at-=wt,n.back+=wt}ut>>>=gt,at-=gt,n.back+=gt;if(yt&64){e.msg="invalid distance code",n.mode=G;break}n.offset=bt,n.extra=yt&15,n.mode=X;case X:if(n.extra){kt=n.extra;while(at<kt){if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}n.offset+=ut&(1<<n.extra)-1,ut>>>=n.extra,at-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=G;break}n.mode=V;case V:if(ot===0)break e;ct=lt-ot;if(n.offset>ct){ct=n.offset-ct;if(ct>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=G;break}ct>n.wnext?(ct-=n.wnext,ht=n.wsize-ct):ht=n.wnext-ct,ct>n.length&&(ct=n.length),pt=n.window}else pt=tt,ht=rt-n.offset,ct=n.length;ct>ot&&(ct=ot),ot-=ct,n.length-=ct;do tt[rt++]=pt[ht++];while(--ct);n.length===0&&(n.mode=U);break;case $:if(ot===0)break e;tt[rt++]=n.length,ot--,n.mode=U;break;case J:if(n.wrap){while(at<32){if(st===0)break e;st--,ut|=et[nt++]<<at,at+=8}lt-=ot,e.total_out+=lt,n.total+=lt,lt&&(e.adler=n.check=n.flags?s(n.check,tt,lt,rt-lt):i(n.check,tt,lt,rt-lt)),lt=ot;if((n.flags?ut:it(ut))!==n.check){e.msg="incorrect data check",n.mode=G;break}ut=0,at=0}n.mode=K;case K:if(n.wrap&&n.flags){while(at<32){if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}if(ut!==(n.total&4294967295)){e.msg="incorrect length check",n.mode=G;break}ut=0,at=0}n.mode=Q;case Q:Tt=v;break e;case G:Tt=y;break e;case Y:return b;case Z:default:return g}e.next_out=rt,e.avail_out=ot,e.next_in=nt,e.avail_in=st,n.hold=ut,n.bits=at;if(n.wsize||lt!==e.avail_out&&n.mode<G&&(n.mode<J||t!==c))if(vt(e,e.output,e.next_out,lt-e.avail_out))return n.mode=Y,b;return ft-=e.avail_in,lt-=e.avail_out,e.total_in+=ft,e.total_out+=lt,n.total+=lt,n.wrap&&lt&&(e.adler=n.check=n.flags?s(n.check,tt,lt,e.next_out-lt):i(n.check,tt,lt,e.next_out-lt)),e.data_type=n.bits+(n.last?64:0)+(n.mode===D?128:0)+(n.mode===R||n.mode===B?256:0),(ft===0&&lt===0||t===c)&&Tt===d&&(Tt=w),Tt}function gt(e){if(!e||!e.state)return g;var t=e.state;return t.window&&(t.window=null),e.state=null,d}function yt(e,t){var n;return!e||!e.state?g:(n=e.state,(n.wrap&2)===0?g:(n.head=t,t.done=!1,d))}var r=e("../utils/common"),i=e("./adler32"),s=e("./crc32"),o=e("./inffast"),u=e("./inftrees"),a=0,f=1,l=2,c=4,h=5,p=6,d=0,v=1,m=2,g=-2,y=-3,b=-4,w=-5,E=8,S=1,x=2,T=3,N=4,C=5,k=6,L=7,A=8,O=9,M=10,_=11,D=12,P=13,H=14,B=15,j=16,F=17,I=18,q=19,R=20,U=21,z=22,W=23,X=24,V=25,$=26,J=27,K=28,Q=29,G=30,Y=31,Z=32,et=852,tt=592,nt=15,rt=nt,ct=!0,ht,pt;n.inflateReset=ut,n.inflateReset2=at,n.inflateResetKeep=ot,n.inflateInit=lt,n.inflateInit2=ft,n.inflate=mt,n.inflateEnd=gt,n.inflateGetHeader=yt,n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":1,"./adler32":3,"./crc32":5,"./inffast":7,"./inftrees":9}],9:[function(e,t,n){"use strict";var r=e("../utils/common"),i=15,s=852,o=592,u=0,a=1,f=2,l=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],c=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],h=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],p=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(t,n,d,v,m,g,y,b){var w=b.bits,E=0,S=0,x=0,T=0,N=0,C=0,k=0,L=0,A=0,O=0,M,_,D,P,H,B=null,j=0,F,I=new r.Buf16(i+1),q=new r.Buf16(i+1),R=null,U=0,z,W,X;for(E=0;E<=i;E++)I[E]=0;for(S=0;S<v;S++)I[n[d+S]]++;N=w;for(T=i;T>=1;T--)if(I[T]!==0)break;N>T&&(N=T);if(T===0)return m[g++]=20971520,m[g++]=20971520,b.bits=1,0;for(x=1;x<T;x++)if(I[x]!==0
)break;N<x&&(N=x),L=1;for(E=1;E<=i;E++){L<<=1,L-=I[E];if(L<0)return-1}if(L>0&&(t===u||T!==1))return-1;q[1]=0;for(E=1;E<i;E++)q[E+1]=q[E]+I[E];for(S=0;S<v;S++)n[d+S]!==0&&(y[q[n[d+S]]++]=S);t===u?(B=R=y,F=19):t===a?(B=l,j-=257,R=c,U-=257,F=256):(B=h,R=p,F=-1),O=0,S=0,E=x,H=g,C=N,k=0,D=-1,A=1<<N,P=A-1;if(t===a&&A>s||t===f&&A>o)return 1;var V=0;for(;;){V++,z=E-k,y[S]<F?(W=0,X=y[S]):y[S]>F?(W=R[U+y[S]],X=B[j+y[S]]):(W=96,X=0),M=1<<E-k,_=1<<C,x=_;do _-=M,m[H+(O>>k)+_]=z<<24|W<<16|X|0;while(_!==0);M=1<<E-1;while(O&M)M>>=1;M!==0?(O&=M-1,O+=M):O=0,S++;if(--I[E]===0){if(E===T)break;E=n[d+y[S]]}if(E>N&&(O&P)!==D){k===0&&(k=N),H+=x,C=E-k,L=1<<C;while(C+k<T){L-=I[C+k];if(L<=0)break;C++,L<<=1}A+=1<<C;if(t===a&&A>s||t===f&&A>o)return 1;D=O&P,m[D]=N<<24|C<<16|H-g|0}}return O!==0&&(m[H+O]=E-k<<24|64<<16|0),b.bits=N,0}},{"../utils/common":1}],10:[function(e,t,n){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],11:[function(e,t,n){"use strict";function r(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}t.exports=r},{}],"/lib/inflate.js":[function(e,t,n){"use strict";function h(e,t){var n=new c(t);n.push(e,!0);if(n.err)throw n.msg;return n.result}function p(e,t){return t=t||{},t.raw=!0,h(e,t)}var r=e("./zlib/inflate.js"),i=e("./utils/common"),s=e("./utils/strings"),o=e("./zlib/constants"),u=e("./zlib/messages"),a=e("./zlib/zstream"),f=e("./zlib/gzheader"),l=Object.prototype.toString,c=function(e){this.options=i.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),t.windowBits>=0&&t.windowBits<16&&(!e||!e.windowBits)&&(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(t.windowBits&15)===0&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new a,this.strm.avail_out=0;var n=r.inflateInit2(this.strm,t.windowBits);if(n!==o.Z_OK)throw new Error(u[n]);this.header=new f,r.inflateGetHeader(this.strm,this.header)};c.prototype.push=function(e,t){var n=this.strm,u=this.options.chunkSize,a,f,c,h,p;if(this.ended)return!1;f=t===~~t?t:t===!0?o.Z_FINISH:o.Z_NO_FLUSH,typeof e=="string"?n.input=s.binstring2buf(e):l.call(e)==="[object ArrayBuffer]"?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;do{n.avail_out===0&&(n.output=new i.Buf8(u),n.next_out=0,n.avail_out=u),a=r.inflate(n,o.Z_NO_FLUSH);if(a!==o.Z_STREAM_END&&a!==o.Z_OK)return this.onEnd(a),this.ended=!0,!1;n.next_out&&(n.avail_out===0||a===o.Z_STREAM_END||n.avail_in===0&&(f===o.Z_FINISH||f===o.Z_SYNC_FLUSH))&&(this.options.to==="string"?(c=s.utf8border(n.output,n.next_out),h=n.next_out-c,p=s.buf2string(n.output,c),n.next_out=h,n.avail_out=u-h,h&&i.arraySet(n.output,n.output,c,h,0),this.onData(p)):this.onData(i.shrinkBuf(n.output,n.next_out)))}while(n.avail_in>0&&a!==o.Z_STREAM_END);return a===o.Z_STREAM_END&&(f=o.Z_FINISH),f===o.Z_FINISH?(a=r.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,a===o.Z_OK):f===o.Z_SYNC_FLUSH?(this.onEnd(o.Z_OK),n.avail_out=0,!0):!0},c.prototype.onData=function(e){this.chunks.push(e)},c.prototype.onEnd=function(e){e===o.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},n.Inflate=c,n.inflate=h,n.inflateRaw=p,n.ungzip=h},{"./utils/common":1,"./utils/strings":2,"./zlib/constants":4,"./zlib/gzheader":6,"./zlib/inflate.js":8,"./zlib/messages":10,"./zlib/zstream":11}]},{},[])("/lib/inflate.js")}),$3Dmol=function(e){var t=e.$3Dmol||{};return t}(window),typeof module=="object"&&typeof module.exports=="object"&&(module.exports=$3Dmol),$.get("https://3dmol.csb.pitt.edu/track/report.cgi"),String.prototype.startsWith||(String.prototype.startsWith=function(e){return this.lastIndexOf(e,0)===0}),String.prototype.endsWith||(String.prototype.endsWith=function(e){return this.indexOf(e,this.length-e.length)!==-1}),$.ajaxTransport("+binary",function(e,t,n){if(window.FormData&&(e.dataType&&e.dataType=="binary"||e.data&&(window.ArrayBuffer&&e.data instanceof ArrayBuffer||window.Blob&&e.data instanceof Blob)))return{send:function(t,n){var r=new XMLHttpRequest,i=e.url,s=e.type,o=e.async||!0,u=e.responseType||"blob",a=e.data||null,f=e.username||null,l=e.password||null;r.addEventListener("load",function(){var t={};t[e.dataType]=r.response,n(r.status,r.statusText,t,r.getAllResponseHeaders())}),r.open(s,i,o,f,l);for(var c in t)r.setRequestHeader(c,t[c]);r.responseType=u,r.send(a)},abort:function(){n.abort()}}}),$3Dmol.createViewer=function(e,t){$.type(e)==="string"&&(e=$("#"+e));if(!e)return;t=t||{};try{return new $3Dmol.GLViewer(e,t)}catch(n){throw"error creating viewer: "+n}return null},$3Dmol.viewers={},$3Dmol.getbin=function(e,t){$.ajax({url:e,type:"GET",dataType:"binary",responseType:"arraybuffer",processData:!1}).done(function(e,n,r){t(e)}).fail(function(e,t){console.log(t)})},$3Dmol.download=function(e,t,n,r){var i="",s="",o="",u="",a=t.addModel();if(e.substr(0,5)==="mmtf:"){o=n&&n.pdbUri?n.pdbUri:"https://mmtf.rcsb.org/v1.0/full/",e=e.substr(5).toUpperCase();var f=o+e;n&&typeof n.noComputeSecondaryStructure=="undefined"&&(n.noComputeSecondaryStructure=!0),$3Dmol.getbin(f,function(e){a.addMolData(e,"mmtf",n),t.zoomTo(),t.render(),r&&r(a)})}else{if(e.substr(0,4)==="pdb:"){s="mmtf",n&&n.format&&(s=n.format),n&&typeof n.noComputeSecondaryStructure=="undefined"&&(n.noComputeSecondaryStructure=!0),e=e.substr(4).toUpperCase();if(!e.match(/^[1-9][A-Za-z0-9]{3}$/)){alert("Wrong PDB ID");return}s=="mmtf"?(u=n&&n.mmtfUri?n.mmtfUri:"https://mmtf.rcsb.org/v1.0/full/",f=u+e.toUpperCase()):(o=n&&n.pdbUri?n.pdbUri:"https://files.rcsb.org/view/",f=o+e+"."+s)}else if(e.substr(0,4)=="cid:"){s="sdf",e=e.substr(4);if(!e.match(/^[0-9]+$/)){alert("Wrong Compound ID");return}f="https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/"+e+"/SDF?record_type=3d"}else e.substr(0,4)=="url:"&&(f=e.substr(4),s=f);var l=function(e){a.addMolData(e,s,n),t.zoomTo(),t.render(),r&&r(a)};s=="mmtf"?$3Dmol.getbin(f,l):$.get(f,l).fail(function(e){console.log("fetch of "+f+" failed: "+e.statusText)})}return a},$3Dmol.SurfaceType={VDW:1,MS:2,SAS:3,SES:4},$3Dmol.mergeGeos=function(e,t){var n=t.geometry;if(n===undefined)return;e.geometryGroups.push(n.geometryGroups[0])},$3Dmol.multiLineString=function(e){return e.toString().replace(/^[^\/]+\/\*!?/,"").replace(/\*\/[^\/]+$/,"")},$3Dmol.syncSurface=!1;if(window.navigator.userAgent.indexOf("MSIE ")>=0||window.navigator.userAgent.indexOf("Trident/")>=0)$3Dmol.syncSurface=!0;$3Dmol.specStringToObject=function(e){if(typeof e=="object")return e;if(typeof e=="undefined"||e==null)return e;e=e.replace(/%7E/,"~");var t=function(e){return $.isNumeric(e)?Math.floor(parseFloat(e))==parseInt(e)?parseFloat(e):e.indexOf(".")>=0?parseFloat(e):parseInt(e):e==="true"?!0:e==="false"?!1:e},n={};if(e==="all")return n;var r=e.split(";");for(var i=0;i<r.length;i++){var s=r[i].split(":"),o=s[0],u={},a=s[1];if(a){a=a.replace(/~/g,"=");if(a.indexOf("=")!==-1){var f=a.split(",");for(var l=0;l<f.length;l++){var c=f[l].split("=",2);u[c[0]]=t(c[1])}}else a.indexOf(",")!==-1?u=a.split(","):u=t(a)}n[o]=u}return n},$3Dmol.getExtent=function(e,t){var n,r,i,s,o,u,a,f,l,c,h=!t;n=r=i=9999,s=o=u=-9999,a=f=l=c=0;if(e.length===0)return[[0,0,0],[0,0,0],[0,0,0]];for(var p=0;p<e.length;p++){var d=e[p];if(typeof d=="undefined"||!isFinite(d.x)||!isFinite(d.y)||!isFinite(d.z))continue;c++,a+=d.x,f+=d.y,l+=d.z,n=n<d.x?n:d.x,r=r<d.y?r:d.y,i=i<d.z?i:d.z,s=s>d.x?s:d.x,o=o>d.y?o:d.y,u=u>d.z?u:d.z;if(d.symmetries&&h)for(var v=0;v<d.symmetries.length;v++)c++,a+=d.symmetries[v].x,f+=d.symmetries[v].y,l+=d.symmetries[v].z,n=n<d.symmetries[v].x?n:d.symmetries[v].x,r=r<d.symmetries[v].y?r:d.symmetries[v].y,i=i<d.symmetries[v].z?i:d.symmetries[v].z,s=s>d.symmetries[v].x?s:d.symmetries[v].x,o=o>d.symmetries[v].y?o:d.symmetries[v].y,u=u>d.symmetries[v].z?u:d.symmetries[v].z}return[[n,r,i],[s,o,u],[a/c,f/c,l/c]]},$3Dmol.getAtomProperty=function(e,t){var n=null;return e.properties&&typeof e.properties[t]!="undefined"?n=e.properties[t]:typeof e[t]!="undefined"&&(n=e[t]),n},$3Dmol.getPropertyRange=function(e,t){var n=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY;for(var i=0,s=e.length;i<s;i++){var o=e[i],u=$3Dmol.getAtomProperty(o,t);u!=null&&(u<n&&(n=u),u>r&&(r=u))}return!isFinite(n)&&!isFinite(r)?n=r=0:isFinite(n)?isFinite(r)||(r=n):n=r,[n,r]},typeof define=="function"&&define.amd&&define("$3Dmol",$3Dmol);var $3Dmol=$3Dmol||{};$3Dmol.Math={clamp:function(e,t,n){return Math.min(Math.max(e,t),n)},degToRad:function(){var e=Math.PI/180;return function(t){return t*e}}()},$3Dmol.Quaternion=function(e,t,n,r){this.x=e||0,this.y=t||0,this.z=n||0,this.w=r!==undefined?r:1},$3Dmol.Quaternion.prototype={constructor:$3Dmol.Quaternion,set:function(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},conjugate:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},inverse:function(){return this.conjugate().normalize()},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var e=this.length();return e===0?(this.x=0,this.y=0,this.z=0,this.w=1):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this},multiply:function(e){return this.multiplyQuaternions(this,e)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},multiplyQuaternions:function(e,t){var n=e.x,r=e.y,i=e.z,s=e.w,o=t.x,u=t.y,a=t.z,f=t.w;return this.x=n*f+s*o+r*a-i*u,this.y=r*f+s*u+i*o-n*a,this.z=i*f+s*a+n*u-r*o,this.w=s*f-n*o-r*u-i*a,this},sub:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this},clone:function(){return new $3Dmol.Quaternion(this.x,this.y,this.z,this.w)}},$3Dmol.Vector2=function(e,t){this.x=e||0,this.y=t||0},$3Dmol.Vector2.prototype={constructor:$3Dmol.Vector2,set:function(e,t){return this.x=e,this.y=t,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},copy:function(e){return this.x=e.x,this.y=e.y,this},clone:function(){return new $3Dmol.Vector2(this.x,this.y)}},$3Dmol.Vector3=function(e,t,n){this.x=e||0,this.y=t||0,this.z=n||0},$3Dmol.Vector3.prototype={constructor:$3Dmol.Vector3,set:function(e,t,n){return this.x=e,this.y=t,this.z=n,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},sub:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},divideScalar:function(e){return e!==0?(this.x/=e,this.y/=e,this.z/=e):(this.x=0,this.y=0,this.z=0),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r},applyMatrix4:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r+i[12],this.y=i[1]*t+i[5]*n+i[9]*r+i[13],this.z=i[2]*t+i[6]*n+i[10]*r+i[14],this},applyProjection:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements,s=i[3]*t+i[7]*n+i[11]*r+i[15];return this.x=(i[0]*t+i[4]*n+i[8]*r+i[12])/s,this.y=(i[1]*t+i[5]*n+i[9]*r+i[13])/s,this.z=(i[2]*t+i[6]*n+i[10]*r+i[14])/s,this},applyQuaternion:function(e){var t=this.x,n=this.y,r=this.z,i=e.x,s=e.y,o=e.z,u=e.w,a={};a.x=2*(n*o-r*s),a.y=2*(r*i-t*o),a.z=2*(t*s-n*i);var f={};return f.x=a.y*o-a.z*s,f.y=a.z*i-a.x*o,f.z=a.x*s-a.y*i,this.x=t+e.w*a.x+f.x,this.y=n+e.w*a.y+f.y,this.z=r+e.w*a.z+f.z,this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},normalize:function(){return this.divideScalar(this.length())},cross:function(e){var t=this.x,n=this.y,r=this.z;return this.x=n*e.z-r*e.y,this.y=r*e.x-t*e.z,this.z=t*e.y-n*e.x,this},crossVectors:function(e,t){return this.x=e.y*t.z-e.z*t.y,this.y=e.z*t.x-e.x*t.z,this.z=e.x*t.y-e.y*t.x,this},getPositionFromMatrix:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this},setEulerFromRotationMatrix:function(e,t){var n=e.elements,r=n[0],i=n[4],s=n[8],o=n[1],u=n[5],a=n[9],f=n[2],l=n[6],c=n[10];return t===undefined||t==="XYZ"?(this.y=Math.asin($3Dmol.Math.clamp(s,-1,1)),Math.abs(s)<.99999?(this.x=Math.atan2(-a,c),this.z=Math.atan2(-i,r)):(this.x=Math.atan2(l,u),this.z=0)):console.error("Error with vector's setEulerFromRotationMatrix: Unknown order: "+t),this},rotateAboutVector:function(e,t){e.normalize();var n=Math.cos(t),r=Math.sin(t),i=this.clone().multiplyScalar(n),s=e.clone().cross(this).multiplyScalar(r),o=e.clone().multiplyScalar(e.clone().dot(this)).multiplyScalar(1-n),u=i.add(s).add(o);return this.x=u.x,this.y=u.y,this.z=u.z,this},clone:function(){return new $3Dmol.Vector3(this.x,this.y,this.z)}},$3Dmol.Matrix3=function(e,t,n,r,i,s,o,u,a){this.elements=new Float32Array(9),this.set(e!==undefined?e:1,t||0,n||0,r||0,i!==undefined?i:1,s||0,o||0,u||0,a!==undefined?a:1)},$3Dmol.Matrix3.prototype={constructor:$3Dmol.Matrix3,set:function(e,t,n,r,i,s,o,u,a){var f=this.elements;return f[0]=e,f[3]=t,f[6]=n,f[1]=r,f[4]=i,f[7]=s,f[2]=o,f[5]=u,f[8]=a,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},copy:function(e){var t=e.elements;this.set(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8])},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},getInverse:function(e,t){var n=e.elements,r=this.elements;r[0]=n[10]*n[5]-n[6]*n[9],r[1]=-n[10]*n[1]+n[2]*n[9],r[2]=n[6]*n[1]-n[2]*n[5],r[3]=-n[10]*n[4]+n[6]*n[8],r[4]=n[10]*n[0]-n[2]*n[8],r[5]=-n[6]*n[0]+n[2]*n[4],r[6]=n[9]*n[4]-n[5]*n[8],r[7]=-n[9]*n[0]+n[1]*n[8],r[8]=n[5]*n[0]-n[1]*n[4];var i=n[0]*r[0]+n[1]*r[3]+n[2]*r[6];if(i===0){var s="Matrix3.getInverse(): can't invert matrix, determinant is 0";if(t||!1)throw new Error(s);return console.warn(s),this.identity(),this}return this.multiplyScalar(1/i),this},getDeterminant:function(){var e=this.elements,t=e[0]*e[4]*e[8]+e[1]*e[5]*e[6]+e[2]*e[3]*e[7]-e[2]*e[4]*e[6]-e[1]*e[3]*e[8]-e[0]*e[5]*e[7];return t},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},clone:function(){var e=this.elements;return new $3Dmol.Matrix3(e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8])}},$3Dmol.Matrix4=function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){if(typeof t=="undefined"&&typeof e!="undefined")this.elements=new Float32Array(e);else{var m=this.elements=new Float32Array(16);m[0]=e!==undefined?e:1,m[4]=t||0,m[8]=n||0,m[12]=r||0,m[1]=i||0,m[5]=s!==undefined?s:1,m[9]=o||0,m[13]=u||0,m[2]=a||0,m[6]=f||0,m[10]=l!==undefined?l:1,m[14]=c||0,m[3]=h||0,m[7]=p||0,m[11]=d||0,m[15]=v!==undefined?v:1}},$3Dmol.Matrix4.prototype={constructor:$3Dmol.Matrix4,set:function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){var m=this.elements;return m[0]=e,m[4]=t,m[8]=n,m[12]=r,m[1]=i,m[5]=s,m[9]=o,m[13]=u,m[2]=a,m[6]=f,m[10]=l,m[14]=c,m[3]=h,m[7]=p,m[11]=d,m[15]=v,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15]),this},matrix3FromTopLeft:function(){var e=this.elements;return new $3Dmol.Matrix3(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10])},setRotationFromEuler:function(e,t){var n=this.elements,r=e.x,i=e.y,s=e.z,o=Math.cos(r),u=Math.sin(r),a=Math.cos(i),f=Math.sin(i),l=Math.cos(s),c=Math.sin(s);if(t===undefined||t==="XYZ"){var h=o*l,p=o*c,d=u*l,v=u*c;n[0]=a*l,n[4]=-a*c,n[8]=f,n[1]=p+d*f,n[5]=h-v*f,n[9]=-u*a,n[2]=v-h*f,n[6]=d+p*f,n[10]=o*a}else console.error("Error with matrix4 setRotationFromEuler. Order: "+t);return this},setRotationFromQuaternion:function(e){var t=this.elements,n=e.x,r=e.y,i=e.z,s=e.w,o=n+n,u=r+r,a=i+i,f=n*o,l=n*u,c=n*a,h=r*u,p=r*a,d=i*a,v=s*o,m=s*u,g=s*a;return t[0]=1-(h+d),t[4]=l-g,t[8]=c+m,t[1]=l+g,t[5]=1-(f+d),t[9]=p-v,t[2]=c-m,t[6]=p+v,t[10]=1-(f+h),this},lookAt:function(){var e=new $3Dmol.Vector3,t=new $3Dmol.Vector3,n=new $3Dmol.Vector3;return function(r,i,s){var o=this.elements;return n.subVectors(r,i).normalize(),n.length()===0&&(n.z=1),e.crossVectors(s,n).normalize(),e.length()===0&&(n.x+=1e-4,e.crossVectors(s,n).normalize()),t.crossVectors(n,e),o[0]=e.x,o[4]=t.x,o[8]=n.x,o[1]=e.y,o[5]=t.y,o[9]=n.y,o[2]=e.z,o[6]=t.z,o[10]=n.z,this}}(),multiplyMatrices:function(e,t){var n=e.elements,r=t.elements,i=this.elements,s=n[0],o=n[4],u=n[8],a=n[12],f=n[1],l=n[5],c=n[9],h=n[13],p=n[2],d=n[6],v=n[10],m=n[14],g=n[3],y=n[7],b=n[11],w=n[15],E=r[0],S=r[4],x=r[8],T=r[12],N=r[1],C=r[5],k=r[9],L=r[13],A=r[2],O=r[6],M=r[10],_=r[14],D=r[3],P=r[7],H=r[11],B=r[15];return i[0]=s*E+o*N+u*A+a*D,i[4]=s*S+o*C+u*O+a*P,i[8]=s*x+o*k+u*M+a*H,i[12]=s*T+o*L+u*_+a*B,i[1]=f*E+l*N+c*A+h*D,i[5]=f*S+l*C+c*O+h*P,i[9]=f*x+l*k+c*M+h*H,i[13]=f*T+l*L+c*_+h*B,i[2]=p*E+d*N+v*A+m*D,i[6]=p*S+d*C+v*O+m*P,i[10]=p*x+d*k+v*M+m*H,i[14]=p*T+d*L+v*_+m*B,i[3]=g*E+y*N+b*A+w*D,i[7]=g*S+y*C+b*O+w*P,i[11]=g*x+y*k+b*M+w*H,i[15]=g*T+y*L+b*_+w*B,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},makeTranslation:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this},transpose:function(){var e=this.elements,t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},getPosition:function(){var e=new $3Dmol.Vector3;return function(){console.warn("DEPRECATED: Matrix4's .getPosition() has been removed. Use Vector3.getPositionFromMatrix( matrix ) instead.");var t=this.elements;return e.set(t[12],t[13],t[14])}}(),setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var n=this.elements,r=e.elements,i=r[0],s=r[4],o=r[8],u=r[12],a=r[1],f=r[5],l=r[9],c=r[13],h=r[2],p=r[6],d=r[10],v=r[14],m=r[3],g=r[7],y=r[11],b=r[15];n[0]=l*v*g-c*d*g+c*p*y-f*v*y-l*p*b+f*d*b,n[4]=u*d*g-o*v*g-u*p*y+s*v*y+o*p*b-s*d*b,n[8]=o*c*g-u*l*g+u*f*y-s*c*y-o*f*b+s*l*b,n[12]=u*l*p-o*c*p-u*f*d+s*c*d+o*f*v-s*l*v,n[1]=c*d*m-l*v*m-c*h*y+a*v*y+l*h*b-a*d*b,n[5]=o*v*m-u*d*m+u*h*y-i*v*y-o*h*b+i*d*b,n[9]=u*l*m-o*c*m-u*a*y+i*c*y+o*a*b-i*l*b,n[13]=o*c*h-u*l*h+u*a*d-i*c*d-o*a*v+i*l*v,n[2]=f*v*m-c*p*m+c*h*g-a*v*g-f*h*b+a*p*b,n[6]=u*p*m-s*v*m-u*h*g+i*v*g+s*h*b-i*p*b,n[10]=s*c*m-u*f*m+u*a*g-i*c*g-s*a*b+i*f*b,n[14]=u*f*h-s*c*h-u*a*p+i*c*p+s*a*v-i*f*v,n[3]=l*p*m-f*d*m-l*h*g+a*d*g+f*h*y-a*p*y,n[7]=s*d*m-o*p*m+o*h*g-i*d*g-s*h*y+i*p*y,n[11]=o*f*m-s*l*m-o*a*g+i*l*g+s*a*y-i*f*y,n[15]=s*l*h-o*f*h+o*a*p-i*l*p-s*a*d+i*f*d;var w=r[0]*n[0]+r[1]*n[4]+r[2]*n[8]+r[3]*n[12];if(w===0){var E="Matrix4.getInverse(): can't invert matrix, determinant is 0";if(t||!1)throw new Error(E);return console.warn(E),this.identity(),this}return this.multiplyScalar(1/w),this},isReflected:function(){return this.matrix3FromTopLeft().getDeterminant()<0},compose:function(){var e=new $3Dmol.Matrix4,t=new $3Dmol.Matrix4;return function(n,r,i){var s=this.elements;return e.identity(),e.setRotationFromQuaternion(r),t.makeScale(i.x,i.y,i.z),this.multiplyMatrices(e,t),s[12]=n.x,s[13]=n.y,s[14]=n.z,this}}(),decompose:function(){var e=new $3Dmol.Vector3,t=new $3Dmol.Vector3,n=new $3Dmol.Vector3,r=new $3Dmol.Matrix4;return function(i,s,o){var u=this.elements;return e.set(u[0],u[1],u[2]),t.set(u[4],u[5],u[6]),n.set(u[8],u[9],u[10]),i=i instanceof $3Dmol.Vector3?i:new $3Dmol.Vector3,s=s instanceof $3Dmol.Quaternion?s:new $3Dmol.Quaternion,o=o instanceof $3Dmol.Vector3?o:new $3Dmol.Vector3,o.x=e.length(),o.y=t.length(),o.z=n.length(),i.x=u[12],i.y=u[13],i.z=u[14],r.copy(this),r.elements[0]/=o.x,r.elements[1]/=o.x,r.elements[2]/=o.x,r.elements[4]/=o.y,r.elements[5]/=o.y,r.elements[6]/=o.y,r.elements[8]/=o.z,r.elements[9]/=o.z,r.elements[10]/=o.z,s.setFromRotationMatrix(r),[i,s,o]}}(),scale:function(e){var t=this.elements,n=e.x,r=e.y,i=e.z;return t[0]*=n,t[4]*=r,t[8]*=i,t[1]*=n,t[5]*=r,t[9]*=i,t[2]*=n,t[6]*=r,t[10]*=i,t[3]*=n,t[7]*=r,t[11]*=i,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,Math.max(n,r)))},makeFrustum:function(e,t,n,r,i,s){var o=this.elements,u=2*i/(t-e),a=2*i/(r-n),f=(t+e)/(t-e),l=(r+n)/(r-n),c=-(s+i)/(s-i),h=-2*s*i/(s-i);return o[0]=u,o[4]=0,o[8]=f,o[12]=0,o[1]=0,o[5]=a,o[9]=l,o[13]=0,o[2]=0,o[6]=0,o[10]=c,o[14]=h,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},makePerspective:function(e,t,n,r){var i=n*Math.tan($3Dmol.Math.degToRad(e*.5)),s=-i,o=s*t,u=i*t;return this.makeFrustum(o,u,s,i,n,r)},makeOrthographic:function(e,t,n,r,i,s){var o=this.elements,u=1/(t-e),a=1/(n-r),f=1/(s-i),l=(t+e)*u,c=(n+r)*a,h=(s+i)*f;return o[0]=2*u,o[4]=0,o[8]=0,o[12]=-l,o[1]=0,o[5]=2*a,o[9]=0,o[13]=-c,o[2]=0,o[6]=0,o[10]=-2*f,o[14]=-h,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},isEqual:function(e){var t=e.elements,n=this.elements;return n[0]==t[0]&&n[4]==t[4]&&n[8]==t[8]&&n[12]==t[12]&&n[1]==t[1]&&n[5]==t[5]&&n[9]==t[9]&&n[13]==t[13]&&n[2]==t[2]&&n[6]==t[6]&&n[10]==t[10]&&n[14]==t[14]&&n[3]==t[3]&&n[7]==t[7]&&n[11]==t[11]&&n[15]==t[15]?!0:!1},clone:function(){var e=this.elements;return new $3Dmol.Matrix4(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15])},isIdentity:function(){var e=this.elements;return e[0]==1&&e[4]==0&&e[8]==0&&e[12]==0&&e[1]==0&&e[5]==1&&e[9]==0&&e[13]==0&&e[2]==0&&e[6]==0&&e[10]==1&&e[14]==0&&e[3]==0&&e[7]==0&&e[11]==0&&e[15]==1?!0:!1}},$3Dmol.Ray=function(e,t){this.origin=e!==undefined?e:new $3Dmol.Vector3,this.direction=t!==undefined?t:new $3Dmol.Vector3},$3Dmol.Ray.prototype={constructor:$3Dmol.Ray,set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){var n=t||new $3Dmol.Vector3;return n.copy(this.direction).multiplyScalar(e).add(this.origin)},recast:function(){var e=new $3Dmol.Vector3;return function(t){return this.origin.copy(this.at(t,e)),this}}(),closestPointToPoint:function(e,t){var n=t||new $3Dmol.Vector3;n.subVectors(e,this.origin);var r=n.dot(this.direction);return n.copy(this.direction).multiplyScalar(r).add(this.origin)},distanceToPoint:function(e){var t=new $3Dmol.Vector3;return function(e){var n=t.subVectors(e,this.origin).dot(this.direction);return t.copy(this.direction).multiplyScalar(n).add(this.origin),t.distanceTo(e)}}(),isIntersectionCylinder:function(){},isIntersectionSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},isIntersectionPlane:function(e){var t=e.normal.dot(this.direction);return t!==0?!0:e.distanceToPoint(this.origin)===0?!0:!1},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:undefined;var n=-(this.origin.dot(e.normal)+e.constant)/t;return n},intersectPlane:function(e,t){var n=this.distanceToPlane(e);return n===undefined?undefined:this.at(n,t)},applyMatrix4:function(e){return this.direction.add(this.origin).applyMatrix4(e),this.origin.applyMatrix4(e),this.direction.sub(this.origin),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)},clone:function(){return(new $3Dmol.Ray).copy(this)}},$3Dmol.Sphere=function(e,t){this.center=e!==undefined?e:new $3Dmol.Vector3,this.radius=t!==undefined?t:0},$3Dmol.Sphere.prototype={constructor:$3Dmol.Sphere,set:function(e,t){return this.center.copy(e),this.radius=t,this},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius},clone:function(){return(new $3Dmol.Sphere).copy(this)}},$3Dmol.Cylinder=function(e,t,n){this.c1=e!==undefined?e:new $3Dmol.Vector3,this.c2=t!==undefined?t:new $3Dmol.Vector3,this.direction=(new $3Dmol.Vector3).subVectors(this.c2,this.c1).normalize(),this.radius=n!==undefined?n:0},$3Dmol.Cylinder.prototype={constructor:$3Dmol.Cylinder,copy:function(e){return this.c1.copy(e.c1),this.c2.copy(e.c2),this.direction.copy(e.direction),this.radius=e.radius,this},lengthSq:function(){var e=new $3Dmol.Vector3;return function(){return e.subVectors(this.c2,this.c1).lengthSq()}}(),applyMatrix4:function(e){return this.direction.add(this.c1).applyMatrix4(e),this.c1.applyMatrix4(e),this.c2.applyMatrix4(e),this.direction.sub(this.c1).normalize(),this.radius=this.radius*e.getMaxScaleOnAxis(),this}},$3Dmol.Triangle=function(e,t,n){this.a=e!==undefined?e:new $3Dmol.Vector3,this.b=t!==undefined?t:new $3Dmol.Vector3,this.c=n!==undefined?n:new $3Dmol.Vector3},$3Dmol.Triangle.prototype={constructor:$3Dmol.Triangle,copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},applyMatrix4:function(e){return this.a.applyMatrix4(e),this.b.applyMatrix4(e),this.c.applyMatrix4(e),this},getNormal:function(){var e=new $3Dmol.Vector3;return function(){var t=this.a.clone();return t.sub(this.b),e.subVectors(this.c,this.b),t.cross(e),t.normalize(),t}}()},$3Dmol.EventDispatcher=function(){var e={};this.addEventListener=function(t,n){e[t]===undefined&&(e[t]=[]),e[t].indexOf(n)===-1&&e[t].push(n)},this.removeEventListener=function(t,n){var r=e[t].indexOf(n);r!==-1&&e[t].splice(r,1)},this.dispatchEvent=function(t){var n=e[t.type];if(n!==undefined){t.target=this;for(var r=0,i=n.length;r<i;r++)n[r].call(this,t)}}},$3Dmol.Color=function(e){return arguments.length>1?(this.r=arguments[0]||0,this.g=arguments[1]||0,this.b=arguments[2]||0,this):this.set(e)},$3Dmol.Color.prototype={constructor:$3Dmol.Color,r:0,g:0,b:0,set:function(e){if(e instanceof $3Dmol.Color)return e.clone();typeof e=="number"?this.setHex(e):typeof e=="object"&&"r"in e&&"g"in e&&"b"in e&&(this.r=e.r,this.g=e.g,this.b=e.b)},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,this},getHex:function(){var e=Math.round(this.r*255),t=Math.round(this.g*255),n=Math.round(this.b*255);return e<<16|t<<8|n},clone:function(){return new $3Dmol.Color(this.r,this.g,this.b)},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},scaled:function(){var e={};return e.r=Math.round(this.r*255),e.g=Math.round(this.g*255),e.b=Math.round(this.b*255),e.a=1,e}},$3Dmol.Object3D=function(){this.id=$3Dmol.Object3DIDCount++,this.name="",this.parent=undefined,this.children=[],this.position=new $3Dmol.Vector3,this.rotation=new $3Dmol.Vector3,this.matrix=new $3Dmol.Matrix4,this.matrixWorld=new $3Dmol.Matrix4,this.quaternion=new $3Dmol.Quaternion,this.eulerOrder="XYZ",this.up=new $3Dmol.Vector3(0,1,0),this.scale=new $3Dmol.Vector3(1,1,1),this.matrixAutoUpdate=!0,this.matrixWorldNeedsUpdate=!0,this.rotationAutoUpdate=!0,this.useQuaternion=!1,this.visible=!0},$3Dmol.Object3D.prototype={constructor:$3Dmol.Object3D,lookAt:function(e){this.matrix.lookAt(e,this.position,this.up),this.rotationAutoUpdate&&(this.useQuaternion===!0?this.quaternion.copy(this.matrix.decompose()[1]):this.rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder))},add:function(e){if(e===this){console.error("Can't add $3Dmol.Object3D to itself");return}e.parent=this,this.children.push(e);var t=this;while(t.parent!==undefined)t=t.parent;t!==undefined&&t instanceof $3Dmol.Scene&&t.__addObject(e)},remove:function(e){var t=this.children.indexOf(e);if(t!==-1){e.parent=undefined,this.children.splice(t,1);var n=this;while(n.parent!==undefined)n=n.parent;n!==undefined&&n instanceof $3Dmol.Scene&&n.__removeObject(e)}},updateMatrix:function(){this.matrix.setPosition(this.position),this.useQuaternion===!1?this.matrix.setRotationFromEuler(this.rotation,this.eulerOrder):this.matrix.setRotationFromQuaternion(this.quaternion),(this.scale.x!==1||this.scale.y!==1||this.scale.z!==1)&&this.matrix.scale(this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate===!0&&this.updateMatrix();if(this.matrixWorldNeedsUpdate===!0||e===!0)this.parent===undefined?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix);this.matrixWorldNeedsUpdate=!1;for(var t=0;t<this.children.length;t++)this.children[t].updateMatrixWorld(!0)},clone:function(e){e===undefined&&(e=new $3Dmol.Object3D),e.name=this.name,e.up.copy(this.up),e.position.copy(this.position),e.rotation.copy(this.rotation),e.eulerOrder=this.eulerOrder,e.scale.copy(this.scale),e.rotationAutoUpdate=this.rotationAutoUpdate,e.matrix.copy(this.matrix),e.matrixWorld.copy(this.matrixWorld),e.quaternion.copy(this.quaternion),e.matrixAutoUpdate=this.matrixAutoUpdate,e.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate,e.useQuaternion=this.useQuaternion,e.visible=this.visible;for(var t=0;t<this.children.length;t++){var n=this.children[t];e.add(n.clone())}return e},setVisible:function(e){this.visible=e;for(var t=0;t<this.children.length;t++){var n=this.children[t];n.setVisible(e)}}},$3Dmol.Object3DIDCount=0,$3Dmol.Geometry=function(){var e=65535,t=function(e){this.id=e||0,this.vertexArray=null,this.colorArray=null,this.normalArray=null,this.faceArray=null,this.radiusArray=null,this.lineArray=null,this.vertices=0,this.faceidx=0,this.lineidx=0};t.prototype.setColors=function(e){var t=this.vertexArray,n=this.colorArray;if(t.length!=n.length){console.log("Cannot re-color geometry group due to mismatched lengths.");return}for(var r=0;r<t.length;r+=3){var i=e(t[r],t[r+1],t[r+2]);i instanceof $3Dmol.Color||(i=$3Dmol.CC.color(i)),n[r]=i.r,n[r+1]=i.g,n[r+2]=i.b}},t.prototype.getNumVertices=function(){return this.vertices},t.prototype.getVertices=function(){return this.vertexArray},t.prototype.getCentroid=function(){var e=new $3Dmol.Vector3,t,n,r,i;for(var s=0;s<this.vertices;++s)t=s*3,n=this.vertexArray[t],r=this.vertexArray[t+1],i=this.vertexArray[t+2],e.x+=n,e.y+=r,e.z+=i;return e.divideScalar(this.vertices),e},t.prototype.setNormals=function(){var e=this.faceArray,t=this.vertexArray,n=this.normalArray;if(!this.vertices||!this.faceidx)return;var r,i,s,o,u,a,f,l;for(var c=0;c<e.length/3;++c)r=e[c*3]*3,i=e[c*3+1]*3,s=e[c*3+2]*3,u=new $3Dmol.Vector3(t[r],t[r+1],t[r+2]),a=new $3Dmol.Vector3(t[i],t[i+1],t[i+2]),f=new $3Dmol.Vector3(t[s],t[s+1],t[s+2]),u.subVectors(u,a),f.subVectors(f,a),f.cross(u),l=f,l.normalize(),n[r]+=l.x,n[i]+=l.x,n[s]+=l.x,n[r+1]+=l.y,n[i+1]+=l.y,n[s+1]+=l.y,n[r+2]+=l.z,n[i+2]+=l.z,n[s+2]+=l.z},t.prototype.setLineIndices=function(){if(!this.faceidx)return;var e=this.faceArray,t=this.lineArray=new Uint16Array(this.faceidx*2);this.lineidx=this.faceidx*2;for(var n=0;n<this.faceidx/3;++n){var r=n*3,i=r*2,s=e[r],o=e[r+1],u=e[r+2];t[i]=s,t[i+1]=o,t[i+2]=s,t[i+3]=u,t[i+4]=o,t[i+5]=u}},t.prototype.truncateArrayBuffers=function(e,t){e=e===!0?!0:!1;var n=this.vertexArray,r=this.colorArray,i=this.normalArray,s=this.faceArray,o=this.lineArray,u=this.radiusArray;this.vertexArray=n.subarray(0,this.vertices*3),this.colorArray=r.subarray(0,this.vertices*3),e?(this.normalArray=i.subarray(0,this.vertices*3),this.faceArray=s.subarray(0,this.faceidx),this.lineidx>0?this.lineArray=o.subarray(0,this.lineidx):this.lineArray=new Uint16Array(0)):(this.normalArray=new Float32Array(0),this.faceArray=new Uint16Array(0),this.lineArray=new Uint16Array(0)),u&&(this.radiusArray=u.subarray(0,this.vertices)),t&&(this.normalArray&&(this.normalArray=new Float32Array(this.normalArray)),this.faceArray&&(this.faceArray=new Uint16Array(this.faceArray)),this.lineArray&&(this.lineArray=new Uint16Array(this.lineArray)),this.vertexArray&&(this.vertexArray=new Float32Array(this.vertexArray)),this.colorArray&&(this.colorArray=new Float32Array(this.colorArray)),this.radiusArray&&(this.radiusArray=new Float32Array(this.radiusArray))),this.__inittedArrays=!0};var n=function(n){var r=new t(n.geometryGroups.length);return n.geometryGroups
.push(r),n.groups=n.geometryGroups.length,r.vertexArray=new Float32Array(e*3),r.colorArray=new Float32Array(e*3),n.mesh&&(r.normalArray=new Float32Array(e*3),r.faceArray=new Uint16Array(e*6),r.lineArray=new Uint16Array(e*6)),n.radii&&(r.radiusArray=new Float32Array(e)),r.useOffset=n.offset,r},r=function(e,t,n){$3Dmol.EventDispatcher.call(this),this.id=$3Dmol.GeometryIDCount++,this.name="",this.hasTangents=!1,this.dynamic=!0,this.mesh=e===!0?!0:!1,this.radii=t||!1,this.offset=n||!1,this.verticesNeedUpdate=!1,this.elementsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.buffersNeedUpdate=!1,this.geometryGroups=[],this.groups=0};return r.prototype={constructor:r,updateGeoGroup:function(e){e=e||0;var t=this.groups>0?this.geometryGroups[this.groups-1]:null;if(!t||t.vertices+e>t.vertexArray.length/3)t=n(this);return t},addGeoGroup:function(){return n(this)},setUpNormals:function(e){e=e||!1;for(var t=0;t<this.groups;t++){var n=this.geometryGroups[t];n.setNormals(e)}},setColors:function(e){var t=this.geometryGroups.length;for(var n=0;n<t;n++){var r=this.geometryGroups[n];r.setColors(e)}},setUpWireframe:function(){for(var e=0;e<this.groups;e++){var t=this.geometryGroups[e];t.setLineIndices()}},initTypedArrays:function(){for(var e=0;e<this.groups;e++){var t=this.geometryGroups[e];if(t.__inittedArrays===!0)continue;t.truncateArrayBuffers(this.mesh,!1)}},dispose:function(){this.dispatchEvent({type:"dispose"})}},r}(),Object.defineProperty($3Dmol.Geometry.prototype,"vertices",{get:function(){var e=0;for(var t=0;t<this.groups;t++)e+=this.geometryGroups[t].vertices;return e}}),$3Dmol.GeometryIDCount=0,$3Dmol.Raycaster=function(){var e=function(e,t,n,r){this.ray=new $3Dmol.Ray(e,t),this.ray.direction.lengthSq()>0&&this.ray.direction.normalize(),this.near=r||0,this.far=n||Infinity},t=new $3Dmol.Sphere,n=new $3Dmol.Cylinder,r=new $3Dmol.Triangle,i=new $3Dmol.Vector3,s=new $3Dmol.Vector3,o=new $3Dmol.Vector3,u=new $3Dmol.Vector3,a=new $3Dmol.Ray,f=new $3Dmol.Vector3,l=new $3Dmol.Vector3,c=new $3Dmol.Matrix4,h=function(e,t){return e.distance-t.distance},p=function(e){return Math.min(Math.max(e,-1),1)},d=function(e,a,f,c){l.getPositionFromMatrix(e.matrixWorld);if(a.intersectionShape===undefined)return c;var h=a.intersectionShape,d=f.linePrecision;d*=e.matrixWorld.getMaxScaleOnAxis();var v=d*d;if(a.boundingSphere!==undefined&&a.boundingSphere instanceof $3Dmol.Sphere){t.copy(a.boundingSphere),t.applyMatrix4(e.matrixWorld);if(!f.ray.isIntersectionSphere(t))return c}var m,g,y,b,w,E,S,x,T,N,C,k,L,A;for(m=0,g=h.triangle.length;m<g;m++)if(h.triangle[m]instanceof $3Dmol.Triangle){r.copy(h.triangle[m]),r.applyMatrix4(e.matrixWorld),y=r.getNormal(),b=f.ray.direction.dot(y);if(b>=0)continue;i.subVectors(r.a,f.ray.origin),S=y.dot(i)/b;if(S<0)continue;s.copy(f.ray.direction).multiplyScalar(S).add(f.ray.origin),s.sub(r.a),o.copy(r.b).sub(r.a),u.copy(r.c).sub(r.a);var O=o.dot(u),M=o.lengthSq(),_=u.lengthSq();k=(M*s.dot(u)-O*s.dot(o))/(M*_-O*O);if(k<0||k>1)continue;C=(s.dot(o)-k*O)/M;if(C<0||C>1||C+k>1)continue;c.push({clickable:a,distance:S})}for(m=0,g=h.cylinder.length;m<g;m++)if(h.cylinder[m]instanceof $3Dmol.Cylinder){n.copy(h.cylinder[m]),n.applyMatrix4(e.matrixWorld),i.subVectors(n.c1,f.ray.origin),w=i.dot(n.direction),E=i.dot(f.ray.direction),b=p(f.ray.direction.dot(n.direction)),T=1-b*b;if(T===0)continue;L=(b*E-w)/T,A=(E-b*w)/T,s.copy(n.direction).multiplyScalar(L).add(n.c1),o.copy(f.ray.direction).multiplyScalar(A).add(f.ray.origin),x=u.subVectors(s,o).lengthSq();var D=n.radius*n.radius;if(x<=D){N=(b*w-E)*(b*w-E)-T*(i.lengthSq()-w*w-D),N<=0?k=S=Math.sqrt(x):k=S=(E-b*w-Math.sqrt(N))/T,C=b*k-w;if(C<0||C*C>n.lengthSq()||k<0)continue;c.push({clickable:a,distance:S})}}for(m=0,g=h.line.length;m<g;m+=2){s.copy(h.line[m]),s.applyMatrix4(e.matrixWorld),o.copy(h.line[m+1]),o.applyMatrix4(e.matrixWorld),u.subVectors(o,s);var P=u.lengthSq();u.normalize(),i.subVectors(s,f.ray.origin);var H=i.dot(u);E=i.dot(f.ray.direction),b=p(f.ray.direction.dot(u)),T=1-b*b;if(T===0)continue;L=(b*E-H)/T,A=(E-b*H)/T,s.add(u.multiplyScalar(L)),o.copy(f.ray.direction).multiplyScalar(A).add(f.ray.origin),x=u.subVectors(o,s).lengthSq(),x<v&&L*L<P&&c.push({clickable:a,distance:A})}for(m=0,g=h.sphere.length;m<g;m++)if(h.sphere[m]instanceof $3Dmol.Sphere){t.copy(h.sphere[m]),t.applyMatrix4(e.matrixWorld);if(f.ray.isIntersectionSphere(t)){s.subVectors(t.center,f.ray.origin);var B=s.dot(f.ray.direction);return N=B*B-(s.lengthSq()-t.radius*t.radius),B<0?c:(N<=0?S=B:S=B-Math.sqrt(N),c.push({clickable:a,distance:S}),c)}}};return e.prototype.precision=1e-4,e.prototype.linePrecision=.2,e.prototype.set=function(e,t){this.ray.set(e,t)},e.prototype.intersectObjects=function(e,t){var n=[];for(var r=0,i=t.length;r<i;r++)d(e,t[r],this,n);return n.sort(h),n},e}(),$3Dmol.Projector=function(){var e=new $3Dmol.Matrix4,t=new $3Dmol.Matrix4;this.projectVector=function(e,n){return n.matrixWorldInverse.getInverse(n.matrixWorld),t.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),e.applyProjection(t)},this.unprojectVector=function(e,n){return n.projectionMatrixInverse.getInverse(n.projectionMatrix),t.multiplyMatrices(n.matrixWorld,n.projectionMatrixInverse),e.applyProjection(t)}},$3Dmol.Camera=function(e,t,n,r,i){$3Dmol.Object3D.call(this),this.fov=e!==undefined?e:50,this.aspect=t!==undefined?t:1,this.near=n!==undefined?n:.1,this.far=r!==undefined?r:2e3,this.projectionMatrix=new $3Dmol.Matrix4,this.projectionMatrixInverse=new $3Dmol.Matrix4,this.matrixWorldInverse=new $3Dmol.Matrix4;var s=this.position.z;this.right=s*Math.tan(Math.PI/180*e),this.left=-this.right,this.top=this.right/this.aspect,this.bottom=-this.top,this.ortho=!!i,this.updateProjectionMatrix()},$3Dmol.Camera.prototype=Object.create($3Dmol.Object3D.prototype),$3Dmol.Camera.prototype.lookAt=function(e){this.matrix.lookAt(this.position,e,this.up),this.rotationAutoUpdate&&(this.useQuaternion===!1?this.rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder):this.quaternion.copy(this.matrix.decompose()[1]))},$3Dmol.Camera.prototype.updateProjectionMatrix=function(){this.ortho?this.projectionMatrix.makeOrthographic(this.left,this.right,this.top,this.bottom,this.near,this.far):this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},$3Dmol.SpritePlugin=function(){function i(t,n){var r=e.createProgram(),i=e.createShader(e.FRAGMENT_SHADER),s=e.createShader(e.VERTEX_SHADER),o="precision "+n+" float;\n";return e.shaderSource(i,o+t.fragmentShader),e.shaderSource(s,o+t.vertexShader),e.compileShader(i),e.compileShader(s),!e.getShaderParameter(i,e.COMPILE_STATUS)||!e.getShaderParameter(s,e.COMPILE_STATUS)?(console.error(e.getShaderInfoLog(i)),console.error("could not initialize shader"),null):(e.attachShader(r,i),e.attachShader(r,s),e.linkProgram(r),e.getProgramParameter(r,e.LINK_STATUS)||console.error("Could not initialize shader"),r)}function s(e,t){return e.z!==t.z?t.z-e.z:t.id-e.id}var e,t,n,r={};this.init=function(s){e=s.context,t=s,n=s.getPrecision(),r.vertices=new Float32Array(16),r.faces=new Uint16Array(6);var o=0;r.vertices[o++]=-1,r.vertices[o++]=-1,r.vertices[o++]=0,r.vertices[o++]=0,r.vertices[o++]=1,r.vertices[o++]=-1,r.vertices[o++]=1,r.vertices[o++]=0,r.vertices[o++]=1,r.vertices[o++]=1,r.vertices[o++]=1,r.vertices[o++]=1,r.vertices[o++]=-1,r.vertices[o++]=1,r.vertices[o++]=0,r.vertices[o++]=1,o=0,r.faces[o++]=0,r.faces[o++]=1,r.faces[o++]=2,r.faces[o++]=0,r.faces[o++]=2,r.faces[o++]=3,r.vertexBuffer=e.createBuffer(),r.elementBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,r.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,r.vertices,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r.elementBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,r.faces,e.STATIC_DRAW),r.program=i($3Dmol.ShaderLib.sprite,n),r.attributes={},r.uniforms={},r.attributes.position=e.getAttribLocation(r.program,"position"),r.attributes.uv=e.getAttribLocation(r.program,"uv"),r.uniforms.uvOffset=e.getUniformLocation(r.program,"uvOffset"),r.uniforms.uvScale=e.getUniformLocation(r.program,"uvScale"),r.uniforms.rotation=e.getUniformLocation(r.program,"rotation"),r.uniforms.scale=e.getUniformLocation(r.program,"scale"),r.uniforms.alignment=e.getUniformLocation(r.program,"alignment"),r.uniforms.color=e.getUniformLocation(r.program,"color"),r.uniforms.map=e.getUniformLocation(r.program,"map"),r.uniforms.opacity=e.getUniformLocation(r.program,"opacity"),r.uniforms.useScreenCoordinates=e.getUniformLocation(r.program,"useScreenCoordinates"),r.uniforms.screenPosition=e.getUniformLocation(r.program,"screenPosition"),r.uniforms.modelViewMatrix=e.getUniformLocation(r.program,"modelViewMatrix"),r.uniforms.projectionMatrix=e.getUniformLocation(r.program,"projectionMatrix"),r.uniforms.fogType=e.getUniformLocation(r.program,"fogType"),r.uniforms.fogDensity=e.getUniformLocation(r.program,"fogDensity"),r.uniforms.fogNear=e.getUniformLocation(r.program,"fogNear"),r.uniforms.fogFar=e.getUniformLocation(r.program,"fogFar"),r.uniforms.fogColor=e.getUniformLocation(r.program,"fogColor"),r.uniforms.alphaTest=e.getUniformLocation(r.program,"alphaTest")},this.render=function(n,i,o,u){var a=n.__webglSprites,f=a.length;if(!f)return;var l=r.attributes,c=r.uniforms,h=u/o,p=o*.5,d=u*.5;e.useProgram(r.program),e.enableVertexAttribArray(l.position),e.enableVertexAttribArray(l.uv),e.disable(e.CULL_FACE),e.enable(e.BLEND),e.bindBuffer(e.ARRAY_BUFFER,r.vertexBuffer),e.vertexAttribPointer(l.position,2,e.FLOAT,!1,16,0),e.vertexAttribPointer(l.uv,2,e.FLOAT,!1,16,8),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r.elementBuffer),e.uniformMatrix4fv(c.projectionMatrix,!1,i.projectionMatrix.elements),e.activeTexture(e.TEXTURE0),e.uniform1i(c.map,0);var v=0,m=0,g=n.fog;g?(e.uniform3f(c.fogColor,g.color.r,g.color.g,g.color.b),e.uniform1f(c.fogNear,g.near),e.uniform1f(c.fogFar,g.far),e.uniform1i(c.fogType,1),v=1,m=1):(e.uniform1i(c.fogType,0),v=0,m=0);var y,b,w,E,S,x,T=[];for(y=0;y<f;y++){b=a[y],w=b.material;if(!b.visible||w.opacity===0)continue;w.useScreenCoordinates?b.z=-b.position.z:(b._modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,b.matrixWorld),b.z=-b._modelViewMatrix.elements[14])}a.sort(s);for(y=0;y<f;y++){b=a[y],w=b.material;if(!b.visible||w.opacity===0)continue;if(w.map&&w.map.image&&w.map.image.width){e.uniform1f(c.alphaTest,w.alphaTest);var N=w.map.image.width,C=w.map.image.height;T[0]=N*t.devicePixelRatio/o,T[1]=C*t.devicePixelRatio/u,w.useScreenCoordinates===!0?(e.uniform1i(c.useScreenCoordinates,1),e.uniform3f(c.screenPosition,(b.position.x*t.devicePixelRatio-p)/p,(d-b.position.y*t.devicePixelRatio)/d,Math.max(0,Math.min(1,b.position.z)))):(e.uniform1i(c.useScreenCoordinates,0),e.uniformMatrix4fv(c.modelViewMatrix,!1,b._modelViewMatrix.elements)),n.fog&&w.fog?x=m:x=0,v!==x&&(e.uniform1i(c.fogType,x),v=x),S=1/(w.scaleByViewport?u:1),T[0]*=S*b.scale.x,T[1]*=S*b.scale.y,e.uniform2f(c.uvScale,w.uvScale.x,w.uvScale.y),e.uniform2f(c.uvOffset,w.uvOffset.x,w.uvOffset.y),e.uniform2f(c.alignment,w.alignment.x,w.alignment.y),e.uniform1f(c.opacity,w.opacity),e.uniform3f(c.color,w.color.r,w.color.g,w.color.b),e.uniform1f(c.rotation,b.rotation),e.uniform2fv(c.scale,T),t.setDepthTest(w.depthTest),t.setDepthWrite(w.depthWrite),t.setTexture(w.map,0),e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)}}e.enable(e.CULL_FACE)}},$3Dmol.Light=function(e,t){$3Dmol.Object3D.call(this),this.color=new $3Dmol.Color(e),this.position=new $3Dmol.Vector3(0,1,0),this.target=new $3Dmol.Object3D,this.intensity=t!==undefined?t:1,this.castShadow=!1,this.onlyShadow=!1},$3Dmol.Light.prototype=Object.create($3Dmol.Object3D.prototype),$3Dmol.Material=function(){$3Dmol.EventDispatcher.call(this),this.id=$3Dmol.MaterialIdCount++,this.name="",this.side=$3Dmol.FrontSide,this.opacity=1,this.transparent=!1,this.depthTest=!0,this.depthWrite=!0,this.stencilTest=!0,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.visible=!0,this.needsUpdate=!0},$3Dmol.Material.prototype.setValues=function(e){if(e===undefined)return;for(var t in e){var n=e[t];if(n===undefined){console.warn("$3Dmol.Material: '"+t+"' parameter is undefined.");continue}if(t in this){var r=this[t];r instanceof $3Dmol.Color&&n instanceof $3Dmol.Color?r.copy(n):r instanceof $3Dmol.Color?r.set(n):r instanceof $3Dmol.Vector3&&n instanceof $3Dmol.Vector3?r.copy(n):this[t]=n}}},$3Dmol.Material.prototype.clone=function(e){return e===undefined&&(e=new $3Dmol.Material),e.name=this.name,e.side=this.side,e.opacity=this.opacity,e.transparent=this.transparent,e.depthTest=this.depthTest,e.depthWrite=this.depthWrite,e.stencilTest=this.stencilTest,e.polygonOffset=this.polygonOffset,e.polygonOffsetFactor=this.polygonOffsetFactor,e.polygonOffsetUnits=this.polygonOffsetUnits,e.alphaTest=this.alphaTest,e.overdraw=this.overdraw,e.visible=this.visible,e},$3Dmol.Material.prototype.dispose=function(){this.dispatchEvent({type:"dispose"})},$3Dmol.MaterialIdCount=0,$3Dmol.LineBasicMaterial=function(e){$3Dmol.Material.call(this),this.color=new $3Dmol.Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.vertexColors=!1,this.fog=!0,this.shaderID="basic",this.setValues(e)},$3Dmol.LineBasicMaterial.prototype=Object.create($3Dmol.Material.prototype),$3Dmol.LineBasicMaterial.prototype.clone=function(){var e=new $3Dmol.LineBasicMaterial;return $3Dmol.Material.prototype.clone.call(this,e),e.color.copy(this.color),e},$3Dmol.MeshLambertMaterial=function(e){$3Dmol.Material.call(this),this.color=new $3Dmol.Color(16777215),this.ambient=new $3Dmol.Color(1048575),this.emissive=new $3Dmol.Color(0),this.wrapAround=!1,this.wrapRGB=new $3Dmol.Vector3(1,1,1),this.map=null,this.lightMap=null,this.specularMap=null,this.envMap=null,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.shading=$3Dmol.SmoothShading,this.shaderID="lambert",this.vertexColors=$3Dmol.NoColors,this.skinning=!1,this.setValues(e)},$3Dmol.MeshLambertMaterial.prototype=Object.create($3Dmol.Material.prototype),$3Dmol.MeshLambertMaterial.prototype.clone=function(e){return typeof e=="undefined"&&(e=new $3Dmol.MeshLambertMaterial),$3Dmol.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.shaderID=this.shaderID,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},$3Dmol.MeshDoubleLambertMaterial=function(e){$3Dmol.MeshLambertMaterial.call(this,e),this.shaderID="lambertdouble",this.side=$3Dmol.DoubleSide},$3Dmol.MeshDoubleLambertMaterial.prototype=Object.create($3Dmol.MeshLambertMaterial.prototype),$3Dmol.MeshDoubleLambertMaterial.prototype.clone=function(){var e=new $3Dmol.MeshDoubleLambertMaterial;return $3Dmol.MeshLambertMaterial.prototype.clone.call(this,e),e},$3Dmol.MeshOutlineMaterial=function(e){$3Dmol.Material.call(this),e=e||{},this.fog=!0,this.shaderID="outline",this.wireframe=!1,this.outlineColor=e.color||new $3Dmol.Color(0,0,0),this.outlineWidth=e.width||.1,this.outlinePushback=e.pushback||1},$3Dmol.MeshOutlineMaterial.prototype=Object.create($3Dmol.Material.prototype),$3Dmol.MeshOutlineMaterial.prototype.clone=function(e){return typeof e=="undefined"&&(e=new $3Dmol.MeshOutlineMaterial),$3Dmol.Material.prototype.clone.call(this,e),e.fog=this.fog,e.shaderID=this.shaderID,e.wireframe=this.wireframe,e},$3Dmol.ImposterMaterial=function(e){$3Dmol.Material.call(this),this.color=new $3Dmol.Color(16777215),this.ambient=new $3Dmol.Color(1048575),this.emissive=new $3Dmol.Color(0),this.imposter=!0,this.wrapAround=!1,this.wrapRGB=new $3Dmol.Vector3(1,1,1),this.map=null,this.lightMap=null,this.specularMap=null,this.envMap=null,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.shading=$3Dmol.SmoothShading,this.shaderID=null,this.vertexColors=$3Dmol.NoColors,this.skinning=!1,this.setValues(e)},$3Dmol.ImposterMaterial.prototype=Object.create($3Dmol.Material.prototype),$3Dmol.ImposterMaterial.prototype.clone=function(){var e=new $3Dmol.ImposterMaterial;return $3Dmol.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.shaderID=this.shaderID,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},$3Dmol.SphereImposterMaterial=function(e){$3Dmol.ImposterMaterial.call(this),this.shaderID="sphereimposter",this.setValues(e)},$3Dmol.SphereImposterMaterial.prototype=Object.create($3Dmol.ImposterMaterial.prototype),$3Dmol.SphereImposterMaterial.prototype.clone=function(){var e=new $3Dmol.SphereImposterMaterial;return $3Dmol.ImposterMaterial.prototype.clone.call(this,e),e},$3Dmol.SphereImposterOutlineMaterial=function(e){$3Dmol.ImposterMaterial.call(this),e=e||{},this.shaderID="sphereimposteroutline",this.outlineColor=e.color||new $3Dmol.Color(0,0,0),this.outlineWidth=e.width||.1,this.outlinePushback=e.pushback||1,this.setValues(e)},$3Dmol.SphereImposterOutlineMaterial.prototype=Object.create($3Dmol.ImposterMaterial.prototype),$3Dmol.SphereImposterOutlineMaterial.prototype.clone=function(){var e=new $3Dmol.SphereImposterOutlineMaterial;return $3Dmol.ImposterMaterial.prototype.clone.call(this,e),e.outlineColor=this.outlineColor,e.outlineWidth=this.outlineWidth,e.outlinePushback=this.outlinePushback,e},$3Dmol.StickImposterMaterial=function(e){$3Dmol.ImposterMaterial.call(this),this.shaderID="stickimposter",this.setValues(e)},$3Dmol.StickImposterMaterial.prototype=Object.create($3Dmol.ImposterMaterial.prototype),$3Dmol.StickImposterMaterial.prototype.clone=function(){var e=new $3Dmol.StickImposterOutlineMaterial;return $3Dmol.ImposterMaterial.prototype.clone.call(this,e),e},$3Dmol.StickImposterOutlineMaterial=function(e){$3Dmol.ImposterMaterial.call(this),e=e||{},this.shaderID="stickimposteroutline",this.outlineColor=e.color||new $3Dmol.Color(0,0,0),this.outlineWidth=e.width||.1,this.outlinePushback=e.pushback||1,this.setValues(e)},$3Dmol.StickImposterOutlineMaterial.prototype=Object.create($3Dmol.ImposterMaterial.prototype),$3Dmol.StickImposterOutlineMaterial.prototype.clone=function(){var e=new $3Dmol.StickImposterOutlineMaterial;return $3Dmol.ImposterMaterial.prototype.clone.call(this,e),e.outlineColor=this.outlineColor,e.outlineWidth=this.outlineWidth,e.outlinePushback=this.outlinePushback,e},$3Dmol.InstancedMaterial=function(e){$3Dmol.Material.call(this),this.color=new $3Dmol.Color(16777215),this.ambient=new $3Dmol.Color(1048575),this.emissive=new $3Dmol.Color(0),this.wrapAround=!1,this.wrapRGB=new $3Dmol.Vector3(1,1,1),this.map=null,this.lightMap=null,this.specularMap=null,this.envMap=null,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.shading=$3Dmol.SmoothShading,this.shaderID="instanced",this.vertexColors=$3Dmol.NoColors,this.skinning=!1,this.sphere=null,this.setValues(e)},$3Dmol.InstancedMaterial.prototype=Object.create($3Dmol.Material.prototype),$3Dmol.InstancedMaterial.prototype.clone=function(){var e=new $3Dmol.InstancedMaterial;return $3Dmol.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.shaderID=this.shaderID,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e.sphere=this.sphere,e},$3Dmol.SpriteMaterial=function(e){$3Dmol.Material.call(this),this.color=new $3Dmol.Color(16777215),this.map=new $3Dmol.Texture,this.useScreenCoordinates=!0,this.depthTest=!this.useScreenCoordinates,this.sizeAttenuation=!this.useScreenCoordinates,this.scaleByViewPort=!this.sizeAttenuation,this.alignment=$3Dmol.SpriteAlignment.center.clone(),this.fog=!1,this.uvOffset=new $3Dmol.Vector2(0,0),this.uvScale=new $3Dmol.Vector2(1,1),this.setValues(e),e=e||{},e.depthTest===undefined&&(this.depthTest=!this.useScreenCoordinates),e.sizeAttenuation===undefined&&(this.sizeAttenuation=!this.useScreenCoordinates),e.scaleByViewPort===undefined&&(this.scaleByViewPort=!this.sizeAttenuation)},$3Dmol.SpriteMaterial.prototype=Object.create($3Dmol.Material.prototype),$3Dmol.SpriteMaterial.prototype.clone=function(){var e=new $3Dmol.SpriteMaterial;return $3Dmol.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.useScreenCoordinates=useScreenCoordinates,e.sizeAttenuation=this.sizeAttenuation,e.scaleByViewport=this.scaleByViewPort,e.alignment.copy(this.alignment),e.uvOffset.copy(this.uvOffset),e},$3Dmol.SpriteAlignment={},$3Dmol.SpriteAlignment.topLeft=new $3Dmol.Vector2(1,-1),$3Dmol.SpriteAlignment.topCenter=new $3Dmol.Vector2(0,-1),$3Dmol.SpriteAlignment.topRight=new $3Dmol.Vector2(-1,-1),$3Dmol.SpriteAlignment.centerLeft=new $3Dmol.Vector2(1,0),$3Dmol.SpriteAlignment.center=new $3Dmol.Vector2(0,0),$3Dmol.SpriteAlignment.centerRight=new $3Dmol.Vector2(-1,0),$3Dmol.SpriteAlignment.bottomLeft=new $3Dmol.Vector2(1,1),$3Dmol.SpriteAlignment.bottomCenter=new $3Dmol.Vector2(0,1),$3Dmol.SpriteAlignment.bottomRight=new $3Dmol.Vector2(-1,1),$3Dmol.Texture=function(e){$3Dmol.EventDispatcher.call(this),this.id=$3Dmol.TextureIdCount++,this.name="",this.image=e,this.mipmaps=[],this.mapping=new $3Dmol.UVMapping,this.wrapS=$3Dmol.ClampToEdgeWrapping,this.wrapT=$3Dmol.ClampToEdgeWrapping,this.magFilter=$3Dmol.LinearFilter,this.minFilter=$3Dmol.LinearMipMapLinearFilter,this.anisotropy=1,this.format=$3Dmol.RGBAFormat,this.type=$3Dmol.UnsignedByteType,this.offset=new $3Dmol.Vector2(0,0),this.repeat=new $3Dmol.Vector2(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.needsUpdate=!1,this.onUpdate=null},$3Dmol.Texture.prototype={constructor:$3Dmol.Texture,clone:function(e){return e===undefined&&(e=new $3Dmol.Texture),e.image=this.image,e.mipmaps=this.mipmaps.slice(0),e.mapping=this.mapping,e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.format=this.format,e.type=this.type,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.generateMipmaps=this.generateMipmaps,e.premultiplyAlpha=this.premultiplyAlpha,e.flipY=this.flipY,e.unpackAlignment=this.unpackAlignment,e},dispose:function(){this.dispatchEvent({type:"dispose"})}},$3Dmol.TextureIdCount=0,$3Dmol.FrontSide=0,$3Dmol.BackSide=1,$3Dmol.DoubleSide=2,$3Dmol.NoShading=0,$3Dmol.FlatShading=1,$3Dmol.SmoothShading=2,$3Dmol.NoColors=0,$3Dmol.FaceColors=1,$3Dmol.VertexColors=2,$3Dmol.MultiplyOperation=0,$3Dmol.MixOperation=1,$3Dmol.AddOperation=2,$3Dmol.UVMapping=function(){},$3Dmol.ClampToEdgeWrapping=1001,$3Dmol.LinearFilter=1006,$3Dmol.LinearMipMapLinearFilter=1008,$3Dmol.UnsignedByteType=1009,$3Dmol.RGBAFormat=1021,$3Dmol.Line=function(e,t,n){$3Dmol.Object3D.call(this),this.geometry=e,this.material=t!==undefined?t:new $3Dmol.LineBasicMaterial({color:Math.random()*16777215}),this.type=n!==undefined?n:$3Dmol.LineStrip},$3Dmol.LineStrip=0,$3Dmol.LinePieces=1,$3Dmol.Line.prototype=Object.create($3Dmol.Object3D.prototype),$3Dmol.Line.prototype.clone=function(e){return e===undefined&&(e=new $3Dmol.Line(this.geometry,this.material,this.type)),$3Dmol.Object3D.prototype.clone.call(this,e),e},$3Dmol.Mesh=function(e,t){$3Dmol.Object3D.call(this),this.geometry=e,this.material=t!==undefined?t:new $3Dmol.MeshBasicMaterial({color:Math.random()*16777215,wireframe:!0})},$3Dmol.Mesh.prototype=Object.create($3Dmol.Object3D.prototype),$3Dmol.Mesh.prototype.clone=function(e){return e===undefined&&(e=new $3Dmol.Mesh(this.geometry,this.material)),$3Dmol.Object3D.prototype.clone.call(this,e),e},$3Dmol.Sprite=function(e){$3Dmol.Object3D.call(this),this.material=e!==undefined?e:new $3Dmol.SpriteMaterial,this.rotation3d=this.rotation,this.rotation=0},$3Dmol.Sprite.prototype=Object.create($3Dmol.Object3D.prototype),$3Dmol.Sprite.prototype.updateMatrix=function(){this.matrix.setPosition(this.position),this.rotation3d.set(0,0,this.rotation),this.matrix.setRotationFromEuler(this.rotation3d),(this.scale.x!==1||this.scale.y!==1)&&this.matrix.scale(this.scale),this.matrixWorldNeedsUpdate=!0},$3Dmol.Sprite.prototype.clone=function(e){return e===undefined&&(e=new $3Dmol.Sprite(this.material)),$3Dmol.Object3D.prototype.clone.call(this,e),e},$3Dmol.Renderer=function(e){function K(e,t){return t[0]-e[0]}function Q(e){q[e]||(V.enableVertexAttribArray(e),q[e]=!0)}function G(){for(var e in q)q[e]&&(V.disableVertexAttribArray(e),q[e]=!1)}function Y(e,t,n){_!==e&&(e?V.enable(V.POLYGON_OFFSET_FILL):V.disable(V.POLYGON_OFFSET_FILL))}function Z(e){e!==H&&(V.lineWidth(e),H=e)}function ot(e,t){var n;return e==="fragment"?n=V.createShader(V.FRAGMENT_SHADER):e==="vertex"&&(n=V.createShader(V.VERTEX_SHADER)),V.shaderSource(n,t),V.compileShader(n),V.getShaderParameter(n,V.COMPILE_STATUS)?n:(console.error(V.getShaderInfoLog(n)),console.error("could not initialize shader"),null)}function ut(e,t,r,i){var s,o,u,a,f,l=[];l.push(e),l.push(t);for(s in i)l.push(s),l.push(i[s]);f=l.join();for(s=0,o=v.length;s<o;s++){var c=v[s];if(c.code===f)return c.usedTimes++,c.program}a=V.createProgram();var h=n,p="precision "+h+" float;",g=[p].join("\n"),y=[i.fragdepth?"#extension GL_EXT_frag_depth: enable":"",i.wireframe?"#define WIREFRAME 1":"",p].join("\n"),b=ot("fragment",y+e),w=ot("vertex",g+t);V.attachShader(a,w),V.attachShader(a,b),V.linkProgram(a),V.getProgramParameter(a,V.LINK_STATUS)||console.error("Could not initialize shader"),a.uniforms={},a.attributes={};var E,S,x,T;E=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix"];for(S in r)E.push(S);for(T=0;T<E.length;T++){var N=E[T];a.uniforms[N]=V.getUniformLocation(a,N)}E=["position","normal","color","lineDistance","offset","radius"];for(T=0;T<E.length;T++){var C=E[T];a.attributes[C]=V.getAttribLocation(a,C)}return a.id=m++,v.push({program:a,code:f,usedTimes:1}),d.info.memory.programs=v.length,a}function at(e,t,n,r,i){r.needsUpdate&&(r.program&&it(r),d.initMaterial(r,t,n,i),r.needsUpdate=!1);var s=!1,o=r.program,u=o.uniforms,a=r.uniforms;return o!=g&&(V.useProgram(o),g=o,s=!0),r.id!=b&&(b=r.id,s=!0),e!=E&&(E=e,s=!0),V.uniformMatrix4fv(u.projectionMatrix,!1,e.projectionMatrix.elements),V.uniformMatrix4fv(u.modelViewMatrix,!1,i._modelViewMatrix.elements),V.uniformMatrix3fv(u.normalMatrix,!1,i._normalMatrix.elements),s&&(a.fogColor.value=n.color,a.fogNear.value=n.near,a.fogFar.value=n.far,r.shaderID.startsWith("lambert")||r.shaderID==="instanced"||r.shaderID.endsWith("imposter")?(V.uniformMatrix4fv(u.viewMatrix,!1,e.matrixWorldInverse.elements),W&&(kt(o,t),W=!1),a.directionalLightColor.value=X.directional.colors,a.directionalLightDirection.value=X.directional.positions):r.shaderID.endsWith("outline")?(a.outlineColor.value=r.outlineColor,a.outlineWidth.value=r.outlineWidth,a.outlinePushback.value=r.outlinePushback):r.shaderID==="sphereimposter"&&(V.uniformMatrix4fv(u.viewMatrix,!1,e.matrixWorldInverse.elements),V.uniformMatrix3fv(u.normalMatrix,!1,i._normalMatrix.elements),a.directionalLightColor.value=X.directional.colors,a.directionalLightDirection.value=X.directional.positions),a.opacity.value=r.opacity,ft(u,a)),o}function ft(e,t){var n,r,i,s;for(n in t){if(!e[n])continue;r=t[n].type,i=t[n].value,s=e[n],r==="f"?V.uniform1f(s,i):r==="fv"?V.uniform3fv(s,i):r==="c"?V.uniform3f(s,i.r,i.g,i.b):r==="f4"&&V.uniform4f(s,i[0],i[1],i[2],i[3])}}function lt(e,t,n,r,i,s,o,u){var a,f,v,m,g,y,b;t?(g=e.length-1,y=-1,b=-1):(g=0,y=e.length,b=1);for(var w=g;w!==y;w+=b){a=e[w];if(a.render){f=a.object,v=a.buffer,m=a[n];if(!m)continue;o&&d.setBlending(!0),d.setDepthTest(m.depthTest),d.setDepthWrite(m.depthWrite),Y(m.polygonOffset,m.polygonOffsetFactor,m.polygonOffsetUnits);var E=f._modelViewMatrix.isReflected();d.setMaterialFaces(m,E),d.renderBuffer(r,i,s,m,v,f);if(p||m.outline)m.shaderID=="sphereimposter"?d.renderBuffer(r,i,s,c,v,f):m.shaderID=="stickimposter"?d.renderBuffer(r,i,s,h,v,f):!m.wireframe&&m.shaderID!=="basic"&&m.opacity!==0&&d.renderBuffer(r,i,s,l,v,f)}}}function ct(e,t,n){w=-1,g=null,E=null,C=-1,M=-1,O=-1,T=-1,b=-1,N=-1;if(!e.length)return;for(var r=0,i=e.length;r<i;r++)W=!0,e[r].render(t,n,F,I),w=-1,g=null,E=null,C=-1,M=-1,O=-1,T=-1,b=-1,N=-1}function ht(e,t){var n,r,i,s,o;if(!e.__webglInit){e.__webglInit=!0,e._modelViewMatrix=new $3Dmol.Matrix4,e._normalMatrix=new $3Dmol.Matrix3,e.geometry!==undefined&&e.geometry.__webglInit===undefined&&(e.geometry.__webglInit=!0,e.geometry.addEventListener("dispose",et));if(e instanceof $3Dmol.Mesh||e instanceof $3Dmol.Line){i=e.geometry,s=e.material;for(n=0,r=i.geometryGroups.length;n<r;n++)o=i.geometryGroups[n],o.id=S++,o.__webglVertexBuffer||(e instanceof $3Dmol.Mesh?(bt(o),i.elementsNeedUpdate=!0,i.normalsNeedUpdate=!0):e instanceof $3Dmol.Line&&wt(o),i.verticesNeedUpdate=!0,i.colorsNeedUpdate=!0)}}if(!e.__webglActive){if(e instanceof $3Dmol.Mesh||e instanceof $3Dmol.Line){i=e.geometry;for(n=0,r=i.geometryGroups.length;n<r;n++)o=i.geometryGroups[n],Et(t.__webglObjects,o,e)}else e instanceof $3Dmol.Sprite&&t.__webglSprites.push(e);e.__webglActive=!0}}function pt(e){var t=e.geometry,n=e.material,r,i;if(e instanceof $3Dmol.Mesh||e instanceof $3Dmol.Line){for(var s=0,o=t.geometryGroups.length;s<o;s++)r=t.geometryGroups[s],(t.verticesNeedUpdate||t.elementsNeedUpdate||t.colorsNeedUpdate||t.normalsNeedUpdate)&&yt(r,V.STATIC_DRAW);t.verticesNeedUpdate=!1,t.elementsNeedUpdate=!1,t.normalsNeedUpdate=!1,t.colorsNeedUpdate=!1,t.buffersNeedUpdate=!1}}function dt(e,t){e instanceof $3Dmol.Mesh||e instanceof $3Dmol.Line?vt(t.__webglObjects,e):e instanceof $3Dmol.Sprite&&mt(t.__webglSprites,e),e.__webglActive=!1}function vt(e,t){for(var n=e.length-1;n>=0;--n)e[n].object===t&&e.splice(n,1)}function mt(e,t){for(var n=e.length-1;n>=0;--n)e[n]===t&&e.splice(n,1)}function gt(e){var t=e.object,n=t.material;if(n.transparent){e.opaque=null,e.transparent=n;if(!n.wireframe){var r=n.clone();r.opacity=0,e.blank=r}}else e.opaque=n,e.transparent=null}function yt(e,t,n){var r=e.vertexArray,i=e.colorArray;e.__webglOffsetBuffer!==undefined?(V.bindBuffer(V.ARRAY_BUFFER,e.__webglOffsetBuffer),V.bufferData(V.ARRAY_BUFFER,r,t)):(V.bindBuffer(V.ARRAY_BUFFER,e.__webglVertexBuffer),V.bufferData(V.ARRAY_BUFFER,r,t)),V.bindBuffer(V.ARRAY_BUFFER,e.__webglColorBuffer),V.bufferData(V.ARRAY_BUFFER,i,t);if(e.normalArray&&e.__webglNormalBuffer!==undefined){var s=e.normalArray;V.bindBuffer(V.ARRAY_BUFFER,e.__webglNormalBuffer),V.bufferData(V.ARRAY_BUFFER,s,t)}e.radiusArray&&e.__webglRadiusBuffer!==undefined&&(V.bindBuffer(V.ARRAY_BUFFER,e.__webglRadiusBuffer),V.bufferData(V.ARRAY_BUFFER,e.radiusArray,t));if(e.faceArray&&e.__webglFaceBuffer!==undefined){var o=e.faceArray;V.bindBuffer(V.ELEMENT_ARRAY_BUFFER,e.__webglFaceBuffer),V.bufferData(V.ELEMENT_ARRAY_BUFFER,o,t)}if(e.lineArray&&e.__webglLineBuffer!==undefined){var u=e.lineArray;V.bindBuffer(V.ELEMENT_ARRAY_BUFFER,e.__webglLineBuffer),V.bufferData(V.ELEMENT_ARRAY_BUFFER,u,t)}}function bt(e){e.radiusArray&&(e.__webglRadiusBuffer=V.createBuffer()),e.useOffset&&(e.__webglOffsetBuffer=V.createBuffer()),e.__webglVertexBuffer=V.createBuffer(),e.__webglNormalBuffer=V.createBuffer(),e.__webglColorBuffer=V.createBuffer(),e.__webglFaceBuffer=V.createBuffer(),e.__webglLineBuffer=V.createBuffer(),d.info.memory.geometries++}function wt(e){e.__webglVertexBuffer=V.createBuffer(),e.__webglColorBuffer=V.createBuffer(),d.info.memory.geometries++}function Et(e,t,n){e.push({buffer:t,object:n,opaque:null,transparent:null})}function St(e,t){e._modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld),e._normalMatrix.getInverse(e._modelViewMatrix),e._normalMatrix.transpose()}function xt(e){return(e&e-1)===0}function Tt(e){return V.LINEAR}function Nt
(e,t,n){n?(V.texParameteri(e,V.TEXTURE_WRAP_S,Ct(t.wrapS)),V.texParameteri(e,V.TEXTURE_WRAP_T,Ct(t.wrapT)),V.texParameteri(e,V.TEXTURE_MAG_FILTER,Ct(t.magFilter)),V.texParameteri(e,V.TEXTURE_MIN_FILTER,Ct(t.minFilter))):(V.texParameteri(e,V.TEXTURE_WRAP_S,V.CLAMP_TO_EDGE),V.texParameteri(e,V.TEXTURE_WRAP_T,V.CLAMP_TO_EDGE),V.texParameteri(e,V.TEXTURE_MAG_FILTER,Tt(t.magFilter)),V.texParameteri(e,V.TEXTURE_MIN_FILTER,Tt(t.minFilter)))}function Ct(e){return e===$3Dmol.UnsignedByteType?V.UNSIGNED_BYTE:e===$3Dmol.RGBAFormat?V.RGBA:0}function kt(e,t){var n,r,i,s,o=0,u=0,a=0,f,l,c,h,p=X,d=p.directional.colors,v=p.directional.positions,m=0,g=0,y=0;for(n=0,r=t.length;n<r;n++){i=t[n],f=i.color,c=i.intensity,h=i.distance;if(i instanceof $3Dmol.Light){m++,z.getPositionFromMatrix(i.matrixWorld),U.getPositionFromMatrix(i.target.matrixWorld),z.sub(U),z.normalize();if(z.x===0&&z.y===0&&z.z===0)continue;v[y]=z.x,v[y+1]=z.y,v[y+2]=z.z,d[y]=f.r*c,d[y+1]=f.g*c,d[y+2]=f.b*c,y+=3,g++}}p.ambient[0]=o,p.ambient[1]=u,p.ambient[2]=a,p.directional.length=g}function Lt(){try{if(!(V=t.getContext("experimental-webgl",{alpha:r,premultipliedAlpha:i,antialias:s,stencil:o,preserveDrawingBuffer:u}))&&!(V=t.getContext("webgl",{alpha:r,premultipliedAlpha:i,antialias:s,stencil:o,preserveDrawingBuffer:u})))throw"Error creating WebGL context."}catch(e){console.error(e)}}function At(){V.clearColor(0,0,0,1),V.clearDepth(1),V.clearStencil(0),V.enable(V.DEPTH_TEST),V.depthFunc(V.LEQUAL),V.frontFace(V.CCW),V.cullFace(V.BACK),V.enable(V.CULL_FACE),V.enable(V.BLEND),V.blendEquation(V.FUNC_ADD),V.blendFunc(V.SRC_ALPHA,V.ONE_MINUS_SRC_ALPHA),V.clearColor(a.r,a.g,a.b,f)}e=e||{};var t=e.canvas!==undefined?e.canvas:document.createElement("canvas"),n=e.precision!==undefined?e.precision:"highp",r=e.alpha!==undefined?e.alpha:!0,i=e.premultipliedAlpha!==undefined?e.premultipliedAlpha:!0,s=e.antialias!==undefined?e.antialias:!1,o=e.stencil!==undefined?e.stencil:!0,u=e.preserveDrawingBuffer!==undefined?e.preserveDrawingBuffer:!1,a=e.clearColor!==undefined?new $3Dmol.Color(e.clearColor):new $3Dmol.Color(0),f=e.clearAlpha!==undefined?e.clearAlpha:0,l=new $3Dmol.MeshOutlineMaterial(e.outline),c=new $3Dmol.SphereImposterOutlineMaterial(e.outline),h=new $3Dmol.StickImposterOutlineMaterial(e.outline),p=!!e.outline;this.domElement=t,this.context=null,this.devicePixelRatio=e.devicePixelRatio!==undefined?e.devicePixelRatio:self.devicePixelRatio!==undefined?self.devicePixelRatio:1,t.id=e.id,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.autoUpdateObjects=!0,this.autoUpdateScene=!0,this.renderPluginsPost=[],this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var d=this,v=[],m=0,g=null,y=null,b=-1,w=null,E=null,S=0,x=0,T=-1,N=-1,C=-1,k=-1,L=-1,A=-1,O=-1,M=-1,_=null,D=null,P=null,H=null,B=0,j=0,F=0,I=0,q={},R=new $3Dmol.Matrix4,U=new $3Dmol.Vector3,z=new $3Dmol.Vector3,W=!0,X={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}},V;Lt(),At(),this.context=V;var $=V.getExtension("ANGLE_instanced_arrays"),J=V.getExtension("EXT_frag_depth");this.supportedExtensions=function(){return{supportsAIA:Boolean($),supportsImposters:Boolean(J)}},this.getContext=function(){return V},this.getPrecision=function(){return n},this.setClearColorHex=function(e,t){a.setHex(e),f=t,V.clearColor(a.r,a.g,a.b,f)},this.enableOutline=function(e){l=new $3Dmol.MeshOutlineMaterial(e),c=new $3Dmol.SphereImposterOutlineMaterial(e),h=new $3Dmol.StickImposterOutlineMaterial(e),p=!0},this.disableOutline=function(){p=!1},this.setSize=function(e,n){B=t.width=e*this.devicePixelRatio,j=t.height=n*this.devicePixelRatio,t.style.width=e+"px",t.style.height=n+"px",V.viewport(0,0,V.drawingBufferWidth,V.drawingBufferHeight)},this.clear=function(e,t,n){var r=0;if(e===undefined||e)r|=V.COLOR_BUFFER_BIT;if(t===undefined||t)r|=V.DEPTH_BUFFER_BIT;if(n===undefined||n)r|=V.STENCIL_BUFFER_BIT;V.clear(r)},this.clearTarget=function(e,t,n){this.clear(e,t,n)},this.setMaterialFaces=function(e,t){var n=e.side===$3Dmol.DoubleSide,r=e.side===$3Dmol.BackSide;r=t?!r:r,T!==n&&(n?V.disable(V.CULL_FACE):V.enable(V.CULL_FACE),T=n),N!==r&&(r?V.frontFace(V.CW):V.frontFace(V.CCW),N=r)},this.setDepthTest=function(e){O!==e&&(e?V.enable(V.DEPTH_TEST):V.disable(V.DEPTH_TEST),O=e)},this.setDepthWrite=function(e){M!==e&&(V.depthMask(e),M=e)},this.setBlending=function(e){e?(V.enable(V.BLEND),V.blendEquationSeparate(V.FUNC_ADD,V.FUNC_ADD),V.blendFuncSeparate(V.SRC_ALPHA,V.ONE_MINUS_SRC_ALPHA,V.ONE,V.ONE_MINUS_SRC_ALPHA)):V.disable(V.BLEND),C=e},this.addPostPlugin=function(e){e.init(this),this.renderPluginsPost.push(e)};var et=function(e){var t=e.target;t.removeEventListener("dispose",et),rt(t),d.info.memory.geometries--},tt=function(e){var t=e.target;t.removeEventListener("dispose",tt),st(t),d.info.memory.textures--},nt=function(e){var t=e.target;t.removeEventListener("dispose",nt),it(t)},rt=function(e){e.__webglInit=undefined,e.__webglVertexBuffer!==undefined&&V.deleteBuffer(e.__webglVertexBuffer),e.__webglColorBuffer!==undefined&&V.deleteBuffer(e.__webglColorBuffer);if(e.geometryGroups!==undefined)for(var t=0,n=e.groups;t<n;t++){var r=e.geometryGroups[t];r.__webglVertexBuffer!==undefined&&V.deleteBuffer(r.__webglVertexBuffer),r.__webglColorBuffer!==undefined&&V.deleteBuffer(r.__webglColorBuffer),r.__webglNormalBuffer!==undefined&&V.deleteBuffer(r.__webglNormalBuffer),r.__webglFaceBuffer!==undefined&&V.deleteBuffer(r.__webglFaceBuffer),r.__webglLineBuffer!==undefined&&V.deleteBuffer(r.__webglLineBuffer)}},it=function(e){var t=e.program;if(t===undefined)return;e.program=undefined;var n,r,i,s=!1;for(n=0,r=v.length;n<r;n++){i=v[n];if(i.program===t){i.usedTimes--,i.usedTimes===0&&(s=!0);break}}if(s===!0){var o=[];for(n=0,r=v.length;n<r;n++)i=v[n],i.program!==t&&o.push(i);v=o,V.deleteProgram(t),d.info.memory.programs--}},st=function(e){if(e.image&&e.image.__webglTextureCube)V.deleteTexture(e.image.__webglTextureCube);else{if(!e.__webglInit)return;e.__webglInit=!1,V.deleteTexture(e.__webglTexture)}};this.initMaterial=function(e,t,n,r){e.addEventListener("dispose",nt);var i,s,o,u,a,f,l,c,h;h=e.shaderID;if(h){var p=$3Dmol.ShaderLib[h];e.vertexShader=p.vertexShader,e.fragmentShader=p.fragmentShader,e.uniforms=$3Dmol.ShaderUtils.clone(p.uniforms)}a={wireframe:e.wireframe,fragdepth:e.imposter},e.program=ut(e.fragmentShader,e.vertexShader,e.uniforms,a)},this.renderBuffer=function(e,t,n,r,i,s){if(!r.visible)return;var o,u,a,f,l,c,h,p;o=at(e,t,n,r,s),u=o.attributes;var v=!1,m=r.wireframe?1:0,g=i.id*16777215+o.id*2+m;g!==w&&(w=g,v=!0),v&&(G(),u.position>=0&&(V.bindBuffer(V.ARRAY_BUFFER,i.__webglVertexBuffer),Q(u.position),V.vertexAttribPointer(u.position,3,V.FLOAT,!1,0,0)),u.color>=0&&(V.bindBuffer(V.ARRAY_BUFFER,i.__webglColorBuffer),Q(u.color),V.vertexAttribPointer(u.color,3,V.FLOAT,!1,0,0)),u.normal>=0&&(V.bindBuffer(V.ARRAY_BUFFER,i.__webglNormalBuffer),Q(u.normal),V.vertexAttribPointer(u.normal,3,V.FLOAT,!1,0,0)),u.offset>=0&&(V.bindBuffer(V.ARRAY_BUFFER,i.__webglOffsetBuffer),Q(u.offset),V.vertexAttribPointer(u.offset,3,V.FLOAT,!1,0,0)),u.radius>=0&&(V.bindBuffer(V.ARRAY_BUFFER,i.__webglRadiusBuffer),Q(u.radius),V.vertexAttribPointer(u.radius,1,V.FLOAT,!1,0,0)));var y,b;if(s instanceof $3Dmol.Mesh){if(r.shaderID==="instanced"){var E=r.sphere.geometryGroups[0];v&&(V.bindBuffer(V.ARRAY_BUFFER,i.__webglVertexBuffer),V.bufferData(V.ARRAY_BUFFER,E.vertexArray,V.STATIC_DRAW),V.bindBuffer(V.ARRAY_BUFFER,i.__webglNormalBuffer),V.bufferData(V.ARRAY_BUFFER,E.normalArray,V.STATIC_DRAW),V.bindBuffer(V.ELEMENT_ARRAY_BUFFER,i.__webglFaceBuffer),V.bufferData(V.ELEMENT_ARRAY_BUFFER,E.faceArray,V.STATIC_DRAW)),y=E.faceidx,$.vertexAttribDivisorANGLE(u.offset,1),$.vertexAttribDivisorANGLE(u.radius,1),$.vertexAttribDivisorANGLE(u.color,1),$.drawElementsInstancedANGLE(V.TRIANGLES,y,V.UNSIGNED_SHORT,0,i.radiusArray.length),$.vertexAttribDivisorANGLE(u.offset,0),$.vertexAttribDivisorANGLE(u.radius,0),$.vertexAttribDivisorANGLE(u.color,0)}else r.wireframe?(b=i.lineidx,Z(r.wireframeLinewidth),v&&V.bindBuffer(V.ELEMENT_ARRAY_BUFFER,i.__webglLineBuffer),V.drawElements(V.LINES,b,V.UNSIGNED_SHORT,0)):(y=i.faceidx,v&&V.bindBuffer(V.ELEMENT_ARRAY_BUFFER,i.__webglFaceBuffer),V.drawElements(V.TRIANGLES,y,V.UNSIGNED_SHORT,0));d.info.render.calls++,d.info.render.vertices+=y,d.info.render.faces+=y/3}else s instanceof $3Dmol.Line&&(b=i.vertices,Z(r.linewidth),V.drawArrays(V.LINES,0,b),d.info.render.calls++)},this.render=function(e,t,n){if(t instanceof $3Dmol.Camera==0){console.error("$3Dmol.Renderer.render: camera is not an instance of $3Dmol.Camera.");return}var r,i,s,o,u,a=e.__lights,f=e.fog;b=-1,W=!0,this.autoUpdateScene&&e.updateMatrixWorld(),t.parent===undefined&&t.updateMatrixWorld(),t.matrixWorldInverse.getInverse(t.matrixWorld),R.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this.autoUpdateObjects&&this.initWebGLObjects(e),d.info.render.calls=0,d.info.render.vertices=0,d.info.render.faces=0,d.info.render.points=0,F=B,I=j,(this.autoClear||n)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),u=e.__webglObjects;for(r=0,i=u.length;r<i;r++)s=u[r],o=s.object,s.render=!1,o.visible&&(St(o,t),gt(s),s.render=!0);var l=null;this.setBlending(!1),lt(e.__webglObjects,!0,"opaque",t,a,f,!1,l),lt(e.__webglObjects,!0,"blank",t,a,f,!0,l),lt(e.__webglObjects,!1,"transparent",t,a,f,!0,l),ct(this.renderPluginsPost,e,t),this.setDepthTest(!0),this.setDepthWrite(!0)},this.initWebGLObjects=function(e){e.__webglObjects||(e.__webglObjects=[],e.__webglObjectsImmediate=[],e.__webglSprites=[],e.__webglFlares=[]);if(e.__objectsAdded.length){while(e.__objectsAdded.length)ht(e.__objectsAdded[0],e),e.__objectsAdded.splice(0,1);w=-1}while(e.__objectsRemoved.length)dt(e.__objectsRemoved[0],e),e.__objectsRemoved.splice(0,1);for(var t=0,n=e.__webglObjects.length;t<n;t++)pt(e.__webglObjects[t].object)},this.setTexture=function(e,t){if(e.needsUpdate){e.__webglInit||(e.__webglInit=!0,e.addEventListener("dispose",tt),e.__webglTexture=V.createTexture(),d.info.memory.textures++),V.activeTexture(V.TEXTURE0+t),V.bindTexture(V.TEXTURE_2D,e.__webglTexture),V.pixelStorei(V.UNPACK_FLIP_Y_WEBGL,e.flipY),V.pixelStorei(V.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),V.pixelStorei(V.UNPACK_ALIGNMENT,e.unpackAlignment);var n=e.image,r=xt(n.width)&&xt(n.height),i=Ct(e.format),s=Ct(e.type);Nt(V.TEXTURE_2D,e,r);var o,u=e.mipmaps;if(u.length>0&&r){for(var a=0,f=u.length;a<f;a++)o=u[a],V.texImage2D(V.TEXTURE_2D,a,i,i,s,o);e.generateMipmaps=!1}else V.texImage2D(V.TEXTURE_2D,0,i,i,s,e.image);e.generateMipmaps&&r&&V.generateMipmap(V.TEXTURE_2D),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()}else V.activeTexture(V.TEXTURE0+t),V.bindTexture(V.TEXTURE_2D,e.__webglTexture)},this.addPostPlugin(new $3Dmol.SpritePlugin)},$3Dmol.Scene=function(){$3Dmol.Object3D.call(this),this.fog=null,this.overrideMaterial=null,this.matrixAutoUpdate=!1,this.__objects=[],this.__lights=[],this.__objectsAdded=[],this.__objectsRemoved=[]},$3Dmol.Scene.prototype=Object.create($3Dmol.Object3D.prototype),$3Dmol.Scene.prototype.__addObject=function(e){if(e instanceof $3Dmol.Light)this.__lights.indexOf(e)===-1&&this.__lights.push(e),e.target&&e.target.parent===undefined&&this.add(e.target);else if(this.__objects.indexOf(e)===-1){this.__objects.push(e),this.__objectsAdded.push(e);var t=this.__objectsRemoved.indexOf(e);t!==-1&&this.__objectsRemoved.splice(n,1)}for(var n=0;n<e.children.length;n++)this.__addObject(e.children[n])},$3Dmol.Scene.prototype.__removeObject=function(e){var t;if(e instanceof $3Dmol.Light)t=this.__lights.indexOf(e),t!==-1&&this.__lights.splice(t,1);else{t=this.__objects.indexOf(e);if(t!==-1){this.__objects.splice(t,1),this.__objectsRemoved.push(e);var n=this.__objectsAdded.indexOf(e);n!==-1&&this.__objectsAdded.splice(t,1)}}for(var r=0;r<e.children.length;r++)this.__removeObject(e.children[r])},$3Dmol.Fog=function(e,t,n){this.name="",this.color=new $3Dmol.Color(e),this.near=t!==undefined?t:1,this.far=n!==undefined?n:1e3},$3Dmol.Fog.prototype.clone=function(){return new $3Dmol.Fog(this.color.getHex(),this.near,this.far)},$3Dmol.ShaderUtils={clone:function(e){var t,n,r,i,s={};for(t in e){s[t]={},s[t].type=e[t].type;var o=e[t].value;o instanceof $3Dmol.Color?s[t].value=o.clone():typeof o=="number"?s[t].value=o:o instanceof Array?s[t].value=[]:console.error("Error copying shader uniforms from ShaderLib: unknown type for uniform")}return s},stickimposterFragmentShader:["uniform float opacity;","uniform mat4 projectionMatrix;","uniform vec3 fogColor;","uniform float fogNear;","uniform float fogFar;","varying vec3 vLight;","varying vec3 vColor;","varying vec3 cposition;","varying vec3 p1;","varying vec3 p2;","varying float r;","void main() {","    vec3 color = abs(vColor);","    vec3 pos = cposition;","    vec3 p = pos;","    vec3 v = normalize(pos);","    vec3 pa = p1;","    vec3 va = normalize(p2-p1);","    vec3 tmp1 = v-(dot(v,va)*va);","    vec3 deltap = p-pa;","    float A = dot(tmp1,tmp1);","    if(A == 0.0) discard;","    vec3 tmp2 = deltap-(dot(deltap,va)*va);","    float B = 2.0*dot(tmp1, tmp2);","    float C = dot(tmp2,tmp2)-r*r;","    float det = (B*B) - (4.0*A*C);","    if(det < 0.0) discard;","    float sqrtDet = sqrt(det);","    float posT = (-B+sqrtDet)/(2.0*A);","    float negT = (-B-sqrtDet)/(2.0*A);","    float intersectionT = min(posT,negT);","    vec3 qi = p+v*intersectionT;","    float dotp1 = dot(va,qi-p1);","    float dotp2 = dot(va,qi-p2);","    vec3 norm;","    if( dotp1 < 0.0 || dotp2 > 0.0) {","       vec3 cp;","       if( dotp1 < 0.0) {        cp = p1;","       } else {","          cp = p2;","       }","       vec3 diff = p-cp;","       A = dot(v,v);","       B = dot(diff,v)*2.0;","       C = dot(diff,diff)-r*r;","       det = (B*B) - (4.0*C);","       if(det < 0.0) discard;","       sqrtDet = sqrt(det);","       posT = (-B+sqrtDet)/(2.0);","       negT = (-B-sqrtDet)/(2.0);","       float t = min(posT,negT);","       qi = p+v*t;","       norm = normalize(qi-cp);","    } else {","       norm = normalize(qi-(dotp1*va + p1));","    }","    vec4 clipPos = projectionMatrix * vec4(qi, 1.0);","    float ndcDepth = clipPos.z / clipPos.w;","    float depth = ((gl_DepthRange.diff * ndcDepth) + gl_DepthRange.near + gl_DepthRange.far) / 2.0;","    gl_FragDepthEXT = depth;"].join("\n")},$3Dmol.ShaderLib={basic:{fragmentShader:["uniform mat4 viewMatrix;","uniform float opacity;","uniform vec3 fogColor;","uniform float fogNear;","uniform float fogFar;","varying vec3 vColor;","void main() {","    gl_FragColor = vec4( vColor, opacity );","    float depth = gl_FragCoord.z / gl_FragCoord.w;","    float fogFactor = smoothstep( fogNear, fogFar, depth );","    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}"].join("\n"),vertexShader:["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","attribute vec3 position;","attribute vec3 color;","varying vec3 vColor;","void main() {","    vColor = color;","    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","    gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),uniforms:{opacity:{type:"f",value:1},fogColor:{type:"c",value:new $3Dmol.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3}}},sphereimposter:{fragmentShader:["uniform mat4 viewMatrix;","uniform float opacity;","uniform mat4 projectionMatrix;","uniform vec3 fogColor;","uniform float fogNear;","uniform float fogFar;","uniform float uDepth;","uniform vec3 directionalLightColor[ 1 ];","varying vec3 vColor;","varying vec2 mapping;","varying float rval;","varying vec3 vLight;","varying vec3 center;","void main() {","    float lensqr = dot(mapping,mapping);","    float rsqr = rval*rval;","    if(lensqr > rsqr)","       discard;","    float z = sqrt(rsqr-lensqr);","    vec3 cameraPos = center+ vec3(mapping.x,mapping.y,z);","    vec4 clipPos = projectionMatrix * vec4(cameraPos, 1.0);","    float ndcDepth = clipPos.z / clipPos.w;","    gl_FragDepthEXT = ((gl_DepthRange.diff * ndcDepth) + gl_DepthRange.near + gl_DepthRange.far) / 2.0;","    vec3 norm = normalize(vec3(mapping.x,mapping.y,z));","    float dotProduct = dot( norm, vLight );","    vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );","    vec3 vLight = directionalLightColor[ 0 ] * directionalLightWeighting;","    gl_FragColor = vec4(vLight*vColor, opacity*opacity );","    float fogFactor = smoothstep( fogNear, fogFar, gl_FragDepthEXT/gl_FragCoord.w );","    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}"].join("\n"),vertexShader:["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 directionalLightColor[ 1 ];","uniform vec3 directionalLightDirection[ 1 ];","attribute vec3 position;","attribute vec3 normal;","attribute vec3 color;","varying vec2 mapping;","varying vec3 vColor;","varying float rval;","varying vec3 vLight;","varying vec3 center;","void main() {","    vColor = color;","    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","    center = mvPosition.xyz;","    vec4 projPosition = projectionMatrix * mvPosition;","    vec4 adjust = projectionMatrix* vec4(normal,0.0); adjust.z = 0.0; adjust.w = 0.0;","    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );","    vLight = normalize( lDirection.xyz );","    mapping = normal.xy;","    rval = abs(normal.x);","    gl_Position = projPosition+adjust;","}"].join("\n"),uniforms:{opacity:{type:"f",value:1},fogColor:{type:"c",value:new $3Dmol.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}},lambert:{fragmentShader:["uniform mat4 viewMatrix;","uniform float opacity;","uniform vec3 fogColor;","uniform float fogNear;","uniform float fogFar;","varying vec3 vLightFront;","varying vec3 vColor;","void main() {","    gl_FragColor = vec4( vec3 ( 1.0 ), opacity );","    #ifndef WIREFRAME","    gl_FragColor.xyz *= vLightFront;","    #endif","    gl_FragColor = gl_FragColor * vec4( vColor, opacity );","    float depth = gl_FragCoord.z / gl_FragCoord.w;","    float fogFactor = smoothstep( fogNear, fogFar, depth );","    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}"].join("\n"),vertexShader:["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 directionalLightColor[ 1 ];","uniform vec3 directionalLightDirection[ 1 ];","attribute vec3 position;","attribute vec3 normal;","attribute vec3 color;","varying vec3 vColor;","varying vec3 vLightFront;","void main() {","    vColor = color;","    vec3 objectNormal = normal;","    vec3 transformedNormal = normalMatrix * objectNormal;","    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","    vLightFront = vec3( 0.0 );","    transformedNormal = normalize( transformedNormal );","    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );","    vec3 dirVector = normalize( lDirection.xyz );","    float dotProduct = dot( transformedNormal, dirVector );","    vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );","    vLightFront += directionalLightColor[ 0 ] * directionalLightWeighting;","    gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),uniforms:{opacity:{type:"f",value:1},fogColor:{type:"c",value:new $3Dmol.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}},instanced:{fragmentShader:["uniform mat4 viewMatrix;","uniform float opacity;","uniform vec3 fogColor;","uniform float fogNear;","uniform float fogFar;","varying vec3 vLightFront;","varying vec3 vColor;","void main() {","    gl_FragColor = vec4( vec3 ( 1.0 ), opacity );","    #ifndef WIREFRAME","    gl_FragColor.xyz *= vLightFront;","    #endif","    gl_FragColor = gl_FragColor * vec4( vColor, opacity );","    float depth = gl_FragCoord.z / gl_FragCoord.w;","    float fogFactor = smoothstep( fogNear, fogFar, depth );","    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}"].join("\n"),vertexShader:["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 directionalLightColor[ 1 ];","uniform vec3 directionalLightDirection[ 1 ];","attribute vec3 offset;","attribute vec3 position;","attribute vec3 normal;","attribute vec3 color;","attribute float radius;","varying vec3 vColor;","varying vec3 vLightFront;","void main() {","    vColor = color;","    vec3 objectNormal = normal;","    vec3 transformedNormal = normalMatrix * objectNormal;","    vec4 mvPosition = modelViewMatrix * vec4( position * radius + offset, 1.0 );","    vLightFront = vec3( 0.0 );","    transformedNormal = normalize( transformedNormal );","    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );","    vec3 dirVector = normalize( lDirection.xyz );","    float dotProduct = dot( transformedNormal, dirVector );","    vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );","    vLightFront += directionalLightColor[ 0 ] * directionalLightWeighting;","    gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),uniforms:{opacity:{type:"f",value:1},fogColor:{type:"c",value:new $3Dmol.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}},outline:{fragmentShader:["uniform float opacity;","uniform vec3 outlineColor;","uniform vec3 fogColor;","uniform float fogNear;","uniform float fogFar;","void main() {","    gl_FragColor = vec4( outlineColor, 1 );","}"].join("\n"),vertexShader:["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float outlineWidth;","uniform float outlinePushback;","attribute vec3 position;","attribute vec3 normal;","attribute vec3 color;","void main() {","    vec4 norm = modelViewMatrix*vec4(normalize(normal),0.0);","    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","    mvPosition.xy += norm.xy*outlineWidth;","    gl_Position = projectionMatrix * mvPosition;","    mvPosition.z -= outlinePushback;","    vec4 pushpos = projectionMatrix*mvPosition;","    gl_Position.z = gl_Position.w*pushpos.z/pushpos.w;","}"].join("\n"),uniforms:{opacity:{type:"f",value:1},outlineColor:{type:"c",value:new $3Dmol.Color(0,0,0)},fogColor:{type:"c",value:new $3Dmol.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},outlineWidth:{type:"f",value:.1},outlinePushback:{type:"f",value:1}}},sphereimposteroutline:{fragmentShader:["uniform float opacity;","uniform vec3 outlineColor;","uniform vec3 fogColor;","uniform float fogNear;","uniform float fogFar;","uniform mat4 projectionMatrix;","varying vec2 mapping;","varying float rval;","varying vec3 center;","uniform float outlinePushback;","void main() {","    float lensqr = dot(mapping,mapping);","    float rsqr = rval*rval;","    if(lensqr > rsqr)","       discard;","    float z = sqrt(rsqr-lensqr);","    vec3 cameraPos = center+ vec3(mapping.x,mapping.y,z-outlinePushback);","    vec4 clipPos = projectionMatrix * vec4(cameraPos, 1.0);","    float ndcDepth = clipPos.z / clipPos.w;","    gl_FragDepthEXT = ((gl_DepthRange.diff * ndcDepth) + gl_DepthRange.near + gl_DepthRange.far) / 2.0;","    gl_FragColor = vec4(outlineColor, 1 );","}"].join("\n"),vertexShader:["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float outlineWidth;","uniform float outlinePushback;","attribute vec3 position;","attribute vec3 normal;","attribute vec3 color;","varying vec2 mapping;","varying float rval;","varying vec3 center;","void main() {","    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","    center = mvPosition.xyz;","    vec4 projPosition = projectionMatrix * mvPosition;","    vec2 norm = normal.xy + vec2(sign(normal.x)*outlineWidth,sign(normal.y)*outlineWidth);","    vec4 adjust = projectionMatrix* vec4(norm,normal.z,0.0); adjust.z = 0.0; adjust.w = 0.0;","    mapping = norm.xy;","    rval = abs(norm.x);","    gl_Position = projPosition+adjust;","}"].join("\n"),uniforms:{opacity:{type:"f",value:1},outlineColor:{type:"c",value:new $3Dmol.Color(0,0,0)},fogColor:{type:"c",value:new $3Dmol.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},outlineWidth:{type:"f",value:.1},outlinePushback:{type:"f",value:1}}},stickimposter:{fragmentShader:[$3Dmol.ShaderUtils.stickimposterFragmentShader,"    float dotProduct = dot( norm, vLight );","    vec3 light = vec3( max( dotProduct, 0.0 ) );","    gl_FragColor = vec4(light*color, opacity*opacity );","    float fogFactor = smoothstep( fogNear, fogFar, depth );","    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}"].join("\n"),vertexShader:["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 directionalLightColor[ 1 ];","uniform vec3 directionalLightDirection[ 1 ];","attribute vec3 position;","attribute vec3 normal;","attribute vec3 color;","attribute float radius;","varying vec3 vColor;","varying vec3 vLight;","varying vec3 cposition;","varying vec3 p1;","varying vec3 p2;","varying float r;","void main() {","    vColor = color; vColor.z = abs(vColor.z);","    r = abs(radius);","    vec4 to = modelViewMatrix*vec4(normal, 1.0);","    vec4 pt = modelViewMatrix*vec4(position, 1.0);","    vec4 mvPosition = pt;","    p1 = pt.xyz; p2 = to.xyz;","    vec3 norm = to.xyz-pt.xyz;","    float mult = 1.1;","    if(length(p1) > length(p2)) {","       mvPosition = to;","    }","    vec3 n = normalize(mvPosition.xyz);","    if(color.z >= 0.0) {","       vec3 pnorm = normalize(p1);","       float t = dot(mvPosition.xyz-p1,n)/dot(pnorm,n);","       mvPosition.xyz = p1+t*pnorm;","    } else {","       vec3 pnorm = normalize(p2);","       float t = dot(mvPosition.xyz-p2,n)/dot(pnorm,n);","       mvPosition.xyz = p2+t*pnorm;","       mult *= -1.0;","    }","    vec3 cr = normalize(cross(mvPosition.xyz,norm))*radius;","    vec3 doublecr = normalize(cross(mvPosition.xyz,cr))*radius;","    mvPosition.xy +=  mult*(cr + doublecr).xy;","    cposition = mvPosition.xyz;","    gl_Position = projectionMatrix * mvPosition;","    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );","    vLight = normalize( lDirection.xyz )*directionalLightColor[0];","}"].join("\n"),uniforms:{opacity:{type:"f",value:1},fogColor:{type:"c",value:new $3Dmol.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}},stickimposteroutline:{fragmentShader:$3Dmol.ShaderUtils.stickimposterFragmentShader+"gl_FragColor = vec4(color,1.0);}",vertexShader:["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 directionalLightColor[ 1 ];","uniform vec3 directionalLightDirection[ 1 ];","uniform vec3 outlineColor;","uniform float outlineWidth;","uniform float outlinePushback;","attribute vec3 position;","attribute vec3 normal;","attribute vec3 color;","attribute float radius;","varying vec3 vColor;","varying vec3 vLight;","varying vec3 cposition;","varying vec3 p1;","varying vec3 p2;","varying float r;","void main() {","    vColor = outlineColor;","    float rad = radius+sign(radius)*outlineWidth;","    r = abs(rad);","    vec4 to = modelViewMatrix*vec4(normal, 1.0);","    vec4 pt = modelViewMatrix*vec4(position, 1.0);","    to.xyz += normalize(to.xyz)*outlinePushback;","    pt.xyz += normalize(pt.xyz)*outlinePushback;","    vec4 mvPosition = pt;","    p1 = pt.xyz; p2 = to.xyz;","    vec3 norm = to.xyz-pt.xyz;","    float mult = 1.1;","    if(length(p1) > length(p2)) {","       mvPosition = to;","    }","    vec3 n = normalize(mvPosition.xyz);","    if(color.z >= 0.0) {","       vec3 pnorm = normalize(p1);","       float t = dot(mvPosition.xyz-p1,n)/dot(pnorm,n);","       mvPosition.xyz = p1+t*pnorm;","    } else {","       vec3 pnorm = normalize(p2);","       float t = dot(mvPosition.xyz-p2,n)/dot(pnorm,n);","       mvPosition.xyz = p2+t*pnorm;","       mult *= -1.0;","    }","    vec3 cr = normalize(cross(mvPosition.xyz,norm))*rad;","    vec3 doublecr = normalize(cross(mvPosition.xyz,cr))*rad;","    mvPosition.xy +=  mult*(cr + doublecr).xy;","    cposition = mvPosition.xyz;","    gl_Position = projectionMatrix * mvPosition;","    vLight = vec3(1.0,1.0,1.0);","}"].join("\n"),uniforms:{opacity:{type:"f",value:1},fogColor:{type:"c",value:new $3Dmol.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},outlineColor:{type:"c",value:new $3Dmol.Color(0,0,0)},outlineWidth:{type:"f",value:.1},outlinePushback:{type:"f",value:1}}},lambertdouble:{fragmentShader:["uniform mat4 viewMatrix;","uniform float opacity;","uniform vec3 fogColor;","uniform float fogNear;","uniform float fogFar;","varying vec3 vLightFront;","varying vec3 vLightBack;","varying vec3 vColor;","void main() {","    gl_FragColor = vec4( vec3 ( 1.0 ), opacity );","    #ifndef WIREFRAME","    if ( gl_FrontFacing )","       gl_FragColor.xyz *= vLightFront;","    else","       gl_FragColor.xyz *= vLightBack;","    #endif","    gl_FragColor = gl_FragColor * vec4( vColor, opacity );","    float depth = gl_FragCoord.z / gl_FragCoord.w;","    float fogFactor = smoothstep( fogNear, fogFar, depth );","    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}"].join("\n"),vertexShader:["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 directionalLightColor[ 1 ];","uniform vec3 directionalLightDirection[ 1 ];","attribute vec3 position;","attribute vec3 normal;","attribute vec3 color;","varying vec3 vColor;","varying vec3 vLightFront;","varying vec3 vLightBack;","void main() {","    vColor = color;","    vec3 objectNormal = normal;","    vec3 transformedNormal = normalMatrix * objectNormal;","    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","    vLightFront = vec3( 0.0 );","    vLightBack = vec3( 0.0 );","    transformedNormal = normalize( transformedNormal );","    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );","    vec3 dirVector = normalize( lDirection.xyz );","    float dotProduct = dot( transformedNormal, dirVector );","    vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );","    vec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","    vLightFront += directionalLightColor[ 0 ] * directionalLightWeighting;","    vLightBack += directionalLightColor[ 0 ] * directionalLightWeightingBack;","    gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),uniforms:{opacity:{type:"f",value:1},fogColor:{type:"c",value:new $3Dmol.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}},sprite:{fragmentShader:["uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","    vec4 texture = texture2D(map, vUV);","    if (texture.a < alphaTest) discard;","    gl_FragColor = vec4(color * texture.xyz, texture.a * opacity);","    if (fogType > 0) {","        float depth = gl_FragCoord.z / gl_FragCoord.w;","        float fogFactor = 0.0;","        if (fogType == 1) {","            fogFactor = smoothstep(fogNear, fogFar, depth);","        }","        else {","            const float LOG2 = 1.442695;","            float fogFactor = exp2(- fogDensity * fogDensity * depth * depth * LOG2);","            fogFactor = 1.0 - clamp(fogFactor, 0.0, 1.0);","        }","        gl_FragColor = mix(gl_FragColor, vec4(fogColor, gl_FragColor.w), fogFactor);","    }","}"].join("\n"),vertexShader:["uniform int useScreenCoordinates;","uniform vec3 screenPosition;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 alignment;","uniform vec2 uvOffset;"
,"uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","    vUV = uvOffset + uv * uvScale;","    vec2 alignedPosition = position + alignment;","    vec2 rotatedPosition;","    rotatedPosition.x = ( cos(rotation) * alignedPosition.x - sin(rotation) * alignedPosition.y ) * scale.x;","    rotatedPosition.y = ( sin(rotation) * alignedPosition.x + cos(rotation) * alignedPosition.y ) * scale.y;","    vec4 finalPosition;","    if(useScreenCoordinates != 0) {","        finalPosition = vec4(screenPosition.xy + rotatedPosition, screenPosition.z, 1.0);","    }","    else {","        finalPosition = projectionMatrix * modelViewMatrix * vec4(0.0, 0.0, 0.0, 1.0); finalPosition /= finalPosition.w;","        finalPosition.xy += rotatedPosition; ","    }","    gl_Position = finalPosition;","}"].join("\n"),uniforms:{}}},typeof console=="undefined"&&(console={log:function(){}}),$3Dmol.ProteinSurface=function(){var e=1,t=2,n=4,r=0,s=0,o=0,u=1.4,a=2,f=a,l=0,c=0,h=0,p=0,d=null,v=null,m=null,g=0,y=0,b=0,w=0,E=0,S=0,x=0,T=0,N={H:1.2,Li:1.82,Na:2.27,K:2.75,C:1.7,N:1.55,O:1.52,F:1.47,P:1.8,S:1.8,CL:1.75,BR:1.85,SE:1.9,ZN:1.39,CU:1.4,NI:1.63,X:2},C=function(e){return!e.elem||typeof N[e.elem]=="undefined"?"X":e.elem},L={},A={},O,M,_=[new Int32Array([1,0,0]),new Int32Array([-1,0,0]),new Int32Array([0,1,0]),new Int32Array([0,-1,0]),new Int32Array([0,0,1]),new Int32Array([0,0,-1]),new Int32Array([1,1,0]),new Int32Array([1,-1,0]),new Int32Array([-1,1,0]),new Int32Array([-1,-1,0]),new Int32Array([1,0,1]),new Int32Array([1,0,-1]),new Int32Array([-1,0,1]),new Int32Array([-1,0,-1]),new Int32Array([0,1,1]),new Int32Array([0,1,-1]),new Int32Array([0,-1,1]),new Int32Array([0,-1,-1]),new Int32Array([1,1,1]),new Int32Array([1,1,-1]),new Int32Array([1,-1,1]),new Int32Array([-1,1,1]),new Int32Array([1,-1,-1]),new Int32Array([-1,-1,1]),new Int32Array([-1,1,-1]),new Int32Array([-1,-1,-1])],D,P=function(e,t,n){return e<D[0][0]||e>D[1][0]?!1:t<D[0][1]||t>D[1][1]?!1:n<D[0][2]||n>D[1][2]?!1:!0};this.getFacesAndVertices=function(e){var t={},n,i;for(n=0,i=e.length;n<i;n++)t[e[n]]=!0;var u=M;for(n=0,i=u.length;n<i;n++)u[n].x=u[n].x/f-r,u[n].y=u[n].y/f-s,u[n].z=u[n].z/f-o;var a=[];for(n=0,i=O.length;n<i;n+=3){var l=O[n],c=O[n+1],h=O[n+2],p=u[l].atomid,g=u[c].atomid,y=u[h].atomid,b=p;g<b&&(b=g),y<b&&(b=y);if(!t[b])continue;var w=u[O[n]],E=u[O[n+1]],S=u[O[n+2]];l!==c&&c!==h&&l!==h&&(a.push(l),a.push(c),a.push(h))}return d=null,v=null,m=null,{vertices:u,faces:a}},this.initparm=function(e,t,n){n>1e6&&(f=a/2);var i=1/f*5.5;D=e,b=e[0][0],S=e[1][0],w=e[0][1],x=e[1][1],E=e[0][2],T=e[1][2],t?(b-=u+i,w-=u+i,E-=u+i,S+=u+i,x+=u+i,T+=u+i):(b-=i,w-=i,E-=i,S+=i,x+=i,T+=i),b=Math.floor(b*f)/f,w=Math.floor(w*f)/f,E=Math.floor(E*f)/f,S=Math.ceil(S*f)/f,x=Math.ceil(x*f)/f,T=Math.ceil(T*f)/f,r=-b,s=-w,o=-E,h=Math.ceil(f*(S-b))+1,c=Math.ceil(f*(x-w))+1,l=Math.ceil(f*(T-E))+1,this.boundingatom(t),p=u*f,d=new Uint8Array(h*c*l),v=new Float64Array(h*c*l),m=new Int32Array(h*c*l)},this.boundingatom=function(e){var t=[],n,r,i,s;flagradius=e;for(var o in N){if(!N.hasOwnProperty(o))continue;var a=N[o];e?t[o]=(a+u)*f+.5:t[o]=a*f+.5,i=t[o]*t[o],A[o]=Math.floor(t[o])+1,L[o]=new Int32Array(A[o]*A[o]),indx=0;for(j=0;j<A[o];j++)for(k=0;k<A[o];k++)n=j*j+k*k,n>i?L[o][indx]=-1:(r=Math.sqrt(i-n),L[o][indx]=Math.floor(r)),indx++}},this.fillvoxels=function(n,r){var i,s;for(i=0,s=d.length;i<s;i++)d[i]=0,v[i]=-1,m[i]=-1;for(i in r){var o=n[r[i]];if(o===undefined)continue;this.fillAtom(o,n)}for(i=0,s=d.length;i<s;i++)d[i]&e&&(d[i]|=t)},this.fillAtom=function(t,n){var i,u,a,p,v,g,y,b,w,E,S,x,T,N,k,O,M,_,D;i=Math.floor(.5+f*(t.x+r)),u=Math.floor(.5+f*(t.y+s)),a=Math.floor(.5+f*(t.z+o));var P=C(t),H=0,B=0,j=c*l;for(E=0,D=A[P];E<D;E++)for(S=0;S<D;S++){if(L[P][H]!=-1)for(O=-1;O<2;O++)for(M=-1;M<2;M++)for(_=-1;_<2;_++)if(O!==0&&M!==0&&_!==0){y=O*E,w=_*S;for(x=0;x<=L[P][H];x++){b=x*M,T=i+y,N=u+b,k=a+w;if(T<0||N<0||k<0||T>=h||N>=c||k>=l)continue;var F=T*j+N*l+k;if(!(d[F]&e))d[F]|=e,m[F]=t.serial;else{var I=n[m[F]];I.serial!=t.serial&&(p=i+y-Math.floor(.5+f*(I.x+r)),v=u+b-Math.floor(.5+f*(I.y+s)),g=a+w-Math.floor(.5+f*(I.z+o)),y*y+b*b+w*w<p*p+v*v+g*g&&(m[F]=t.serial))}}}H++}},this.fillvoxelswaals=function(e,n){var r,i;for(r=0,i=d.length;r<i;r++)d[r]&=~t;for(r in n){var s=e[n[r]];if(s===undefined)continue;this.fillAtomWaals(s,e)}},this.fillAtomWaals=function(e,n){var i,u,a,p,v,g,y=0,b,w,E,S,x,T,N,k,O,M,_,D,P;i=Math.floor(.5+f*(e.x+r)),u=Math.floor(.5+f*(e.y+s)),a=Math.floor(.5+f*(e.z+o));var H=C(e),B=c*l;for(N=0,P=A[H];N<P;N++)for(k=0;k<P;k++){if(L[H][y]!=-1)for(M=-1;M<2;M++)for(_=-1;_<2;_++)for(D=-1;D<2;D++)if(M!==0&&_!==0&&D!==0){b=M*N,E=D*k;for(O=0;O<=L[H][y];O++){w=O*_,S=i+b,x=u+w,T=a+E;if(S<0||x<0||T<0||S>=h||x>=c||T>=l)continue;var j=S*B+x*l+T;if(!(d[j]&t))d[j]|=t,m[j]=e.serial;else{var F=n[m[j]];F.serial!=e.serial&&(p=i+b-Math.floor(.5+f*(F.x+r)),v=u+w-Math.floor(.5+f*(F.y+s)),g=a+E-Math.floor(.5+f*(F.z+o)),b*b+w*w+E*E<p*p+v*v+g*g&&(m[j]=e.serial))}}}y++}},this.buildboundary=function(){var t=c*l;for(i=0;i<h;i++)for(j=0;j<l;j++)for(k=0;k<c;k++){var r=i*t+k*l+j;if(d[r]&e){var s=!1,o=0;while(o<26){var u=i+_[o][0],a=j+_[o][2],f=k+_[o][1];if(u>-1&&u<h&&f>-1&&f<c&&a>-1&&a<l&&!(d[u*t+f*l+a]&e)){d[r]|=n;break}o++}}}};var H=function(e,t,n){var r=new Int32Array(e*t*n*3);this.set=function(e,i,s,o){var u=((e*t+i)*n+s)*3;r[u]=o.ix,r[u+1]=o.iy,r[u+2]=o.iz},this.get=function(e,i,s){var o=((e*t+i)*n+s)*3;return{ix:r[o],iy:r[o+1],iz:r[o+2]}}};this.fastdistancemap=function(){var r=0,i,s,o,u,a,m=new H(h,c,l),g=c*l,y=p*p,b=[],w=[],E;for(s=0;s<h;s++)for(o=0;o<c;o++)for(u=0;u<l;u++){E=s*g+o*l+u,d[E]&=~t;if(d[E]&e&&d[E]&n){var S={ix:s,iy:o,iz:u};m.set(s,o,u,S),b.push(S),v[E]=0,d[E]|=t,d[E]&=~n}}do{w=this.fastoneshell(b,m),b=[];for(s=0,a=w.length;s<a;s++)E=g*w[s].ix+l*w[s].iy+w[s].iz,d[E]&=~n,v[E]<=1.0404*y&&b.push({ix:w[s].ix,iy:w[s].iy,iz:w[s].iz})}while(b.length!==0);b=[],w=[],m=null;var x=f-.5;x<0&&(x=0);var T=y-.5/(.1+x);for(s=0;s<h;s++)for(o=0;o<c;o++)for(u=0;u<l;u++)E=s*g+o*l+u,d[E]&=~n,d[E]&e&&(!(d[E]&t)||d[E]&t&&v[E]>=T)&&(d[E]|=n)},this.fastoneshell=function(r,i){var s,o,u,a,f,p,m,g,y,b,w,E,S=[];if(r.length===0)return S;tnv={ix:-1,iy:-1,iz:-1};var x=c*l;for(m=0,y=r.length;m<y;m++){s=r[m].ix,o=r[m].iy,u=r[m].iz,w=i.get(s,o,u);for(g=0;g<6;g++)tnv.ix=s+_[g][0],tnv.iy=o+_[g][1],tnv.iz=u+_[g][2],tnv.ix<h&&tnv.ix>-1&&tnv.iy<c&&tnv.iy>-1&&tnv.iz<l&&tnv.iz>-1&&(E=tnv.ix*x+l*tnv.iy+tnv.iz,d[E]&e&&!(d[E]&t)?(i.set(tnv.ix,tnv.iy,u+_[g][2],w),a=tnv.ix-w.ix,f=tnv.iy-w.iy,p=tnv.iz-w.iz,b=a*a+f*f+p*p,v[E]=b,d[E]|=t,d[E]|=n,S.push({ix:tnv.ix,iy:tnv.iy,iz:tnv.iz})):d[E]&e&&d[E]&t&&(a=tnv.ix-w.ix,f=tnv.iy-w.iy,p=tnv.iz-w.iz,b=a*a+f*f+p*p,b<v[E]&&(i.set(tnv.ix,tnv.iy,tnv.iz,w),v[E]=b,d[E]&n||(d[E]|=n,S.push({ix:tnv.ix,iy:tnv.iy,iz:tnv.iz})))))}for(m=0,y=r.length;m<y;m++){s=r[m].ix,o=r[m].iy,u=r[m].iz,w=i.get(s,o,u);for(g=6;g<18;g++)tnv.ix=s+_[g][0],tnv.iy=o+_[g][1],tnv.iz=u+_[g][2],tnv.ix<h&&tnv.ix>-1&&tnv.iy<c&&tnv.iy>-1&&tnv.iz<l&&tnv.iz>-1&&(E=tnv.ix*x+l*tnv.iy+tnv.iz,d[E]&e&&!(d[E]&t)?(i.set(tnv.ix,tnv.iy,u+_[g][2],w),a=tnv.ix-w.ix,f=tnv.iy-w.iy,p=tnv.iz-w.iz,b=a*a+f*f+p*p,v[E]=b,d[E]|=t,d[E]|=n,S.push({ix:tnv.ix,iy:tnv.iy,iz:tnv.iz})):d[E]&e&&d[E]&t&&(a=tnv.ix-w.ix,f=tnv.iy-w.iy,p=tnv.iz-w.iz,b=a*a+f*f+p*p,b<v[E]&&(i.set(tnv.ix,tnv.iy,tnv.iz,w),v[E]=b,d[E]&n||(d[E]|=n,S.push({ix:tnv.ix,iy:tnv.iy,iz:tnv.iz})))))}for(m=0,y=r.length;m<y;m++){s=r[m].ix,o=r[m].iy,u=r[m].iz,w=i.get(s,o,u);for(g=18;g<26;g++)tnv.ix=s+_[g][0],tnv.iy=o+_[g][1],tnv.iz=u+_[g][2],tnv.ix<h&&tnv.ix>-1&&tnv.iy<c&&tnv.iy>-1&&tnv.iz<l&&tnv.iz>-1&&(E=tnv.ix*x+l*tnv.iy+tnv.iz,d[E]&e&&!(d[E]&t)?(i.set(tnv.ix,tnv.iy,u+_[g][2],w),a=tnv.ix-w.ix,f=tnv.iy-w.iy,p=tnv.iz-w.iz,b=a*a+f*f+p*p,v[E]=b,d[E]|=t,d[E]|=n,S.push({ix:tnv.ix,iy:tnv.iy,iz:tnv.iz})):d[E]&e&&d[E]&t&&(a=tnv.ix-w.ix,f=tnv.iy-w.iy,p=tnv.iz-w.iz,b=a*a+f*f+p*p,b<v[E]&&(i.set(tnv.ix,tnv.iy,tnv.iz,w),v[E]=b,d[E]&n||(d[E]|=n,S.push({ix:tnv.ix,iy:tnv.iy,iz:tnv.iz})))))}return S},this.marchingcubeinit=function(e){for(var r=0,i=d.length;r<i;r++)e==1?d[r]&=~n:e==4?(d[r]&=~t,d[r]&n&&(d[r]|=t),d[r]&=~n):e==2?d[r]&n&&d[r]&t?d[r]&=~n:d[r]&n&&!(d[r]&t)&&(d[r]|=t):e==3&&(d[r]&=~n)};var B=function(){var e=Array(256);for(var t=0;t<256;t++)e[t]=[];this.incrementUsed=function(t,n){typeof e[t][n]=="undefined"&&(e[t][n]={used:0,unused:0}),e[t][n].used++},this.incrementUnused=function(t,n){typeof e[t][n]=="undefined"&&(e[t][n]={used:0,unused:0}),e[t][n].unused++};var n=function(e){var t="[";for(var n=0;n<e.length;n++){var r=0,i=e[n];for(var s=0;s<i.length;s++)r|=1<<i[s];t+="0x"+r.toString(16)+", "}t+="]",console.log(t)};this.print=function(){var t=MarchingCube.triTable,r,i=[];for(var s=0;s<t.length;s++){var o=[];for(var u=0;u<t[s].length;u+=3){var a=u/3;if(typeof e[s][a]=="undefined"||!e[s][a].unused)o.push(t[s][u]),o.push(t[s][u+1]),o.push(t[s][u+2]);typeof e[s][a]=="undefined"&&console.log("undef "+s+","+a)}i.push(o)}console.log(JSON.stringify(i)),n(i)}};this.marchingcube=function(e){this.marchingcubeinit(e),M=[],O=[],$3Dmol.MarchingCube.march(d,M,O,{smooth:1,nX:h,nY:c,nZ:l});var t=c*l;for(var n=0,r=M.length;n<r;n++)M[n].atomid=m[M[n].x*t+l*M[n].y+M[n].z];$3Dmol.MarchingCube.laplacianSmooth(1,M,O)}},$3Dmol.autoload=function(e){$(".viewer_3Dmoljs")[0]!==undefined&&($3Dmol.autoinit=!0);if($3Dmol.autoinit){e=e!=undefined?e:null,$3Dmol.viewers={};var t=0;$(".viewer_3Dmoljs").each(function(){var n=$(this),r=[];n.css("position")=="static"&&n.css("position","relative");var i=typeof window[n.data("callback")]=="function"?window[n.data("callback")]:null,s=null;n.data("pdb")?(r.push("https://files.rcsb.org/view/"+n.data("pdb")+".pdb"),s="pdb"):n.data("cid")?(s="sdf",r.push("https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/"+n.data("cid")+"/SDF?record_type=3d")):n.data("href")&&r.push(n.data("href"));var o=n.data();for(var u in o)u.substring(0,3)==="pdb"&&u!=="pdb"?r.push("https://files.rcsb.org/view/"+o[u]+".pdb"):u.substring(0,4)==="href"&&u!=="href"?r.push(o[u]):u.substring(0,3)==="cid"&&u!=="cid"&&r.push("https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/"+o[u]+"/SDF?record_type=3d");var a={};n.data("options")&&(a=$3Dmol.specStringToObject(n.data("options")));var f=$3Dmol.CC.color(n.data("backgroundcolor")),l={line:{}};n.data("style")&&(l=$3Dmol.specStringToObject(n.data("style")));var c={};n.data("select")&&(c=$3Dmol.specStringToObject(n.data("select")));var h=[],p=[],d=[],v=n.data(),m=/style(.+)/,g=/surface(.*)/,y=/labelres(.*)/,b=[];for(var w in v)v.hasOwnProperty(w)&&b.push(w);b.sort();for(var u=0;u<b.length;u++){var w=b[u],E=m.exec(w);if(E){var S="select"+E[1],x=$3Dmol.specStringToObject(v[S]),T=$3Dmol.specStringToObject(v[w]);h.push([x,T])}E=g.exec(w);if(E){var S="select"+E[1],x=$3Dmol.specStringToObject(v[S]),T=$3Dmol.specStringToObject(v[w]);p.push([x,T])}E=y.exec(w);if(E){var S="select"+E[1],x=$3Dmol.specStringToObject(v[S]),T=$3Dmol.specStringToObject(v[w]);d.push([x,T])}}var N=function(e){e.setStyle(c,l);for(var t=0;t<h.length;t++){var n=h[t][0]||{},r=h[t][1]||{line:{}};e.setStyle(n,r)}for(var t=0;t<p.length;t++){var n=p[t][0]||{},r=p[t][1]||{};e.addSurface($3Dmol.SurfaceType.VDW,r,n,n)}for(var t=0;t<d.length;t++){var n=d[t][0]||{},r=d[t][1]||{};e.addResLabels(n,r)}e.zoomTo(),e.render()},C=e;try{C==null&&(C=$3Dmol.viewers[this.id||t++]=$3Dmol.createViewer(n,{defaultcolors:$3Dmol.rasmolElementColors})),C.setBackgroundColor(f)}catch(k){console.log(k),window.location="http://get.webgl.org"}if(r.length!=0)for(var u=0;u<r.length;u++)val=u,uri=r[u],s=n.data("type")||n.data("datatype")||s,s||(s=uri.substr(uri.lastIndexOf(".")+1)),$.get(uri,function(e){C.addModel(e,s,a),N(C),i&&val==r.length-1&&i(C)},"text");else{if(n.data("element")){var L=$("#"+n.data("element")).val()||"",s=n.data("type")||n.data("datatype");s||(console.log("Warning: No type specified for embedded viewer with moldata from "+n.data("element")+"\n assuming type 'pdb'"),s="pdb"),C.addModel(L,s,a)}N(C),i&&i(C)}})}},$(document).ready(function(){$3Dmol.autoload()}),function(){$3Dmol.elementColors.greenCarbon.C=65280,$3Dmol.elementColors.cyanCarbon.C=65535,$3Dmol.elementColors.magentaCarbon.C=16711935,$3Dmol.elementColors.yellowCarbon.C=16776960,$3Dmol.elementColors.whiteCarbon.C=16777215,$3Dmol.elementColors.orangeCarbon.C=16737792,$3Dmol.elementColors.purpleCarbon.C=8388736,$3Dmol.elementColors.blueCarbon.C=255},$3Dmol.CC={cache:{0:new $3Dmol.Color(0)},color:function e(t){if(!t)return this.cache[0];if(typeof this.cache[t]!="undefined")return this.cache[t];if(t&&t.constructor===Array)return t.map(e,this);t=this.getHex(t);if(typeof t=="number"){var n=new $3Dmol.Color(t);return this.cache[t]=n,n}return t},colorTab:{white:16777215,silver:12632256,gray:8421504,grey:8421504,black:0,red:16711680,maroon:8388608,yellow:16776960,orange:16737792,olive:8421376,lime:65280,green:32768,aqua:65535,cyan:65535,teal:32896,blue:255,navy:128,fuchsia:16711935,magenta:16711935,purple:8388736},getHex:function(e){return isNaN(parseInt(e))?typeof e=="string"?(e=e.trim(),e.length==4&&e[0]=="#"&&(e="#"+e[1]+e[1]+e[2]+e[2]+e[3]+e[3]),e.length==7&&e[0]=="#"?parseInt(e.substring(1),16):this.colorTab[e.toLowerCase()]||0):e:parseInt(e)}},$3Dmol.CC=$3Dmol.CC,$3Dmol.CC.color=$3Dmol.CC.color,$3Dmol.ssColors=$3Dmol.ssColors||{},$3Dmol.ssColors.pyMol={h:16711680,s:16776960,c:65280},$3Dmol.ssColors.Jmol={h:16711808,s:16762880,c:16777215},$3Dmol.elementColors=$3Dmol.elementColors||{},$3Dmol.elementColors.defaultColor=16716947,$3Dmol.elementColors.Jmol={H:16777215,D:16777215,T:16777215,He:14286847,HE:14286847,Li:13402367,LI:13402367,B:16758197,C:9474192,N:3166456,O:16715021,F:9494608,Na:11230450,NA:11230450,Mg:9109248,MG:9109248,Al:12560038,AL:12560038,Si:1578e4,SI:1578e4,P:16744448,S:16777008,Cl:2093087,CL:2093087,Ca:4062976,CA:4062976,Ti:12567239,TI:12567239,Cr:9083335,CR:9083335,Mn:10255047,MN:10255047,Fe:14706227,FE:14706227,Ni:5296208,NI:5296208,Cu:13140019,CU:13140019,Zn:8224944,ZN:8224944,Br:10889513,BR:10889513,Ag:12632256,AG:12632256,I:9699476,Ba:51456,BA:51456,Au:16765219,AU:16765219},$3Dmol.elementColors.rasmol={H:16777215,D:16777215,T:16777215,He:16761035,HE:16761035,Li:11674146,LI:11674146,B:65280,C:13158600,N:9408511,O:15728640,F:14329120,Na:255,NA:255,Mg:2263842,MG:2263842,Al:8421520,AL:8421520,Si:14329120,SI:14329120,P:16753920,S:16762930,Cl:65280,CL:65280,Ca:8421520,CA:8421520,Ti:8421520,TI:8421520,Cr:8421520,CR:8421520,Mn:8421520,MN:8421520,Fe:16753920,FE:16753920,Ni:10824234,NI:10824234,Cu:10824234,CU:10824234,Zn:10824234,ZN:10824234,Br:10824234,BR:10824234,Ag:8421520,AG:8421520,I:10494192,Ba:16753920,BA:16753920,Au:14329120,AU:14329120},$3Dmol.elementColors.defaultColors=$3Dmol.elementColors.rasmol,$3Dmol.elementColors.greenCarbon=$.extend({},$3Dmol.elementColors.defaultColors),$3Dmol.elementColors.greenCarbon.C=65280,$3Dmol.elementColors.cyanCarbon=$.extend({},$3Dmol.elementColors.defaultColors),$3Dmol.elementColors.cyanCarbon.C=65535,$3Dmol.elementColors.magentaCarbon=$.extend({},$3Dmol.elementColors.defaultColors),$3Dmol.elementColors.magentaCarbon.C=16711935,$3Dmol.elementColors.yellowCarbon=$.extend({},$3Dmol.elementColors.defaultColors),$3Dmol.elementColors.yellowCarbon.C=16776960,$3Dmol.elementColors.whiteCarbon=$.extend({},$3Dmol.elementColors.defaultColors),$3Dmol.elementColors.whiteCarbon.C=16777215,$3Dmol.elementColors.orangeCarbon=$.extend({},$3Dmol.elementColors.defaultColors),$3Dmol.elementColors.orangeCarbon.C=16737792,$3Dmol.elementColors.purpleCarbon=$.extend({},$3Dmol.elementColors.defaultColors),$3Dmol.elementColors.purpleCarbon.C=8388736,$3Dmol.elementColors.blueCarbon=$.extend({},$3Dmol.elementColors.defaultColors),$3Dmol.elementColors.blueCarbon.C=255,$3Dmol.residues={},$3Dmol.residues.amino={Ala:13158600,Arg:1334015,Asn:56540,Asp:15075850,Cys:15132160,Gln:56540,Glu:15075850,Gly:15461355,His:8553170,Ile:1016335,Leu:1016335,Lys:1334015,Met:15132160,Phe:3289770,Pro:14456450,Ser:16422400,Thr:16422400,Trp:11819700,Tyr:3289770,Val:1016335,Asx:16738740,Glx:16738740,other:12492910},$3Dmol.residues.shapely={Ala:9240460,Arg:124,Asn:16743536,Asp:10485826,Cys:16777072,Gln:16731212,Glu:6684672,Gly:16777215,His:7368959,Ile:19456,Leu:4546117,Lys:4671416,Met:12099650,Phe:5459026,Pro:5395026,Ser:16740418,Thr:12078080,Trp:5195264,Tyr:9203788,Val:16747775,Asx:16711935,Glx:16711935,other:16711935},$3Dmol.residues.nucleic={A:10526975,G:16740464,I:8454143,C:16747595,T:10551200,U:16744576},$3Dmol.chains={},$3Dmol.chains.atom={A:12636415,B:11599792,C:16761032,D:16777088,E:16761087,F:11596016,G:16765040,H:15761536,I:16113331,J:49151,K:13458524,L:6737322,M:10145074,N:15631086,O:52945,P:65407,Q:3978097,R:139,S:12433259,T:25600,U:8388608,V:8421376,W:8388736,X:32896,Y:12092939,Z:11674146},$3Dmol.chains.hetatm={A:9478351,B:8441752,C:13602992,D:13619056,E:13603023,F:8437952,G:13607008,H:12603504,I:12955267,J:42959,K:11881548,L:5682578,M:9090346,N:12481214,O:46753,P:53103,Q:3447649,R:187,S:10854235,T:37888,U:11534336,V:11579392,W:11534512,X:45232,Y:15250963,Z:12726834},$3Dmol.builtinColorSchemes={ssPyMol:{prop:"ss",map:$3Dmol.ssColors.pyMol},ssJmol:{prop:"ss",map:$3Dmol.ssColors.Jmol},Jmol:{prop:"elem",map:$3Dmol.elementColors.Jmol},"default":{prop:"elem",map:$3Dmol.elementColors.defaultColors},greenCarbon:{prop:"elem",map:$3Dmol.elementColors.greenCarbon},cyanCarbon:{prop:"elem",map:$3Dmol.elementColors.cyanCarbon},magentaCarbon:{prop:"elem",map:$3Dmol.elementColors.magentaCarbon},yellowCarbon:{prop:"elem",map:$3Dmol.elementColors.yellowCarbon},whiteCarbon:{prop:"elem",map:$3Dmol.elementColors.whiteCarbon},orangeCarbon:{prop:"elem",map:$3Dmol.elementColors.orangeCarbon},purpleCarbon:{prop:"elem",map:$3Dmol.elementColors.purpleCarbon},blueCarbon:{prop:"elem",map:$3Dmol.elementColors.blueCarbon},amino:{prop:"resAmino",map:$3Dmol.residues.amino},shapely:{prop:"resShapely",map:$3Dmol.residues.shapely},nucleic:{prop:"resNucleic",map:$3Dmol.residues.nucleic},chain:{prop:"chain",map:$3Dmol.chains.atom},chainHetatm:{prop:"chain",map:$3Dmol.chains.hetatm}},$3Dmol.getColorFromStyle=function(e,t){var n=t.colorscheme;typeof $3Dmol.builtinColorSchemes[n]!="undefined"&&(n=$3Dmol.builtinColorSchemes[n]);var r=e.color;typeof t.color!="undefined"&&t.color!="spectrum"&&(r=t.color);if(typeof n!="undefined")if(typeof $3Dmol.builtinColorSchemes[n]!="undefined")typeof n[e[n.prop]]!="undefined"&&(r=n.map[e[n.prop]]);else if(typeof $3Dmol.elementColors[n]!="undefined"){var n=$3Dmol.elementColors[n];typeof n[e[n.prop]]!="undefined"&&(r=n.map[e[n.prop]])}else if(typeof n[e[n.prop]]!="undefined")r=n.map[e[n.prop]];else if(typeof n.prop!="undefined"&&typeof n.gradient!="undefined"){var i=n.prop,s=n.gradient;typeof $3Dmol.Gradient.builtinGradients[s]!="undefined"&&(s=new $3Dmol.Gradient.builtinGradients[s](n.min,n.max,n.mid));var o=s.range()||[-1,1],u=$3Dmol.getAtomProperty(e,i);u!=null&&(r=s.valueToHex(u,o))}else if(typeof n.prop!="undefined"&&typeof n.map!="undefined"){var i=n.prop,u=$3Dmol.getAtomProperty(e,i);typeof n.map[u]!="undefined"&&(r=n.map[u])}else typeof t.colorscheme[e.elem]!="undefined"?r=t.colorscheme[e.elem]:console.log("Could not interpret colorscheme "+n);else typeof t.colorfunc!="undefined"&&(r=t.colorfunc(e));var a=$3Dmol.CC.color(r);return a};var $3Dmol=$3Dmol||{};$3Dmol.drawCartoon=function(){var e=5,t=5,n=.2,r=1.3,i=.8,s=.1,o=.4,u=function(e,t){var n=[],r=e;r=[],r.push(e[0]);var i,s,o,u,a,f,l,c,h;for(i=1,s=e.length-1;i<s;i++){a=e[i],f=e[i+1];if(a.smoothen){var p=new $3Dmol.Vector3((a.x+f.x)/2,(a.y+f.y)/2,(a.z+f.z)/2);p.atom=a.atom,r.push(p)}else r.push(a)}r.push(e[e.length-1]);for(i=-1,o=r.length;i<=o-3;i++){u=r[i===-1?0:i],a=r[i+1],f=r[i+2],l=r[i===o-3?o-1:i+3],c=(new $3Dmol.Vector3).subVectors(f,u).multiplyScalar(.5),h=(new $3Dmol.Vector3).subVectors(l,a).multiplyScalar(.5);if(f.skip)continue;for(var d=0;d<t;d++){var v=1/t*d,m=a.x+v*c.x+v*v*(-3*a.x+3*f.x-2*c.x-h.x)+v*v*v*(2*a.x-2*f.x+c.x+h.x),g=a.y+v*c.y+v*v*(-3*a.y+3*f.y-2*c.y-h.y)+v*v*v*(2*a.y-2*f.y+c.y+h.y),y=a.z+v*c.z+v*v*(-3*a.z+3*f.z-2*c.z-h.z)+v*v*v*(2*a.z-2*f.z+c.z+h.z),b=new $3Dmol.Vector3(m,g,y);d<t/2?b.atom=a.atom:b.atom=f.atom,n.push(b)}}return n.push(r[r.length-1]),n},a=function(e,t,n,r,i,s){var o,u,a,f;for(var l=0,c=t.length;l<c;l++){f=Math.round(l*(r.length-1)/c),a=$3Dmol.CC.color(r[f]),geoGroup=e.updateGeoGroup(2);var h=geoGroup.vertexArray,p=geoGroup.colorArray,d=geoGroup.faceArray;o=geoGroup.vertices,u=o*3,h[u]=t[l].x,h[u+1]=t[l].y,h[u+2]=t[l].z,h[u+3]=n[l].x,h[u+4]=n[l].y,h[u+5]=n[l].z;for(var v=0;v<6;++v)p[u+3*v]=a.r,p[u+1+3*v]=a.g,p[u+2+3*v]=a.b;if(l>0){var m=[o,o+1,o-1,o-2],g=geoGroup.faceidx;d[g]=m[0],d[g+1]=m[1],d[g+2]=m[3],d[g+3]=m[1],d[g+4]=m[2],d[g+5]=m[3],geoGroup.faceidx+=6}geoGroup.vertices+=2}},f=function(e,t,n,r,i,s,o){var f,l,c,h;c=t.length;if(c<2||t[0].length<2)return;r=r||axisDIV;for(f=0;f<c;f++)t[f]=u(t[f],r);h=t[0].length;if(!i)return a(e,t[0],t[c-1],n,r,s);var p,d,v,m,g,y,b=[],w=[],E=[];for(l=0;l<c;l++)b.push(.25+1.5*Math.sqrt((c-1)*l-Math.pow(l,2))/(c-1)),w.push(.5),E.push(2*(Math.pow(l/c,2)-l/c)+.6);var S=[];for(l=0;l<c*2-1;l++)S[l]=[l,l+1,l+1-2*c,l-2*c];S[c*2-1]=[l,l+1-2*c,l+1-4*c,l-2*c];var x,T,N,C,k,L,A,O=e.updateGeoGroup(2*c*h);for(f=0;f<h;f++){A=Math.round(f*(n.length-1)/h),L=$3Dmol.CC.color(n[A]),g=v,y=m,v=[],m=[],p=[],t[0][f].atom!==undefined&&(C=t[0][f].atom,o==="oval"?d=b:o==="rectangle"?d=w:o==="parabola"&&(d=E)),d||(d=w);var M,_;for(l=0;l<c;l++)f<h-1?M=t[l][f+1].clone().sub(t[l][f]):M=t[l][f-1].clone().sub(t[l][f]).negate(),l<c-1?_=t[l+1][f].clone().sub(t[l][f]):_=t[l-1][f].clone().sub(t[l][f]).negate(),p[l]=_.cross(M).normalize().multiplyScalar(i*d[l]);for(l=0;l<c;l++)v[l]=t[l][f].clone().add(p[l].clone().negate());for(l=0;l<c;l++)m[l]=t[l][f].clone().add(p[l]);var D=O.vertexArray,P=O.colorArray,H=O.faceArray;x=O.vertices,T=x*3;for(l=0;l<c;l++)D[T+3*l+0]=v[l].x,D[T+3*l+1]=v[l].y,D[T+3*l+2]=v[l].z;for(l=0;l<c;l++)D[T+3*l+0+3*c]=m[c-1-l].x,D[T+3*l+1+3*c]=m[c-1-l].y,D[T+3*l+2+3*c]=m[c-1-l].z;for(l=0;l<2*c;++l)P[T+3*l+0]=L.r,P[T+3*l+1]=L.g,P[T+3*l+2]=L.b;if(f>0){for(l=0;l<c*2;l++){var B=[x+S[l][0],x+S[l][1],x+S[l][2],x+S[l][3]];N=O.faceidx,H[N]=B[0],H[N+1]=B[1],H[N+2]=B[3],H[N+3]=B[1],H[N+4]=B[2],H[N+5]=B[3],O.faceidx+=6}if(C.clickable||C.hoverable){var j=[];j.push(new $3Dmol.Triangle(g[0],v[0],v[c-1])),j.push(new $3Dmol.Triangle(g[0],v[c-1],g[c-1])),j.push(new $3Dmol.Triangle(g[c-1],v[c-1],m[c-1])),j.push(new $3Dmol.Triangle(g[c-1],m[c-1],y[c-1])),j.push(new $3Dmol.Triangle(m[0],y[0],y[c-1])),j.push(new $3Dmol.Triangle(m[c-1],m[0],y[c-1])),j.push(new $3Dmol.Triangle(v[0],g[0],y[0])),j.push(new $3Dmol.Triangle(m[0],v[0],y[0]));for(l in j)C.intersectionShape.triangle.push(j[l])}}O.vertices+=2*c,k=C}var D=O.vertexArray,P=O.colorArray,H=O.faceArray;x=O.vertices,T=x*3,N=O.faceidx;for(f=0;f<c-1;f++){var B=[f,f+1,2*c-2-f,2*c-1-f];N=O.faceidx,H[N]=B[0],H[N+1]=B[1],H[N+2]=B[3],H[N+3]=B[1],H[N+4]=B[2],H[N+5]=B[3],O.faceidx+=6}for(f=0;f<c-1;f++){var B=[x-1-f,x-2-f,x-2*c+f+1,x-2*c+f];N=O.faceidx,H[N]=B[0],H[N+1]=B[1],H[N+2]=B[3],H[N+3]=B[1],H[N+4]=B[2],H[N+5]=B[3],O.faceidx+=6}},l=function(e,t,n,r,i,s){if(t.length<2)return;var o,f;o=t[0],f=t[t.length-1],r=r||axisDIV,o=u(o,r),f=u(f,r);if(!i)return a(e,o,f,n,r,s);var l=[],c=[],h,p,d,v,m,g=[[0,2,-6,-8],[-4,-2,6,4],[7,-1,-5,3],[-3,5,1,-7]],y,b,w,E,S,x,T,N,C,k,L,A,O,M;for(N=0,C=o.length;N<C;N++){S=Math.round(N*(n.length-1)/C),E=$3Dmol.CC.color(n[S]),l.push(p=o[N]),l.push(p),l.push(d=f[N]),l.push(d);if(N<C-1){var _=o[N+1].clone().sub(o[N]),D=f[N].clone().sub(o[N]);h=D.cross(_).normalize().multiplyScalar(i)}l.push(v=o[N].clone().add(h)),l.push(v),l.push(m=f[N].clone().add(h)),l.push(m),p.atom!==undefined&&(x=p.atom),M=e.updateGeoGroup(8);var P=M.vertexArray,H=M.colorArray,B=M.faceArray;y=M.vertices,b=y*3,P[b]=p.x,P[b+1]=p.y,P[b+2]=p.z,P[b+3]=p.x,P[b+4]=p.y,P[b+5]=p.z,P[b+6]=d.x,P[b+7]=d.y,P[b+8]=d.z,P[b+9]=d.x,P[b+10]=d.y,P[b+11]=d.z,P[b+12]=v.x,P[b+13]=v.y,P[b+14]=v.z,P[b+15]=v.x,P[b+16]=v.y,P[b+17]=v.z,P[b+18]=m.x,P[b+19]=m.y,P[b+20]=m.z,P[b+21]=m.x,P[b+22]=m.y,P[b+23]=m.z;for(k=0;k<8;++k)H[b+3*k]=E.r,H[b+1+3*k]=E.g,H[b+2+3*k]=E.b;if(N>0){var j=T!==undefined&&x!==undefined&&T.serial!==x.serial;for(k=0;k<4;k++){var F=[y+g[k][0],y+g[k][1],y+g[k][2],y+g[k][3]];w=M.faceidx,B[w]=F[0],B[w+1]=F[1],B[w+2]=F[3],B[w+3]=F[1],B[w+4]=F[2],B[w+5]=F[3],M.faceidx+=6;if(x.clickable||T.clickable||x.hoverable||T.hoverable){var I=l[F[3]].clone(),q=l[F[0]].clone(),R=l[F[2]].clone(),U=l[F[1]].clone();I.atom=l[F[3]].atom||null,R.atom=l[F[2]].atom||null,q.atom=l[F[0]].atom||null,U.atom=l[F[1]].atom||null;if(j){var z=I.clone().add(q).multiplyScalar(.5),W=R.clone().add(U).multiplyScalar(.5),X=I.clone().add(U).multiplyScalar(.5);if(k%2===0){if(T.clickable||T.hoverable)L=new $3Dmol.Triangle(z,X,I),A=new $3Dmol.Triangle(W,R,X),O=new $3Dmol.Triangle(X,R,I),T.intersectionShape.triangle.push(L),T.intersectionShape.triangle.push(A),T.intersectionShape.triangle.push(O);if(x.clickable||x.hoverable)L=new $3Dmol.Triangle(q,U,X),A=new $3Dmol.Triangle(U,W,X),O=new $3Dmol.Triangle(q,X,z),x.intersectionShape.triangle.push(L),x.intersectionShape.triangle.push(A),x.intersectionShape.triangle.push(O)}else{if(x.clickable||x.hoverable)L=new $3Dmol.Triangle(z,X,I),A=new $3Dmol.Triangle(W,R,X),O=new $3Dmol.Triangle(X,R,I),x.intersectionShape.triangle.push(L),x.intersectionShape.triangle.push(A),x.intersectionShape.triangle.push(O);if(T.clickable||T.hoverable)L=new $3Dmol.Triangle(q,U,X),A=new $3Dmol.Triangle(U,W,X),O=new $3Dmol.Triangle(q,X,z),T.intersectionShape.triangle.push(L),T.intersectionShape.triangle.push(A),T.intersectionShape.triangle.push(O)}}else if(x.clickable||x.hoverable)L=new $3Dmol.Triangle(q,U,I),A=new $3Dmol.Triangle(U,R,I),x.intersectionShape.triangle.push(L),x.intersectionShape.triangle.push(A)}}}M.vertices+=8,T=x}var V=l.length-8;M=e.updateGeoGroup(8);var P=M.vertexArray,H=M.colorArray,B=M.faceArray;y=M.vertices,b=y*3,w=M.faceidx;for(N=0;N<4;N++){l.push(l[N*2]),l.push(l[V+N*2]);var $=l[N*2],J=l[V+N*2];P[b+6*N]=$.x,P[b+1+6*N]=$.y,P[b+2+6*N]=$.z,P[b+3+6*N]=J.x,P[b+4+6*N]=J.y,P[b+5+6*N]=J.z,H[b+6*N]=E.r,H[b+1+6*N]=E.g,H[b+2+6*N]=E.b,H[b+3+6*N]=E.r,H[b+4+6*N]=E.g,H[b+5+6*N]=E.b}V+=8,L=[y,y+2,y+6,y+4],A=[y+1,y+5,y+7,y+3],B[w]=L[0],B[w+1]=L[1],B[w+2]=L[3],B[w+3]=L[1],B[w+4]=L[2],B[w+5]=L[3],B[w+6]=A[0],B[w+7]=A[1],B[w+8]=A[3],B[w+9]=A[1],B[w+10]=A[2],B[w+11]=A[3],M.faceidx+=12,M.vertices+=8;var K=function(e){this.vert=e,this.twin=null,this.next=null},Q=function(e,t,n){edges=[];var r={},i=0;for(var s=0;s<t;s+=3){var o=e[s],u=e[s+1],a=e[s+2],f=new K(o);edges.push(f);var l=new K(u);edges.push(l);var c=new K(a);edges.push(c),f.next=l,l.next=c,c.next=f,r[a|o<<16]=f,r[o|u<<16]=l,r[u|a<<16]=c}for(var h in r)r.hasOwnProperty(h)&&i++;i!=t*3&&console.warn("Bad mesh: duplicated edges or inconsistent winding.len="+i+" faceCount="+t+" vertCount="+n);var p=0;for(var h in r)if(r.hasOwnProperty(h)){var d=(h&65535)<<16|h>>16;r.hasOwnProperty(d)?(r[h].twin=r[d],r[d].twin=r[h]):p+=1}var v=new Uint16Array(t*6);if(p>0){console.log("Mesh is not watertight. Contains "+p+" edges");for(var s=0;s<t;s+=3)v[s*2+0]=edges[s+2].vert,v[s*2+1]=edges[s+0].twin==null?v[s*2+0]:edges[s+0].twin.next.vert,v[s*2+2]=edges[s+0].vert,v[s*2+3]=edges[s+1].twin==null?v[s*2+1]:edges[s+1].twin.next.vert,v[s*2+4]=edges[s+1].vert,v[s*2+5]=edges[s+2].twin==null?v[s*2+2]:edges[s+2].twin.next.vert}else for(var s=0;s<t;s+=3)v[s*2+0]=edges[s+2].vert,v[s*2+1]=edges[s+0].twin.next.vert,v[s*2+2]=edges[s+0].vert,v[s*2+3]=edges[s+1].twin.next.vert,v[s*2+4]=edges[s+1].vert,v[s*2+5]=edges[s+2].twin.next.vert;return v}},c=function(e,t,n,r,i){if(t.length===0)return;i=i===undefined?5:i;var s=new $3Dmol.Geometry,o=u(t,i),a=new $3Dmol.LineBasicMaterial({linewidth:n});a.vertexColors=!0;var f=new $3Dmol.Line(s,a);f.type=$3Dmol.LineStrip,e.add(f)},h=function(e,t,n,r,i,s,o){if(!o||o==="default")o="rectangle";o==="edged"?l(e,t,n,r,i,s):(o==="rectangle"||o==="oval"||o==="parabola")&&f(e,t,n,r,i,s,o)},p=function(e){return e&&e.elem==="C"&&e.atom==="CA"},d=function(e,t){if(e&&t&&e.chain===t.chain){if(e.reschain===t.reschain&&(e.resi===t.resi||e.resi===t.resi-1))return!0;if(e.resi<t.resi){var n=e.x-t.x,r=e.y-t.y,i=e.z-t.z,s=n*n+r*r+i*i;if(s<16)return!0}}return!1},v=function(e,t,n,r,i){if(t==null||t.vertices==0)return;i&&(t.initTypedArrays(),t.setUpNormals());var s=new $3Dmol.MeshDoubleLambertMaterial;s.vertexColors=$3Dmol.FaceColors,typeof n=="number"&&n>=0&&n<1&&(s.transparent=!0,s.opacity=n),s.outline=r;var o=new $3Dmol.Mesh(t,s);e.add(o)},m={C:!0,CA:!0,O:!0,P:!0,OP2:!0,O2P:!0,"O5'":!0,"O3'":!0,"C5'":!0,"C2'":!0,"O5*":!0,"O3*":!0,"C5*":!0,"C2*":!0,N1:!0,N3:!0},g={DA:!0,DG:!0,A:!0,G:!0},y={DT:!0,DC:!0,U:!0,C:!0,T:!0},b={DA:!0,DG:!0,A:!0,G:!0,DT:!0,DC:!0,U:!0,C:!0,T:!0},w=function(n,r,i,s,u,a,f){a=a||e,f=f||t;var l,w,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R=new $3Dmol.Geometry(!0),U=new $3Dmol.Geometry(!0),z=[],W=[],X=1,V=!1,J={};for(var K in $3Dmol.Gradient.builtinGradients)$3Dmol.Gradient.builtinGradients.hasOwnProperty(K)&&(J[K]=new $3Dmol.Gradient.builtinGradients[K](i[0],i[1]));var Q=function(e,t){return i&&t.color==="spectrum"?t.colorscheme in J?J[t.colorscheme].valueToHex(e.resi):J.sinebow.valueToHex(e.resi):$3Dmol.getColorFromStyle(e,t).getHex()};for(var k=0;k<a;k++)W[k]=[];var G=!1,Y=!1;k=0;var Z=[];for(k in r){x=r[k];if(x.elem==="C"&&x.atom==="CA"){var et=d(S,x);et&&x.ss==="s"?G=!0:G&&(S&&w&&S.style.cartoon.arrows&&w.style.cartoon.arrows&&(S.ss="arrow end",S.ss="arrow start"),G=!1),et&&S.ss==="h"?(!Y&&x.style.cartoon.tubes&&(x.ss="tube start"),Y=!0):Y&&S.ss!=="tube start"&&(w&&w.style.cartoon.tubes&&(w.ss="tube end"),Y=!1),w=S,S=x}x&&x.atom in m&&Z.push(x)}var tt=function(e){for(var t=0;!C&&t<a;t++)c(n,W[t],1,z,f,X);s&&W[0].length>0&&h(U,W,z,f,C,X,W.style);if(e){var r=[];for(t=0;t<a;t++)r[t]=W[t][W[t].length-1];var i=z[z.length-1]}W=[];for(t=0;t<a;t++)W[t]=[];z=[];if(e){for(t=0;t<a;t++)W[t].push(r[t]);z.push(i)}v(n,U,X,V,!0),v(n,R,X,V,!1),U=new $3Dmol.Geometry(!0),R=new $3Dmol.Geometry(!0)};S=undefined;for(var nt=0;nt<Z.length;nt++){x=Z[nt];var rt=x.resn.trim(),it=rt in b;X=1,l=x.style.cartoon,S&&S.style.cartoon&&(X=S.style.cartoon.opacity),S&&S.style.cartoon&&S.style.cartoon.outline&&(V=S.style.cartoon.outline),S&&S.style.cartoon&&(!x.style.cartoon||S.style.cartoon.opacity!=x.style.cartoon.opacity)&&tt(S.chain==x.chain),W.length&&W[0].length>3e4/a/f/2&&tt(!0);if(l.style==="trace"){if(!x.hetflag)if(x.elem==="C"&&x.atom==="CA"||it&&x.atom==="P"){N=Q(x,l),$.isNumeric(l.thickness)?C=l.thickness:C=o;if(d(S,x))if(N==T){var st=$3Dmol.CC.color(N);$3Dmol.GLDraw.drawCylinder(R,S,x,C,st,2,2)}else{var ot=(new $3Dmol.Vector3).addVectors(S,x).multiplyScalar(.5),ut=$3Dmol.CC.color(T),at=$3Dmol.CC.color(N);$3Dmol.GLDraw.drawCylinder(R,S,ot,C,ut,2,0),$3Dmol.GLDraw.drawCylinder(R,ot,x,C,at,0,2)}S=x,T=N}}else{if(p(x)||it&&(x.atom==="P"||x.atom.indexOf("O5")==0)){if(q){if(x.ss!=="tube end")continue;q=!1,I=new $3Dmol.Vector3(x.x,x.y,x.z),$3Dmol.GLDraw.drawCylinder(R,F,I,2,$3Dmol.CC.color(T),1,1),x.ss="h"}if(S&&(!d(S,x)||S.ss==="tube start")){S.ss==="tube start"&&(q=!0,F=new $3Dmol.Vector3(S.x,S.y,S.z),S.ss="h"),B&&(D?H=(new $3Dmol.Vector3).addVectors(S,D).multiplyScalar(.5):H=new $3Dmol.Vector3(S.x,S.y,S.z),$3Dmol.GLDraw.drawCylinder(R,H,B,.4,$3Dmol.CC.color(B.color),0,2),E(W,a,!u,D,P,_,S,Z,nt),z.push(N),H=null,B=null);for(k=0;!C&&k<a;k++)c(n,W[k],1,z,f,X);s&&W[0].length>0&&h(U,W,z,f,C,X,W.style),W=[];for(k=0;k<a;k++)W[k]=[];z=[]}if(S===undefined||S.rescode!=x.rescode||S.resi!=x.resi){if(B){H=(new $3Dmol.Vector3).addVectors(S,x).multiplyScalar(.5);var ft=H.clone().sub(B).multiplyScalar(.02);H.add(ft),$3Dmol.GLDraw.drawCylinder(R,H,B,.4,$3Dmol.CC.color(B.color),0,2),H=null,B=null}N=Q(x,l),z.push(N),$.isNumeric(l.thickness)?C=l.thickness:C=o,S=x,O=new $3Dmol.Vector3(S.x,S.y,S.z),O.resi=S.resi,T=N}(x.clickable===!0||x.hoverable===!0)&&(x.intersectionShape===undefined||x.intersectionShape.triangle===undefined)&&(x.intersectionShape={sphere:null,cylinder:[],line:[],triangle:[]})}else if(p(S)&&x.atom==="O"||it&&S.atom==="P"&&(x.atom==="OP2"||x.atom==="O2P")||it&&S.atom.indexOf("O5")==0&&x.atom.indexOf("C5")==0){M=new $3Dmol.Vector3(x.x,x.y,x.z),M.resi=x.resi;if(x.atom==="OP2"||x.atom==="O2P")P=new $3Dmol.Vector3(x.x,x.y,x.z)}else it&&x.atom.indexOf("O3")==0?D=new $3Dmol.Vector3(x.x,x.y,x.z):x.atom==="N1"&&rt in g||x.atom==="N3"&&rt in y?(B=new $3Dmol.Vector3(x.x,x.y,x.z),B.color=$3Dmol.getColorFromStyle(x,l).getHex()):p(S)&&(j=new $3Dmol.Vector3(x.x,x.y,x.z),j.resi=x.resi);if(M&&O&&M.resi===O.resi)E(W,a,!u,O,M,_,S,Z,nt),_=M,O=null,M=null,j=null,z.push(N);else if(O&&j&&j.resi===O.resi){var lt,ct=nt+1;ct<Z.length&&(lt=Z[nt+1]);if(!lt||S.resi!=lt.resi)console.log("Fudging orientation for "+S.resn+S.resi+" as some sites not listed for this residue"),E(W,a,!u,O,j,_,S,Z,nt),_=j,O=null,M=null,j=null,z.push(N)}}}B&&(D?H=(new $3Dmol.Vector3).addVectors(S,D).multiplyScalar
(.5):H=new $3Dmol.Vector3(S.x,S.y,S.z),$3Dmol.GLDraw.drawCylinder(R,H,B,.4,$3Dmol.CC.color(B.color),0,2),E(W,a,!u,D,P,_,S,Z,nt),z.push(N)),tt()},E=function(e,t,s,u,a,f,l,c,h){var p,d,v,m,g,y,b;if(!u||!a||!l)return;var w=a.sub(u);w.normalize();var E=c[h];for(var d=h+1;d<c.length;d++){E=c[d];if(E.atom==l.atom)break}E=E?new $3Dmol.Vector3(E.x,E.y,E.z):new $3Dmol.Vector3(0,0,0),E.sub(u);if(l.ss==="arrow start"){var S=E.clone().multiplyScalar(.3).cross(a);u.add(S);var x=E.clone().cross(w).normalize();w.rotateAboutVector(x,.43)}l.style.cartoon.ribbon?p=l.style.cartoon.thickness||o:l.style.cartoon.width?p=l.style.cartoon.width:l.ss==="c"?l.atom==="P"?p=i:p=n:l.ss==="arrow start"?(p=r,g=!0):l.ss==="arrow end"?p=n:l.ss==="h"&&l.style.cartoon.tubes||l.ss==="tube start"?p=n:p=r,f!=null&&w.dot(f)<0&&w.negate(),w.multiplyScalar(p);for(d=0;d<t;d++)v=-1+d*2/(t-1),m=new $3Dmol.Vector3(u.x+v*w.x,u.y+v*w.y,u.z+v*w.z),m.atom=l,s&&l.ss==="s"&&(m.smoothen=!0),e[d].push(m);if(g){w.multiplyScalar(2);for(d=0;d<t;d++)v=-1+d*2/(t-1),m=new $3Dmol.Vector3(u.x+v*w.x,u.y+v*w.y,u.z+v*w.z),m.atom=l,m.smoothen=!1,m.skip=!0,e[d].push(m)}b=l.style.cartoon.style||"default",e.style?e.style!=b&&(console.log("Warning: a cartoon chain's strand-style is ambiguous"),e.style="default"):e.style=b;if(l.ss==="arrow start"||l.ss==="arrow end")l.ss="s";return g},S=function(e,t,n,r){r=parseInt(parseFloat(r)*5)||5,w(e,t,n,!0,!1,r,r)};return S}();var $3Dmol=$3Dmol||{};$3Dmol.GLDraw=function(){var e={},t=function(){var e=new $3Dmol.Vector3;return function(t){e.set(t[0],t[1],t[2]);var n=e.x,r=e.y,i=e.z,s=Math.sqrt(n*n+r*r),o,u,a,f,l,c,h,p;s<1e-4?(a=0,f=1):(a=-n/s,f=r/s),r=-a*n+f*r,u=Math.sqrt(r*r+i*i),u<1e-4?(l=0,c=1):(l=i/u,c=r/u);var v=new Float32Array(9);return v[0]=f,v[1]=a,v[2]=0,v[3]=-a*c,v[4]=f*c,v[5]=l,v[6]=a*l,v[7]=-f*l,v[8]=c,v}}(),n=function(){var e={vertices:[],norms:[]},t=[],n=4,r=Math.pow(2,n),i=2,s=Math.pow(2,i),o=r/s,u;t[0]=new $3Dmol.Vector3(-1,0,0),t[o]=new $3Dmol.Vector3(0,0,1),t[o*2]=new $3Dmol.Vector3(1,0,0),t[o*3]=new $3Dmol.Vector3(0,0,-1);for(i=3;i<=n;i++){s=Math.pow(2,i-1),o=r/s;for(u=0;u<s-1;u++)t[o/2+u*o]=t[u*o].clone().add(t[(u+1)*o]).normalize();u=s-1,t[o/2+u*o]=t[u*o].clone().add(t[0]).normalize()}return t}(),r={cache:{},getVerticesForRadius:function(e,t,r){if(typeof this.chache!==undefined&&this.cache[e]!==undefined&&this.cache[e][t+r]!==undefined)return this.cache[e][t+r];var i=new $3Dmol.Vector3(0,1,0),s=n.length,o=[],u=[],a;for(var f=0;f<s;f++)o.push(n[f].clone().multiplyScalar(e)),o.push(n[f].clone().multiplyScalar(e)),a=n[f].clone().normalize(),u.push(a),u.push(a);var l=[],c=10,h=s;if(c%2!==0||!c)return console.error("heightSegments must be even"),null;var p=0,d=Math.PI*2,v=0,m=Math.PI,g,y,b=!1,w=!1;for(y=0;y<=c;y++){b=y===0||y===c?!0:!1,w=y===c/2?!0:!1;var E=[],S=[];for(g=0;g<=h;g++){if(w){var x=g<h?2*g:0;S.push(x+1),E.push(x);continue}var T=g/h,N=y/c;if(!b||g===0)if(g<h){var C=new $3Dmol.Vector3;C.x=-e*Math.cos(p+T*d)*Math.sin(v+N*m),t==1?C.y=0:C.y=e*Math.cos(v+N*m),C.z=e*Math.sin(p+T*d)*Math.sin(v+N*m),Math.abs(C.x)<1e-5&&(C.x=0),Math.abs(C.y)<1e-5&&(C.y=0),Math.abs(C.z)<1e-5&&(C.z=0),t===1?(a=new $3Dmol.Vector3(0,Math.cos(v+N*m),0),a.normalize()):(a=new $3Dmol.Vector3(C.x,C.y,C.z),a.normalize()),o.push(C),u.push(a),E.push(o.length-1)}else E.push(o.length-h);else b&&E.push(o.length-1)}w&&l.push(S),l.push(E)}var k={vertices:o,normals:u,verticesRows:l,w:h,h:c};return this.cache[e]={},this.cache[e][t+r]=k,k}};this.caps={NONE:0,FLAT:1,ROUND:2};var i=0;e.drawCylinder=function(e,n,s,o,u,a,f){if(!n||!s)return;i++;var l=f||a;u=u||{r:0,g:0,b:0};var c=[s.x,s.y,s.z];c[0]-=n.x,c[1]-=n.y,c[2]-=n.z;var h=t(c),p=r.getVerticesForRadius(o,f,"to"),d=p.w,v=p.h,m=d,g=l?v*d+2:2*d,y=e.updateGeoGroup(g),b=p.vertices,w=p.normals,E=p.verticesRows,S=E[v/2],x=E[v/2+1],T=y.vertices,N,C,k,L,A,O,M=y.vertexArray,_=y.normalArray,D=y.colorArray,P=y.faceArray;for(k=0;k<d;++k){var H=2*k;L=h[0]*b[H].x+h[3]*b[H].y+h[6]*b[H].z,A=h[1]*b[H].x+h[4]*b[H].y+h[7]*b[H].z,O=h[5]*b[H].y+h[8]*b[H].z,N=3*(T+H),C=y.faceidx,M[N]=L+n.x,M[N+1]=A+n.y,M[N+2]=O+n.z,M[N+3]=L+s.x,M[N+4]=A+s.y,M[N+5]=O+s.z,_[N]=L,_[N+3]=L,_[N+1]=A,_[N+4]=A,_[N+2]=O,_[N+5]=O,D[N]=u.r,D[N+3]=u.r,D[N+1]=u.g,D[N+4]=u.g,D[N+2]=u.b,D[N+5]=u.b,P[C]=x[k]+T,P[C+1]=x[k+1]+T,P[C+2]=S[k]+T,P[C+3]=S[k]+T,P[C+4]=x[k+1]+T,P[C+5]=S[k+1]+T,y.faceidx+=6}if(l){var B=f?0:v/2,j=a?v+1:v/2+1,F,I,q,R,U,z,W,X,V,$,J,K,Q,G,Y,Z,et,tt,nt,rt,it,st,ot,ut,at,ft,lt,ct,ht,pt,dt,vt;for(A=B;A<j;A++){if(A===v/2)continue;var mt=A<=v/2?s:n,gt=r.getVerticesForRadius(o,f,"to"),yt=r.getVerticesForRadius(o,a,"from");mt===s?(b=gt.vertices,w=gt.normals,E=gt.verticesRows):mt==n&&(b=yt.vertices,w=yt.normals,E=yt.verticesRows);for(L=0;L<d;L++)C=y.faceidx,F=E[A][L+1],ht=(F+T)*3,I=E[A][L],pt=(I+T)*3,q=E[A+1][L],dt=(q+T)*3,R=E[A+1][L+1],vt=(R+T)*3,U=h[0]*b[F].x+h[3]*b[F].y+h[6]*b[F].z,z=h[0]*b[I].x+h[3]*b[I].y+h[6]*b[I].z,W=h[0]*b[q].x+h[3]*b[q].y+h[6]*b[q].z,X=h[0]*b[R].x+h[3]*b[R].y+h[6]*b[R].z,V=h[1]*b[F].x+h[4]*b[F].y+h[7]*b[F].z,$=h[1]*b[I].x+h[4]*b[I].y+h[7]*b[I].z,J=h[1]*b[q].x+h[4]*b[q].y+h[7]*b[q].z,K=h[1]*b[R].x+h[4]*b[R].y+h[7]*b[R].z,Q=h[5]*b[F].y+h[8]*b[F].z,G=h[5]*b[I].y+h[8]*b[I].z,Y=h[5]*b[q].y+h[8]*b[q].z,Z=h[5]*b[R].y+h[8]*b[R].z,M[ht]=U+mt.x,M[pt]=z+mt.x,M[dt]=W+mt.x,M[vt]=X+mt.x,M[ht+1]=V+mt.y,M[pt+1]=$+mt.y,M[dt+1]=J+mt.y,M[vt+1]=K+mt.y,M[ht+2]=Q+mt.z,M[pt+2]=G+mt.z,M[dt+2]=Y+mt.z,M[vt+2]=Z+mt.z,D[ht]=u.r,D[pt]=u.r,D[dt]=u.r,D[vt]=u.r,D[ht+1]=u.g,D[pt+1]=u.g,D[dt+1]=u.g,D[vt+1]=u.g,D[ht+2]=u.b,D[pt+2]=u.b,D[dt+2]=u.b,D[vt+2]=u.b,et=h[0]*w[F].x+h[3]*w[F].y+h[6]*w[F].z,tt=h[0]*w[I].x+h[3]*w[I].y+h[6]*w[I].z,nt=h[0]*w[q].x+h[3]*w[q].y+h[6]*w[q].z,rt=h[0]*w[R].x+h[3]*w[R].y+h[6]*w[R].z,it=h[1]*w[F].x+h[4]*w[F].y+h[7]*w[F].z,st=h[1]*w[I].x+h[4]*w[I].y+h[7]*w[I].z,ot=h[1]*w[q].x+h[4]*w[q].y+h[7]*w[q].z,ut=h[1]*w[R].x+h[4]*w[R].y+h[7]*w[R].z,at=h[5]*w[F].y+h[8]*w[F].z,ft=h[5]*w[I].y+h[8]*w[I].z,lt=h[5]*w[q].y+h[8]*w[q].z,ct=h[5]*w[R].y+h[8]*w[R].z,A===0?(_[ht]=et,_[dt]=nt,_[vt]=rt,_[ht+1]=it,_[dt+1]=ot,_[vt+1]=ut,_[ht+2]=at,_[dt+2]=lt,_[vt+2]=ct,P[C]=F+T,P[C+1]=q+T,P[C+2]=R+T,y.faceidx+=3):A===j-1?(_[ht]=et,_[pt]=tt,_[dt]=nt,_[ht+1]=it,_[pt+1]=st,_[dt+1]=ot,_[ht+2]=at,_[pt+2]=ft,_[dt+2]=lt,P[C]=F+T,P[C+1]=I+T,P[C+2]=q+T,y.faceidx+=3):(_[ht]=et,_[pt]=tt,_[vt]=rt,_[ht+1]=it,_[pt+1]=st,_[vt+1]=ut,_[ht+2]=at,_[pt+2]=ft,_[vt+2]=ct,_[pt]=tt,_[dt]=nt,_[vt]=rt,_[pt+1]=st,_[dt+1]=ot,_[vt+1]=ut,_[pt+2]=ft,_[dt+2]=lt,_[vt+2]=ct,P[C]=F+T,P[C+1]=I+T,P[C+2]=R+T,P[C+3]=I+T,P[C+4]=q+T,P[C+5]=R+T,y.faceidx+=6)}}y.vertices+=g},e.drawCone=function(e,r,i,s,o){if(!r||!i)return;o=o||{r:0,g:0,b:0};var u=[i.x,i.y,i.z];u.x-=r.x,u.y-=r.y,u.z-=r.z;var a=t(u),f=n.length,l=n,c=f+2,h=e.updateGeoGroup(c),p=h.vertices,d,v,m,g,y,b,w=h.vertexArray,E=h.normalArray,S=h.colorArray,x=h.faceArray,d=p*3,T=(new $3Dmol.Vector3(u[0],u[1],u[2])).normalize();w[d]=r.x,w[d+1]=r.y,w[d+2]=r.z,E[d]=-T.x,E[d+1]=-T.y,E[d+2]=-T.z,S[d]=o.r,S[d+1]=o.g,S[d+2]=o.b,w[d+3]=i.x,w[d+4]=i.y,w[d+5]=i.z,E[d+3]=T.x,E[d+4]=T.y,E[d+5]=T.z,S[d+3]=o.r,S[d+4]=o.g,S[d+5]=o.b,d+=6;for(m=0;m<f;++m){var N=l[m].clone();N.multiplyScalar(s),g=a[0]*N.x+a[3]*N.y+a[6]*N.z,y=a[1]*N.x+a[4]*N.y+a[7]*N.z,b=a[5]*N.y+a[8]*N.z,w[d]=g+r.x,w[d+1]=y+r.y,w[d+2]=b+r.z,E[d]=g,E[d+1]=y,E[d+2]=b,S[d]=o.r,S[d+1]=o.g,S[d+2]=o.b,d+=3}h.vertices+=f+2;var v=h.faceidx;for(m=0;m<f;m++){var C=p+2+m,k=p+2+(m+1)%f;x[v]=C,x[v+1]=k,x[v+2]=p,v+=3,x[v]=C,x[v+1]=k,x[v+2]=p+1,v+=3}h.faceidx+=6*f};var s={cache:{},getVerticesForRadius:function(e){if(typeof this.cache[e]!="undefined")return this.cache[e];var t={vertices:[],verticesRows:[],normals:[]},n=1,r=16*n,i=10*n;e<1&&(r=10*n,i=8*n);var s=0,o=Math.PI*2,u=0,a=Math.PI,f,l,c=[],h=[];for(l=0;l<=i;l++){var p=[];for(f=0;f<=r;f++){var d=f/r,v=l/i,m={};m.x=-e*Math.cos(s+d*o)*Math.sin(u+v*a),m.y=e*Math.cos(u+v*a),m.z=e*Math.sin(s+d*o)*Math.sin(u+v*a);var g=new $3Dmol.Vector3(m.x,m.y,m.z);g.normalize(),t.vertices.push(m),t.normals.push(g),p.push(t.vertices.length-1)}t.verticesRows.push(p)}return this.cache[e]=t,t}};e.drawSphere=function(e,t,n,r){var i=new $3Dmol.Vector3(t.x,t.y,t.z),o,u,a=s.getVerticesForRadius(n),f=a.vertices,l=a.normals,c=e.updateGeoGroup(f.length),h=c.vertices,p=c.vertexArray,d=c.colorArray,v=c.faceArray,m=c.lineArray,g=c.normalArray;for(var y=0,b=f.length;y<b;++y){var w=3*(h+y),E=f[y];p[w]=E.x+t.x,p[w+1]=E.y+t.y,p[w+2]=E.z+t.z,d[w]=r.r,d[w+1]=r.g,d[w+2]=r.b}c.vertices+=f.length;var S=a.verticesRows,x=S.length-1;for(u=0;u<x;u++){var T=S[u].length-1;for(o=0;o<T;o++){var N=c.faceidx,C=c.lineidx,k=S[u][o+1]+h,L=k*3,A=S[u][o]+h,O=A*3,M=S[u+1][o]+h,_=M*3,D=S[u+1][o+1]+h,P=D*3,H=l[k-h],B=l[A-h],j=l[M-h],F=l[D-h],I,q;Math.abs(f[k-h].y)===n?(g[L]=H.x,g[_]=j.x,g[P]=F.x,g[L+1]=H.y,g[_+1]=j.y,g[P+1]=F.y,g[L+2]=H.z,g[_+2]=j.z,g[P+2]=F.z,v[N]=k,v[N+1]=M,v[N+2]=D,m[C]=k,m[C+1]=M,m[C+2]=k,m[C+3]=D,m[C+4]=M,m[C+5]=D,c.faceidx+=3,c.lineidx+=6):Math.abs(f[M-h].y)===n?(g[L]=H.x,g[O]=B.x,g[_]=j.x,g[L+1]=H.y,g[O+1]=B.y,g[_+1]=j.y,g[L+2]=H.z,g[O+2]=B.z,g[_+2]=j.z,v[N]=k,v[N+1]=A,v[N+2]=M,m[C]=k,m[C+1]=A,m[C+2]=k,m[C+3]=M,m[C+4]=A,m[C+5]=M,c.faceidx+=3,c.lineidx+=6):(g[L]=H.x,g[O]=B.x,g[P]=F.x,g[L+1]=H.y,g[O+1]=B.y,g[P+1]=F.y,g[L+2]=H.z,g[O+2]=B.z,g[P+2]=F.z,g[O]=B.x,g[_]=j.x,g[P]=F.x,g[O+1]=B.y,g[_+1]=j.y,g[P+1]=F.y,g[O+2]=B.z,g[_+2]=j.z,g[P+2]=F.z,v[N]=k,v[N+1]=A,v[N+2]=D,v[N+3]=A,v[N+4]=M,v[N+5]=D,m[C]=k,m[C+1]=A,m[C+2]=k,m[C+3]=D,m[C+4]=A,m[C+5]=M,m[C+6]=M,m[C+7]=D,c.faceidx+=6,c.lineidx+=8)}}};var o={cache:{},getVerticesForRadii:function(e,t,n,r,i){function m(e,t,n,r,i,s){var o=t[0][0]*e[0]+t[0][1]*e[1]+t[0][2]*e[2],u=t[1][0]*e[0]+t[1][1]*e[1]+t[1][2]*e[2],a=t[2][0]*e[0]+t[2][1]*e[1]+t[2][2]*e[2],f=n[0][0]*o+n[0][1]*u+n[0][2]*a,l=n[1][0]*o+n[1][1]*u+n[1][2]*a,c=n[2][0]*o+n[2][1]*u+n[2][2]*a;return[f+r,l+i,c+s]}function g(e,t,n,r,i){var s=t[0][0]*e[0]+t[0][1]*e[1]+t[0][2]*e[2],o=t[1][0]*e[0]+t[1][1]*e[1]+t[1][2]*e[2],u=t[2][0]*e[0]+t[2][1]*e[1]+t[2][2]*e[2];return[s+n,o+r,u+i]}var s="";for(var o=0;o<3;o++)for(var u=0;u<3;u++)s+=i[o][u];s=e+"_"+t+"_"+n+"_"+s;if(typeof this.cache[s]!="undefined")return this.cache[s];if(typeof this.cache[e+"_"+t+"_"+n+"_100010001"]!="undefined"){var a=this.cache[e+"_"+t+"_"+n+"_100010001"],f=[];for(var l=0;l<8;l++){var c=a[l],h=c.vertices,p={};p.verticesRows=c.verticesRows.slice(),p.vertices=[],p.normals=[];for(var d=0;d<h.length;d++){var v=g([h[d].x,h[d].y,h[d].z],i,0,0,0);p.vertices.push({x:v[0],y:v[1],z:v[2]})}f.push(p)}return this.cache[s]=f,f}var y=[],b={vertices:[],verticesRows:[],normals:[]},w={vertices:[],verticesRows:[],normals:[]},E={vertices:[],verticesRows:[],normals:[]},S={vertices:[],verticesRows:[],normals:[]},x={vertices:[],verticesRows:[],normals:[]},T={vertices:[],verticesRows:[],normals:[]},N={vertices:[],verticesRows:[],normals:[]},C={vertices:[],verticesRows:[],normals:[]},k=1,L=16*k,A=10*k;e<1&&(L=10*k,A=8*k);var O=0,M=Math.PI/2,_=0,D=Math.PI/2,P,H,h=[],B=[];for(H=0;H<=A;H++){var j=[],F=[],I=[],q=[],R=[],U=[],z=[],W=[];for(P=0;P<=L;P++){var X=P/L,d=H/A,V={};V.x=-e*Math.cos(O+X*M)*Math.sin(_+d*D),V.y=t*Math.cos(_+d*D),V.z=n*Math.sin(O+X*M)*Math.sin(_+d*D);var u=m([V.x,-1*V.y,V.z],r,i,0,0,0);b.vertices.push({x:u[0],y:u[1],z:u[2]}),j.push(b.vertices.length-1),u=m([V.x,-1*V.y,-1*V.z],r,i,0,0,0),w.vertices.push({x:u[0],y:u[1],z:u[2]}),F.push(w.vertices.length-1),u=m([-1*V.x,-1*V.y,V.z],r,i,0,0,0),E.vertices.push({x:u[0],y:u[1],z:u[2]}),I.push(E.vertices.length-1),u=m([-1*V.x,-1*V.y,-1*V.z],r,i,0,0,0),S.vertices.push({x:u[0],y:u[1],z:u[2]}),q.push(S.vertices.length-1),u=m([V.x,V.y,V.z],r,i,0,0,0),x.vertices.push({x:u[0],y:u[1],z:u[2]}),R.push(x.vertices.length-1),u=m([V.x,V.y,-1*V.z],r,i,0,0,0),T.vertices.push({x:u[0],y:u[1],z:u[2]}),U.push(T.vertices.length-1),u=m([-1*V.x,V.y,-1*V.z],r,i,0,0,0),N.vertices.push({x:u[0],y:u[1],z:u[2]}),z.push(N.vertices.length-1),u=m([-1*V.x,V.y,V.z],r,i,0,0,0),C.vertices.push({x:u[0],y:u[1],z:u[2]}),W.push(C.vertices.length-1)}b.verticesRows.push(j),w.verticesRows.push(F),E.verticesRows.push(I),S.verticesRows.push(q),x.verticesRows.push(R),T.verticesRows.push(U),N.verticesRows.push(z),C.verticesRows.push(W)}return this.cache[s]=[b,w,E,S,x,T,N,C],[b,w,E,S,x,T,N,C]}};return e.drawEllipsoid=function(e,t,n,r,i,s,u,a){function f(e){vA=new $3Dmol.Vector3(e[0].x,e[0].y,e[0].z),vB=new $3Dmol.Vector3(e[1].x,e[1].y,e[1].z),vC=new $3Dmol.Vector3(e[2].x,e[2].y,e[2].z),vA.subVectors(vA,vB),vC.subVectors(vC,vB),vC.cross(vA);var t=vC;return t.normalize(),t}var l,c,h=o.getVerticesForRadii(n,r,i,s,u);for(var p=0;p<8;p++){var d=h[p],v=d.vertices,m=e.updateGeoGroup(v.length),g=m.vertices,y=m.vertexArray,b=m.colorArray,w=m.faceArray,E=m.lineArray,S=m.normalArray;for(var x=0,T=v.length;x<T;++x){var N=3*(g+x),C=v[x];y[N]=C.x+t.x,y[N+1]=C.y+t.y,y[N+2]=C.z+t.z,b[N]=a.r,b[N+1]=a.g,b[N+2]=a.b}m.vertices+=v.length;var k=d.verticesRows,L=k.length-1;for(c=0;c<L;c++){var A=k[c].length-1;for(l=0;l<A;l++){var O=m.faceidx,M=m.lineidx,_=k[c][l+1]+g,D=_*3,P=k[c][l]+g,H=P*3,B=k[c+1][l]+g,j=B*3,F=k[c+1][l+1]+g,I=F*3;w[O]=_,w[O+1]=P,w[O+2]=F,w[O+3]=P,w[O+4]=B,w[O+5]=F;var q=f([v[_-g],v[P-g],v[F-g]]);S[D]=q.x,S[H]=q.x,S[I]=q.x,S[D+1]=q.y,S[H+1]=q.y,S[I+1]=q.y,S[D+2]=q.z,S[H+2]=q.z,S[I+2]=q.z;var R=f([v[P-g],v[B-g],v[F-g]]);S[H]=R.x,S[j]=R.x,S[I]=R.x,S[H+1]=R.y,S[j+1]=R.y,S[I+1]=R.y,S[H+2]=R.z,S[j+2]=R.z,S[I+2]=R.z,E[M]=_,E[M+1]=P,E[M+2]=_,E[M+3]=F,E[M+4]=P,E[M+5]=B,E[M+6]=B,E[M+7]=F,m.faceidx+=6,m.lineidx+=8}}}},e}();var $3Dmol=$3Dmol||{};$3Dmol.GLModel=function(){function c(t,o){var h=[],p=[],d=t,m=!1,g=null,y=null,b=null,w={},E=new $3Dmol.Matrix4,S=!0,x=$3Dmol.elementColors.defaultColor,T=o?o:$3Dmol.elementColors.defaultColors,N=1.5,C=function(e,t){var n=N;return typeof t.radius!="undefined"?n=t.radius:s[e.elem]&&(n=s[e.elem]),typeof t.scale!="undefined"&&(n*=t.scale),n},k=function(e,t){if(!e.style.cross)return;var r=e.style.cross;if(r.hidden)return;var i=r.linewidth||n;t[i]||(t[i]=new $3Dmol.Geometry);var s=t[i].updateGeoGroup(6),o=C(e,r),u=[[o,0,0],[-o,0,0],[0,o,0],[0,-o,0],[0,0,o],[0,0,-o]],a=e.clickable||e.hoverable;a&&e.intersectionShape===undefined&&(e.intersectionShape={sphere:[],cylinder:[],line:[]});var f=$3Dmol.getColorFromStyle(e,r),l=s.vertexArray,c=s.colorArray;for(var h=0;h<6;h++){var p=s.vertices*3;s.vertices++,l[p]=e.x+u[h][0],l[p+1]=e.y+u[h][1],l[p+2]=e.z+u[h][2],c[p]=f.r,c[p+1]=f.g,c[p+2]=f.b;if(a){var d=new $3Dmol.Vector3(u[h][0],u[h][1],u[h][2]);d.multiplyScalar(.1),d.set(d.x+e.x,d.y+e.y,d.z+e.z),e.intersectionShape.line.push(d)}}},L=function(e,t,n){var r=new $3Dmol.Vector3(e.x,e.y,e.z),i=new $3Dmol.Vector3(t.x,t.y,t.z),s=i.clone(),o=null;s.sub(r);var u,a,f,l,c,p,d,v,m;return e.bonds.length===1?t.bonds.length===1?(o=s.clone(),Math.abs(o.x)>1e-4?o.y+=1:o.x+=1):(c=(n+1)%t.bonds.length,p=t.bonds[c],d=h[p],v=new $3Dmol.Vector3(d.x,d.y,d.z),m=v.clone(),m.sub(r),o=m.clone(),o.cross(s)):(c=(n+1)%e.bonds.length,p=e.bonds[c],d=h[p],v=new $3Dmol.Vector3(d.x,d.y,d.z),m=v.clone(),m.sub(r),o=m.clone(),o.cross(s)),o.lengthSq()<.01&&(o=s.clone(),Math.abs(o.x)>1e-4?o.y+=1:o.x+=1),o.cross(s),o.normalize(),o},A=function(){v.cross(dir),v.normalize(),v.multiplyScalar(r*3),p1a=p1.clone(),p1a.add(v),p1b=p1.clone(),p1b.sub(v),p2a=p1a.clone(),p2a.add(dir),p2b=p1b.clone(),p2b.add(dir)},O=function(e,t,n,r,i,s){e[n]=r.x,e[n+1]=r.y,e[n+2]=r.z,t[n]=s.r,t[n+1]=s.g,t[n+2]=s.b,e[n+3]=i.x,e[n+4]=i.y,e[n+5]=i.z,t[n+3]=s.r,t[n+4]=s.g,t[n+5]=s.b},M=function(e,t,r){if(!e.style.line)return;var i=e.style.line;if(i.hidden)return;var s,o,u,a,f=i.linewidth||n;r[f]||(r[f]=new $3Dmol.Geometry);var l=r[f].updateGeoGroup(6*e.bonds.length),c=l.vertexArray,h=l.colorArray;for(var p=0;p<e.bonds.length;p++){var d=e.bonds[p],v=t[d];if(!v.style.line)continue;if(e.serial>=v.serial)continue;var m=new $3Dmol.Vector3(e.x,e.y,e.z),g=new $3Dmol.Vector3(v.x,v.y,v.z),y=m.clone().add(g).multiplyScalar(.5),b=!1;if(e.clickable||e.hoverable)e.intersectionShape===undefined&&(e.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}),e.intersectionShape.line.push(m),e.intersectionShape.line.push(y),v.intersectionShape.line.push(y),v.intersectionShape.line.push(g);var w=$3Dmol.getColorFromStyle(e,e.style.line),E=$3Dmol.getColorFromStyle(v,v.style.line);if(e.bondStyles&&e.bondStyles[p]){var S=e.bondStyles[p];if(!S.iswire)continue;S.radius&&(bondR=S.radius),S.singleBond&&(b=!0),typeof S.color1!="undefined"&&(w=$3Dmol.CC.color(S.color1)),typeof S.color2!="undefined"&&(E=$3Dmol.CC.color(S.color2))}var x=l.vertices*3;if(e.bondOrder[p]>1&&e.bondOrder[p]<4&&!b){var T=L(e,v,p),N=g.clone();N.sub(m);if(e.bondOrder[p]==2){T.multiplyScalar(.1),s=m.clone(),s.add(T),o=m.clone(),o.sub(T),u=s.clone(),u.add(N),a=o.clone(),a.add(N);if(w==E)l.vertices+=4,O(c,h,x,s,u,w),O(c,h,x+6,o,a,w);else{l.vertices+=8,N.multiplyScalar(.5);var C=s.clone();C.add(N);var k=o.clone();k.add(N),O(c,h,x,s,C,w),O(c,h,x+6,C,u,E),O(c,h,x+12,o,k,w),O(c,h,x+18,k,a,E)}}else if(e.bondOrder[p]==3){T.multiplyScalar(.1),s=m.clone(),s.add(T),o=m.clone(),o.sub(T),u=s.clone(),u.add(N),a=o.clone(),a.add(N);if(w==E)l.vertices+=6,O(c,h,x,m,g,w),O(c,h,x+6,s,u,w),O(c,h,x+12,o,a,w);else{l.vertices+=12,N.multiplyScalar(.5);var C=s.clone();C.add(N);var k=o.clone();k.add(N),O(c,h,x,m,y,w),O(c,h,x+6,y,g,E),O(c,h,x+12,s,C,w),O(c,h,x+18,C,u,E),O(c,h,x+24,o,k,w),O(c,h,x+30,k,a,E)}}}else w==E?(l.vertices+=2,O(c,h,x,m,g,w)):(l.vertices+=4,O(c,h,x,m,y,w),O(c,h,x+6,y,g,E))}},_=.25,D=function(e,t){if(!e.style.sphere)return;var n=e.style.sphere;if(n.hidden)return;var r=$3Dmol.getColorFromStyle(e,n),i,s,o=C(e,n);if((e.clickable===!0||e.hoverable)&&e.intersectionShape!==undefined){var u=new $3Dmol.Vector3(e.x,e.y,e.z);e.intersectionShape.sphere.push(new $3Dmol.Sphere(u,o))}$3Dmol.GLDraw.drawSphere(t,e,o,r)},P=function(e,t){if(!e.style.sphere)return;var n=e.style.sphere;if(n.hidden)return;var r=C(e,n),i=$3Dmol.getColorFromStyle(e,n),s=t.updateGeoGroup(1),o=s.vertices,u=o*3,a=s.vertexArray,f=s.colorArray,l=s.radiusArray;a[u]=e.x,a[u+1]=e.y,a[u+2]=e.z;var c=s.normalArray,f=s.colorArray;f[u]=i.r,f[u+1]=i.g,f[u+2]=i.b,l[o]=r;if((e.clickable===!0||e.hoverable)&&e.intersectionShape!==undefined){var h=new $3Dmol.Vector3(e.x,e.y,e.z);e.intersectionShape.sphere.push(new $3Dmol.Sphere(h,r))}s.vertices+=1},H=function(e,t,n,r){var i=e.updateGeoGroup(4),s=i.vertices,o=s*3,u=i.vertexArray,a=i.colorArray;for(var f=0;f<4;f++)u[o+3*f]=t.x,u[o+3*f+1]=t.y,u[o+3*f+2]=t.z;var l=i.normalArray,a=i.colorArray;for(var f=0;f<4;f++)a[o+3*f]=r.r,a[o+3*f+1]=r.g,a[o+3*f+2]=r.b;l[o+0]=-n,l[o+1]=n,l[o+2]=0,l[o+3]=-n,l[o+4]=-n,l[o+5]=0,l[o+6]=n,l[o+7]=-n,l[o+8]=0,l[o+9]=n,l[o+10]=n,l[o+11]=0,i.vertices+=4;var c=i.faceArray,h=i.faceidx;c[h+0]=s,c[h+1]=s+1,c[h+2]=s+2,c[h+3]=s+2,c[h+4]=s+3,c[h+5]=s,i.faceidx+=6},B=function(e,t){if(!e.style.sphere)return;var n=e.style.sphere;if(n.hidden)return;var r=C(e,n),i=$3Dmol.getColorFromStyle(e,n);if((e.clickable===!0||e.hoverable)&&e.intersectionShape!==undefined){var s=new $3Dmol.Vector3(e.x,e.y,e.z);e.intersectionShape.sphere.push(new $3Dmol.Sphere(s,r))}H(t,e,r,i)},j=function(e,t,n,r,i,s,o){var u=e.updateGeoGroup(4),a=u.vertices,f=a*3,l=u.vertexArray,c=u.colorArray,h=u.radiusArray,p=u.normalArray,d=i.r,v=i.g,m=i.b,g=function(e){var t=-e;return t==0&&(t=-0.0001),t},y=f;for(var b=0;b<4;b++)l[y]=t.x,p[y]=n.x,c[y]=d,y++,l[y]=t.y,p[y]=n.y,c[y]=v,y++,l[y]=t.z,p[y]=n.z,b<2?c[y]=m:c[y]=g(m),y++;u.vertices+=4,h[a]=-r,h[a+1]=r,h[a+2]=-r,h[a+3]=r;var w=u.faceArray,E=u.faceidx;w[E+0]=a,w[E+1]=a+1,w[E+2]=a+2,w[E+3]=a+2,w[E+4]=a+3,w[E+5]=a,u.faceidx+=6},F=function(e,t,n){if(!e.style.stick)return;var r=e.style.stick;if(r.hidden)return;var i=r.radius||_,s=i,o=r.singleBonds||!1,u=0,a=0,f=$3Dmol.getColorFromStyle(e,r),l,c,h;!e.capDrawn&&e.bonds.length<4&&(u=2);var p=$3Dmol.GLDraw.drawCylinder;n.imposter&&(p=j);for(var d=0;d<e.bonds.length;d++){var v=e.bonds[d],m=t[v];if(e.serial<m.serial){var g=m.style;if(!g.stick)continue;var y=$3Dmol.getColorFromStyle(m,g.stick);s=i;var b=o;if(e.bondStyles&&e.bondStyles[d]){var w=e.bondStyles[d];if(w.iswire)continue;w.radius&&(s=w.radius),w.singleBond&&(b=!0),typeof w.color1!="undefined"&&(f=$3Dmol.CC.color(w.color1)),typeof w.color2!="undefined"&&(y=$3Dmol.CC.color(w.color2))}var E=new $3Dmol.Vector3(e.x,e.y,e.z),S=new $3Dmol.Vector3(m.x,m.y,m.z);if(e.bondOrder[d]===1||b){!m.capDrawn&&m.bonds.length<4&&(a=2),f!=y?(l=(new $3Dmol.Vector3).addVectors(E,S).multiplyScalar(.5),p(n,E,l,s,f,u,0),p(n,l,S,s,y,0,a)):p(n,E,S,s,f,u,a);if(e.clickable||m.clickable){l=(new $3Dmol.Vector3).addVectors(E,S).multiplyScalar(.5);if(e.clickable||e.hoverable){var x=new $3Dmol.Cylinder(E,l,s),T=new $3Dmol.Sphere(E,s);e.intersectionShape.cylinder.push(x),e.intersectionShape.sphere.push(T)}if(m.clickable||m.hoverable){var N=new $3Dmol.Cylinder(S,l,s),C=new $3Dmol.Sphere(S,s);m.intersectionShape.cylinder.push(N),m.intersectionShape.sphere.push(C)}}}else if(e.bondOrder[d]>1){var k=0,A=0;s!=i&&(k=2,A=2);var O=S.clone(),M=null;O.sub(E);var D,P,B,F,I,M=L(e,m,d);if(e.bondOrder[d]==2){var D=s/2.5,M=L(e,m,d);M.multiplyScalar(D*1.5),P=E.clone(),P.add(M),B=E.clone(),B.sub(M),F=P.clone(),F.add(O),I=B.clone(),I.add(O),f!=y?(l=(new $3Dmol.Vector3).addVectors(P,F).multiplyScalar(.5),h=(new $3Dmol.Vector3).addVectors(B,I).multiplyScalar(.5),p(n,P,l,D,f,k,0),p(n,l,F,D,y,0,A),p(n,B,h,D,f,k,0),p(n,h,I,D,y,0,A)):(p(n,P,F,D,f,k,A),p(n,B,I,D,f,k,A));if(e.clickable||m.clickable){l=(new $3Dmol.Vector3).addVectors(P,F).multiplyScalar(.5),h=(new $3Dmol.Vector3).addVectors(B,I).multiplyScalar(.5);if(e.clickable||e.hoverable){var q=new $3Dmol.Cylinder(P,l,D),R=new $3Dmol.Cylinder(B,h,D);e.intersectionShape.cylinder.push(q),e.intersectionShape.cylinder.push(R)}if(m.clickable||m.hoverable){var U=new $3Dmol.Cylinder(F,l,D),z=new $3Dmol.Cylinder(I,h,D);m.intersectionShape.cylinder.push(U),m.intersectionShape.cylinder.push(z)}}}else if(e.bondOrder[d]==3){D=s/4,M.cross(O),M.normalize(),M.multiplyScalar(D*3),P=E.clone(),P.add(M),B=E.clone(),B.sub(M),F=P.clone(),F.add(O),I=B.clone(),I.add(O),f!=y?(l=(new $3Dmol.Vector3).addVectors(P,F).multiplyScalar(.5),h=(new $3Dmol.Vector3).addVectors(B,I).multiplyScalar(.5),mp3=(new $3Dmol.Vector3).addVectors(E,S).multiplyScalar(.5),p(n,P,l,D,f,k,0),p(n,l,F,D,y,0,A),p(n,E,mp3,D,f,u,0),p(n,mp3,S,D,y,0,a),p(n,B,h,D,f,k,0),p(n,h,I,D,y,0,A)):(p(n,P,F,D,f,k,A),p(n,E,S,D,f,u,a),p(n,B,I,D,f,k,A));if(e.clickable||m.clickable){l=(new $3Dmol.Vector3).addVectors(P,F).multiplyScalar(.5),h=(new $3Dmol.Vector3).addVectors(B,I).multiplyScalar(.5),mp3=(new $3Dmol.Vector3).addVectors(E,S).multiplyScalar(.5);if(e.clickable||e.hoverable){var q=new $3Dmol.Cylinder(P.clone(),l.clone(),D),R=new $3Dmol.Cylinder(B.clone(),h.clone(),D),W=new $3Dmol.Cylinder(E.clone(),mp3.clone(),D);e.intersectionShape.cylinder.push(q),e.intersectionShape.cylinder.push(R),e.intersectionShape.cylinder.push(W)}if(m.clickable||m.hoverable){var U=new $3Dmol.Cylinder(F.clone(),l.clone(),D),z=new $3Dmol.Cylinder(I.clone(),h.clone(),D),X=new $3Dmol.Cylinder(S.clone(),mp3.clone(),D);m.intersectionShape.cylinder.push(U),m.intersectionShape.cylinder.push(z),m.intersectionShape.cylinder.push(X)}}}}}}var V=!1,$=0,J=!1;for(var d=0;d<e.bonds.length;d++){var b=o;if(e.bondStyles&&e.bondStyles[d]){var w=e.bondStyles[d];w.singleBond&&(b=!0),w.radius&&w.radius!=i&&(J=!0)}(b||e.bondOrder[d]==1)&&$++}J?$>0&&(V=!0):$==0&&e.bonds.length>0&&(V=!0);if(V){var K=e.style;s=i,n.imposter?H(n.sphereGeometry,e,s,f):$3Dmol.GLDraw.drawSphere(n,e,s,f)}},I=function(e,t){t=t||{};var n=new $3Dmol.Object3D,r=[],i={},s={},o=D,u=null,a=null;t.supportsImposters?(o=B,u=new $3Dmol.Geometry(!0),u.imposter=!0,a=new $3Dmol.Geometry(!0,!0),a.imposter=!0,a.sphereGeometry=u,a.drawnCaps={}):t.supportsAIA?(o=P,u=new $3Dmol.Geometry(!1,!0,!0),u.instanced=!0,a=new $3Dmol.Geometry(!0)):(u=new $3Dmol.Geometry(!0),a=new $3Dmol.Geometry(!0));var f,l,c,h,p={},d=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY];for(f=0,c=e.length;f<c;f++){var v=e[f];if(v&&v.style){(v.clickable||v.hoverable)&&v.intersectionShape===undefined&&(v.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}),h={line:undefined,cross:undefined,stick:undefined,sphere:undefined};for(l in h)v.style[l]?v.style[l].opacity?h[l]=parseFloat(v.style[l].opacity):h[l]=1:h[l]=undefined,p[l]?h[l]!=undefined&&p[l]!=h[l]&&(console.log("Warning: "+l+" opacity is ambiguous"),p[l]=1):p[l]=h[l];o(v,u),k(v,s),M(v,e,i),F(v,e,a),typeof v.style.cartoon!="undefined"&&!v.style.cartoon.hidden&&(v.style.cartoon.color==="spectrum"&&typeof v.resi=="number"&&!v.hetflag&&(v.resi<d[0]&&(d[0]=v.resi),v.resi>d[1]&&(d[1]=v.resi)),r.push(v))}}r.length>0&&$3Dmol.drawCartoon(n,r,d);if(u&&u.vertices>0){u.initTypedArrays();var m=null;if(u.imposter)m=new $3Dmol.SphereImposterMaterial({ambient:0,vertexColors:!0,reflectivity:0});else if(u.instanced){var g=new $3Dmol.Geometry(!0);$3Dmol.GLDraw.drawSphere(g,{x:0,y:0,z:0},1,new $3Dmol.Color(.5,.5,.5)),g.initTypedArrays(),m=new $3Dmol.InstancedMaterial({sphereMaterial:new $3Dmol.MeshLambertMaterial({ambient:0,vertexColors:!0,reflectivity:0}),sphere:g})}else var m=new $3Dmol.MeshLambertMaterial({ambient:0,vertexColors:!0,reflectivity:0});p.sphere<1&&p.sphere>=0&&(m.transparent=!0,m.opacity=p.sphere);var g=new $3Dmol.Mesh(u,m);n.add(g)}if(a.vertices>0)if(a.imposter){var y=new $3Dmol.StickImposterMaterial({ambient:0,vertexColors:!0,reflectivity:0});a.initTypedArrays();var b=new $3Dmol.Mesh(a,y);n.add(b)}else{var E=new $3Dmol.MeshLambertMaterial({vertexColors:!0,ambient:0,reflectivity:0});p.stick<1&&p.stick>=0&&(E.transparent=!0,E.opacity=p.stick),a.initTypedArrays(),E.wireframe&&a.setUpWireframe();var b=new $3Dmol.Mesh(a,E);n.add(b)}for(f in i)if(i.hasOwnProperty(f)){var x=f,T=new $3Dmol.LineBasicMaterial({linewidth:x,vertexColors:!0});p.line<1&&p.line>=0&&(T.transparent=!0,T.opacity=p.line),i[f].initTypedArrays();var N=new $3Dmol.Line(i[f],T,$3Dmol.LinePieces);n.add(N)}for(f in s)if(s.hasOwnProperty(f)){var x=f,C=new $3Dmol.LineBasicMaterial({linewidth:x,vertexColors:!0});p.cross<1&&p.cross>=0&&(C.transparent=!0,C.opacity=p.cross),s[f].initTypedArrays();var L=new $3Dmol.Line(s[f],C,$3Dmol.LinePieces);n.add(L)}if(S&&w.symmetries&&w.symmetries.length>0){var A=new $3Dmol.Object3D,O;for(O=0;O<w.symmetries.length;O++){var _=new $3Dmol.Object3D;_=n.clone(),_.matrix.copy(w.symmetries[O]),_.matrixAutoUpdate=!1,A.add(_)}return A}return n};this.getCrystData=function(){return w.cryst?w.cryst:null},this.getSymmetries=function(){return typeof w.symmetries=="undefined"&&(w.symmetries=[E]),w.symmetries},this.setSymmetries=function(e){typeof e=="undefined"?w.symmetries=[E]:w.symmetries=e},this.getID=function(){return d},this.getFrames=function(){return p},this.setFrame=function(e){if(p.length==0)return;e>=0&&e<p.length?h=p[e]:h=p[p.length-1],g=null},this.addFrame=function(e){p.push(e)},this.vibrate=function(e,t){var t=t||1,e=e||10;e--;for(var n=1;n<=e;n++){var r=[];for(var i=0;i<h.length;i++){var s=new $3Dmol.Vector3($3Dmol.getAtomProperty(h[i],"dx"),$3Dmol.getAtomProperty(h[i],"dy"),$3Dmol.getAtomProperty(h[i],"dz")),o=new $3Dmol.Vector3(h[i].x,h[i].y,h[i].z);s.multiplyScalar(n*t/e),o.add(s);var u={};for(var a in h[i])u[a]=h[i][a];u.x=o.x,u.y=o.y,u.z=o.z,r.push(u)}p.push(r)}p.unshift(h)},this.setAtomDefaults=function(t){for(var n=0;n<t.length;n++){var r=t[n];if(r){r.style=r.style||e,r.color=r.color||T[r.elem]||x,r.model=d;if(r.clickable||r.hoverable)r.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}}}},this.addMolData=function(e,t,n){n=n||{};var r=$3Dmol.GLModel.parseMolData(e,t,n);S=!n.duplicateAssemblyAtoms;var i=r.modelData;i&&(Array.isArray(i)?w=i[0]:w=i);if(p.length==0){for(var s=0;s<r.length;s++)r[s].length!=0&&p.push(r[s]);p[0]&&(h=p[0])}else if(n.frames)for(var s=0;s<r.length;s++)p.push(r[s]);else for(var s=0;s<r.length;s++)this.addAtoms(r[s]);for(var s=0;s<p.length;s++)this.setAtomDefaults(p[s],d);n.vibrate&&n.vibrate.frames&&n.vibrate.amplitude&&this.vibrate(n.vibrate.frames,n.vibrate.amplitude),n.style&&this.setStyle({},n.style)},this.setDontDuplicateAtoms=function(e){S=e},this.setModelData=function(e){w=e},this.atomIsSelected=function(e,t){if(typeof t=="undefined")return!0;var n=!!t.invert,r=!0;for(var i in t)if(i=="and"||i=="or"||i=="not"){if(i=="not"){if(this.atomIsSelected(e,t[i])){r=!1;break}}else if(i=="and"){var s=t[i];for(var o=0;o<s.length;o++)if(!this.atomIsSelected(e,s[o])){r=!1;break}}else if(i=="or"){var u=t[i],a=!0;for(var o=0;o<u.length;o++){if(this.atomIsSelected(e,u[o])){a=!0;break}a=!1}r=a}}else if(i==="predicate"){if(!t.predicate(e)){r=!1;break}}else if(i=="properties"&&e[i])for(var f in t.properties){if(typeof e.properties[f]=="undefined"){r=!1;break}if(e.properties[f]!=t.properties[f]){r=!1;break}}else if(t.hasOwnProperty(i)&&i!="props"&&i!="invert"&&i!="model"&&i!="byres"&&i!="expand"&&i!="within"&&i!="and"&&i!="or"&&i!="not"){if(typeof e[i]=="undefined"){r=!1;break}var l=!1;if(i==="bonds"){var c=t[i];if(c!=e.bonds.length){r=!1;break}}else if($.isArray(t[i])){var h=t[i];for(var o=0;o<h.length;o++)if(e[i]==h[o]){l=!0;break}if(!l){r=!1;break}}else{var c=t[i];if(e[i]!=c){r=!1;break}}}return n?!r:r},this.selectedAtoms=function(e,t){var n=[];e=e||{},t||(t=h);var r=t.length;for(var i=0;i<r;i++){var s=t[i];s&&this.atomIsSelected(s,e)&&n.push(s)}if(e.hasOwnProperty("expand")){var o=R(n,parseFloat(e.expand)),u=n.length;for(var i=0;i<o.length;i++)for(var a=0;a<u;a++){var f=q(o[i],n[a]),l=Math.pow(e.expand,2);f<l&&f>0&&n.push(o[i])}}if(e.hasOwnProperty("within")&&e.within.hasOwnProperty("sel")&&e.within.hasOwnProperty("distance")){var c=this.selectedAtoms(e.within.sel,h),p={};for(var i=0;i<c.length;i++)for(var a=0;a<n.length;a++){var f=q(c[i],n[a]),l=Math.pow(parseFloat(e.within.distance),2);f<l&&f>0&&(p[a]=1)}var d=[];if(e.within.invert)for(var a=0;a<n.length;a++)p[a]||d.push(n[a]);else for(a in p)d.push(n[a]);n=d}if(e.hasOwnProperty("byres")){var v={},m=[],g=[];for(var i=0;i<n.length;i++){var s=n[i],y=s.chain,b=s.resi;v[y]===undefined&&(v[y]={});if(s.hasOwnProperty("resi")&&v[y][b]===undefined){v[y][b]=!0,g.push(s);while(g.length>0){s=g.pop(),y=s.chain,b=s.resi;if(m[s.index]===undefined){m[s.index]=!0;for(var a=0;a<s.bonds.length;a++){var w=h[s.bonds[a]];m[w.index]===undefined&&w.hasOwnProperty("resi")&&w.chain==y&&w.resi==b&&(g.push(w),n.push(w))}}}}}}return n};var q=function(e,t){var n=t.x-e.x,r=t.y-e.y,i=t.z-e.z;return Math.pow(n,2)+Math.pow(r,2)+Math.pow(i,2)},R=function(e,t){if(t<=0)return e;var n=$3Dmol.getExtent(e),r=[[],[],[]];for(var i=0;i<3;i++)r[0][i]=n[0][i]-t,r[1][i]=n[1][i]+t,r[2][i]=n[2][i];var s=[];for(var i=0;i<h.length;i++){var o=h[i].x,u=h[i].y,a=h[i].z;o>=r[0][0]&&o<=r[1][0]&&u>=r[0][1]&&u<=r[1][1]&&a>=r[0][2]&&a<=r[1][2]&&(o>=n[0][0]&&o<=n[1][0]&&u>=n[0][1]&&u<=n[1][1]&&a>=n[0][2]&&a<=n[1][2]||s.push(h[i]))}return s};this.addAtoms=function(t){g=null;var n=h.length,r=[],i;for(i=0;i<t.length;i++)typeof t[i].index=="undefined"&&(t[i].index=i),typeof t[i].serial=="undefined"&&(t[i].serial=i),r[t[i].index]=n+i;for(i=0;i<t.length;i++){var s=t[i],o=r[s.index],u=$.extend(!1,{},s);u.index=o,u.bonds=[],u.bondOrder=[],u.model=d,u.style=u.style||e,typeof u.color=="undefined"&&(u.color=T[u.elem]||x);var a=s.bonds?s.bonds.length:0;for(var f=0;f<a;f++){var l=r[s.bonds[f]];typeof l!="undefined"&&(u.bonds.push(l),u.bondOrder.push(s.bondOrder?s.bondOrder[f]:1))}h.push(u)}},this.removeAtoms=function(e){g=null;var t=[],n;for(n=0;n<e.length;n++)t[e[n].index]=!0;var r=[];for(n=0;n<h.length;n++){var i=h[n];t[i.index]||r.push(i)}h=[],this.addAtoms(r)},this.setStyle=function(e,t,n){typeof t=="undefined"&&typeof n=="undefined"&&(t=e,e={});var r;for(r in e)u.indexOf(r)===-1&&console.log("Unknown selector "+r);for(r in t)f.indexOf(r)===-1&&console.log("Unknown style "+r);var i=!1,s=function(s){var u=o.selectedAtoms(e,s);for(var a=0;a<s.length;a++)s[a]&&(s[a].capDrawn=!1);for(var a=0;a<u.length;a++){i=!0;if(u[a].clickable||u[a].hoverable)u[a].intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]};n||(u[a].style={});for(r in t)if(t.hasOwnProperty(r)){u[a].style[r]=u[a].style[r]||{};for(var f in t[r])u[a].style[r][f]=t[r][f]}}},o=this;s(h);for(var a=0;a<p.length;a++)s(p[a]);i&&(g=null)},this.setClickable=function(e,t,n){var r;for(r in e)u.indexOf(r)===-1&&console.log("Unknown selector "+r);t=!!t;if(n&&typeof n!="function"){console.log("Callback is not a function");return}var i,s=this.selectedAtoms(e,h),o=s.length;for(i=0;i<o;i++)s[i].intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]},s[i].clickable=t,n&&(s[i].callback=n);o>0&&(g=null)},this.setHoverable=function(e,t,n,r){var i;for(i in e)u.indexOf(i)===-1&&console.log("Unknown selector "+i);t=!!t;if(n&&typeof n!="function"){console.log("Hover_callback is not a function");return}if(r&&typeof r!="function"){console.log("Unhover_callback is not a function");return}var s,o=this.selectedAtoms(e,h),a=o.length;for(s=0;s<a;s++)o[s].intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]},o[s].hoverable=t,n&&(o[s].hover_callback=n),r&&
(o[s].unhover_callback=r);a>0&&(g=null)},this.setColorByElement=function(e,t){if(g!==null&&l(t,b))return;b=t;var n=this.selectedAtoms(e,n);n.length>0&&(g=null);for(var r=0;r<n.length;r++){var i=n[r];typeof t[i.elem]!="undefined"&&(i.color=t[i.elem])}},this.setColorByProperty=function(e,t,n,r){var i,s,o=this.selectedAtoms(e,o);b=null,o.length>0&&(g=null),typeof $3Dmol.Gradient.builtinGradients[n]!="undefined"&&(n=new $3Dmol.Gradient.builtinGradients[n]),r||(r=n.range()),r||(r=$3Dmol.getPropertyRange(o,t));for(i=0;i<o.length;i++){s=o[i];var u=$3Dmol.getAtomProperty(s,t);u!=null&&(s.color=n.valueToHex(parseFloat(s.properties[t]),r))}},this.setColorByFunction=function(e,t){var n=this.selectedAtoms(e,n);if(typeof t!="function")return;b=null,n.length>0&&(g=null);for(i=0;i<n.length;i++)a=n[i],a.color=t(a)},this.toCDObject=function(e){var t={a:[],b:[]};e&&(t.s=[]);for(var n=0;n<h.length;n++){var r={},i=h[n];r.x=i.x,r.y=i.y,r.z=i.z,i.elem!="C"&&(r.l=i.elem);if(e){var s=0;while(s<t.s.length&&JSON.stringify(i.style)!==JSON.stringify(t.s[s]))s++;s===t.s.length&&t.s.push(i.style),s!==0&&(r.s=s)}t.a.push(r);for(var o=0;o<i.bonds.length;o++){var u=n,a=i.bonds[o];if(u>=a)continue;var f={b:u,e:a},l=i.bondOrder[o];l!=1&&(f.o=l),t.b.push(f)}}return t},this.globj=function(e,t){var n=new Date;if(g===null){g=I(h,t);var r=new Date;y&&(e.remove(y),y=null),y=g.clone(),m&&(y.setVisible(!1),g.setVisible(!1)),e.add(y)}},this.removegl=function(e){y&&(y.geometry!==undefined&&y.geometry.dispose(),y.material!==undefined&&y.material.dispose(),e.remove(y),y=null),g=null},this.hide=function(){m=!0,y&&y.setVisible(!1),g&&g.setVisible(!1)},this.show=function(){m=!1,y&&y.setVisible(!0),g&&g.setVisible(!0)},this.addResLabels=function(e,t,n){var r=this.selectedAtoms(e,r),i={};for(var s=0;s<r.length;s++){var o=r[s],u=o.chain,a=o.resn,f=o.resi,l=a+""+f;i[u]||(i[u]={}),i[u][l]||(i[u][l]=[]),i[u][l].push(o)}var c=$.extend(!0,{},n);for(var u in i)if(i.hasOwnProperty(u)){var h=i[u];for(var l in h)if(h.hasOwnProperty(l)){var r=h[l],p=new $3Dmol.Vector3(0,0,0);for(var s=0;s<r.length;s++){var o=r[s];p.x+=o.x,p.y+=o.y,p.z+=o.z}p.divideScalar(r.length),c.position=p,t.addLabel(l,c)}}},this.setCoordinates=function(e,t){t=t||"";if(!e)return[];if(/\.gz$/.test(t)){t=t.replace(/\.gz$/,"");try{e=pako.inflate(e,{to:"string"})}catch(n){console.log(n)}}if(t=="mdcrd"||t=="inpcrd"||t=="pdb"){p=[];var r=h.length,i=c.parseCrd(e,t),s=0;while(s<i.length){var o=[];for(var u=0;u<r;u++){var a={};for(var f in h[u])a[f]=h[u][f];o[u]=a,o[u].x=i[s++],o[u].y=i[s++],o[u].z=i[s++]}p.push(o)}return h=p[0],p}return[]},this.addAtomSpecs=function(e){for(var t=0;t<e.length;t++)u.indexOf(e[t])==-1&&u.push(e[t])}}var e={line:{}},t=["  G","  A","  T","  C","  U"," DG"," DA"," DT"," DC"," DU"],n=1,s={H:1.2,D:1.2,T:1.2,Li:1.82,LI:1.82,Na:2.27,NA:2.27,K:2.75,C:1.7,N:1.55,O:1.52,F:1.47,P:1.8,S:1.8,CL:1.75,Cl:1.75,BR:1.85,Br:1.85,SE:1.9,Se:1.9,ZN:1.39,Zn:1.39,CU:1.4,Cu:1.4,NI:1.63,Ni:1.63},o=["resn","x","y","z","color","surfaceColor","elem","hetflag","chain","resi","icode","rescode","serial","atom","bonds","ss","singleBonds","bondOrder","properties","b","pdbline","clickable","callback","invert","reflectivity","altLoc"],u=o.concat(["model","bonds","predicate","invert","byres","expand","within","and","or","not"]),f=["line","cross","stick","sphere","cartoon","colorfunc"],l=function(e,t){return e&&t?JSON.stringify(e)==JSON.stringify(t):e==t};return c.parseCrd=function(e,t){var n=[],r=0;if(t=="pdb"){var i=e.indexOf("\nATOM");while(i!=-1){while(e.slice(i,i+5)=="\nATOM"||e.slice(i,i+7)=="\nHETATM")n[r++]=parseFloat(e.slice(i+31,i+39)),n[r++]=parseFloat(e.slice(i+39,i+47)),n[r++]=parseFloat(e.slice(i+47,i+55)),i=e.indexOf("\n",i+54),e.slice(i,i+4)=="\nTER"&&(i=e.indexOf("\n",i+5));i=e.indexOf("\nATOM",i)}return n}var i=e.indexOf("\n");return t=="inpcrd"&&(i=e.indexOf("\n",i+1)),e=e.slice(i+1),n=e.match(/\S+/g).map(parseFloat),n},c.parseMolData=function(e,t,n){t=t||"";if(!e)return[];if(/\.gz$/.test(t)){t=t.replace(/\.gz$/,"");try{e=pako.inflate(e,{to:"string"})}catch(r){console.log(r)}}typeof $3Dmol.Parsers[t]=="undefined"&&(t=t.split(".").pop(),typeof $3Dmol.Parsers[t]=="undefined"&&(console.log("Unknown format: "+t),e.match(/^@<TRIPOS>MOLECULE/gm)?t="mol2":e.match(/^HETATM/gm)||e.match(/^ATOM/gm)?t="pdb":e.match(/^.*\n.*\n.\s*(\d+)\s+(\d+)/gm)?t="sdf":e.match(/^%VERSION\s+\VERSION_STAMP/gm)?t="prmtop":t="xyz",console.log("Best guess: "+t)));var i=$3Dmol.Parsers[t],s=i(e,n);return s},c.setAtomDefaults=function(t,n){for(var r=0;r<t.length;r++){var i=t[r];if(i){i.style=i.style||e,i.color=i.color||ElementColors[i.elem]||defaultColor,i.model=n;if(i.clickable||i.hoverable)i.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}}}},c}(),$3Dmol.GLShape=function(){function a(i){i=i||{},$3Dmol.ShapeIDCount++,this.boundingSphere=new $3Dmol.Sphere,this.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]},u(this,i);var a=[],f=null,l=null,c=new $3Dmol.Geometry(!0),h=new $3Dmol.Geometry(!0);this.updateStyle=function(e){for(var t in e)i[t]=e[t];u(this,i)},this.addCustom=function(e){e.vertexArr=e.vertexArr||[],e.faceArr=e.faceArr||[],e.normalArr=e.normalArr||[];var t=c.geometryGroups.length;s(this,c,e)},this.addSphere=function(e){e.center=e.center||{x:0,y:0,z:0},e.radius=e.radius?$3Dmol.Math.clamp(e.radius,0,Infinity):1.5,e.color=$3Dmol.CC.color(e.color),this.intersectionShape.sphere.push(new $3Dmol.Sphere(e.center,e.radius)),$3Dmol.GLDraw.drawSphere(c,e.center,e.radius,e.color),a.push({centroid:new $3Dmol.Vector3(e.center.x,e.center.y,e.center.z)});var t=c.updateGeoGroup(0);o(this.boundingSphere,a,t.vertexArray)},this.addEllipsoid=function(e){e.center=e.center||{x:0,y:0,z:0},e.color=$3Dmol.CC.color(e.color),$3Dmol.GLDraw.drawEllipsoid(c,e.center,e.radiusX,e.radiusY,e.radiusZ,e.matrixOrient,e.matrixRotate,e.color),a.push({centroid:new $3Dmol.Vector3(e.center.x,e.center.y,e.center.z)});var t=c.updateGeoGroup(0);this.boundingSphere.center=new $3Dmol.Vector3(e.center.x,e.center.y,e.center.z),this.boundingSphere.radius=(e.radiusX+e.radiusY+e.radiusZ)/3},this.addCylinder=function(e){e.start=e.start||{},e.end=e.end||{};var t=new $3Dmol.Vector3(e.start.x||0,e.start.y||0,e.start.z||0),n=new $3Dmol.Vector3(e.end.x,e.end.y||0,e.end.z||0);typeof n.x=="undefined"&&(n.x=3);var r=e.radius||.1,i=$3Dmol.CC.color(e.color);this.intersectionShape.cylinder.push(new $3Dmol.Cylinder(t,n,r)),$3Dmol.GLDraw.drawCylinder(c,t,n,r,i,e.fromCap,e.toCap);var s=new $3Dmol.Vector3;a.push({centroid:s.addVectors(t,n).multiplyScalar(.5)});var u=c.updateGeoGroup(0);o(this.boundingSphere,a,u.vertexArray)},this.addDashedCylinder=function(e){console.log("addDashedCylinder"),e.start=e.start||{},e.end=e.end||{},e.dashLength=e.dashLength||.25,e.gapLength=e.gapLength||.25;var t=new $3Dmol.Vector3(e.start.x||0,e.start.y||0,e.start.z||0),n=new $3Dmol.Vector3(e.end.x,e.end.y||0,e.end.z||0);typeof n.x=="undefined"&&(n.x=3);var r=e.radius||.1,i=$3Dmol.CC.color(e.color),s=Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2)+Math.pow(t.z-n.z,2)),u=s/(e.gapLength+e.dashLength),f=new $3Dmol.Vector3(e.start.x||0,e.start.y||0,e.start.z||0),l=new $3Dmol.Vector3(e.end.x,e.end.y||0,e.end.z||0),h=new $3Dmol.Vector3((n.x-t.x)/(s/e.gapLength),(n.y-t.y)/(s/e.gapLength),(n.z-t.z)/(s/e.gapLength)),p=new $3Dmol.Vector3((n.x-t.x)/(s/e.dashLength),(n.y-t.y)/(s/e.dashLength),(n.z-t.z)/(s/e.dashLength));for(var d=0;d<u;d++)l=new $3Dmol.Vector3(f.x+p.x,f.y+p.y,f.z+p.z),this.intersectionShape.cylinder.push(new $3Dmol.Cylinder(f,l,r)),$3Dmol.GLDraw.drawCylinder(c,f,l,r,i,e.fromCap,e.toCap),f=new $3Dmol.Vector3(l.x+h.x,l.y+h.y,l.z+h.z);var v=new $3Dmol.Vector3;a.push({centroid:v.addVectors(t,n).multiplyScalar(.5)});var m=c.updateGeoGroup(0);o(this.boundingSphere,a,m.vertexArray)},this.addLine=function(e){e.start=e.start||{},e.end=e.end||{};var t=new $3Dmol.Vector3(e.start.x||0,e.start.y||0,e.start.z||0),n=new $3Dmol.Vector3(e.end.x,e.end.y||0,e.end.z||0);typeof n.x=="undefined"&&(n.x=3);var r=c.updateGeoGroup(2),i=r.vertices,s=i*3,o=r.vertexArray;o[s]=t.x,o[s+1]=t.y,o[s+2]=t.z,o[s+3]=n.x,o[s+4]=n.y,o[s+5]=n.z,r.vertices+=2;var u=r.lineArray,a=r.lineidx;u[a]=i,u[a+1]=i+1,r.lineidx+=2},this.addArrow=function(e){e.start=e.start||{},e.end=e.end||{},e.start=new $3Dmol.Vector3(e.start.x||0,e.start.y||0,e.start.z||0);if(e.dir instanceof $3Dmol.Vector3&&e.length instanceof number){var t=e.dir.clone().multiplyScalar(e.length).add(start);e.end=t}else e.end=new $3Dmol.Vector3(e.end.x,e.end.y||0,e.end.z||0),typeof e.end.x=="undefined"&&(e.end.x=3);e.radius=e.radius||.1,e.radiusRatio=e.radiusRatio||1.618034,e.mid=0<e.mid&&e.mid<1?e.mid:.618034,r(this,c,e);var n=new $3Dmol.Vector3;a.push({centroid:n.addVectors(e.start,e.end).multiplyScalar(.5)});var i=c.updateGeoGroup(0);o(this.boundingSphere,a,i.vertexArray)},this.addIsosurface=function(t,n,r){var i=n.isoval!==undefined&&typeof n.isoval=="number"?n.isoval:0,o=n.voxel?!0:!1,u=n.smoothness===undefined?1:n.smoothness,a=t.size.x,f=t.size.y,l=t.size.z,h=new Int16Array(a*f*l),d=t.data,v,m;for(v=0,m=h.length;v<m;++v)h[v]=-1;var g=!1,y=[],b=[];if(t["verts_"+n.isoval])y=t["verts_"+n.isoval],b=t["faces_"+n.isoval],g=!0;else{bitdata=new Uint8Array(a*f*l);for(v=0,m=d.length;v<m;++v){var w=i>=0?d[v]-i:i-d[v];w>0&&(bitdata[v]|=e)}$3Dmol.MarchingCube.march(bitdata,y,b,{fulltable:!0,voxel:!1,unitCube:t.unit,origin:t.origin,matrix:t.matrix,nX:a,nY:f,nZ:l}),t["verts_"+n.isoval]=y.slice(),t["faces_"+n.isoval]=b.slice()}var E=[],S=[],x=[];n.selectedRegion&&n.coords===undefined&&(n.coords=n.selectedRegion);if(n.coords!==undefined){var T=n.coords[0].x,N=n.coords[0].y,C=n.coords[0].z,k=n.coords[0].x,L=n.coords[0].y,A=n.coords[0].z;for(var v=0;v<n.coords.length;v++)n.coords[v].x>T?T=n.coords[v].x:n.coords[v].x<k&&(k=n.coords[v].x),n.coords[v].y>N?N=n.coords[v].y:n.coords[v].y<L&&(L=n.coords[v].y),n.coords[v].z>C?C=n.coords[v].z:n.coords[v].z<A&&(A=n.coords[v].z);var O=2;n.radius!==undefined&&(O=n.radius),n.selectedOffset!==undefined&&(O=n.selectedOffset),n.seldist!==undefined&&(O=n.seldist),k-=O,T+=O,L-=O,N+=O,A-=O,C+=O;for(var v=0;v<y.length;v++)y[v].x>k&&y[v].x<T&&y[v].y>L&&y[v].y<N&&y[v].z>A&&y[v].z<C&&p(y[v],n.coords,O)?(E.push(S.length),S.push({x:y[v].x,y:y[v].y,z:y[v].z})):E.push(-1);for(var v=0;v+2<b.length;v+=3)E[b[v]]!==-1&&E[b[v+1]]!==-1&&E[b[v+2]]!==-1&&(x.push(b[v]-(b[v]-E[b[v]])),x.push(b[v+1]-(b[v+1]-E[b[v+1]])),x.push(b[v+2]-(b[v+2]-E[b[v+2]])));!o&&u>0&&$3Dmol.MarchingCube.laplacianSmooth(u,S,x)}s(this,c,{vertexArr:S,faceArr:x,normalArr:[],clickable:n.clickable,hoverable:n.hoverable}),this.updateStyle(n);var M=new $3Dmol.Vector3(t.origin.x,t.origin.y,t.origin.z),_=new $3Dmol.Vector3(t.size.x*t.unit.x,t.size.y*t.unit.y,t.size.z*t.unit.z),D=new $3Dmol.Vector3(0,0,0),P=M.clone(),H=M.clone().add(_);for(var v=0;v<S.length;v++)D.add(S[v]),P.max(S[v]),H.min(S[v]);D.divideScalar(S.length);var B=D.distanceTo(H),j=D.distanceTo(P);this.boundingSphere.center=D,this.boundingSphere.radius=Math.max(B,j),typeof r=="function"&&r()};var p=function(e,t,n){for(var r=0;r<t.length;r++)if(d(t[r],e)<=n)return!0;return!1},d=function(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)+Math.pow(e.z-t.z,2))},v=function(e,t,n,r){var i;return r.matrix?(i=new $3Dmol.Vector3(e,t,n),i=i.applyMatrix4(r.matrix),i={x:i.x,y:i.y,z:i.z}):(i.x=r.origin.x+r.unit.x*e,i.y=r.origin.y+r.unit.y*t,i.z=r.origin.z+r.unit.z*n),i};this.addVolumetricData=function(e,t,n){var e=new $3Dmol.VolumeData(e,t);this.addIsosurface(e,n)},this.globj=function(e){l&&(e.remove(l),l=null);if(this.hidden)return;t(c),c.initTypedArrays(),typeof this.color!="undefined"&&n(c,this.color),f=new $3Dmol.Object3D;var r=null;if(this.side==$3Dmol.DoubleSide)var r=new $3Dmol.MeshDoubleLambertMaterial({wireframe:this.wireframe,side:this.side,transparent:this.opacity<1?!0:!1,opacity:this.opacity,wireframeLinewidth:this.linewidth});else var r=new $3Dmol.MeshLambertMaterial({wireframe:this.wireframe,side:this.side,transparent:this.opacity<1?!0:!1,opacity:this.opacity,wireframeLinewidth:this.linewidth});var i=new $3Dmol.Mesh(c,r);f.add(i);var s=new $3Dmol.LineBasicMaterial({linewidth:this.linewidth,color:this.color}),o=new $3Dmol.Line(h,s,$3Dmol.LinePieces);f.add(o),l=f.clone(),e.add(l)},this.removegl=function(e){l&&(l.geometry!==undefined&&l.geometry.dispose(),l.material!==undefined&&l.material.dispose(),e.remove(l),l=null),f=null}}var e=2,t=function(e){var t=e.updateGeoGroup(0);t.vertices>0&&t.truncateArrayBuffers(!0,!0)},n=function(e,t){var n=t||$3Dmol.CC.color(t);e.colorsNeedUpdate=!0;var r,i,s;t.constructor!==Array&&(r=t.r,i=t.g,s=t.b);for(var o in e.geometryGroups){var u=e.geometryGroups[o],a=u.colorArray;for(var f=0,l=u.vertices;f<l;++f){if(t.constructor===Array){var c=t[f];r=c.r,i=c.g,s=c.b}a[f*3]=r,a[f*3+1]=i,a[f*3+2]=s}}},r=function(e,t,n){var r=n.start,i=n.end,s=n.radius,o=n.radiusRatio,u=n.mid;if(!r||!i)return;var a=t.updateGeoGroup(51),f=i.clone();f.sub(r).multiplyScalar(u);var l=r.clone().add(f),c=f.clone().negate();e.intersectionShape.cylinder.push(new $3Dmol.Cylinder(r.clone(),l.clone(),s)),e.intersectionShape.sphere.push(new $3Dmol.Sphere(r.clone(),s));var h=[];h[0]=f.clone(),Math.abs(h[0].x)>1e-4?h[0].y+=1:h[0].x+=1,h[0].cross(f),h[0].normalize(),h[0]=h[0],h[4]=h[0].clone(),h[4].crossVectors(h[0],f),h[4].normalize(),h[8]=h[0].clone().negate(),h[12]=h[4].clone().negate(),h[2]=h[0].clone().add(h[4]).normalize(),h[6]=h[4].clone().add(h[8]).normalize(),h[10]=h[8].clone().add(h[12]).normalize(),h[14]=h[12].clone().add(h[0]).normalize(),h[1]=h[0].clone().add(h[2]).normalize(),h[3]=h[2].clone().add(h[4]).normalize(),h[5]=h[4].clone().add(h[6]).normalize(),h[7]=h[6].clone().add(h[8]).normalize(),h[9]=h[8].clone().add(h[10]).normalize(),h[11]=h[10].clone().add(h[12]).normalize(),h[13]=h[12].clone().add(h[14]).normalize(),h[15]=h[14].clone().add(h[0]).normalize();var p=a.vertices,d=a.vertexArray,v=a.colorArray,m=a.faceArray,g=a.normalArray,y=a.lineArray,b,w,E;for(w=0,E=h.length;w<E;++w){b=3*(p+3*w);var S=h[w].clone().multiplyScalar(s).add(r),x=h[w].clone().multiplyScalar(s).add(l),T=h[w].clone().multiplyScalar(s*o).add(l);d[b]=S.x,d[b+1]=S.y,d[b+2]=S.z,d[b+3]=x.x,d[b+4]=x.y,d[b+5]=x.z,d[b+6]=T.x,d[b+7]=T.y,d[b+8]=T.z;if(w>0){var N=d[b-3],C=d[b-2],k=d[b-1],L=new $3Dmol.Vector3(N,C,k),A=i.clone(),O=l.clone(),M=new $3Dmol.Vector3(T.x,T.y,T.z);e.intersectionShape.triangle.push(new $3Dmol.Triangle(M,A,L)),e.intersectionShape.triangle.push(new $3Dmol.Triangle(L.clone(),O,M.clone()))}}a.vertices+=48,b=a.vertices*3,d[b]=r.x,d[b+1]=r.y,d[b+2]=r.z,d[b+3]=l.x,d[b+4]=l.y,d[b+5]=l.z,d[b+6]=i.x,d[b+7]=i.y,d[b+8]=i.z,a.vertices+=3;var _,D,P,H,B,j,F,I,q,R,U,z,W,X,V,$,J,K,Q,G,Y=0,Z=a.vertices-3,et=a.vertices-2,tt=a.vertices-1,nt=Z*3,rt=et*3,it=tt*3;for(w=0,E=h.length-1;w<E;++w){var st=p+3*w;b=st*3,P=a.faceidx,H=a.lineidx,B=st,U=B*3,j=st+1,z=j*3,F=st+2,W=F*3,I=st+4,X=I*3,q=st+5,V=q*3,R=st+3,$=R*3,D=[h[w],h[w],h[w+1],h[w+1]],J=K=h[w],Q=G=h[w+1],g[U]=J.x,g[z]=K.x,g[$]=G.x,g[U+1]=J.y,g[z+1]=K.y,g[$+1]=G.y,g[U+2]=J.z,g[z+2]=K.z,g[$+2]=G.z,g[z]=K.x,g[X]=Q.x,g[$]=G.x,g[z+1]=K.y,g[X+1]=Q.y,g[$+1]=G.y,g[z+2]=K.z,g[X+2]=Q.z,g[$+2]=G.z,g[W]=K.x,g[V]=Q.x,g[W+1]=K.y,g[V+1]=Q.y,g[W+2]=K.z,g[V+2]=Q.z,m[P]=B,m[P+1]=j,m[P+2]=R,m[P+3]=j,m[P+4]=I,m[P+5]=R,m[P+6]=B,m[P+7]=R,m[P+8]=Z,m[P+9]=F,m[P+10]=et,m[P+11]=q,m[P+12]=F,m[P+13]=tt,m[P+14]=q,y[H]=B,y[H+1]=j,y[H+2]=B,y[H+3]=R,y[H+4]=I,y[H+5]=R,y[H+6]=B,y[H+7]=R,y[H+8]=F,y[H+9]=j,y[H+10]=F,y[H+11]=q,y[H+12]=I,y[H+13]=q,y[H+14]=F,y[H+15]=tt,y[H+16]=F,y[H+17]=q,y[H+18]=tt,y[H+19]=q,a.faceidx+=15,a.lineidx+=20}_=[p+45,p+46,p+1,p,p+47,p+2],D=[h[15],h[15],h[0],h[0]],P=a.faceidx,H=a.lineidx,B=_[0],U=B*3,j=_[1],z=j*3,F=_[4],W=F*3,I=_[2],X=I*3,q=_[5],V=q*3,R=_[3],$=R*3,J=K=h[15],Q=G=h[0],g[U]=J.x,g[z]=K.x,g[$]=G.x,g[U+1]=J.y,g[z+1]=K.y,g[$+1]=G.y,g[U+2]=J.z,g[z+2]=K.z,g[$+2]=G.z,g[z]=K.x,g[X]=Q.x,g[$]=G.x,g[z+1]=K.y,g[X+1]=Q.y,g[$+1]=G.y,g[z+2]=K.z,g[X+2]=Q.z,g[$+2]=G.z,g[W]=K.x,g[V]=Q.x,g[W+1]=K.y,g[V+1]=Q.y,g[W+2]=K.z,g[V+2]=Q.z,f.normalize(),c.normalize(),g[nt]=c.x,g[rt]=g[it]=f.x,g[nt+1]=c.y,g[rt+1]=g[it+1]=f.y,g[nt+2]=c.z,g[rt+2]=g[it+2]=f.z,m[P]=B,m[P+1]=j,m[P+2]=R,m[P+3]=j,m[P+4]=I,m[P+5]=R,m[P+6]=B,m[P+7]=R,m[P+8]=Z,m[P+9]=F,m[P+10]=et,m[P+11]=q,m[P+12]=F,m[P+13]=tt,m[P+14]=q,y[H]=B,y[H+1]=j,y[H+2]=B,y[H+3]=R,y[H+4]=I,y[H+5]=R,y[H+6]=B,y[H+7]=R,y[H+8]=F,y[H+9]=j,y[H+10]=F,y[H+11]=q,y[H+12]=I,y[H+13]=q,y[H+14]=F,y[H+15]=tt,y[H+16]=F,y[H+17]=q,y[H+18]=tt,y[H+19]=q,a.faceidx+=15,a.lineidx+=20},i=function(e,t,n,r,i){var s=t.addGeoGroup(),u=n.vertexArr,a=n.normalArr,f=n.faceArr;s.vertices=u.length,s.faceidx=f.length;var l,c,h,p,d,v,m,g=s.vertexArray,y=s.colorArray;if(r.constructor!==Array)var b=r.r,w=r.g,p=r.b;for(v=0,m=s.vertices;v<m;++v){l=v*3,c=u[v],g[l]=c.x,g[l+1]=c.y,g[l+2]=c.z;if(r.constructor===Array)var d=r[v],b=d.r,w=d.g,p=d.b;y[l]=b,y[l+1]=w,y[l+2]=p}if(i)for(v=0,m=s.faceidx/3;v<m;++v){l=v*3,h=f[l],p=f[l+1],d=f[l+2];var E=new $3Dmol.Vector3,S=new $3Dmol.Vector3,x=new $3Dmol.Vector3;e.intersectionShape.triangle.push(new $3Dmol.Triangle(E.copy(u[h]),S.copy(u[p]),x.copy(u[d])))}if(i){var T=new $3Dmol.Vector3(0,0,0),N=0;for(var w=0;w<t.geometryGroups.length;w++)T.add(t.geometryGroups[w].getCentroid()),N++;T.divideScalar(N),o(e.boundingSphere,{centroid:T},g)}s.faceArray=new Uint16Array(f),s.truncateArrayBuffers(!0,!0);if(a.length<s.vertices)s.setNormals();else{var C=s.normalArray=new Float32Array(s.vertices*3),k;for(v=0,m=s.vertices;v<m;++v)l=v*3,k=a[v],C[l]=k.x,C[l+1]=k.y,C[l+2]=k.z}s.setLineIndices(),s.lineidx=s.lineArray.length},s=function(e,t,n){var r=n,s=r.vertexArr,o=r.normalArr,u=r.faceArr;if(s.length===0||u.length===0)console.warn("Error adding custom shape component: No vertices and/or face indices supplied!"),e.error=!0;var a=n.color;typeof a=="undefined"&&(a=e.color),a=$3Dmol.CC.color(a);var f=$3Dmol.splitMesh(r);for(var l=0,c=f.length;l<c;l++)i(e,t,f[l],f[l].colorArr?f[l].colorArr:a,n.clickable)},o=function(e,t,n){e.center.set(0,0,0);var r,i;if(t.length>0){for(r=0,i=t.length;r<i;++r){var s=t[r].centroid;e.center.add(s)}e.center.divideScalar(t.length)}var o=e.radius*e.radius;for(r=0,i=n.length/3;r<i;r++){var u=n[r*3],a=n[r*3+1],f=n[r*3+2],l=e.center.distanceToSquared({x:u,y:a,z:f});o=Math.max(o,l)}e.radius=Math.sqrt(o)},u=function(e,t){typeof t.color!="undefined"?(e.color=t.color||new $3Dmol.Color,t.color instanceof $3Dmol.Color||(e.color=$3Dmol.CC.color(t.color))):e.color=$3Dmol.CC.color(0),e.wireframe=t.wireframe?!0:!1,e.opacity=t.alpha?$3Dmol.Math.clamp(t.alpha,0,1):1,typeof t.opacity!="undefined"&&(e.opacity=$3Dmol.Math.clamp(t.opacity,0,1)),e.side=t.side!==undefined?t.side:$3Dmol.DoubleSide,e.linewidth=typeof t.linewidth=="undefined"?1:t.linewidth,e.clickable=t.clickable?!0:!1,e.callback=typeof t.callback=="function"?t.callback:null,e.hoverable=t.hoverable?!0:!1,e.hover_callback=typeof t.hover_callback=="function"?t.hover_callback:null,e.unhover_callback=typeof t.unhover_callback=="function"?t.unhover_callback:null,e.hidden=t.hidden};return Object.defineProperty(a.prototype,"position",{get:function(){return this.boundingSphere.center}}),Object.defineProperty(a.prototype,"x",{get:function(){return this.boundingSphere.center.x}}),Object.defineProperty(a.prototype,"y",{get:function(){return this.boundingSphere.center.y}}),Object.defineProperty(a.prototype,"z",{get:function(){return this.boundingSphere.center.z}}),a}(),$3Dmol.ShapeIDCount=0,$3Dmol.splitMesh=function(e){var t=64e3;if(e.vertexArr.length<t)return[e];var n=e.vertexArr.length,r=[{vertexArr:[],normalArr:[],faceArr:[]}];e.colorArr&&(r.colorArr=[]);var i=[],s=[],o=0,u=e.faceArr,a=[0,0,0];for(var f=0,l=u.length;f<l;f+=3){var c=r[o];for(var h=0;h<3;h++){var p=u[f+h];i[p]!==o&&(i[p]=o,s[p]=c.vertexArr.length,c.vertexArr.push(e.vertexArr[p]),e.normalArr&&e.normalArr[p]&&c.normalArr.push(e.normalArr[p]),e.colorArr&&e.colorArr[p]&&c.colorArr.push(e.colorArr[p])),c.faceArr.push(s[p])}c.vertexArr.length>=t&&(r.push({vertexArr:[],normalArr:[],faceArr:[]}),e.colorArr&&(r.colorArr=[]),o++)}return r},$3Dmol.GLViewer=function(){function n(n,r){function wt(e){var t=[];typeof e=="undefined"&&(e={});var n=[],r;if(typeof e.model=="undefined")for(r=0;r<p.length;r++)p[r]&&n.push(p[r]);else n=e.model,$.isArray(n)||(n=[n]);for(r=0;r<n.length;r++)t=t.concat(n[r].selectedAtoms(e));return t}function Et(e,t){typeof t=="undefined"&&(t={});var n=[],r;if(typeof t.model=="undefined")for(r=0;r<p.length;r++)p[r]&&n.push(p[r]);else n=t.model,$.isArray(n)||(n=[n]);for(r=0;r<n.length;r++)if(n[r].atomIsSelected(e,t))return!0;return!1}function Nt(e,t){e.dashLength=e.dashLength||.5,e.gapLength=e.gapLength||.5,e.start=e.start||{},e.end=e.end||{};var n=new $3Dmol.Vector3(e.start.x||0,e.start.y||0,e.start.z||0),r=new $3Dmol.Vector3(e.end.x,e.end.y||0,e.end.z||0),i=new $3Dmol.Vector3,s=new $3Dmol.Vector3,o=new $3Dmol.Vector3,u,a,f,l=n.clone(),c=0;i.subVectors(r,n),u=i.length(),i.normalize(),s=i.clone(),o=i.clone(),s.multiplyScalar(e.dashLength),o.multiplyScalar(e.gapLength),a=s.length(),f=o.length();while(c<u){if(c+a>u){e.start=n,e.end=r,t.addLine(e);break}l.addVectors(n,s),e.start=n,e.end=l,t.addLine(e),n=l.clone(),c+=a,l.addVectors(n,o),n=l.clone(),c+=f}return t}function Ct(e,t,n,r,i){var s=[];if(typeof t.model=="undefined")for(o=0;o<p.length;o++)p[o]&&s.push(p[o]);else s=t.model,$.isArray(s)||(s=[s]);for(var o=0;o<s.length;o++)s[o]&&(typeof s[o]=="number"?p[s[o]][e](t,n,r,i):s[o][e](t,n,r,i))}function _t(e){var t=new $3Dmol.MeshLambertMaterial;t.vertexColors=$3Dmol.VertexColors;for(var n in e)n!=="color"&&n!=="map"&&e.hasOwnProperty(n)&&(t[n]=e[n]);return e.opacity!==undefined&&(e.opacity===1?t.transparent=!1:t.transparent=!0),t}r=r||{};var i=r.callback,s=r.defaultcolors;s||(s=$3Dmol.elementColors.defaultColors);var o=r.nomouse,u=0;r.backgroundColor=r.backgroundColor||"#ffffff",typeof r.backgroundColor!=undefined&&(u=$3Dmol.CC.color(r.backgroundColor).getHex());var a=0;typeof r.camerax!=undefined&&(a=parseFloat(r.camerax));var f=this,l=n,c=l.id,h=null,p=[],d={},v=[],m=[],g=[],y=[],b=[],w=[],E=null,S=500;typeof r.hoverDuration!=undefined&&(S=r.hoverDuration);var x=l.width(),T=l.height(),N=x/T,C=1,k=800,L=150,A=20,O=[],M=new $3Dmol.Renderer({antialias:!0,preserveDrawingBuffer:!0,premultipliedAlpha:!1,id:r.id});M.domElement.style.width="100%",M.domElement.style.height="100%",M.domElement.style.padding="0",M.domElement.style.position="absolute",M.domElement.style.top="0px",M.domElement.style.left="0px",M.domElement.style.zIndex="0";var _=new $3Dmol.Camera(A,N,C,k,r.orthographic);_.position=new $3Dmol.Vector3(a,0,L);var D=new $3Dmol.Vector3;_.lookAt(D);var P=new $3Dmol.Raycaster(new $3Dmol.Vector3(0,0,0),new $3Dmol.Vector3(0,0,0)),H=new $3Dmol.Projector,B=new $3Dmol.Vector3(0,0,0),j=null,F=null,I=null,q=.4,R=-50,U=50,z=new $3Dmol.Quaternion(0,0,0,1),W=new $3Dmol.Quaternion(0,0,0,1),X=!1,V=!1,J=0,K=0,Q=0,G=0,Y=0,Z=0,et=0,tt=function(){var e=0;for(var t in d){if(!d.hasOwnProperty(t))continue;t>e&&(e=t)}return e+1},nt=function(){var e=_.position.z-F.position.z;e<1&&(e=1),_.near=e+R,_.near<1&&(_.near=1),_.far=e+U,_.near+1>_.far&&(_.far=_.near+1),_.fov=A,_.right=e*Math.tan(Math.PI/180*A),_.left=-_.right,_.top=_.right/N,_.bottom=-_.top,_.updateProjectionMatrix(),j.fog.near=_.near+q*(_.far-_.near),j.fog.far=_.far,r.disableFog&&(j.fog.near=j.fog.far)},rt=function(e){if(!j)return;nt(),M.render(j,_);if(!e&&O.length>0){var t=f.getView();for(var n=0;n<O.length;n++){var r=O[n];r.setView(t,!0)}}},it=function(){j=new $3Dmol.Scene,j.fog=new $3Dmol.Fog(u,100,200),I=new $3Dmol.Object3D,F=new $3Dmol.Object3D,F.useQuaternion=!0,F.quaternion=new $3Dmol.Quaternion(0,0,0,1),F.add(I),j.add(F);var e=new $3Dmol.Light(16777215);e.position=(new $3Dmol.Vector3(.2,.2,1)).normalize(),e.intensity=1,j.add(e)};it(),M.setClearColorHex(u,1),j.fog.color=$3Dmol.CC.color(u);var st=null,ot=function(){y.splice(0,y.length),b.splice(0,b.length);var e,t;for(e=0,t=p.length;e<t;e++){var n=p[e];if(n){var r=n.selectedAtoms({clickable:!0}),i=n.selectedAtoms({hoverable:!0});Array.prototype.push.apply(b,i),Array.prototype.push.apply(y,r)}}for(e=0,t=v.length;e<t;e++){var s=v[e];s&&s.clickable&&y.push(s),s&&s.hoverable&&b.push(s)}},ut=function(e,t,n){if(y.length==0)return;var r={x:e,y:t,z:-1};B.set(r.x,r.y,r.z),H.unprojectVector(B,_),B.sub(_.position).normalize(),P.set(_.position,B);var i=[];i=P.intersectObjects(I,y);if(i.length){var s=i[0].clickable;s.callback!==undefined&&typeof s.callback=="function"&&s.callback(s,f,n,l)}},at=function(e,t,n){if(b.length==0)return;var r={x:e,y:t,z:-1};B.set(r.x,r.y,r.z),H.unprojectVector(B,_),B.sub(_.position).normalize(),P.set(_.position,B);var i=[];i=P.intersectObjects(I,b);if(i.length){var s=i[0].clickable;E=s,s.hover_callback!==undefined&&typeof s.hover_callback=="function"&&s.hover_callback(s,f,n,l)}else E=null},ft=function(e,t,n){var r={x:e,y:t,z:-1};B.set(r.x,r.y,r.z),H.unprojectVector(B,_),B.sub(_.position).normalize(),P.set(_.position,B);var i=[];i=P.intersectObjects(I,b),i[0]===undefined&&(E.unhover_callback(E,f,n,l),E=null),i[0]!==undefined&&i[0].clickable!==E&&(E.unhover_callback(E,f,n,l),E=null)},lt=function(e){var t=e.originalEvent.targetTouches[0].pageX-e.originalEvent.targetTouches[1].pageX,n=e.originalEvent.targetTouches[0].pageY-e.originalEvent.targetTouches[1].pageY;return Math.sqrt(t*t+n*n)},ct=function(e){var t=e.pageX,n=e.pageY;return e.originalEvent.targetTouches&&e.originalEvent.targetTouches[0]?(t=e.originalEvent.targetTouches[0].pageX,n=e.originalEvent.targetTouches[0].pageY):e.originalEvent.changedTouches&&e.originalEvent.changedTouches[0]&&(t=e.originalEvent.changedTouches[0].pageX,n=e.originalEvent.changedTouches[0].pageY),[t,n]},ht=function(e,t){var n=e/x,r=t/T,i=F.position.z,s=F.quaternion,o=new $3Dmol.Vector3(0,0,i);return H.projectVector(o,_),o.x+=n*2,o.y-=r*2,H.unprojectVector(o,_),o.z=0,o.applyQuaternion(s),o};$("body").bind("mouseup touchend",function(e){if(V&&j){var t=ct(e),n=t[0],r=t[1];if(n==J&&r==K){var i=$("canvas",l).offset(),s=(n-i.left)/x*2-1,o=-((r-i.top)/T)*2+1;ut(s,o,e,l)}}V=!1});var pt,dt=this._handleMouseDown=function(e){e.preventDefault();if(!j)return;var t=ct(e),n=t[0],r=t[1];if(n===undefined)return;V=!0,st=null,pt=e.which,J=n,K=r,Q=0,e.originalEvent.targetTouches&&e.originalEvent.targetTouches.length==2&&(Q=lt(e)),z=F.quaternion,Y=F.position.z,G=I.position.clone(),Z=R,et=U},vt,mt=this._handleMouseScroll=function(e){e.preventDefault();if(!j)return;var t=(L-F.position.z)*.85,n=1;e.originalEvent.ctrlKey&&(n=-1);var r=0;e.originalEvent.detail?(e.originalEvent.detail<1&&(r=-1),F.position.z+=n*t*e.originalEvent.detail/10):e.originalEvent.wheelDelta&&(e.originalEvent.wheelDelta<1&&(r=-1),F.position.z-=n*t*e.originalEvent.wheelDelta/400),F.position.z>L&&(F.position.z=L*.999),typeof scroll_callback=="function"&&scroll_callback(r,e),rt()};this.pngURI=function(){return $("canvas",l)[0].toDataURL("image/png")},this.setScrollCallback=function(e){scroll_callback=e},this.setHoverDuration=function(e){S=e};var gt,yt=this._handleMouseMove=function(e){clearTimeout(gt);var t=$("canvas",l).offset(),n=(ct(e)[0]-t.left)/x*2-1,r=-((ct(e)[1]-t.top)/T)*2+1;!V&&E!==null&&ft(n,r,e),gt=setTimeout(function(){V||at(n,r,e)},S),x=l.width(),T=l.height(),e.preventDefault();if(!j)return;if(!V)return;var i=0,s=ct(e),o=s[0],u=s[1];if(o===undefined)return;var a=(o-J)/x,f=(u-K)/T;if(Q!=0&&e.originalEvent.targetTouches&&e.originalEvent.targetTouches.length==2){var c=lt(e);i=2,f=(c-Q)*2/(x+T)}else e.originalEvent.targetTouches&&e.originalEvent.targetTouches.length==3&&(i=1);var h=Math.sqrt(a*a+f*f),p;if(i==3||pt==3&&e.ctrlKey)R=Z+a*100,U=et+f*100;else if(i==2||pt==3||e.shiftKey)p=(L-F.position.z)*.85,p<80&&(p=80),F.position.z=Y+f*p,F.position.z>L&&(F.position.z=L*.999);else if(i==1||pt==2||e.ctrlKey){var d=ht(o-J,u-K);I.position.addVectors(G,d)}else if((i===0||pt==1)&&h!==0){var v=Math.sin(h*Math.PI)/h;W.x=Math.cos(h*Math.PI),W.y=0,W.z=v*a,W.w=-v*f,F.quaternion=new $3Dmol.Quaternion(1,0,0,0),F.quaternion.multiply(W),F.quaternion.multiply(z)}rt()},bt=function(e){l=e,x=l.width(),T=l.height(),N=x/T,M.setSize(x,T),l.append(M.domElement),h=$(M.domElement),o||(h.bind("mousedown touchstart",dt),h.bind("DOMMouseScroll mousewheel",mt),h.bind("mousemove touchmove",yt),h.bind("contextmenu",function(e){e.preventDefault()}))};bt(l),this.setContainer=function(e){return $.type(e)==="string"&&(e=$("#"+e)),e||(e=l),bt(e),this},this.setBackgroundColor=function(e,t){if(typeof t=="undefined")t=1;else if(t<0||t>1)t=1;var n=$3Dmol.CC.color(e);return j.fog.color=n,u=n.getHex(),M.setClearColorHex(n.getHex(),t),rt(),this},this.getBackgroundColor=function(){return u},this.setProjection=function(e){_.ortho=e==="orthographic",nt()},this.setViewStyle=function(e){if(e.style==="outline"){var t={};e.color&&(t.color=$3Dmol.CC.color(e.color)),e.width&&(t.width=e.width),M.enableOutline(t)}else M.disableOutline();return this},r.style&&this.setViewStyle(r),this.setWidth=function(e){return x=e||x,M.setSize(x,T),this},this.setHeight=function(e){return T=e||T,M.setSize(x,T),this},this.resize=function(){return x=l.width(),T=l.height(),N=x/T,M.setSize(x,T),_.aspect=N,_.updateProjectionMatrix(),rt(),this},this.getSize=function(){var e={};return e.w=l.width(),e.h=l.height(),e},this.resizeTo=function(e,t){var n={};return n.w=l.width(),n.h=l.height(),x=e,T=t,N=x/T,M.setSize(x,T),_.aspect=N,_.updateProjectionMatrix(),rt(),n},this.resizeToWidth=function(e){var t={};return t.w=l.width(),t.h=l.height(),t.a=t.w/t.h,x=e,T=e/t.a-4,N=x/T,M.setSize(x,T),_.aspect=N,_.updateProjectionMatrix(),rt(),t},$(window).resize(this.resize),this.getModel=function(e){return e in p?p[e]:p.length==0?null:p[p.length-1]},this.rotate=function(e,t,n,r){n=n!==undefined?n:0,typeof t=="undefined"&&(t="y");var i=function(e){var n=Math.sin(e/2),r=Math.cos(e/2),i=0,s=0,o=0;return t=="x"?i=n:t=="y"?s=n:t=="z"?o=n:(i=n,s=n,o=n),(new $3Dmol.Quaternion(i,s,o,r)).normalize()},s=20,o=Math.PI*e/180,u=i(o);if(n){var a=(new $3Dmol.Quaternion).copy(F.quaternion).multiply(u);xt(n,r,I.position,F.position.z,a,D)}else F.quaternion.multiply(u),rt();return this},this.surfacesFinished=function(){for(var e in d)if(!d[e][0].done)return!1;return!0},this.getView=function(){if(!I)return[0,0,0,0,0,0,0,1];var e=I.position,t=F.quaternion;return[e.x,e.y,e.z,F.position.z,t.x,t.y,t.z,t.w]},this.setView=function(e,t){return e!==undefined&&(e instanceof Array||e.length!==8)?!I||!F?this:(I.position.x=e[0],I.position.y=e[1],I.position.z=e[2],F.position.z=e[3],F.quaternion.x=e[4],F.quaternion.y=e[5],F.quaternion.z=e[6],F.quaternion.w=e[7],typeof e[8]!="undefined"&&(F.position.x=e[8],F.position.y=e[9]),rt(t),this):this},this.render=function(e){var t=new Date;ot();var n=this.getView(),r,i,s=M.supportedExtensions();for(r=0;r<p.length;r++)p[r]&&p[r].globj(I,s);for(r=0;r<v.length;r++)v[r]&&v[r].globj(I,s);for(r in d){if(!d.hasOwnProperty(r))continue;var o=d[r];for(i=0;i<o.length;i++)if(o.hasOwnProperty(i)){var u=o[i].geo;if(!o[i].finished){u.verticesNeedUpdate=!0,u.elementsNeedUpdate=!0,u.normalsNeedUpdate=!0,u.colorsNeedUpdate=!0,u.buffersNeedUpdate=!0,u.boundingSphere=null,o[i].done&&(o[i].finished=!0),o[i].lastGL&&I.remove(o[i].lastGL);var a=null;o[i].mat instanceof $3Dmol.LineBasicMaterial?a=new $3Dmol.Line(u,o[i].mat):a=new $3Dmol.Mesh(u,o[i].mat),o[i].mat.transparent&&o[i].mat.opacity==0?a.visible=!1:a.visible=!0;if(o[i].symmetries.length>1||o[i].symmetries.length==1&&!o[i].symmetries[i].isIdentity()){var f,l=new $3Dmol.Object3D;for(f=0;f<o[i].symmetries.length;f++){var c=a.clone();c.matrix=o[i].symmetries[f],c.matrixAutoUpdate=!1,l.add(c)}o[i].lastGL=l,I.add(l)}else o[i].lastGL=a,I.add(a)}}}this.setView(n);var h=new Date;return typeof e=="function"&&e(),this},this.autoload=function(e,t){$3Dmol.autoload(e,t)},this.selectedAtoms=function(e){return wt(e)},this.pdbData=function(e){var t=wt(e),n="";for(var r=0,i=t.length;r<i;++r)n+=t[r].pdbline+"\n";return n};var St=function(e,t,n){if(n==1)return t;if(n==0)return e;var r=e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w;if(r>.9995){var i=new $3Dmol.Quaternion(e.x+n*(t.x-e.x),e.y+n*(t.y-e.y),e.z+n*(t.z-e.z),e.w+n*(t.w-e.w));return i.normalize(),i}r<0&&(t=t.clone().multiplyScalar(-1),r=-r),r>1?r=1:r<-1&&(r=-1);var s=Math.acos(r),o=s*n,u=t.clone();u.sub(e.clone().multiplyScalar(r)),u.normalize();var a=Math.cos(o),f=Math.sin(o),l=new $3Dmol.Quaternion(e.x*a+u.x*f,e.y*a+u.y*f,e.z*a+u.z*f,e.w*a+u.w*f);return l.normalize(),l},xt=function(e,t,n,r,i,s){var o=20,u=Math.ceil(e/o);u<1&&(u=1);var a={mpos:I.position.clone(),rz:F.position.z,rot:F.quaternion.clone(),cam:D.clone()};if(t){var u=new Array(u),f=u.length;for(var l=0;l<f;l++){var c=(l+1)/f,h={mpos:a.mpos,rz:a.rz,rot:a.rot};n&&(h.mpos=n.clone().sub(a.mpos).multiplyScalar(c).add(a.mpos)),typeof r!="undefined"&&r!=null&&(h.rz=a.rz+c*(r-a.rz)),i&&(h.rot=St(a.rot,i,c)),s&&(h.cam=s.clone().sub(a.cam).multiplyScalar(c).add(a.cam)),u[l]=h}var p=0,d=function(
){var e=u[p];p+=1,e.mpos&&(I.position=e.mpos),e.rz&&(F.position.z=e.rz),e.rot&&(F.quaternion=e.rot),e.cam&&_.lookAt(e.cam),p<u.length&&setTimeout(d,o),rt()};setTimeout(d,o)}else{var v={},c=1/u;n&&(v.mpos=n.clone().sub(a.mpos).multiplyScalar(c)),typeof r!="undefined"&&r!=null&&(v.rz=c*(r-a.rz));if(i){var h=St(a.rot,i,c);v.rot=a.rot.clone().inverse().multiply(h)}s&&(v.cam=s.clone().sub(a.cam).multiplyScalar(c));var p=0,d=function(){p+=1,v.mpos&&I.position.add(v.mpos),v.rz&&(F.position.z+=v.rz),v.rot&&F.quaternion.multiply(v.rot),v.cam&&(D.add(v.cam),_.lookAt(D)),p<u&&setTimeout(d,o),rt()};setTimeout(d,o)}};this.zoom=function(e,t,n){var e=e||2,t=t!==undefined?t:0,r=(L-F.position.z)/e,i=L-r;return t>0?xt(t,n,I.position,i,F.quaternion,D):(F.position.z=i,rt()),this},this.translate=function(e,t,n,r){var n=n!==undefined?n:0,i=e/x,s=t/T,o=new $3Dmol.Vector3(0,0,-L);H.projectVector(o,_),o.x-=i,o.y-=s,H.unprojectVector(o,_),o.z=0;var u=D.clone().add(o);return n>0?xt(n,r,I.position,F.position.z,F.quaternion,u):(D=u,_.lookAt(D),rt()),this},this.fitSlab=function(e){e=e||{};var t=wt(e),n=$3Dmol.getExtent(t),r=n[1][0]-n[0][0],i=n[1][1]-n[0][1],s=n[1][2]-n[0][2],o=Math.sqrt(r*r+i*i+s*s);return o<5&&(o=5),R=-o/1.9,U=o/2,this},this.center=function(e,t,n){t=t!==undefined?t:0;var r,i;e=e||{};var s=wt(e),o=$3Dmol.getExtent(s);$.isEmptyObject(e)?($.each(v,function(e,t){if(t&&t.boundingSphere&&t.boundingSphere.center){var n=t.boundingSphere.center,r=t.boundingSphere.radius;r>0?(s.push(new $3Dmol.Vector3(n.x+r,n.y,n.z)),s.push(new $3Dmol.Vector3(n.x-r,n.y,n.z)),s.push(new $3Dmol.Vector3(n.x,n.y+r,n.z)),s.push(new $3Dmol.Vector3(n.x,n.y-r,n.z)),s.push(new $3Dmol.Vector3(n.x,n.y,n.z+r)),s.push(new $3Dmol.Vector3(n.x,n.y,n.z-r))):s.push(n)}}),o=$3Dmol.getExtent(s),r=s,i=o):(r=wt({}),i=$3Dmol.getExtent(r));var u=new $3Dmol.Vector3(o[2][0],o[2][1],o[2][2]),a=i[1][0]-i[0][0],f=i[1][1]-i[0][1],l=i[1][2]-i[0][2],c=Math.sqrt(a*a+f*f+l*l);c<5&&(c=5),R=-c/1.9,U=c/2,a=o[1][0]-o[0][0],f=o[1][1]-o[0][1],l=o[1][2]-o[0][2],c=Math.sqrt(a*a+f*f+l*l),c<5&&(c=5);var h=25;for(var p=0;p<s.length;p++)if(s[p]){var d=u.distanceToSquared(s[p]);d>h&&(h=d)}var c=Math.sqrt(h)*2,m=u.clone().multiplyScalar(-1);return t>0?xt(t,n,m,F.position.z,F.quaternion,D):(I.position=m,rt()),this},this.zoomTo=function(e,t,n){t=t!==undefined?t:0;var r,i;e=e||{};var s=wt(e),o=$3Dmol.getExtent(s);$.isEmptyObject(e)?($.each(v,function(e,t){if(t&&t.boundingSphere&&t.boundingSphere.center){var n=t.boundingSphere.center,r=t.boundingSphere.radius;r>0?(s.push(new $3Dmol.Vector3(n.x+r,n.y,n.z)),s.push(new $3Dmol.Vector3(n.x-r,n.y,n.z)),s.push(new $3Dmol.Vector3(n.x,n.y+r,n.z)),s.push(new $3Dmol.Vector3(n.x,n.y-r,n.z)),s.push(new $3Dmol.Vector3(n.x,n.y,n.z+r)),s.push(new $3Dmol.Vector3(n.x,n.y,n.z-r))):s.push(n)}}),o=$3Dmol.getExtent(s),r=s,i=o):(r=wt({}),i=$3Dmol.getExtent(r));var u=new $3Dmol.Vector3(o[2][0],o[2][1],o[2][2]),a=i[1][0]-i[0][0],f=i[1][1]-i[0][1],l=i[1][2]-i[0][2],c=Math.sqrt(a*a+f*f+l*l);c<5&&(c=5),R=-c/1.9,U=c/2,a=o[1][0]-o[0][0],f=o[1][1]-o[0][1],l=o[1][2]-o[0][2],c=Math.sqrt(a*a+f*f+l*l),c<5&&(c=5);var h=25;for(var p=0;p<s.length;p++)if(s[p]){var d=u.distanceToSquared(s[p]);d>h&&(h=d)}var c=Math.sqrt(h)*2,m=u.clone().multiplyScalar(-1),g=-(c*.5/Math.tan(Math.PI/180*_.fov/2)-L);return t>0?xt(t,n,m,g,F.quaternion,D):(I.position=m,F.position.z=g,rt()),this},this.setSlab=function(e,t){R=e,U=t},this.getSlab=function(e){return{near:R,far:U}},this.addLabel=function(e,t,n){t=t||{};if(n){var r=$3Dmol.getExtent(wt(n));t.position={x:r[2][0],y:r[2][1],z:r[2][2]}}var i=new $3Dmol.Label(e,t);return i.setContext(),I.add(i.sprite),t.fixed&&g.push(m.length),m.push(i),rt(),i},this.addResLabels=function(e,t){return Ct("addResLabels",e,this,t),this},this.removeLabel=function(e){for(var t=0;t<m.length;t++)if(m[t]==e){m.splice(t,1),e.dispose(),I.remove(e.sprite);break}return this},this.removeAllLabels=function(){for(var e=0;e<m.length;e++)I.remove(m[e].sprite);return m.splice(0,m.length),this},this.setLabelStyle=function(e,t){return I.remove(e.sprite),e.dispose(),e.stylespec=t,e.setContext(),I.add(e.sprite),rt(),e},this.setLabelText=function(e,t){return I.remove(e.sprite),e.dispose(),e.text=t,e.setContext(),I.add(e.sprite),rt(),e};var Tt=function(e){};this.addShape=function(e){e=e||{};var t=new $3Dmol.GLShape(e);return t.shapePosition=v.length,v.push(t),t},this.removeShape=function(e){if(!e)return this;e.removegl(I),delete v[e.shapePosition];while(v.length>0&&typeof v[v.length-1]=="undefined")v.pop();return this},this.removeAllShapes=function(){for(var e=0;e<v.length;e++){var t=v[e];t&&t.removegl(I)}return v.splice(0,v.length),this},this.addSphere=function(e){e=e||{};var t=new $3Dmol.GLShape(e);return t.shapePosition=v.length,t.addSphere(e),v.push(t),t},this.addEllipsoid=function(e){e=e||{};var t=new $3Dmol.GLShape(e);return t.shapePosition=v.length,t.addEllipsoid(e),v.push(t),t},this.addArrow=function(e){e=e||{};var t=new $3Dmol.GLShape(e);return t.shapePosition=v.length,t.addArrow(e),v.push(t),t},this.addCylinder=function(e){e=e||{};var t=new $3Dmol.GLShape(e);return t.shapePosition=v.length,e.dashed?t.addDashedCylinder(e):t.addCylinder(e),v.push(t),t},this.addLine=function(e){e=e||{},e.wireframe=!0;var t=new $3Dmol.GLShape(e);return t.shapePosition=v.length,e.dashed?t=Nt(e,t):t.addLine(e),v.push(t),t},this.addUnitCell=function(e){var t=new $3Dmol.GLShape({wireframe:!0});t.shapePosition=v.length;var n=e.getCrystData();if(n){if(n.matrix)var r=n.matrix;else{var i=n.a,s=n.b,o=n.c,u=n.alpha,a=n.beta,f=n.gamma;u=u*Math.PI/180,a=a*Math.PI/180,f=f*Math.PI/180;var l,c,h;l=Math.cos(a),c=(Math.cos(u)-Math.cos(a)*Math.cos(f))/Math.sin(f),h=Math.sqrt(Math.max(0,1-l*l-c*c));var r=new $3Dmol.Matrix4(i,s*Math.cos(f),o*l,0,0,s*Math.sin(f),o*c,0,0,0,o*h,0,0,0,0,1)}var p=[new $3Dmol.Vector3(0,0,0),new $3Dmol.Vector3(1,0,0),new $3Dmol.Vector3(0,1,0),new $3Dmol.Vector3(0,0,1),new $3Dmol.Vector3(1,1,0),new $3Dmol.Vector3(0,1,1),new $3Dmol.Vector3(1,0,1),new $3Dmol.Vector3(1,1,1)];for(var d=0;d<p.length;d++)p[d]=p[d].applyMatrix4(r);t.addLine({start:p[0],end:p[1]}),t.addLine({start:p[0],end:p[2]}),t.addLine({start:p[1],end:p[4]}),t.addLine({start:p[2],end:p[4]}),t.addLine({start:p[0],end:p[3]}),t.addLine({start:p[3],end:p[5]}),t.addLine({start:p[2],end:p[5]}),t.addLine({start:p[1],end:p[6]}),t.addLine({start:p[4],end:p[7]}),t.addLine({start:p[6],end:p[7]}),t.addLine({start:p[3],end:p[6]}),t.addLine({start:p[5],end:p[7]})}return v.push(t),t},this.addCustom=function(e){e=e||{};var t=new $3Dmol.GLShape(e);return t.shapePosition=v.length,t.addCustom(e),v.push(t),t},this.addVolumetricData=function(e,t,n){n=n||{};var r=new $3Dmol.GLShape(n);return r.shapePosition=v.length,r.addVolumetricData(e,t,n),v.push(r),r},this.addIsosurface=function(e,t,n){t=t||{};var r=new $3Dmol.GLShape(t);return r.shapePosition=v.length,r.addIsosurface(e,t,n),v.push(r),r},this.enableFog=function(e){e?j.fog=new $3Dmol.Fog(u,100,200):(r.disableFog=!0,rt())},this.setFrame=function(e){for(var t=0;t<p.length;t++)p[t].setFrame(e);return this},this.getFrames=function(){var e=0,t=0;for(var n=0;n<p.length;n++)p[n].getFrames().length>e&&(t=n,e=p[n].getFrames().length);return e},this.animate=function(e){X=!0;var t=100,n="forward",r=0;e=e||{},e.interval&&(t=e.interval),e.loop&&(n=e.loop),e.reps&&(r=e.reps);var i=this.getFrames(),s=this,o=0,u=1,a=0,f=i*r,l=function(e){e=="forward"?(s.setFrame(o),o=(o+u)%i):e=="backward"?(s.setFrame(i-1-o),o=(o+u)%i):(s.setFrame(o),o+=u,u*=o%(i-1)==0?-1:1),s.render(),(++a==f||!s.isAnimated())&&clearInterval(c)},c=setInterval(function(){l(n)},t);return this},this.stopAnimate=function(){return X=!1,this},this.isAnimated=function(){return X},this.addModel=function(e,t,n){var r=new $3Dmol.GLModel(p.length,s);return r.addMolData(e,t,n),p.push(r),r},this.addModels=function(e,t,n){n=n||{},n.multimodel=!0,n.frames=!0;var r=$3Dmol.GLModel.parseMolData(e,t,n);for(var i=0;i<r.length;i++){var o=new $3Dmol.GLModel(p.length,s);o.setAtomDefaults(r[i]),o.addFrame(r[i]),o.setFrame(0),r.modelData&&o.setModelData(r.modelData[i]),o.setDontDuplicateAtoms(!n.duplicateAssemblyAtoms),p.push(o)}return p},this.addModelsAsFrames=function(e,t,n){n=n||{},n.multimodel=!0,n.frames=!0;var r=new $3Dmol.GLModel(p.length,s);return r.addMolData(e,t,n),p.push(r),r},this.addAsOneMolecule=function(e,t,n){n=n||{},n.multimodel=!0,n.onemol=!0;var r=new $3Dmol.GLModel(p.length,s);return r.addMolData(e,t,n),p.push(r),r},this.removeModel=function(e){if(!e)return;e.removegl(I),delete p[e.getID()];while(p.length>0&&typeof p[p.length-1]=="undefined")p.pop();return this},this.removeAllModels=function(){for(var e=0;e<p.length;e++){var t=p[e];t.removegl(I)}return p.splice(0,p.length),this},this.exportJSON=function(e,t){var n={};return t===undefined?n.m=p.map(function(t){return t.toCDObject(e)}):n.m=[model[t].toCDObject()],JSON.stringify(n)},this.createModelFrom=function(e,t){var n=new $3Dmol.GLModel(p.length,s);for(var r=0;r<p.length;r++)if(p[r]){var i=p[r].selectedAtoms(e);n.addAtoms(i),t&&p[r].removeAtoms(i)}return p.push(n),n},this.setStyle=function(e,t){return typeof t=="undefined"&&(t=e,e={}),Ct("setStyle",e,t,!1),this},this.addStyle=function(e,t){return typeof t=="undefined"&&(t=e,e={}),Ct("setStyle",e,t,!0),this},this.setClickable=function(e,t,n){return Ct("setClickable",e,t,n),this},this.setHoverable=function(e,t,n,r){return Ct("setHoverable",e,t,n,r),this},this.vibrate=function(e,t){return Ct("vibrate",e,t),this},this.setColorByProperty=function(e,t,n,r){return Ct("setColorByProperty",e,t,n,r),this},this.setColorByElement=function(e,t){return Ct("setColorByElement",e,t),this};var kt=function(e,t){var n=[];for(var r=0;r<e.length;r++){var i=e[r];if(typeof i=="undefined")continue;if(i.x<t[0][0]||i.x>t[1][0])continue;if(i.y<t[0][1]||i.y>t[1][1])continue;if(i.z<t[0][2]||i.z>t[1][2])continue;n.push(i)}return n},Lt=function(e){var t=e[1][0]-e[0][0],n=e[1][1]-e[0][1],r=e[1][2]-e[0][2];return t*n*r},At=function(e,n,r){var i=[],s={};for(var o=0,u=n.length;o<u;o++)s[n[o].index]=o;var a=function(e){var t=[];for(var n=0,r=e.length;n<r;n++)e[n].index in s&&t.push(s[e[n].index]);return t},f=function(e){var t=[];return t[0]=[e[0][0],e[0][1],e[0][2]],t[1]=[e[1][0],e[1][1],e[1][2]],t},l=function(e){if(Lt(e)<t)return[e];var n=e[1][0]-e[0][0],r=e[1][1]-e[0][1],i=e[1][2]-e[0][2],s;n>r&&n>i?s=0:r>n&&r>i?s=1:s=2;var o=f(e),u=f(e),a=(e[1][s]-e[0][s])/2+e[0][s];o[1][s]=a,u[0][s]=a;var c=l(o),h=l(u);return c.concat(h)},c=l(e),h=6;for(var o=0,u=c.length;o<u;o++){var p=f(c[o]);p[0][0]-=h,p[0][1]-=h,p[0][2]-=h,p[1][0]+=h,p[1][1]+=h,p[1][2]+=h;var d=kt(n,p),v=kt(r,c[o]);i.push({extent:c[o],atoms:a(d),toshow:a(v)})}return i},Ot=function(e,t,n){var r=new $3Dmol.Geometry(!0),i=r.updateGeoGroup(0),s=[];for(l=0,c=e.length;l<c;l++){var o=e[l];o&&(typeof o.surfaceColor!="undefined"?s[l]=o.surfaceColor:o.color&&(s[l]=$3Dmol.CC.color(o.color)))}var u=i.vertexArray,a=t.vertices,f,l,c;for(l=0,c=a.length;l<c;l++)f=i.vertices*3,u[f]=a[l].x,u[f+1]=a[l].y,u[f+2]=a[l].z,i.vertices++;var h=i.colorArray;if(n.voldata&&n.volscheme){var p=n.volscheme,d=n.voldata,v=p.range()||[-1,1];for(l=0,c=a.length;l<c;l++){var m=d.getVal(a[l].x,a[l].y,a[l].z),g=$3Dmol.CC.color(p.valueToHex(m,v)),f=l*3;h[f]=g.r,h[f+1]=g.g,h[f+2]=g.b}}else if(s.length>0)for(l=0,c=a.length;l<c;l++){var y=a[l].atomid,b=l*3;h[b]=s[y].r,h[b+1]=s[y].g,h[b+2]=s[y].b}var w=t.faces;i.faceidx=w.length,r.initTypedArrays();var E=i.vertexArray,S=i.normalArray,x,T,N,C;for(l=0,c=w.length;l<c;l+=3){var k=w[l],L=w[l+1],A=w[l+2],y=a[k].atomid,O=a[L].atomid,M=a[A].atomid,b=k*3,_=L*3,D=A*3;x=new $3Dmol.Vector3(E[b],E[b+1],E[b+2]),T=new $3Dmol.Vector3(E[_],E[_+1],E[_+2]),N=new $3Dmol.Vector3(E[D],E[D+1],E[D+2]),N.subVectors(N,T),x.subVectors(x,T),N.cross(x),C=N,C.normalize(),S[b]+=C.x,S[_]+=C.x,S[D]+=C.x,S[b+1]+=C.y,S[_+1]+=C.y,S[D+1]+=C.y,S[b+2]+=C.z,S[_+2]+=C.z,S[D+2]+=C.z}i.faceArray=new Uint16Array(w);var P=new $3Dmol.Mesh(r,n);return P.doubleSided=!0,P},Mt=function(e,t,n,r,i,s){var o=new Date,u=new $3Dmol.ProteinSurface;u.initparm(t,e===1?!1:!0,s);var a=new Date;u.fillvoxels(i,n);var f=new Date;u.buildboundary();if(e==$3Dmol.SurfaceType.SES||e==$3Dmol.SurfaceType.MS)u.fastdistancemap(),u.boundingatom(!1),u.fillvoxelswaals(i,n);var l=new Date;u.marchingcube(e);var c=new Date;return u.getFacesAndVertices(r)};this.addMesh=function(e){var t={geo:e.geometry,mat:e.material,done:!0,finished:!1},n=tt();return d[n]=t,n};var Dt=function(e){var t=[];return $.each(e,function(e,n){t[e]=$.extend({},n)}),t},Pt={VDW:$3Dmol.SurfaceType.VDW,MS:$3Dmol.SurfaceType.MS,SAS:$3Dmol.SurfaceType.SAS,SES:$3Dmol.SurfaceType.SES};this.addSurface=function(t,n,r,i,s,o){var u=tt();typeof t=="string"?Pt[t]!==undefined?t=Pt[t]:console.log("Surface type : "+t+" is not recognized"):t===undefined&&console.log("Surface type : "+t+" is not recognized");var a=null,l=null,c=Dt(wt(r));i?a=Dt(wt(i)):a=c;var h=!1,v;for(v=0;v<p.length;v++)if(p[v]){var m=p[v].getSymmetries();if(m.length>1||m.length==1&&!m[0].isIdentity()){h=!0;break}}var g=function(i,a,c){s?l=Dt(wt(s)):l=c;var h,p=new Date,d=$3Dmol.getExtent(c,!0),v,m;if(n.map&&n.map.prop){var g=n.map.prop,b=n.map.scheme||n.map.gradient||new $3Dmol.Gradient.RWB,w=b.range();w||(w=$3Dmol.getPropertyRange(c,g)),n.colorscheme={prop:g,gradient:b}}for(v=0,m=a.length;v<m;v++)h=a[v],h.surfaceColor=$3Dmol.getColorFromStyle(h,n);var E=Lt(d),S=At(d,a,c);if(l&&l.length&&l.length>0){var x=$3Dmol.getExtent(l,!0),T=function(e,t){var n=function(e,t){var n=e.extent,r=n[1][0]-n[0][0],i=n[1][1]-n[0][1],s=n[1][2]-n[0][2],o=r-t[2][0];o*=o;var u=i-t[2][1];u*=u;var a=s-t[2][2];return a*=a,o+u+a},r=n(e,x),i=n(t,x);return r-i};S.sort(T)}var N=[];for(v=0,m=a.length;v<m;v++)h=a[v],N[v]={x:h.x,y:h.y,z:h.z,serial:v,elem:h.elem};var C=!!$3Dmol.syncSurface;if(C){var k=function P(e){if(e>=S.length){o&&typeof o=="function"&&o(u);return}var n=Mt(t,S[e].extent,S[e].atoms,S[e].toshow,N,E),r=$3Dmol.splitMesh({vertexArr:n.vertices,faceArr:n.faces});for(var s=0,l=r.length;s<l;s++){var n={vertices:r[s].vertexArr,faces:r[s].faceArr},c=Ot(a,n,y);$3Dmol.mergeGeos(i.geo,c)}f.render(),setTimeout(P,1,e+1)};setTimeout(k,1,0)}else{var L=[];t<0&&(t=0);for(v=0,m=e;v<m;v++){var A=new Worker($3Dmol.SurfaceWorker);L.push(A),A.postMessage({type:-1,atoms:N,volume:E})}var O=0,M=function(e){var t=$3Dmol.splitMesh({vertexArr:e.data.vertices,faceArr:e.data.faces});for(var n=0,r=t.length;n<r;n++){var s={vertices:t[n].vertexArr,faces:t[n].faceArr},l=Ot(a,s,y);$3Dmol.mergeGeos(i.geo,l)}f.render(),O++,O==S.length&&(i.done=!0,o&&typeof o=="function"&&o(u))},_=function(e){console.log(e.message+" ("+e.filename+":"+e.lineno+")")};for(v=0;v<S.length;v++){var D=L[v%L.length];D.onmessage=M,D.onerror=_,D.postMessage({type:t,expandedExtent:S[v].extent,extendedAtoms:S[v].atoms,atomsToShow:S[v].toshow})}}};n=n||{};var y=_t(n),b=[];if(h){var w={},E={};for(v=0;v<p.length;v++)w[v]=[],E[v]=[];for(v=0;v<a.length;v++)w[a[v].model].push(a[v]);for(v=0;v<c.length;v++)E[c[v].model].push(c[v]);for(v=0;v<p.length;v++)E[v].length>0&&(b.push({geo:new $3Dmol.Geometry(!0),mat:y,done:!1,finished:!1,symmetries:p[v].getSymmetries()}),g(b[v],w[v],E[v]))}else b.push({geo:new $3Dmol.Geometry(!0),mat:y,done:!1,finished:!1,symmetries:[new $3Dmol.Matrix4]}),g(b[b.length-1],a,c);return d[u]=b,u},this.setSurfaceMaterialStyle=function(e,t){if(d[e]){var n=d[e];for(var r=0;r<n.length;r++){var i=n[r].mat=_t(t);n[r].mat.side=$3Dmol.FrontSide;if(t.color){n[r].mat.color=t.color,n[r].geo.colorsNeedUpdate=!0;var s=$3Dmol.CC.color(t.color);n[r].geo.setColors(function(){return s})}else if(i.voldata&&i.volscheme){var o=i.volscheme,u=i.voldata,a=o.range()||[-1,1];n[r].geo.setColors(function(e,t,n){var r=u.getVal(e,t,n),i=$3Dmol.CC.color(o.valueToHex(r,a));return i})}n[r].finished=!1}}return this},this.removeSurface=function(e){var t=d[e];for(var n=0;n<t.length;n++)t[n]&&t[n].lastGL&&(t[n].geo!==undefined&&t[n].geo.dispose(),t[n].mat!==undefined&&t[n].mat.dispose(),I.remove(t[n].lastGL));return delete d[e],rt(),this},this.removeAllSurfaces=function(){for(var e in d){if(!d.hasOwnProperty(e))continue;var t=d[e];for(var n=0;n<t.length;n++)t[n]&&t[n].lastGL&&(t[n].geo!==undefined&&t[n].geo.dispose(),t[n].mat!==undefined&&t[n].mat.dispose(),I.remove(t[n].lastGL));delete d[e]}return rt(),this},this.jmolMoveTo=function(){var e=I.position,t="center { "+ -e.x+" "+ -e.y+" "+ -e.z+" }; ",n=F.quaternion;return t+="moveto .5 quaternion { "+n.x+" "+n.y+" "+n.z+" "+n.w+" };",t},this.clear=function(){return this.removeAllSurfaces(),this.removeAllModels(),this.removeAllLabels(),this.removeAllShapes(),rt(),this},this.mapAtomProperties=function(e,t){t=t||{};var n=wt(t);if(typeof e=="function")for(var r=0,i=n.length;r<i;r++){var s=n[r];e(s)}else for(var r=0,i=n.length;r<i;r++){var s=n[r];for(var o=0,u=e.length;o<u;o++){var a=e[o];if(a.props)for(var f in a.props)a.props.hasOwnProperty(f)&&Et(s,a)&&(s.properties||(s.properties={}),s.properties[f]=a.props[f])}}return this},this.linkViewer=function(e){return O.push(e),this};try{typeof i=="function"&&i(this)}catch(Ht){console.log("error with glviewer callback: "+Ht)}}var e=4,t=64e3;return n}(),$3Dmol.glmolViewer=$3Dmol.GLViewer;var $3Dmol=$3Dmol||{};$3Dmol.Gradient=function(e,t){},$3Dmol.Gradient.valueToHex=function(e,t){},$3Dmol.Gradient.range=function(){},$3Dmol.Gradient.RWB=function(e,t,n){var r=1;typeof t=="undefined"&&$.isArray(e)&&e.length>=2&&(t=e[1],e=e[0]),this.valueToHex=function(i,s){var o,u;i=r*i,s?(o=s[0],u=s[1]):(o=e,u=t);if(i===undefined)return 16777215;u>o?(i<o&&(i=o),i>u&&(i=u)):(i>o&&(i=o),i<u&&(i=u));var a=(u+o)/2;s&&typeof s[2]!="undefined"?a=s[2]:typeof n!="undefined"?a=n:a=(o+u)/2;var f,l;if(o<u)return i<=a?(f=Math.floor(255*Math.sqrt((i-o)/(a-o))),l=16711680+256*f+f,l):(f=Math.floor(255*Math.sqrt(1-(i-a)/(u-a))),l=65536*f+256*f+255,l);if(o>u)return i<=a?(f=Math.floor(255*Math.sqrt(1-(i-a)/(u-a))),l=65536*f+256*f+255,l):(f=Math.floor(255*Math.sqrt((i-o)/(a-o))),l=16711680+256*f+f,l)},this.range=function(){return typeof e!="undefined"&&typeof t!="undefined"?[e,t]:null}},$3Dmol.Gradient.ROYGB=function(e,t){var n=1;typeof t=="undefined"&&$.isArray(e)&&e.length>=2&&(t=e[1],e=e[0]),this.valueToHex=function(r,i){var s,o;r=n*r,i?(s=i[0],o=i[1]):(s=e,o=t);if(typeof r=="undefined")return 16777215;if(o>s)r<s&&(r=s),r>o&&(r=o);else{r>s&&(r=s),r<o&&(r=o),r=s-r;var u=s;s=o,o=u}var a=(s+o)/2,f=(s+a)/2,l=(a+o)/2,c,h;return r<f?(c=Math.floor(255*Math.sqrt((r-s)/(f-s))),h=16711680+256*c+0,h):r<a?(c=Math.floor(255*Math.sqrt(1-(r-f)/(a-f))),h=65536*c+65280+0,h):r<l?(c=Math.floor(255*Math.sqrt((r-a)/(l-a))),h=65280+1*c,h):(c=Math.floor(255*Math.sqrt(1-(r-l)/(o-l))),h=0+256*c+255,h)},this.range=function(){return typeof e!="undefined"&&typeof t!="undefined"?[e,t]:null}},$3Dmol.Gradient.Sinebow=function(e,t){var n=1;typeof t=="undefined"&&$.isArray(e)&&e.length>=2&&(t=e[1],e=e[0]),t<e&&(n=-1,e*=-1,t*=-1),this.valueToHex=function(r,i){var s,o;r=n*r,i?(s=i[0],o=i[1]):(s=e,o=t);if(typeof r=="undefined")return 16777215;o>s?(r<s&&(r=s),r>o&&(r=o)):(r>s&&(r=s),r<o&&(r=o));var u=(r-s)/(o-s),a=5*u/6+.5,f=Math.sin(Math.PI*a);f*=f*255;var l=Math.sin(Math.PI*(a+1/3));l*=l*255;var c=Math.sin(Math.PI*(a+2/3));return c*=c*255,65536*Math.floor(f)+256*Math.floor(c)+1*Math.floor(l)},this.range=function(){return typeof e!="undefined"&&typeof t!="undefined"?[e,t]:null}},$3Dmol.Gradient.builtinGradients={rwb:$3Dmol.Gradient.RWB,roygb:$3Dmol.Gradient.ROYGB,sinebow:$3Dmol.Gradient.Sinebow},$3Dmol.LabelCount=0,$3Dmol.Label=function(e,t){this.id=$3Dmol.LabelCount++,this.stylespec=t||{},this.canvas=document.createElement("canvas"),this.canvas.width=134,this.canvas.height=35,this.context=this.canvas.getContext("2d"),this.sprite=new $3Dmol.Sprite,this.text=e},$3Dmol.Label.prototype={constructor:$3Dmol.Label,getStyle:function(){return this.stylespec},setContext:function(){var e=function(e,t,n,r,i,s,o){e.beginPath(),e.moveTo(t+s,n),e.lineTo(t+r-s,n),e.quadraticCurveTo(t+r,n,t+r,n+s),e.lineTo(t+r,n+i-s),e.quadraticCurveTo(t+r,n+i,t+r-s,n+i),e.lineTo(t+s,n+i),e.quadraticCurveTo(t,n+i,t,n+i-s),e.lineTo(t,n+s),e.quadraticCurveTo(t,n,t+s,n),e.closePath(),e.fill(),o&&e.stroke()},t=function(e,t,n){var r=n;return typeof e!="undefined"&&(e instanceof $3Dmol.Color?r=e.scaled():r=$3Dmol.CC.color(e).scaled()),typeof t!="undefined"&&(r.a=parseFloat(t)),r};return function(){var n=this.stylespec,r=typeof n.useScreen=="undefined"?!1:n.useScreen,i=n.showBackground;if(i==="0"||i==="false")i=!1;typeof i=="undefined"&&(i=!0);var s=n.font?n.font:"sans-serif",o=parseInt(n.fontSize)?parseInt(n.fontSize):18,u=t(n.fontColor,n.fontOpacity,{r:255,g:255,b:255,a:1}),a=n.padding?n.padding:4,f=n.borderThickness?n.borderThickness:0,l=t(n.backgroundColor,n.backgroundOpacity,{r:0,g:0,b:0,a:1}),c=t(n.borderColor,n.borderOpacity,l),h=n.position?n.position:{x:-10,y:1,z:1},p=n.inFront!==undefined?n.inFront:!0;if(p==="false"||p==="0")p=!1;var d=n.alignment||$3Dmol.SpriteAlignment.topLeft;typeof d=="string"&&d in $3Dmol.SpriteAlignment&&(d=$3Dmol.SpriteAlignment[d]);var v="";n.bold&&(v="bold "),this.context.font=v+o+"px  "+s;var m=this.context.measureText(this.text),g=m.width;i||(f=0);var y=g+2.5*f+2*a,b=o*1.25+2*f+2*a;if(n.backgroundImage){var w=n.backgroundImage,E=n.backgroundWidth?n.backgroundWidth:w.width,S=n.backgroundHeight?n.backgroundHeight:w.height;E>y&&(y=E),S>b&&(b=S)}this.canvas.width=y,this.canvas.height=b,this.context.clearRect(0,0,this.canvas.width,this.canvas.height);var v="";n.bold&&(v="bold "),this.context.font=v+o+"px  "+s,this.context.fillStyle="rgba("+l.r+","+l.g+","+l.b+","+l.a+")",this.context.strokeStyle="rgba("+c.r+","+c.g+","+c.b+","+c.a+")",this.context.lineWidth=f,i&&e(this.context,f,f,y-2*f,b-2*f,6,f>0);if(n.backgroundImage){var w=n.backgroundImage,E=n.backgroundWidth?n.backgroundWidth:w.width,S=n.backgroundHeight?n.backgroundHeight:w.height;this.context.drawImage(w,0,0,E,S)}this.context.fillStyle="rgba("+u.r+","+u.g+","+u.b+","+u.a+")",this.context.fillText(this.text,f+a,o+f+a,g);var x=new $3Dmol.Texture(this.canvas);x.needsUpdate=!0,this.sprite.material=new $3Dmol.SpriteMaterial({map:x,useScreenCoordinates:r,alignment:d,depthTest:!p}),this.sprite.scale.set(1,1,1),this.sprite.position.set(h.x,h.y,h.z)}}(),dispose:function(){this.sprite.material.map!==undefined&&this.sprite.material.map.dispose(),this.sprite.material!==undefined&&this.sprite.material.dispose()}},$3Dmol=$3Dmol||{},$3Dmol.MarchingCubeInitializer=function(){var e=2,t={};t.march=function(t,o,u,a){var f=!!a.fulltable,l=a.hasOwnProperty("origin")&&a.origin.hasOwnProperty("x")?a.origin:{x:0,y:0,z:0},c=!!a.voxel,h=a.matrix,p=a.nX||0,d=a.nY||0,v=a.nZ||0,m=a.scale||1,g=null;a.unitCube?g=a.unitCube:g={x:m,y:m,z:m};var y=new Int32Array(p*d*v),b,w;for(b=0,w=y.length;b<w;++b)y[b]=-1;var E=function(e,t,n,r,i,s){var u={x:0,y:0,z:0},a=!!(r&1<<i),f=!!(r&1<<s),p=i;!a&&f&&(p=s),p&1&&n++,p&2&&t++,p&4&&e++,h?(u=new $3Dmol.Vector3(e,t,n),u=u.applyMatrix4(h),u={x:u.x,y:u.y,z:u.z}):(u.x=l.x+g.x*e,u.y=l.y+g.y*t,u.z=l.z+g.z*n);var m=(d*e+t)*v+n;return c?(o.push(u),o.length-1):(y[m]<0&&(y[m]=o.length,o.push(u)),y[m])},S=new Int32Array(12),x=f?i:n,T=f?s:r;for(b=0;b<p-1;++b)for(var N=0;N<d-1;++N)for(var C=0;C<v-1;++C){var k=0;for(var L=0;L<8;++L){var A=(d*(b+((L&4)>>2))+N+((L&2)>>1))*v+C+(L&1),O=!!(t[A]&e);k|=O<<L}if(k===0||k===255)continue;var M=x[k];if(M===0)continue;var _=T[k];M&1&&(S[0]=E(b,N,C,k,0,1)),M&2&&(S[1]=E(b,N,C,k,1,3)),M&4&&(S[2]=E(b,N,C,k,3,2)),M&8&&(S[3]=E(b,N,C,k,2,0)),M&16&&(S[4]=E(b,N,C,k,4,5)),M&32&&(S[5]=E(b,N,C,k,5,7)),M&64&&(S[6]=E(b,N,C,k,7,6)),M&128&&(S[7]=E(b,N,C,k,6,4)),M&256&&(S[8]=E(b,N,C,k,0,4)),M&512&&(S[9]=E(b,N,C,k,1,5)),M&1024&&(S[10]=E(b,N,C,k,3,7)),M&2048&&(S[11]=E(b,N,C,k,2,6));for(var D=0;D<_.length;D+=3){var P=S[_[D]],H=S[_[D+1]],B=S[_[D+2]];c&&D>=3&&(o.push(o[P]),P=o.length-1,o.push(o[H]),H=o.length-1,o.push(o[B]),B=o.length-1),u.push(P),u.push(H),u.push(B)}}},t.laplacianSmooth=function(e,t,n){var r=new Array(t.length),i,s,o,u,a,f;for(i=0,s=t.length;i<s;i++)r[i]={x:0,y:0,z:0};var l=new Array(20),c;for(i=0;i<20;i++)l[i]=new Array(t.length);for(i=0,s=t.length;i<s;i++)l[0][i]=0;for(i=0,s=n.length/3;i<s;i++){var h=i*3,p=i*3+1,d=i*3+2;c=!0;for(o=0,u=l[0][n[h]];o<u;o++)if(n[p]==l[o+1][n[h]]){c=!1;break}c&&(l[0][n[h]]++,l[l[0][n[h]]][n[h]]=n[p]),c=!0;for(o=0,u=l[0][n[h]];o<u;o++)if(n[d]==l[o+1][n[h]]){c=!1;break}c&&(l[0][n[h]]++,l[l[0][n[h]]][n[h]]=n[d]),c=!0;for(o=0,u=l[0][n[p]];o<u;o++)if(n[h]==l[o+1][n[p]]){c=!1;break}c&&(l[0][n[p]]++,l[l[0][n[p]]][n[p]]=n[h]),c=!0;for(o=0,u=l[0][n[p]];o<u;o++)if(n[d]==l[o+1][n[p]]){c=!1;break}c&&(l[0][n[p]]++,l[l[0][n[p]]][n[p]]=n[d]),c=!0;for(o=0;o<l[0][n[d]];o++)if(n[h]==l[o+1][n[d]]){c=!1;break}c&&(l[0][n[d]]++,l[l[0][n[d]]][n[d]]=n[h]),c=!0;for(o=0,u=l[0][n[d]];o<u;o++)if(n[p]==l[o+1][n[d]]){c=!1;break}c&&(l[0][n[d]]++,l[l[0][n[d]]][n[d]]=n[p])}var v=1,m=.5,g,y=1,b=.75/(y+3.5);for(a=0;a<e;a++){for(i=0,s=t.length;i<s;i++)if(l[0][i]<3)r[i].x=t[i].x,r[i].y=t[i].y,r[i].z=t[i].z;else if(l[0][i]==3||l[0][i]==4){r[i].x=0,r[i].y=0,r[i].z=0;for(o=0,u=l[0][i];o<u;o++)r[i].x+=t[l[o+1][i]].x,r[i].y+=t[l[o+1][i]].y,r[i].z+=t[l[o+1][i]].z;r[i].x+=m*t[i].x,r[i].y+=m*t[i].y,r[i].z+=m*t[i].z,r[i].x/=m+l[0][i],r[i].y/=m+l[0][i],r[i].z/=m+l[0][i]}else{r[i].x=0,r[i].y=0,r[i].z=0;for(o=0,u=l[0][i];o<u;o++)r[i].x+=t[l[o+1][i]].x,r[i].y+=t[l[o+1][i]].y,r[i].z+=t[l[o+1][i]].z;r[i].x+=v*t[i].x,r[i].y+=v*t[i].y,r[i].z+=v*t[i].z,r[i].x/=v+l[0][i],r[i].y/=v+l[0][i],r[i].z/=v+l[0][i]}for(i=0,s=t.length;i<s;i++)t[i].x=r[i].x,t[i].y=r[i].y,t[i].z=r[i].z}},t.edgeTable=[0,0,0,0,0,0,0,2816,0,0,0,1792,0,3328,3584,3840,0,0,0,138,0,21,0,134,0,0,0,652,0,2067,3865,3600,0,0,0,42,0,0,0,294,0,0,21,28,0,3875,1049,3360,0,168,162,170,0,645,2475,2210,0,687,293,172,4010,3747,3497,3232,0,0,0,0,0,69,0,900,0,0,0,1792,138,131,1608,1920,0,81,0,2074,84,85,84,86,0,81,0,3676,330,1105,1881,1616,0,0,0,42,0,69,0,502,0,0,21,3580,138,2035,1273,1520,2816,104,2337,106,840,581,367,102,2816,3695,3429,3180,1898,1635,1385,1120,0,0,0,0,0,0,0,3910,0,0,69,588,42,2083,41,2880,0,0,0,1722,0,2293,4095,3830,0,255,757,764,2538,2291,3065,2800,0,0,81,338,0,3925,1119,3414,84,855,85,340,2130,2899,89,2384,1792,712,194,1162,4036,3781,3535,3270,708,719,197,204,3018,2755,2505,2240,0,0,0,0,168,420,168,1958,162,162,676,2988,170,163,680,928,3328,3096,3328,3642,52,53,1855,1590,2340,2111,2869,2620,298,51,825,560,3584,3584,3090,3482,1668,1941,1183,1430,146,2975,2069,2460,154,915,153,400,3840,3592,3329,3082,1796,1541,1295,1030,2818,2575,2309,2060,778,515,265,0];var n=new Uint32Array(t.edgeTable),r=t.triTable=[[],[],[],[],[],[],[],[11,9,8],[],[],[],[8,10,9],[],[10,8,11],[9,11,10],[8,10,9,8,11,10],[],[],[],[1,7,3],[],[4,2,0],[],[2,1,7],[],[],[],[2,7,3,2,9,7],[],[1,4,11,1,0,4],[3,8,0,11,9,4,11,10,9],[4,11,9,11,10,9],[],[],[],[5,3,1],[],[],[],[2,5,8,2,1,5],[],[],[2,4,0],[3,2,4],[],[0,9,1,8,10,5,8,11,10],[3,4,0,3,10,4],[5,8,10,8,11,10],[],[3,5,7],[7,1,5],[1,7,3,1,5,7],[],[9,2,0,9,7,2],[0,3,8,1,7,11,1,5,7],[11,1,7,1,5,7],[],[9,1,0,5,3,2,5,7,3],[8,2,5,8,0,2],[2,5,3,5,7,3],[3,9,1,3,8,9,7,11,10,7,10,5],[9,1,0,10,7,11,10,5,7],[3,8,0,7,10,5,7,11,10],[11,5,7,11,10,5],[],[],[],[],[],[0,6,2],[],[7,2,9,7,9,8],[],[],[],[8,10,9],[7,1,3],[7,1,0],[6,9,3,6,10,9],[7,10,8,10,9,8],[],[6,0,4],[],[11,1,4,11,3,1],[2,4,6],[2,0,4,2,4,6],[2,4,6],[1,4,2,4,6,2],[],[6,0,4],[],[2,11,3,6,9,4,6,10,9],[8,6,1,8,1,3],[10,0,6,0,4,6],[8,0,3,9,6,10,9,4,6],[10,4,6,10,9,4],[],[],[],[5,3,1],[],[0,6,2],[],[7,4,8,5,2,1,5,6,2],[],[],[2,4,0],[7,4,8,2,11,3,10,5,6],[7,1,3],[5,6,10,0,9,1,8,7,4],[5,6,10,7,0,3,7,4,0],[10,5,6,4,8,7],[9,11,8],[3,5,6],[0,5,11,0,11,8],[6,3,5,3,1,5],[3,9,6,3,8,9],[9,6,0,6,2,0],[0,3,8,2,5,6,2,1,5],[1,6,2,1,5,6],[9,11,8],[1,0,9,6,10,5,11,3,2],[6,10,5,2,8,0,2,11,8],[3,2,11,10,5,6],[10,5,6,9,3,8,9,1,3],[0,9,1,5,6,10],[8,0,3,10,5,6],[10,5,6],[],[],[],[],[],[],[],[1,10,2,9,11,6,9,8,11],[],[],[6,0,2],[3,6,9,3,2,6],[3,5,1],[0,5,1,0,11,5],[0,3,5],[6,9,11,9,8,11],[],[],[],[4,5,9,7,1,10,7,3,1],[],[11,6,7,2,4,5,2,0,4],[11,6,7,8,0,3,1,10,2,9,4,5],[6,7,11,1,10,2,9,4,5],[],[4,1,0,4,5,1,6,7,3,6,3,2],[9,4,5,0,6,7,0,2,6],[4,5,9,6,3,2,6,7,3],[6,7,11,5,3,8,5,1,3],[6,7,11,4,1,0,4,5,1],[4,5,9,3,8,0,11,6,7],[9,4,5,7,11,6],[],[],[0,6,4],[8,6,4,8,1,6],[],[0,10,2,0,9,10,4,8,11,4,11,6],[10,2,1,6,0,3,6,4,0],[10,2,1,11,4,8,11,6,4],[4,2,6],[1,0,9,2,4,8,2,6,4],[2,4,0,2,6,4],[8,2,4,2,6,4],[11,4,1,11,6,4],[0,9,1,4,11,6,4,8,11],[3,6,0,6,4,0],[8,6,4,8,11,6],[10,8,9],[6,3,9,6,7,3],[6,7,1],[10,7,1,7,3,1],[7,11,6,8,10,2,8,9,10],[11,6,7,10,0,9,10,2,0],[2,1,10,7,11,6,8,0,3],[1,10,2,6,7,11],[7,2,6,7,9,2],[1,0,9,3,6,7,3,2,6],[7,0,6,0,2,6],[2,7,3,2,6,7],[7,11,6,3,9,1,3,8,9],[9,1,0,11,6,7],[0,3,8,11,6,7],[11,6,7],[],[],[],[],[5,3,7],[8,5,2,8,7,5],[5,3,7],[1,10,2,5,8,7,5,9,8],[1,7,5],[1,7,5],[9,2,7,9,7,5],[11,3,2,8,5,9,8,7,5],[1,3,7,1,7,5],[0,7,1,7,5,1],[9,3,5,3,7,5],[9,7,5,9,8,7],[8,10,11],[3,4,10,3,10,11],[8,10,11],[5,9,4,1,11,3,1,10,11],[2,4,5],[5,2,4,2,0,4],[0,3,8,5,9,4,10,2,1],[2,1,10,9,4,5],[2,8,5,2,11,8],[3,2,11,1,4,5,1,0,4],[9,4,5,8,2,11,8,0,2],[11,3,2,9,4,5],[8,5,3,5,1,3],[5,0,4,5,1,0],[3,8,0,4,5,9],[9,4,5],[11,9,10],[11,9,10],[1,11,4,1,10,11],[8,7,4,11,1,10,11,3,1],[2,7,9,2,9,10],[4,8,7,0,10,2,0,9,10],[2,1,10,0,7,4,0,3,7],[10,2,1,8,7,4],[1,7,4],[3,2,11,4,8,7,9,1,0],[11,4,2,4,0,2],[2,11,3,7,4,8],[4,1,7,1,3,7],[1,0,9,8,7,4],[3,4,0,3,7,4],[8,7,4],[8,9,10,8,10,11],[3,9,11,9,10,11],[0,10,8,10,11,8],[10,3,1,10,11,3],[2,8,10,8,9,10],[9,2,0,9,10,2],[8,0,3,1,10,2],[10,2,1],[1,11,9,11,8,9],[11,3,2,0,9,1],[11,0,2,11,8,0],[11,3,2],[8,1,3,8,9,1],[9,1,0],[8,0,3],[]],i=[0,265,515,778,2060,2309,2575,2822,1030,1295,1541,1804,3082,3331,3593,3840,400,153,915,666,2460,2197,2975,2710,1430,1183,1941,1692,3482,3219,3993,3728,560,825,51,314,2620,2869,2111,2358,1590,1855,1077,1340,3642,3891,3129,3376,928,681,419,170,2988,2725,2479,2214,1958,1711,1445,1196,4010,3747,3497,3232,2240,2505,2755,3018,204,453,719,966,3270,3535,3781,4044,1226,1475,1737,1984,2384,2137,2899,2650,348,85,863,598,3414,3167,3925,3676,1370,1107,1881,1616,2800,3065,2291,2554,764,1013,255,502,3830,4095,3317,3580,1786,2035,1273,1520,2912,2665,2403,2154,876,613,367,102,3942,3695,3429,3180,1898,1635,1385,1120,1120,1385,1635,1898,3180,3429,3695,3942,102,367,613,876,2154,2403,2665,2912,1520,1273,2035,1786,3580,3317,4095,3830,502,255,1013,764,2554,2291,3065,2800,1616,1881,1107,1370,3676,3925,3167,3414,598,863,85,348,2650,2899,2137,2384,1984,1737,1475,1226,4044,3781,3535,3270,966,719,453,204,3018,2755,2505,2240,3232,3497,3747,4010,1196,1445,1711,1958,2214,2479,2725,2988,170,419,681,928,3376,3129,3891,3642,1340,1077,1855,1590,2358,2111,2869,2620,314,51,825,560,3728,3993,3219,3482,1692,1941,1183,1430,2710,2975,2197,2460,666,915,153,400,3840,3593,3331,3082,1804,1541,1295,1030,2822,2575,2309,2060,778,515,265,0],s=[[],[8,3,0],[9,0,1],[8,3,1,8,1,9],[11,2,3],[11,2,0,11,0,8],[11,2,3,0,1,9],[2,1,11,1,9,11,11,9,8],[10,1,2],[8,3,0,1,2,10],[9,0,2,9,2,10],[3,2,8,2,10,8,8,10,9],[10,1,3,10,3,11],[1,0,10,0,8,10,10,8,11],[0,3,9,3,11,9,9,11,10],[8,10,9,8,11,10],[8,4,7],[3,0,4,3,4,7],[1,9,0,8,4,7],[9,4,1,4,7,1,1,7,3],[2,3,11,7,8,4],[7,11,4,11,2,4,4,2,0],[3,11,2,4,7,8,9,0,1],[2,7,11,2,1,7,1,4,7,1,9,4],[10,1,2,8,4,7],[2,10,1,0,4,7,0,7,3],[4,7,8,0,2,10,0,10,9],[2,7,3,2,9,7,7,9,4,2,10,9],[8,4,7,11,10,1,11,1,3],[11,4,7,1,4,11,1,11,10,1,0,4],[3,8,0,7,11,4,11,9,4,11,10,9],[7,11,4,4,11,9,11,10,9],[9,5,4],[3,0,8,4,9,5],[5,4,0,5,0,1],[4,8,5,8,3,5,5,3,1],[11,2,3,9,5,4],[9,5,4,8,11,2,8,2,0],[3,11,2,1,5,4,1,4,0],[8,5,4,2,5,8,2,8,11,2,1,5],[2,10,1,9,5,4],[0,8,3,5,4,9,10,1,2],[10,5,2,5,4,2,2,4,0],[3,4,8,3,2,4,2,5,4,2,10,5],[5,4,9,1,3,11,1,11,10],[0,9,1,4,8,5,8,10,5,8,11,10],[3,4,0,3,10,4,4,10,5,3,11,10],[4,8,5,5,8,10,8,11,10],[9,5,7,9,7,8],[0,9,3,9,5,3,3,5,7],[8,0,7,0,1,7,7,1,5],[1,7,3,1,5,7],[11,2,3,8,9,5,8,5,7],[9,2,0,9,7,2,2,7,11,9,5,7],[0,3,8,2,1,11,1,7,11,1,5,7],[2,1,11,11,1,7,1,5,7],[1,2,10,5,7,8,5,8,9],[9,1,0,10,5,2,5,3,2,5,7,3],[5,2,10,8,2,5,8,5,7,8,0,2],[10,5,2,2,5,3,5,7,3],[3,9,1,3,8,9,7,11,10,7,10,5],[9,1,0,10,7,11,10,5,7],[3,8,0,7,10,5,7,11,10],[11,5,7,11,10,5],[11,7,6],[0,8,3,11,7,6],[9,0,1,11,7,6],[7,6,11,3,1,9,3,9,8],[2,3,7,2,7,6],[8,7,0,7,6,0,0,6,2],[1,9,0,3,7,6,3,6,2],[7,6,2,7,2,9,2,1,9,7,9,8],[1,2,10,6,11,7],[2,10,1,7,6,11,8,3,0],[11,7,6,10,9,0,10,0,2],[7,6,11,3,2,8,8,2,10,8,10,9],[6,10,7,10,1,7,7,1,3],[6,10,1,6,1,7,7,1,0,7,0,8],[9,0,3,6,9,3,6,10,9,6,3,7],[6,10,7,7,10,8,10,9,8],[8,4,6,8,6,11],[11,3,6,3,0,6,6,0,4],[0,1,9,4,6,11,4,11,8],[1,9,4,11,1,4,11,3,1,11,4,6],[3,8,2,8,4,2,2,4,6],[2,0,4,2,4,6],[1,9,0,3,8,2,2,8,4,2,4,6],[9,4,1,1,4,2,4,6,2],[10,1,2,11,8,4,11,4,6],[10,1,2,11,3,6,6,3,0,6,0,4],[0,2,10,0,10,9,4,11,8,4,6,11],[2,11,3,6,9,4,6,10,9],[8,4,6,8,6,1,6,10,1,8,1,3],[1,0,10,10,0,6,0,4,6],[8,0,3,9,6,10,9,4,6],[10,4,6,10,9,4],[9,5,4,7,6,11],[4,9,5,3,0,8,11,7,6],[6,11,7,4,0,1,4,1,5],[6,11,7,4,8,5,5,8,3,5,3,1],[4,9,5,6,2,3,6,3,7],[9,5,4,8,7,0,0,7,6,0,6,2],[4,0,1,4,1,5,6,3,7,6,2,3],[7,4,8,5,2,1,5,6,2],[6,11,7,1,2,10,9,5,4
],[11,7,6,8,3,0,1,2,10,9,5,4],[11,7,6,10,5,2,2,5,4,2,4,0],[7,4,8,2,11,3,10,5,6],[4,9,5,6,10,7,7,10,1,7,1,3],[5,6,10,0,9,1,8,7,4],[5,6,10,7,0,3,7,4,0],[10,5,6,4,8,7],[5,6,9,6,11,9,9,11,8],[0,9,5,0,5,3,3,5,6,3,6,11],[0,1,5,0,5,11,5,6,11,0,11,8],[11,3,6,6,3,5,3,1,5],[9,5,6,3,9,6,3,8,9,3,6,2],[5,6,9,9,6,0,6,2,0],[0,3,8,2,5,6,2,1,5],[1,6,2,1,5,6],[1,2,10,5,6,9,9,6,11,9,11,8],[1,0,9,6,10,5,11,3,2],[6,10,5,2,8,0,2,11,8],[3,2,11,10,5,6],[10,5,6,9,3,8,9,1,3],[0,9,1,5,6,10],[8,0,3,10,5,6],[10,5,6],[10,6,5],[8,3,0,10,6,5],[0,1,9,5,10,6],[10,6,5,9,8,3,9,3,1],[3,11,2,10,6,5],[6,5,10,2,0,8,2,8,11],[1,9,0,6,5,10,11,2,3],[1,10,2,5,9,6,9,11,6,9,8,11],[1,2,6,1,6,5],[0,8,3,2,6,5,2,5,1],[5,9,6,9,0,6,6,0,2],[9,6,5,3,6,9,3,9,8,3,2,6],[11,6,3,6,5,3,3,5,1],[0,5,1,0,11,5,5,11,6,0,8,11],[0,5,9,0,3,5,3,6,5,3,11,6],[5,9,6,6,9,11,9,8,11],[10,6,5,4,7,8],[5,10,6,7,3,0,7,0,4],[5,10,6,0,1,9,8,4,7],[4,5,9,6,7,10,7,1,10,7,3,1],[7,8,4,2,3,11,10,6,5],[11,6,7,10,2,5,2,4,5,2,0,4],[11,6,7,8,0,3,1,10,2,9,4,5],[6,7,11,1,10,2,9,4,5],[7,8,4,5,1,2,5,2,6],[4,1,0,4,5,1,6,7,3,6,3,2],[9,4,5,8,0,7,0,6,7,0,2,6],[4,5,9,6,3,2,6,7,3],[6,7,11,4,5,8,5,3,8,5,1,3],[6,7,11,4,1,0,4,5,1],[4,5,9,3,8,0,11,6,7],[9,4,5,7,11,6],[10,6,4,10,4,9],[8,3,0,9,10,6,9,6,4],[1,10,0,10,6,0,0,6,4],[8,6,4,8,1,6,6,1,10,8,3,1],[2,3,11,6,4,9,6,9,10],[0,10,2,0,9,10,4,8,11,4,11,6],[10,2,1,11,6,3,6,0,3,6,4,0],[10,2,1,11,4,8,11,6,4],[9,1,4,1,2,4,4,2,6],[1,0,9,3,2,8,2,4,8,2,6,4],[2,4,0,2,6,4],[3,2,8,8,2,4,2,6,4],[1,4,9,11,4,1,11,1,3,11,6,4],[0,9,1,4,11,6,4,8,11],[11,6,3,3,6,0,6,4,0],[8,6,4,8,11,6],[6,7,10,7,8,10,10,8,9],[9,3,0,6,3,9,6,9,10,6,7,3],[6,1,10,6,7,1,7,0,1,7,8,0],[6,7,10,10,7,1,7,3,1],[7,11,6,3,8,2,8,10,2,8,9,10],[11,6,7,10,0,9,10,2,0],[2,1,10,7,11,6,8,0,3],[1,10,2,6,7,11],[7,2,6,7,9,2,2,9,1,7,8,9],[1,0,9,3,6,7,3,2,6],[8,0,7,7,0,6,0,2,6],[2,7,3,2,6,7],[7,11,6,3,9,1,3,8,9],[9,1,0,11,6,7],[0,3,8,11,6,7],[11,6,7],[11,7,5,11,5,10],[3,0,8,7,5,10,7,10,11],[9,0,1,10,11,7,10,7,5],[3,1,9,3,9,8,7,10,11,7,5,10],[10,2,5,2,3,5,5,3,7],[5,10,2,8,5,2,8,7,5,8,2,0],[9,0,1,10,2,5,5,2,3,5,3,7],[1,10,2,5,8,7,5,9,8],[2,11,1,11,7,1,1,7,5],[0,8,3,2,11,1,1,11,7,1,7,5],[9,0,2,9,2,7,2,11,7,9,7,5],[11,3,2,8,5,9,8,7,5],[1,3,7,1,7,5],[8,7,0,0,7,1,7,5,1],[0,3,9,9,3,5,3,7,5],[9,7,5,9,8,7],[4,5,8,5,10,8,8,10,11],[3,0,4,3,4,10,4,5,10,3,10,11],[0,1,9,4,5,8,8,5,10,8,10,11],[5,9,4,1,11,3,1,10,11],[3,8,4,3,4,2,2,4,5,2,5,10],[10,2,5,5,2,4,2,0,4],[0,3,8,5,9,4,10,2,1],[2,1,10,9,4,5],[8,4,5,2,8,5,2,11,8,2,5,1],[3,2,11,1,4,5,1,0,4],[9,4,5,8,2,11,8,0,2],[11,3,2,9,4,5],[4,5,8,8,5,3,5,1,3],[5,0,4,5,1,0],[3,8,0,4,5,9],[9,4,5],[7,4,11,4,9,11,11,9,10],[3,0,8,7,4,11,11,4,9,11,9,10],[11,7,4,1,11,4,1,10,11,1,4,0],[8,7,4,11,1,10,11,3,1],[2,3,7,2,7,9,7,4,9,2,9,10],[4,8,7,0,10,2,0,9,10],[2,1,10,0,7,4,0,3,7],[10,2,1,8,7,4],[2,11,7,2,7,1,1,7,4,1,4,9],[3,2,11,4,8,7,9,1,0],[7,4,11,11,4,2,4,0,2],[2,11,3,7,4,8],[9,1,4,4,1,7,1,3,7],[1,0,9,8,7,4],[3,4,0,3,7,4],[8,7,4],[8,9,10,8,10,11],[0,9,3,3,9,11,9,10,11],[1,10,0,0,10,8,10,11,8],[10,3,1,10,11,3],[3,8,2,2,8,10,8,9,10],[9,2,0,9,10,2],[8,0,3,1,10,2],[10,2,1],[2,11,1,1,11,9,11,8,9],[11,3,2,0,9,1],[11,0,2,11,8,0],[11,3,2],[8,1,3,8,9,1],[9,1,0],[8,0,3],[]];return t},$3Dmol.MarchingCube=$3Dmol.MarchingCubeInitializer(),$3Dmol.Parsers=function(){var e={},t=function(e){for(var t=0,n=e.length;t<n;t++)e[t].index||(e[t].index=t);var r={},i=4.95;for(var s=0;s<e.length;s++){var o=e[s],u=Math.floor(o.x/i),a=Math.floor(o.y/i),l=Math.floor(o.z/i);r[u]||(r[u]={}),r[u][a]||(r[u][a]={}),r[u][a][l]||(r[u][a][l]=[]),r[u][a][l].push(o)}var c=function(e,t){for(var n=0;n<e.length;n++){var r=e[n];for(var i=0;i<t.length;i++){var s=t[i];if(f(r,s)){var o=r.bonds.indexOf(s.index),u=s.bonds.indexOf(r.index);o==-1&&u==-1?(r.bonds.push(s.index),r.bondOrder.push(1),s.bonds.push(r.index),s.bondOrder.push(1)):o==-1?(r.bonds.push(s.index),r.bondOrder.push(s.bondOrder[u])):u==-1&&(s.bonds.push(r.index),s.bondOrder.push(r.bondOrder[o]))}}}},h=[{x:0,y:0,z:1},{x:0,y:1,z:-1},{x:0,y:1,z:0},{x:0,y:1,z:1},{x:1,y:-1,z:-1},{x:1,y:-1,z:0},{x:1,y:-1,z:1},{x:1,y:0,z:-1},{x:1,y:0,z:0},{x:1,y:0,z:1},{x:1,y:1,z:-1},{x:1,y:1,z:0},{x:1,y:1,z:1}];for(var u in r){u=parseInt(u);for(var a in r[u]){a=parseInt(a);for(var l in r[u][a]){l=parseInt(l);var p=r[u][a][l];for(var t=0;t<p.length;t++){var d=p[t];for(var v=t+1;v<p.length;v++){var m=p[v];f(d,m)&&d.bonds.indexOf(m.index)==-1&&(d.bonds.push(m.index),d.bondOrder.push(1),m.bonds.push(d.index),m.bondOrder.push(1))}}for(var g=0;g<h.length;g++){var y=h[g];if(!r[u+y.x]||!r[u+y.x][a+y.y]||!r[u+y.x][a+y.y][l+y.z])continue;var b=r[u+y.x][a+y.y][l+y.z];c(p,b)}}}}},n=function(e){var n=[],r=[],i,s;for(i=0,s=e.length;i<s;i++){var o=e[i];o.index=i,o.hetflag?r.push(o):n.push(o)}t(r),n.sort(function(e,t){return e.chain!=t.chain?e.chain<t.chain?-1:1:e.resi-t.resi});var u=-1,a=-1,l;for(i=0,s=n.length;i<s;i++){var c=n[i];c.resi!==u&&(u=c.resi,l||a++,l=!1),c.reschain=a;for(var h=i+1;h<n.length;h++){var p=n[h];if(p.chain!=c.chain)break;if(p.resi-c.resi>1)break;f(c,p)&&(c.bonds.indexOf(p.index)===-1&&(c.bonds.push(p.index),c.bondOrder.push(1),p.bonds.push(c.index),p.bondOrder.push(1)),c.resi!==p.resi&&(l=!0))}}},r=function(e){var t=3.2,n=10.24,r=[],i,s,o;for(i=0,o=e.length;i<o;i++){e[i].index=i;var u=e[i];!u.hetflag&&(u.atom==="N"||u.atom==="O")&&(r.push(u),u.hbondOther=null,u.hbondDistanceSq=Number.POSITIVE_INFINITY)}r.sort(function(e,t){return e.z-t.z});for(i=0,o=r.length;i<o;i++){var a=r[i];for(s=i+1;s<o;s++){var f=r[s],l=f.z-a.z;if(l>t)break;if(f.atom==a.atom)continue;var c=Math.abs(f.y-a.y);if(c>t)continue;var h=Math.abs(f.x-a.x);if(h>t)continue;var p=h*h+c*c+l*l;if(p>n)continue;if(f.chain==a.chain&&Math.abs(f.resi-a.resi)<4)continue;p<a.hbondDistanceSq&&(a.hbondOther=f,a.hbondDistanceSq=p),p<f.hbondDistanceSq&&(f.hbondOther=a,f.hbondDistanceSq=p)}}},s=function(e){r(e);var t={},n,i,s,o,u,a;for(n=0,i=e.length;n<i;n++){u=e[n],typeof t[u.chain]=="undefined"&&(t[u.chain]=[]);if(isFinite(u.hbondDistanceSq)){var f=u.hbondOther;typeof t[f.chain]=="undefined"&&(t[f.chain]=[]),Math.abs(f.resi-u.resi)===4&&(t[u.chain][u.resi]="h")}}for(s in t)for(o=1;o<t[s].length-1;o++){var l=t[s][o-1],c=t[s][o+1];a=t[s][o],l=="h"&&l==c&&a!=l&&(t[s][o]=l)}for(n=0,i=e.length;n<i;n++)u=e[n],isFinite(u.hbondDistanceSq)&&t[u.chain][u.resi]!="h"&&u.ss!="h"&&(t[u.chain][u.resi]="maybesheet");for(n=0,i=e.length;n<i;n++){u=e[n];if(isFinite(u.hbondDistanceSq)&&t[u.chain][u.resi]=="maybesheet"){var f=u.hbondOther,h=t[f.chain][f.resi];if(h=="maybesheet"||h=="s")t[u.chain][u.resi]="s",t[f.chain][f.resi]="s"}}for(s in t){for(o=1;o<t[s].length-1;o++){var l=t[s][o-1],c=t[s][o+1];a=t[s][o],l=="s"&&l==c&&a!=l&&(t[s][o]=l)}for(o=0;o<t[s].length;o++)a=t[s][o],(a=="h"||a=="s")&&t[s][o-1]!=a&&t[s][o+1]!=a&&delete t[s][o]}var p=null;for(n=0,i=e.length;n<i;n++){u=e[n],a=t[u.chain][u.resi];if(typeof a=="undefined"||a=="maybesheet")continue;u.ss=a,t[u.chain][u.resi-1]!=a&&(u.ssbegin=!0),t[u.chain][u.resi+1]!=a&&(u.ssend=!0)}},o=function(e,t){for(var n=0,r=e.length;n<r;n++){var i=e[n];for(var s=0;s<i.bonds.length;s++){var o=i.bonds[s],u=e[o],a=t[i.serial];if(u&&a){var f=u.bonds.indexOf(a);f<0&&(u.bonds.push(a),u.bondOrder.push(i.bondOrder[s]))}}}};e.vasp=e.VASP=function(e,t){var n=[[]],r={},i=e.replace(/^\s+/,"").split(/[\n\r]/);if(i.length<3)return n;if(!i[1].match(/\d+/))return console.log("Warning: second line of the vasp structure file must be a number"),n;r.length=parseFloat(i[1]);if(r.length<0)return console.log("Warning: Vasp implementation for negative lattice lengths is not yet available"),n;r.xVec=new Float32Array(i[2].replace(/^\s+/,"").split(/\s+/)),r.yVec=new Float32Array(i[3].replace(/^\s+/,"").split(/\s+/)),r.zVec=new Float32Array(i[4].replace(/^\s+/,"").split(/\s+/));var s=new $3Dmol.Matrix4(r.xVec[0],r.xVec[1],r.xVec[2],0,r.yVec[0],r.yVec[1],r.yVec[2],0,r.zVec[0],r.zVec[1],r.zVec[2],0,0,0,0,1);s.multiplyScalar(r.length);var o=n.modelData=[{symmetries:[],cryst:{matrix:s}}],u=i[5].replace(/\s+/,"").replace(/\s+$/,"").split(/\s+/),a=new Int16Array(i[6].replace(/^\s+/,"").split(/\s+/)),f=i[7].replace(/\s+/,"");if(f.match(/C/))f="cartesian";else{if(!f.match(/D/))return console.log("Warning: Unknown vasp mode in POSCAR file: mode must be either C(artesian) or D(irect)"),n;f="direct"}if(u.length!=a.length)return console.log("Warning: declaration of atomary species wrong:"),console.log(u),console.log(a),n;i.splice(0,8);var l=0;for(var c=0,h=u.length;c<h;c++){var p=u[c];for(var d=0,v=a[c];d<v;d++){var m=new Float32Array(i[l+d].replace(/^\s+/,"").split(/\s+/));atom={},atom.elem=p,f=="cartesian"?(atom.x=r.length*m[0],atom.y=r.length*m[1],atom.z=r.length*m[2]):(atom.x=r.length*(m[0]*r.xVec[0]+m[1]*r.yVec[0]+m[2]*r.zVec[0]),atom.y=r.length*(m[0]*r.xVec[1]+m[1]*r.yVec[1]+m[2]*r.zVec[1]),atom.z=r.length*(m[0]*r.xVec[2]+m[1]*r.yVec[2]+m[2]*r.zVec[2])),atom.bonds=[],n[0].push(atom)}l+=a[c]}return n},e.cube=e.CUBE=function(e,n){var r=[[]],i=e.replace(/^\s+/,"").split(/\n\r|\r+/);if(i.length<6)return r;var s=i[2].replace(/^\s+/,"").replace(/\s+/g," ").split(" "),o=Math.abs(parseFloat(s[0]));s=i[3].replace(/^\s+/,"").replace(/\s+/g," ").split(" ");var u=parseFloat(s[0])>0?.529177:1;i=i.splice(6,o);var a=r[r.length-1].length,f=a+i.length;for(var l=a;l<f;++l){var c={};c.serial=l;var h=i[l-a],p=h.replace(/^\s+/,"").replace(/\s+/g," ").split(" ");p[0]==6?c.elem="C":p[0]==1?c.elem="H":p[0]==8?c.elem="O":p[0]==17&&(c.elem="Cl"),c.x=parseFloat(p[2])*u,c.y=parseFloat(p[3])*u,c.z=parseFloat(p[4])*u,c.hetflag=!0,c.bonds=[],c.bondOrder=[],c.properties={},r[r.length-1].push(c)}for(var l=0;l<r.length;l++)t(r[l]);return r},e.xyz=e.XYZ=function(e,n){var r=[[]],i=e.split(/\r?\n|\r/);while(i.length>0){if(i.length<3)break;var s=parseInt(i[0]);if(isNaN(s)||s<=0)break;if(i.length<s+2)break;var o=2,u=r[r.length-1].length,a=u+s;for(var f=u;f<a;f++){var l=i[o++],c=l.replace(/^\s+/,"").replace(/\s+/g," ").split(" "),h={};h.serial=f;var p=c[0];h.atom=h.elem=p[0].toUpperCase()+p.substr(1).toLowerCase(),h.x=parseFloat(c[1]),h.y=parseFloat(c[2]),h.z=parseFloat(c[3]),h.hetflag=!0,h.bonds=[],h.bondOrder=[],h.properties={},r[r.length-1][f]=h,c.length>=7&&(h.dx=parseFloat(c[4]),h.dy=parseFloat(c[5]),h.dz=parseFloat(c[6]))}if(!n.multimodel)break;r.push([]),i.splice(0,o)}for(var f=0;f<r.length;f++)t(r[f]);if(n.onemol){var d=r;r=[],r.push(d[0]);for(var f=1;f<d.length;f++){var o=r[0].length;for(var v=0;v<d[f].length;v++){var m=d[f][v];for(var g=0;g<m.bonds.length;g++)m.bonds[g]=m.bonds[g]+o;m.index=r[0].length,m.serial=r[0].length,r[0].push(m)}}}return r},e.sdf=e.SDF=function(e,t){var n=[[]],r=!1;typeof t.keepH!="undefined"&&(r=!t.keepH);var i=e.split(/\r?\n|\r/);while(i.length>0){if(i.length<4)break;var s=parseInt(i[3].substr(0,3));if(isNaN(s)||s<=0)break;var o=parseInt(i[3].substr(3,3)),u=4;if(i.length<4+s+o)break;var a=[],f=n[n.length-1].length,l=f+s,c,h;for(c=f;c<l;c++,u++){h=i[u];var p={},d=h.substr(31,3).replace(/ /g,"");p.atom=p.elem=d[0].toUpperCase()+d.substr(1).toLowerCase();if(p.elem!="H"||!r)p.serial=c,a[c]=n[n.length-1].length,p.x=parseFloat(h.substr(0,10)),p.y=parseFloat(h.substr(10,10)),p.z=parseFloat(h.substr(20,10)),p.hetflag=!0,p.bonds=[],p.bondOrder=[],p.properties={},p.index=n[n.length-1].length,n[n.length-1].push(p)}for(c=0;c<o;c++,u++){h=i[u];var v=a[parseInt(h.substr(0,3))-1+f],m=a[parseInt(h.substr(3,3))-1+f],g=parseInt(h.substr(6,3));typeof v!="undefined"&&typeof m!="undefined"&&(n[n.length-1][v].bonds.push(m),n[n.length-1][v].bondOrder.push(g),n[n.length-1][m].bonds.push(v),n[n.length-1][m].bondOrder.push(g))}if(!t.multimodel)break;t.onemol||n.push([]);while(i[u]!="$$$$")u++;i.splice(0,++u)}return n},e.cdjson=e.json=function(e,t){var n=[[]];typeof e=="string"&&(e=JSON.parse(e));var r=e.m,i=r[0].a,s=r[0].b,o=r[0].s,u=t!==undefined&&t.parseStyle!==undefined?t.parseStyle:o!==undefined,a=n[n.length-1].length;for(var f=0;f<i.length;f++){var l=i[f],c={};c.id=l.i,c.x=l.x,c.y=l.y,c.z=l.z||0,c.bonds=[],c.bondOrder=[];var h=l.l||"C";c.elem=h[0].toUpperCase()+h.substr(1).toLowerCase(),c.serial=n[n.length-1].length,u&&(c.style=o[l.s||0]),n[n.length-1].push(c)}for(var f=0;f<s.length;f++){var p=s[f],d=p.b+a,v=p.e+a,m=p.o||1,g=n[n.length-1][d],y=n[n.length-1][v];g.bonds.push(v),g.bondOrder.push(m),y.bonds.push(d),y.bondOrder.push(m)}return n},e.scif=e.scif=function(e,t){var n=[[]];return n[0]=e,n},e.smmcif=e.smmcif=function(e,n){var r=[[]];r[0]=e;for(var i=0;i<r.length;i++)t(r[i]);return r},e.mcif=e.cif=function(e,n){function a(e,t){var n=[],r=0,i=0;while(i<e.length){while(e.substr(i,t.length)!==t&&i<e.length){if(e[i]==="'"){i++;while(i<e.length&&e[i]!=="'")i++}else if(e[i]==='"'){i++;while(i<e.length&&e[i]!=='"')i++}i++}n.push(e.substr(r,i-r)),r=i+=t.length}return n}var r=[],i=!n.doAssembly,o=!n.duplicateAssemblyAtoms,u=r.modelData=[],f=e.split(/\r?\n|\r/),c=[],h=!1;for(var p=0;p<f.length;p++){var d=f[p].split("#")[0];h?d[0]===";"&&(h=!1):d[0]===";"&&(h=!0);if(h||d!==""){if(!h){d=d.trim();if(d[0]==="_"){var v=d.split(/\s/)[0].indexOf(".");v>-1&&(d[v]="_",d=d.substr(0,v)+"_"+d.substr(v+1))}}c.push(d)}}var p=0;while(p<c.length){while(!c[p].startsWith("data_")||c[p]==="data_global")p++;p++;var m={};while(p<c.length&&!c[p].startsWith("data_"))if(c[p][0]===undefined)p++;else if(c[p][0]==="_"){var g=c[p].split(/\s/)[0].toLowerCase(),y=m[g]=m[g]||[],b=c[p].substr(c[p].indexOf(g)+g.length);if(b===""){p++;if(c[p][0]===";"){var w=c[p].substr(1);p++;while(c[p]!==";")w=w+"\n"+c[p],p++;y.push(w)}else y.push(c[p])}else y.push(b.trim());p++}else if(c[p].substr(0,5)==="loop_"){p++;var E=[];while(c[p]===""||c[p][0]==="_"){if(c[p]!==""){var g=c[p].split(/\s/)[0].toLowerCase(),y=m[g]=m[g]||[];E.push(y)}p++}var S=0;while(p<c.length&&c[p][0]!=="_"&&!c[p].startsWith("loop_")&&!c[p].startsWith("data_")){var d=a(c[p]," ");for(var x=0;x<d.length;x++)d[x]!==""&&(E[S].push(d[x]),S=(S+1)%E.length);p++}}else p++;u.push({symmetries:[]}),r.push([]);var T=0,N=m._atom_site_id!==undefined?m._atom_site_id.length:m._atom_site_label.length;function C(e){return e*e}var k;if(m._cell_length_a!==undefined){var L=parseFloat(m._cell_length_a),A=parseFloat(m._cell_length_b),O=parseFloat(m._cell_length_c),M=parseFloat(m._cell_angle_alpha)||90,_=parseFloat(m._cell_angle_beta)||90,D=parseFloat(m._cell_angle_gamma)||90,P=M*Math.PI/180,H=_*Math.PI/180,B=D*Math.PI/180,j=Math.cos(P),F=Math.cos(H),I=Math.cos(B),q=Math.sin(B);k=[[L,A*I,O*F],[0,A*q,O*(j-F*I)/q],[0,0,O*Math.sqrt(1-C(j)-C(F)-C(I)+2*j*F*I)/q]],u[u.length-1].cryst={a:L,b:A,c:O,alpha:M,beta:_,gamma:D}}function R(e,t,n){var r=k[0][0]*e+k[0][1]*t+k[0][2]*n,i=k[1][0]*e+k[1][1]*t+k[1][2]*n,s=k[2][0]*e+k[2][1]*t+k[2][2]*n;return{x:r,y:i,z:s}}for(var U=0;U<N;U++){if(m._atom_site_group_pdb!==undefined&&m._atom_site_group_pdb[U]==="TER")continue;var z={};if(m._atom_site_cartn_x!==undefined)z.x=parseFloat(m._atom_site_cartn_x[U]),z.y=parseFloat(m._atom_site_cartn_y[U]),z.z=parseFloat(m._atom_site_cartn_z[U]);else{var W=R(parseFloat(m._atom_site_fract_x[U]),parseFloat(m._atom_site_fract_y[U]),parseFloat(m._atom_site_fract_z[U]));z.x=W.x,z.y=W.y,z.z=W.z}z.chain=m._atom_site_auth_asym_id?m._atom_site_auth_asym_id[U]:undefined,z.resi=m._atom_site_auth_seq_id?parseInt(m._atom_site_auth_seq_id[U]):undefined,z.resn=m._atom_site_auth_comp_id?m._atom_site_auth_comp_id[U].trim():undefined,z.atom=m._atom_site_auth_atom_id?m._atom_site_auth_atom_id[U].replace(/"/gm,""):undefined,z.hetflag=!m._atom_site_group_pdb||m._atom_site_group_pdb[U]==="HETA"||m._atom_site_group_pdb[U]==="HETATM";var X=m._atom_site_type_symbol[U];z.elem=X[0].toUpperCase()+X.substr(1).toLowerCase(),z.bonds=[],z.ss="c",z.serial=U,z.bondOrder=[],z.properties={},r[r.length-1].push(z)}if(m._pdbx_struct_oper_list_id!==undefined&&!i){for(var U=0;U<m._pdbx_struct_oper_list_id.length;U++){var V=parseFloat(m["_pdbx_struct_oper_list_matrix[1][1]"][U]),$=parseFloat(m["_pdbx_struct_oper_list_matrix[1][2]"][U]),J=parseFloat(m["_pdbx_struct_oper_list_matrix[1][3]"][U]),K=parseFloat(m["_pdbx_struct_oper_list_vector[1]"][U]),Q=parseFloat(m["_pdbx_struct_oper_list_matrix[2][1]"][U]),G=parseFloat(m["_pdbx_struct_oper_list_matrix[2][2]"][U]),Y=parseFloat(m["_pdbx_struct_oper_list_matrix[2][3]"][U]),Z=parseFloat(m["_pdbx_struct_oper_list_vector[2]"][U]),et=parseFloat(m["_pdbx_struct_oper_list_matrix[3][1]"][U]),tt=parseFloat(m["_pdbx_struct_oper_list_matrix[3][2]"][U]),nt=parseFloat(m["_pdbx_struct_oper_list_matrix[3][3]"][U]),rt=parseFloat(m["_pdbx_struct_oper_list_vector[3]"][U]),it=new $3Dmol.Matrix4(V,$,J,K,Q,G,Y,Z,et,tt,nt,rt);u[u.length-1].symmetries.push(it)}for(var U=0;U<r.length;U++)l(u[u.length-1].symmetries,o,r[U])}function st(e){var t=e.match("-");e=e.replace(/[-xyz]/g,"");var n=e.split("/"),r,i;return n[1]===undefined?i=1:i=parseInt(n[1]),n[0]===""?r=1:r=parseInt(n[0]),r/i*(t?-1:1)}if(m._symmetry_equiv_pos_as_xyz!==undefined)for(var ot=0;ot<m._symmetry_equiv_pos_as_xyz.length;ot++){var ut=m._symmetry_equiv_pos_as_xyz[ot].replace(/["' ]/g,""),at=ut.split(",").map(function(e){return e.replace(/-/g,"+-")}),it=new $3Dmol.Matrix4(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1);for(var ft=0;ft<3;ft++){var lt=at[ft].split("+"),ct=0,ht=0,pt=0,dt=0;for(var vt=0;vt<lt.length;vt++){var mt=lt[vt];if(mt==="")continue;var gt=st(mt);mt.match("x")?it.elements[ft+0]=gt:mt.match("y")?it.elements[ft+4]=gt:mt.match("z")?it.elements[ft+8]=gt:it.elements[ft+12]=gt}}var yt=new $3Dmol.Matrix4(k[0][0],k[0][1],k[0][2],0,k[1][0],k[1][1],k[1][2],0,k[2][0],k[2][1],k[2][2],0),bt=(new $3Dmol.Matrix4).getInverse(yt,!0);it=(new $3Dmol.Matrix4).multiplyMatrices(it,bt),it=(new $3Dmol.Matrix4).multiplyMatrices(yt,it),u[u.length-1].symmetries.push(it)}}for(var U=0;U<r.length;U++)t(r[U]),s(r[U]),l(u[U].symmetries,o,r[U]);return r},e.mol2=e.MOL2=function(e,t){var n=[[]],r=!1;typeof t.keepH!="undefined"&&(r=!t.keepH);var i=e.substr(s,e.length).split(/\r?\n|\r/);while(i.length>0){var s=e.search(/@<TRIPOS>MOLECULE/),o=e.search(/@<TRIPOS>ATOM/);if(s==-1||o==-1)break;var u=[],a=i[2].replace(/^\s+/,"").replace(/\s+/g," ").split(" "),f=parseInt(a[0]),l=0;a.length>1&&(l=parseInt(a[1]));var c=4,h;for(h=3;h<i.length;h++)if(i[h]=="@<TRIPOS>ATOM"){c=h+1;break}var p=n[n.length-1].length,d=p+f,v;for(h=p;h<d;h++){v=i[c++],a=v.replace(/^\s+/,"").replace(/\s+/g," ").split(" ");var m={},g=a[5].split(".")[0];m.atom=m.elem=g[0].toUpperCase()+g.substr(1).toLowerCase();if(m.elem!="H"||!r){var y=n[n.length-1].length,b=parseInt(a[0]);m.serial=b,m.x=parseFloat(a[2]),m.y=parseFloat(a[3]),m.z=parseFloat(a[4]),m.atom=a[5];var w=parseFloat(a[8]);m.index=y,m.bonds=[],m.bondOrder=[],m.properties={charge:w,partialCharge:w},u[b]=y,n[n.length-1].push(m)}}var E=!1;while(c<i.length)if(i[c++]=="@<TRIPOS>BOND"){E=!0;break}if(E&&l)for(h=0;h<l;h++){v=i[c++],a=v.replace(/^\s+/,"").replace(/\s+/g," ").split(" ");var S=parseInt(a[1]);fromAtom=n[n.length-1][u[S]];var x=parseInt(a[2]);toAtom=n[n.length-1][u[x]];var T=parseInt(a[3]);isNaN(T)&&(T=1),fromAtom!==undefined&&toAtom!==undefined&&(fromAtom.bonds.push(u[x]),fromAtom.bondOrder.push(T),toAtom.bonds.push(u[S]),toAtom.bondOrder.push(T))}if(t.multimodel){t.onemol||n.push([]),i.splice(0,c),e=i.join("\n");continue}break}return n};var u={H:.37,He:.32,Li:1.34,Be:.9,B:.82,C:.77,N:.75,O:.73,F:.71,Ne:.69,Na:1.54,Mg:1.3,Al:1.18,Si:1.11,P:1.06,S:1.02,Cl:.99,Ar:.97,K:1.96,Ca:1.74,Sc:1.44,Ti:1.56,V:1.25,Mn:1.39,Fe:1.25,Co:1.26,Ni:1.21,Cu:1.38,Zn:1.31,Ga:1.26,Ge:1.22,Se:1.16,Br:1.14,Kr:1.1,Rb:2.11,Sr:1.92,Y:1.62,Zr:1.48,Nb:1.37,Mo:1.45,Tc:1.56,Ru:1.26,Rh:1.35,Pd:1.31,Ag:1.53,Cd:1.48,In:1.44,Sn:1.41,Sb:1.38,Te:1.35,I:1.33,Xe:1.3,Cs:2.25,Ba:1.98,Lu:1.6,Hf:1.5,Ta:1.38,W:1.46,Re:1.59,Os:1.44,Ir:1.37,Pt:1.28,Au:1.44,Hg:1.49,Tl:1.48,Pb:1.47,Bi:1.46,Rn:1.45},a=function(e){return u[e]||1.6},f=function(e,t){var n=a(e.elem)+a(t.elem);n+=.25,n*=n;var r=e.x-t.x;r*=r;if(r>n)return!1;var i=e.y-t.y;i*=i;if(i>n)return!1;var s=e.z-t.z;s*=s;if(s>n)return!1;var o=r+i+s;return isNaN(o)?!1:o<.5?!1:o>n?!1:e.altLoc!=t.altLoc&&e.altLoc!=" "&&t.altLoc!=" "?!1:!0},l=function(e,t,n){var r=n.length,i=r,s,o,u;if(!t){for(s=0;s<e.length;s++)if(!e[s].isIdentity()){var a=new $3Dmol.Vector3;for(u=0;u<r;u++){var f=[];for(o=0;o<n[u].bonds.length;o++)f.push(n[u].bonds[o]+i);a.set(n[u].x,n[u].y,n[u].z),a.applyMatrix4(e[s]);var l={};for(var c in n[u]){if(c=="properties")continue;if(c=="serial")continue;l[c]=n[u][c]}l.x=a.x,l.y=a.y,l.z=a.z,l.bonds=f,l.properties={},l.properties.symmat=e[s],l.serial=n.length+1,n.push(l)}i=n.length}}else if(e.length>1)for(s=0;s<n.length;s++){var h=[];for(o=0;o<e.length;o++)if(!e[o].isIdentity()){var p=new $3Dmol.Vector3;p.set(n[s].x,n[s].y,n[s].z),p.applyMatrix4(e[o]),h.push(p)}n[s].symmetries=h}},c=function(e){var t;for(t in e)return!1;return!0},h=function(e,t,r){var i=[],a=!t.keepH,f=!!t.noSecondaryStructure,h=!t.noComputeSecondaryStructure,p=!t.doAssembly,d=!t.duplicateAssemblyAtoms,v=t.altLoc?t.altLoc:"A",m={symmetries:[]},g,y=[],b=!1,w=[],E,S,x,T,N={};for(E=0;E<e.length;E++){T=e[E].replace(/^\s*/,"");var C=T.substr(0,6),k,L,A,O;if(C.indexOf("END")==0){y=e.slice(E+1);if(C=="END")for(var M in r)r.hasOwnProperty(M)&&delete r[M];break}if(C=="ATOM  "||C=="HETATM"){var _,D,P,H,B,j,F,I,q,R,U,z;U=T.substr(16,1);if(U!=" "&&U!=v&&v!="*")continue;R=parseInt(T.substr(6,5)),g=T.substr(12,4).replace(/ /g,""),_=T.substr(17,3).replace(/ /g,""),D=T.substr(21,1),P=parseInt(T.substr(22,4)),H=T.substr(26,1),B=parseFloat(T.substr(30,8)),j=parseFloat(T.substr(38,8)),F=parseFloat(T.substr(46,8)),z=parseFloat(T.substr(60,8)),q=T.substr(76,2).replace(/ /g,""),q===""||typeof u[q]=="undefined"?(q=T.substr(12,2).replace(/ /g,""),q.length>0&&q[0]=="H"&&q!="Hg"&&(q="H"),q.length>1&&(q=q[0].toUpperCase()+q.substr(1).toLowerCase(),typeof u[q]=="undefined"?q=q[0]:T[0]=="A"&&q=="Ca"&&(q="C"))):q=q[0].toUpperCase()+q.substr(1).toLowerCase();if(q=="H"&&a)continue;C[0]=="H"?I=!0:I=!1,w[R]=i.length,i.push({resn:_,x:B,y:j,z:F,elem:q,hetflag:I,altLoc:U,chain:D,resi:P,icode:H,rescode:P+(H!=" "?"^"+H:""),serial:R,atom:g,bonds:[],ss:"c",bondOrder:[],properties:{},b:z,pdbline:T})}else if(C=="SHEET "){b=!0,k=T.substr(21,1),L=parseInt(T.substr(22,4)),A=T.substr(32,1),O=parseInt(T.substr(33,4)),k in r||(r[k]={}),r[k][L]="s1";for(var W=L+1;W<O;W++)r[k][W]="s";r[k][O]="s2"}else if(C=="CONECT"){var X=parseInt(T.substr(6,5)),V=w[X],$=i[V],J=[11,16,21,26];for(S=0;S<4;S++){var K=parseInt(T.substr(J[S],5)),Q=w[K],G=i[Q];if($!==undefined&&G!==undefined)if(!N[[V,Q]]){N[[V,Q]]=1;if($.bonds.length==0||$.bonds[$.bonds.length-1]!=Q)$.bonds.push(Q),$.bondOrder.push(1)}else{N[[V,Q]]+=1;for(var Y=0;Y<$.bonds.length;Y++)if($.bonds[Y]==Q){var Z=N[[V,Q]];Z>=4?$.bondOrder[Y]=1:$.bondOrder[Y]=Z}}}}else if(C=="HELIX "){b=!0,k=T.substr(19,1),L=parseInt(T.substr(21,4)),A=T.substr(31,1),O=parseInt(T.substr(33,4)),k in r||(r[k]={}),r[k][L]="h1";for(var W=L+1;W<O;W++)r[k][W]="h";r[k][O]="h2"}else if(!p&&C=="REMARK"&&T.substr(13,5)=="BIOMT"){var et,tt=new $3Dmol.Matrix4;for(et=1;et<=3;et++){T=e[E].replace(/^\s*/,"");if(parseInt(T.substr(18,1))==et)tt.elements[et-1]=parseFloat(T.substr(23,10)),tt.elements[et-1+4]=parseFloat(T.substr(33,10)),tt.elements[et-1+8]=parseFloat(T.substr(43,10)),tt.elements[et-1+12]=parseFloat(T.substr(53)),E++;else while(T.substr(13,5)=="BIOMT")E++,T=e[E].replace(/^\s*/,"")}tt.elements[3]=0,tt.elements[7]=0,tt.elements[11]=0,tt.elements[15]=1,m.symmetries.push(tt),E--}else if(C=="CRYST1"){var nt,z,rt,it,st,ot;nt=parseFloat(T.substr(7,8)),z=parseFloat(T.substr(16,8)),rt=parseFloat(T.substr(25,8)),it=parseFloat(T.substr(34,6)),st=parseFloat(T.substr(41,6)),ot=parseFloat(T.substr(48,6)),m.cryst={a:nt,b:z,c:rt,alpha:it,beta:st,gamma:ot}}else if(C=="ANISOU"){var R=parseInt(T.substr(6,5)),ut=w[R],at=i[ut];if(at){var ft=T.substr(30).trim().split(/\s+/),lt={u11:parseInt(ft[0]),u22:parseInt(ft[1]),u33:parseInt(ft[2]),u12:parseInt(ft[3]),u13:parseInt(ft[4]),u23:parseInt(ft[5])};at.uMat=lt}}}var ct=(new Date).getTime();o(i,w),n(i),p||l(m.symmetries,d,i),h&&!f&&(ct=(new Date).getTime(),s(i)),ct=(new Date).getTime();if(!c(r))for(E=0;E<i.length;E++){g=i[E];if(g===undefined)continue;if(g.chain in r&&g.resi in r[g.chain]){var ht=r[g.chain][g.resi];g.ss=ht[0],ht.length>1&&(ht[1]=="1"?g.ssbegin=!0:ht[1]=="2"&&(g.ssend=!0))}}return[i,m,y]};e.pdb=e.PDB=e.pdbqt=e.PDBQT=function(e,t){var n=[],r={};n.modelData=[];var i=e.split(/\r?\n|\r/);while(i.length>0){var s=h(i,t,r),o=s[0],u=s[1];i=s[2];if(o.length==0)continue;if(t.multimodel&&t.onemol&&n.length>0){var a=n[0].length;for(var f=0;f<o.length;f++){var l=o[f];l.index=f;for(var c=0;c<l.bonds.length;c++)l.bonds[c]+=a;n[0].push(l)}}else n.modelData.push(u),n.push(o);if(!t.multimodel)break}return n},e.pqr=e.PQR=function(e,t){var r=[[]],i=0,o=r[r.length-1].length,u,a=!t.noSecondaryStructure,f=!t.doAssembly,l=!t.duplicateAssemblyAtoms,c=r.modelData=[{symmetries:[]}],h=[],p=e.split(/\r?\n|\r/),d,v,m,g;for(d=0;d<p.length;d++){g=p[d].replace(/^\s*/,"");var y=g.substr(0,6),b,w,E,S;if(y.indexOf("END")==0){if(t.multimodel){t.onemol||r.push([]);continue}break}if(y=="ATOM  "||y=="HETATM"){var x,T=parseInt(g.substr(6,5)),u=g.substr(12,4).replace(/ /g,""),N=g.substr(17,3),C=g.substr(21,1),k=parseInt(g.substr(22,4)),L=g.substr(30).trim().split(/\s+/),A=parseFloat(L[0]),O=parseFloat(L[1]),M=parseFloat(L[2]),_=parseFloat(L[3]),D=parseFloat(L[4]),P=u[0];u.length>1&&u[1].toUpperCase()!=u[1]&&(P=u.substr(0,2)),g[0]=="H"?x=!0:x=!1,h[T]=r[r.length-1].length,r[r.length-1].push({resn:N,x:A,y:O,z:M,elem:P,hetflag:x,chain:C,resi:k,serial:T,atom:u,bonds:[],ss:"c",bondOrder:[],properties:{charge:_,partialCharge:_,radius:D},pdbline:g})}else if(y=="CONECT"){var H=parseInt(g.substr(6,5)),B=r[r.length-1][h[H]];for(v=0;v<4;v++){var j=parseInt(g.substr([11,16,21,26][v],5)),F=r[r.length-1][h[j]];B!==undefined&&F!==undefined&&(B.bonds.push(h[j]),B.bondOrder.push(1))}}}for(var d=0;d<r.length;d++)n(r[d]),a&&s(r[d]);return r};var p=function(e){return String.fromCharCode.apply(null,e).replace(/\0/g,"")},d=function(e){return e==2?"h":e==3?"s":e==4?"h":e==0?"h":"c"};return e.mmtf=e.MMTF=function(e,t){var n=!t.keepH,r=t.altLoc?t.altLoc:"A",i=!!t.noSecondaryStructure,o=!t.noComputeSecondaryStructure,u=!t.doAssembly,a=!t.duplicateAssemblyAtoms,f=t.assemblyIndex?t.assemblyIndex:0,c=MMTF.decode(e),h=[[]],v=h.modelData=[],m=0,g=0,y=0,b=0,w=c.chainNameList,E=c.secStructList,S=c.insCodeList,x=c.sequenceIndexList,T=c.bFactorList,N=c.altLocList,C=c.occupancyList,k=c.bondAtomList,L=c.bondOrderList,A=c.numModels;if(A==0)return h;t.multimodel||(A=1);var O,M,_,D,P,H;t.bioAssemblyList=c.bioAssemblyList,t.groupList=c.groupList;var B={},j=[];if(c.groupList)for(O=0,H=c.groupList.length;O<H;O++){var F=c.groupList[O].chemCompType,I=c.groupList[O].groupName;if(I=="HOH")continue;if(F=="NON-POLYMER"||F.indexOf("SACCHARID")>-1||F=="OTHER")B[I]=[]}var q=[],R=[];if(!u&&c.bioAssemblyList&&c.bioAssemblyList.length>0){var U=c.bioAssemblyList[f].transformList;for(O=0,H=U.length;O<H;O++){var z=new $3Dmol.Matrix4(U[O].matrix);z.transpose(),R.push(z);var W=U[O].chainIndexList;q.push(W)}}var X=0;for(P=0;P<A;P++){var V=c.chainsPerModel[P],$=h[h.length-1],J=[];v.push({symmetries:R});for(O=0;O<V;++O){var K=c.groupsPerChain[g],Q=p(c.chainIdList.subarray(g*4,g*4+4));c.chainNameList&&(Q=p(c.chainNameList.subarray(g*4,g*4+4)));var G=y,Y="";for(M=0;M<K;++M){var Z=c.groupList[c.groupTypeList[y]],et=Z.atomNameList.length,tt=0,nt=!1,rt=!1;if(E){tt=E[y];var it=d(tt);if(y==0||it!=Y)nt=!0;Y=it;var st=y+1;if(st>=E.length||d(E[st]!=it))rt=!0}var ot=null;c.insCodeList&&(ot=String.fromCharCode(S[y]));var ut=null;x&&(ut=x[y]);var at=c.groupIdList[y],ft=Z.groupName,lt=b;for(_=0;_<et;++_){var ct=Z.elementList[_];if(n&&ct=="H"){b+=1;continue}var ht="";T&&(ht=T[b]);var pt="";N&&N[b]&&(pt=String.fromCharCode(N[b]));var dt="";C&&(dt=C[b]);if(pt!=""&&pt!=r&&r!="*"&&typeof B[ft]=="undefined"){b+=1;continue}var vt=c.atomIdList[b],mt=Z.atomNameList[_],gt=0;Z.atomChargeList&&(gt=Z.atomChargeList[_]);var yt=c.xCoordList[b],bt=c.yCoordList[b],wt=c.zCoordList[b];if(!u&&q.length>0&&q[0].indexOf(g)==-1){b+=1;continue}var Et=null,St=tt<0;St&&c.groupList[O]&&c.groupList[O].chemCompType.indexOf("PEPTIDE")>-1&&(St=!1),typeof B[ft]!="undefined"&&(St=!0,Et=ft+"_"+at+"_"+Q,j.indexOf(Et)==-1&&(j.push(Et),B[ft].push({ligandidA:Et,ligandid:Et}))),J[b]=$.length,$.push({resn:ft,x:yt,y:bt,z:wt,elem:ct,hetflag:St,chain:Q,resi:at,icode:pt,rescode:at+(pt!=" "?"^"+pt:""),serial:vt,altLoc:pt,index:b,atom:mt,bonds:[],ss:d(tt),ssbegin:nt,ssend:rt,bondOrder:[],properties:{charge:gt,occupancy:dt,ligandid:Et},b:ht}),b+=1}var xt=Z.bondAtomList;for(_=0,D=Z.bondOrderList.length;_<D;++_){var Tt=lt+xt[_*2],Nt=lt+xt[_*2+1],Ct=Z.bondOrderList[_],kt=J[Tt],Lt=J[Nt],At=$[kt],Ot=$[Lt];At&&Ot&&(At.bonds.push(Lt),At.bondOrder.push(Ct),Ot.bonds.push(kt),Ot.bondOrder.push(Ct))}y+=1}y=G;for(M=0;M<K;++M)y+=1;g+=1}if(k)for(_=X,D=k.length;_<D;_+=2){var Tt=k[_],Nt=k[_+1],Ct=L?L[_/2]:1;if(Tt>=b){X=_;break}var kt=J[Tt],Lt=J[Nt],At=$[kt],Ot=$[Lt];At&&Ot&&(At.bonds.push(Lt),At.bondOrder.push(Ct),Ot.bonds.push(kt),Ot.bondOrder.push(Ct))}t.multimodel&&(t.onemol||h.push([]));if(!u)for(var H=0;H<h.length;H++)l(v[m].symmetries,a,h[H]);m+=1}return o&&!i&&s(h),t.ligands=B,h},e.prmtop=e.PRMTOP=function(e,t){function d(e){var t=s.indexOf(o.filter(function(t){return t.includes(e)})[0]);if(Number.isInteger(t)&&t>0){while(!s[t].includes("FORMAT"))t++;return t}return-1}function v(e){var t=s[e].match(/\((\d*)\S*/),n=s[e].match(/[a-zA-Z](\d*)\)\s*/);return n==null&&(n=s[e].match(/[a-zA-Z](\d*)\.\d*\)\s*/)),[t[1],n[1]]}var n=[],r=0,s=e.split(/\r?\n|\r/);if(!(s.length>0&&s[0].includes("VERSION")))return[];var o=s.filter(function(e){return e.includes("POINTERS")||e.includes("ATOM_NAME")||e.includes("CHARGE")||e.includes("RADII")||e.includes("BONDS_INC_HYDROGEN")||e.includes("BONDS_WITHOUT_HYDROGEN")}),u=d("POINTERS");if(u==-1)return[];var a=v(u),f=parseInt(s[u+1].slice(0,a[1]));if(isNaN(f)||f<=0)return[];u=d("ATOM_NAME");if(u==-1)return[];a=v(u);var l=a[0];for(i=0;i<f/a[0];i++){i==parseInt(f/a[0])&&(l=f%a[0]);for(j=0;j<l;j++){var c={},h={charge:"",radii:""};c.serial=r,c.x=0,c.y=0,c.z=0,c.atom=s[u+1].slice(a[1]*j,a[1]*(j+1)),c.elem=s[u+1].slice(a[1]*j,a[1]*j+1),c.properties=h,c.bonds=[],c.bondOrder=[],n.push(c),r++}u++}u=d("CHARGE");if(u!=-1){a=v(u),r=0,l=a[0];for(i=0;i<f/a[0];i++){i==parseInt(f/a[0])&&(l=f%a[0]);for(j=0;j<l;j++)n[r].properties.charge=s[u+1].slice(a[1]*j,a[1]*(j+1)),r++;u++}}u=d("RADII");if(u!=-1){a=v(u),r=0,l=a[0];for(i=0;i<f/a[0];i++){i==parseInt(f/a[0])&&(l=f%a[0]);for(j=0;j<l;j++)n[r].properties.radii=s[u+1].slice(a[1]*j,a[1]*(j+1)),r++;u++}}u=d("BONDS_WITHOUT_HYDROGEN");if(u!=-1){a=v(u),r=0,l=a[0];var p;for(i=0;i<f/a[0];i++){i==parseInt(f/a[0])&&(l=f%a[0]);for(j=0;j<l;j++)r%3==0&&(p=parseInt(s[u+1].slice(a[1]*j,a[1]*(j+1))/3+1)),r%3==1&&n[p].bonds.push(parseInt(s[u+1].slice(a[1]*j,a[1]*(j+1))/3+1)),r++;u++}}u=d("BONDS_INC_HYDROGEN");if(u!=-1){a=v(u),r=0,l=a[0];var p;for(i=0;i<f/a[0];i++){i==parseInt(f/a[0])&&(l=f%a[0]);for(j=0;j<l;j++)r%3==0&&(p=parseInt(s[u+1].slice(a[1]*j,a[1]*(j+1))/3+1)),r%3==1&&n[p].bonds.push(parseInt(s[u+1].slice(a[1]*j,a[1]*(j+1))/3+1)),r++;u++}}return[n]},e.gro=e.GRO=function(e,n){var r=[],i=e.split(/\r?\n|\r/);while(i.length>0){if(i.length<3)break;var s=parseInt(i[1]);if(isNaN(s)||s<=0)break;if(i.length<s+3)break;r.push([]);var o=2,u=r[r.length-1].length,a=u+s;for(var f=u;f<a;f++){var l=i[o++],c={};c.serial=f,c.atom=l.slice(10,15).trim(),c.atom.charCodeAt(1)>=97&&c.atom.charCodeAt(1)<=122?c.elem=c.atom.slice(0,2):c.elem=c.atom[0],c.x=parseFloat(l.slice(20,28)),c.y=parseFloat(l.slice(28,36)),c.z=parseFloat(l.slice(36,44)),c.resi=l.slice(5,10),c.bonds=[],c.bondOrder=[],c.properties={},l.length>44&&(c.dx=parseFloat(l.slice(44,52)),c.dy=parseFloat(l.slice(52,60)),c.dz=parseFloat(l.slice(60,68))),r[r.length-1][f]=c}i.splice(0,++o)}for(var f=0;f<r.length;f++)t(r[f]);return r},e}();var $3Dmol=$3Dmol||{};$3Dmol.partialCharges={"ALA:N":-0.15,"ALA:CA":.1,"ALA:CB":0,"ALA:C":.6,"ALA:O":-0.55,"ARG:N":-0.15,"ARG:CA":.1,"ARG:CB":0,"ARG:CG":0,"ARG:CD":.1,"ARG:NE":-0.1,"ARG:CZ":.5,"ARG:NH1":.25,"ARG:NH2":.25,"ARG:C":.6,"ARG:O":-0.55,"ASN:N":-0.15,"ASN:CA":.1,"ASN:CB":0,"ASN:CG":.55,"ASN:OD1":-0.55,"ASN:ND2":0,"ASN:C":.6,"ASN:O":-0.55,"ASP:N":-0.15,"ASP:CA":.1,"ASP:CB":0,"ASP:CG":.14,"ASP:OD1":-0.57,"ASP:OD2":-0.57,"ASP:C":.6,"ASP:O":-0.55,"CYS:N":-0.15,"CYS:CA":.1,"CYS:CB":.19,"CYS:SG":-0.19,"CYS:C":.6,"CYS:O":-0.55,"GLN:N":-0.15,"GLN:CA":.1,"GLN:CB":0,"GLN:CG":0,"GLN:CD":.55,"GLN:OE1":-0.55,"GLN:NE2":0,"GLN:C":.6,"GLN:O":-0.55,"GLU:N":-0.15,"GLU:CA":.1,"GLU:CB":0,"GLU:CG":0,"GLU:CD":.14,"GLU:OE1":-0.57,"GLU:OE2":-0.57,"GLU:C":.6,"GLU:O":-0.55,"GLY:N":-0.15,"GLY:CA":.1,"GLY:C":.6,"GLY:O":-0.55,"HIS:N":-0.15,"HIS:CA":.1,"HIS:CB":0,"HIS:CG":.1,"HIS:ND1":-0.1,"HIS:CD2":.1,"HIS:NE2":-0.4,"HIS:CE1":.3,"HIS:C":.6,"HIS:O":-0.55,"ILE:N":-0.15,"ILE:CA":.1,"ILE:CB":0,"ILE:CG2":0,"ILE:CG1":0,"ILE:CD":0,"ILE:C":.6,"ILE:O":-0.55,"LEU:N":-0.15,"LEU:CA":.1,"LEU:CB":0,"LEU:CG":0,"LEU:CD1":0,"LEU:CD2":0,"LEU:C"
:.6,"LEU:O":-0.55,"LYS:N":-0.15,"LYS:CA":.1,"LYS:CB":0,"LYS:CG":0,"LYS:CD":0,"LYS:CE":.25,"LYS:NZ":.75,"LYS:C":.6,"LYS:O":-0.55,"MET:N":-0.15,"MET:CA":.1,"MET:CB":0,"MET:CG":.06,"MET:SD":-0.12,"MET:CE":.06,"MET:C":.6,"MET:O":-0.55,"PHE:N":-0.15,"PHE:CA":.1,"PHE:CB":0,"PHE:CG":0,"PHE:CD1":0,"PHE:CD2":0,"PHE:CE1":0,"PHE:CE2":0,"PHE:CZ":0,"PHE:C":.6,"PHE:O":-0.55,"PRO:N":-0.25,"PRO:CD":.1,"PRO:CA":.1,"PRO:CB":0,"PRO:CG":0,"PRO:C":.6,"PRO:O":-0.55,"SER:N":-0.15,"SER:CA":.1,"SER:CB":.25,"SER:OG":-0.25,"SER:C":.6,"SER:O":-0.55,"THR:N":-0.15,"THR:CA":.1,"THR:CB":.25,"THR:OG1":-0.25,"THR:CG2":0,"THR:C":.6,"THR:O":-0.55,"TRP:N":-0.15,"TRP:CA":.1,"TRP:CB":0,"TRP:CG":-0.03,"TRP:CD2":.1,"TRP:CE2":-0.04,"TRP:CE3":-0.03,"TRP:CD1":.06,"TRP:NE1":-0.06,"TRP:CZ2":0,"TRP:CZ3":0,"TRP:CH2":0,"TRP:C":.6,"TRP:O":-0.55,"TYR:N":-0.15,"TYR:CA":.1,"TYR:CB":0,"TYR:CG":0,"TYR:CD1":0,"TYR:CE1":0,"TYR:CD2":0,"TYR:CE2":0,"TYR:CZ":.25,"TYR:OH":-0.25,"TYR:C":.6,"TYR:O":-0.55,"VAL:N":-0.15,"VAL:CA":.1,"VAL:CB":0,"VAL:CG1":0,"VAL:CG2":0,"VAL:C":.6,"VAL:O":-0.55},$3Dmol.applyPartialCharges=function(e,t){if(!t||typeof e.partialCharge=="undefined")if(e.resn&&e.atom){var n=e.resn+":"+e.atom;e.properties.partialCharge=$3Dmol.partialCharges[n]}},function(){},$3Dmol.VolumeData=function(e,t,n){this.unit={x:1,y:1,z:1},this.origin={x:0,y:0,z:0},this.size={x:0,y:0,z:0},this.data=new Float32Array([]),this.matrix=null,t=t.toLowerCase();if(/\.gz$/.test(t)){t=t.replace(/\.gz$/,"");try{this[t]&&this[t].isbinary?e=pako.inflate(e):e=(new TextDecoder("utf-8")).decode(pako.inflate(e))}catch(r){console.log(r)}}this[t]&&this[t](e);if(n){if(n.negate)for(var i=0,s=this.data.length;i<s;i++)this.data[i]=-this.data[i];if(n.normalize){var o=0;for(var i=0,s=this.data.length;i<s;i++)o+=this.data[i];var u=o/this.data.length;o=0;for(var i=0,s=this.data.length;i<s;i++){var a=this.data[i]-u;o+=a*a}var f=o/this.data.length;for(var i=0,s=this.data.length;i<s;i++)this.data[i]=(this.data[i]-u)/f}}},$3Dmol.VolumeData.prototype.getVal=function(e,t,n){return e-=this.origin.x,t-=this.origin.y,n-=this.origin.z,e/=this.unit.x,t/=this.unit.y,n/=this.unit.z,e=Math.round(e),t=Math.round(t),n=Math.round(n),e<0||e>=this.size.x?0:t<0||t>=this.size.y?0:n<0||n>=this.size.z?0:this.data[e*this.size.y*this.size.z+t*this.size.z+n]},$3Dmol.VolumeData.prototype.getCoordinates=function(e){var t=e/(this.size.y*this.size.z),n=e%(this.size.y*this.size.z),r=e%this.size.z;return t*=this.unit.x,n*=this.unit.y,r*=this.unit.z,t+=this.origin.x,n+=this.origin.y,r+=this.origin.z,{x:t,y:n,z:r}},$3Dmol.VolumeData.prototype.vasp=function(e){var t=e.replace(/^\s+/,"").split(/[\n\r]/),n=$3Dmol.Parsers.vasp(e)[0],r=n.length;if(r==0){console.log("No good formating of CHG or CHGCAR file, not atomic information provided in the file."),this.data=[];return}var i="bohr/hartree",s=1.889725992,o=.036749309,u=parseFloat(t[1]),a;a=t[2].replace(/^\s+/,"").split(/\s+/);var f=(new $3Dmol.Vector3(parseFloat(a[0]),parseFloat(a[1]),parseFloat(a[2]))).multiplyScalar(u*s);a=t[3].replace(/^\s+/,"").split(/\s+/);var l=(new $3Dmol.Vector3(parseFloat(a[0]),parseFloat(a[1]),parseFloat(a[2]))).multiplyScalar(u*s);a=t[4].replace(/^\s+/,"").split(/\s+/);var c=(new $3Dmol.Vector3(parseFloat(a[0]),parseFloat(a[1]),parseFloat(a[2]))).multiplyScalar(u*s),h=f.x*(l.y*c.z-c.y*l.z)-l.x*(f.y*c.z-c.y*f.z)+c.x*(f.y*l.z-l.y*f.z);h=Math.abs(h)/Math.pow(s,3);var p=1/h;t.splice(0,8+r+1);var d=t[0].replace(/^\s+/,"").replace(/\s+/g," ").split(" "),v=Math.abs(d[0]),m=Math.abs(d[1]),g=Math.abs(d[2]),y=this.origin=new $3Dmol.Vector3(0,0,0);this.size={x:v,y:m,z:g},this.unit=new $3Dmol.Vector3(f.x,l.y,c.z),f=f.multiplyScalar(1/(s*v)),l=l.multiplyScalar(1/(s*m)),c=c.multiplyScalar(1/(s*g));if(f.y!=0||f.z!=0||l.x!=0||l.z!=0||c.x!=0||c.y!=0)this.matrix=new $3Dmol.Matrix4(f.x,l.x,c.x,0,f.y,l.y,c.y,0,f.z,l.z,c.z,0,0,0,0,1),this.matrix=this.matrix.multiplyMatrices(this.matrix,(new $3Dmol.Matrix4).makeTranslation(y.x,y.y,y.z)),this.origin=new $3Dmol.Vector3(0,0,0),this.unit=new $3Dmol.Vector3(1,1,1);t.splice(0,1);var b=t.join(" ");b=b.replace(/^\s+/,""),b=b.split(/[\s\r]+/),b.splice(v*m*g+1);var w=new Float32Array(b);for(var E=0;E<w.length;E++)w[E]=w[E]*p*o;this.data=w},$3Dmol.VolumeData.prototype.dx=function(e){var t=e.split(/[\n\r]+/),n,r,i=/gridpositions\s+counts\s+(\d+)\s+(\d+)\s+(\d+)/,s=/^origin\s+(\S+)\s+(\S+)\s+(\S+)/,o=/^delta\s+(\S+)\s+(\S+)\s+(\S+)/,u=/data follows/;for(n=0;n<t.length;n++){var a=t[n];if(r=i.exec(a)){var f=parseInt(r[1]),l=parseInt(r[2]),c=parseInt(r[3]);this.size={x:f,y:l,z:c}}else if(r=o.exec(a)){var h=parseFloat(r[1]);(parseFloat(r[2])!=0||parseFloat(r[3])!=0)&&console.log("Non-orthogonal delta matrix not currently supported in dx format"),n+=1,a=t[n],r=o.exec(a);if(r==null){console.log("Parse error in dx delta matrix");return}var p=parseFloat(r[2]);(parseFloat(r[1])!=0||parseFloat(r[3])!=0)&&console.log("Non-orthogonal delta matrix not currently supported in dx format"),n+=1,a=t[n],r=o.exec(a);if(r==null){console.log("Parse error in dx delta matrix");return}var d=parseFloat(r[3]);(parseFloat(r[1])!=0||parseFloat(r[2])!=0)&&console.log("Non-orthogonal delta matrix not currently supported in dx format"),this.unit=new $3Dmol.Vector3(h,p,d)}else if(r=s.exec(a)){var v=parseFloat(r[1]),m=parseFloat(r[2]),g=parseFloat(r[3]);this.origin=new $3Dmol.Vector3(v,m,g)}else if(r=u.exec(a))break}n+=1;if(!this.size||!this.origin||!this.unit||!this.size){console.log("Error parsing dx format");return}var y=t.splice(n).join(" ");y=y.split(/[\s\r]+/),this.data=new Float32Array(y)},$3Dmol.VolumeData.prototype.cube=function(e){var t=e.replace(/^\s+/,"").split(/[\n\r]+/);if(t.length<6)return;var n=t[2].replace(/^\s+/,"").replace(/\s+/g," ").split(" "),r=parseFloat(n[0]),i=Math.abs(r),s=this.origin=new $3Dmol.Vector3(parseFloat(n[1]),parseFloat(n[2]),parseFloat(n[3]));n=t[3].replace(/^\s+/,"").replace(/\s+/g," ").split(" ");var o=n[0]>0?.529177:1;s.multiplyScalar(o);var u=Math.abs(n[0]),a=(new $3Dmol.Vector3(parseFloat(n[1]),parseFloat(n[2]),parseFloat(n[3]))).multiplyScalar(o);n=t[4].replace(/^\s+/,"").replace(/\s+/g," ").split(" ");var f=Math.abs(n[0]),l=(new $3Dmol.Vector3(parseFloat(n[1]),parseFloat(n[2]),parseFloat(n[3]))).multiplyScalar(o);n=t[5].replace(/^\s+/,"").replace(/\s+/g," ").split(" ");var c=Math.abs(n[0]),h=(new $3Dmol.Vector3(parseFloat(n[1]),parseFloat(n[2]),parseFloat(n[3]))).multiplyScalar(o);this.size={x:u,y:f,z:c},this.unit=new $3Dmol.Vector3(a.x,l.y,h.z);if(a.y!=0||a.z!=0||l.x!=0||l.z!=0||h.x!=0||h.y!=0)this.matrix=new $3Dmol.Matrix4(a.x,l.x,h.x,0,a.y,l.y,h.y,0,a.z,l.z,h.z,0,0,0,0,1),this.matrix=this.matrix.multiplyMatrices(this.matrix,(new $3Dmol.Matrix4).makeTranslation(s.x,s.y,s.z)),this.origin=new $3Dmol.Vector3(0,0,0),this.unit=new $3Dmol.Vector3(1,1,1);var p=6;r<0&&p++;var d=t.splice(i+p).join(" ");d=d.replace(/^\s+/,""),d=d.split(/[\s\r]+/),this.data=new Float32Array(d)},$3Dmol.VolumeData.prototype.ccp4=function(e){var t={};e=new Int8Array(e);var n=new Int32Array(e.buffer,0,56),r=new Float32Array(e.buffer,0,56),i=new DataView(e.buffer);t.MAP=String.fromCharCode(i.getUint8(208),i.getUint8(209),i.getUint8(210),i.getUint8(211)),t.MACHST=[i.getUint8(212),i.getUint8(213)];if(t.MACHST[0]===17&&t.MACHST[1]===17){var s=e.byteLength;for(var o=0;o<s;o+=4)i.setFloat32(o,i.getFloat32(o),!0)}t.NX=n[0],t.NY=n[1],t.NZ=n[2],t.MODE=n[3],t.NXSTART=n[4],t.NYSTART=n[5],t.NZSTART=n[6],t.MX=n[7],t.MY=n[8],t.MZ=n[9],t.xlen=r[10],t.ylen=r[11],t.zlen=r[12],t.alpha=r[13],t.beta=r[14],t.gamma=r[15],t.MAPC=n[16],t.MAPR=n[17],t.MAPS=n[18],t.DMIN=r[19],t.DMAX=r[20],t.DMEAN=r[21],t.ISPG=n[22],t.NSYMBT=n[23],t.LSKFLG=n[24],t.originX=r[49],t.originY=r[50],t.originZ=r[51],t.ARMS=r[54];var u=t,a=[u.xlen,0,0],f=[u.ylen*Math.cos(Math.PI/180*u.gamma),u.ylen*Math.sin(Math.PI/180*u.gamma),0],l=[u.zlen*Math.cos(Math.PI/180*u.beta),u.zlen*(Math.cos(Math.PI/180*u.alpha)-Math.cos(Math.PI/180*u.gamma)*Math.cos(Math.PI/180*u.beta))/Math.sin(Math.PI/180*u.gamma),0];l[2]=Math.sqrt(u.zlen*u.zlen*Math.sin(Math.PI/180*u.beta)*Math.sin(Math.PI/180*u.beta)-l[1]*l[1]);var c=[0,a,f,l],h=[0,u.MX,u.MY,u.MZ],p=[0,u.MAPC,u.MAPR,u.MAPS];this.matrix=new $3Dmol.Matrix4,this.matrix.set(c[p[1]][0]/h[p[1]],c[p[2]][0]/h[p[2]],c[p[3]][0]/h[p[3]],0,c[p[1]][1]/h[p[1]],c[p[2]][1]/h[p[2]],c[p[3]][1]/h[p[3]],0,c[p[1]][2]/h[p[1]],c[p[2]][2]/h[p[2]],c[p[3]][2]/h[p[3]],0,0,0,0,1),this.matrix=this.matrix.multiplyMatrices(this.matrix,(new $3Dmol.Matrix4).makeTranslation(u.NXSTART+u.originX,u.NYSTART+u.originY,u.NZSTART+u.originZ)),this.origin=new $3Dmol.Vector3(0,0,0),this.unit=new $3Dmol.Vector3(1,1,1),this.size={x:t.NX,y:t.NY,z:t.NZ};var d=new Float32Array(e.buffer,1024+t.NSYMBT),v=t.NX,m=t.NY,g=t.NZ;this.data=new Float32Array(v*m*g);for(var o=0;o<v;o++)for(var y=0;y<m;y++)for(var b=0;b<g;b++)this.data[(o*m+y)*g+b]=d[(b*m+y)*v+o];this.header=t},$3Dmol.VolumeData.prototype.ccp4.isbinary=!0,$3Dmol.workerString=function(){self.onmessage=function(e){var t=e.data,n=t.type;if(n<0)self.atomData=t.atoms,self.volume=t.volume,self.ps=new ProteinSurface;else{var r=self.ps;r.initparm(t.expandedExtent,n==1?!1:!0,self.volume),r.fillvoxels(self.atomData,t.extendedAtoms),r.buildboundary();if(n===4||n===2)r.fastdistancemap(),r.boundingatom(!1),r.fillvoxelswaals(self.atomData,t.extendedAtoms);r.marchingcube(n);var i=r.getFacesAndVertices(t.atomsToShow);self.postMessage(i)}}}.toString().replace(/(^.*?\{|\}$)/g,""),$3Dmol.workerString+="; var ProteinSurface="+$3Dmol.ProteinSurface.toString().replace(/[a-zA-Z_$]{1}[0-9a-zA-Z_$]*.MarchingCube./g,"MarchingCube."),$3Dmol.workerString+=",MarchingCube=("+$3Dmol.MarchingCubeInitializer.toString()+")();",$3Dmol.SurfaceWorker=window.URL?window.URL.createObjectURL(new Blob([$3Dmol.workerString],{type:"text/javascript"})):{postMessage:function(){}},$3Dmol.workerString=$3Dmol.workerString,$3Dmol.SurfaceWorker=$3Dmol.SurfaceWorker;