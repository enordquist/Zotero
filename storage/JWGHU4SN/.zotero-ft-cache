research papers
IUCrJ
ISSN 2052-2525
PHYSICS j FELS
Received 30 April 2018 Accepted 31 July 2018
Edited by I. Robinson, UCL, UK Keywords: coherent diffractive imaging; signal-to-noise ratio; spatial resolution; information capacity. Supporting information: this article has supporting information at www.iucrj.org

Signal-to-noise, spatial resolution and information capacity of coherent diffraction imaging
Timur E. Gureyev,a,b,c,d,e* Alexander Kozlov,a Yakov I. Nesterets,c,d David M. Paganin,e Andrew V. Martinf and Harry M. Quineya
aARC Centre of Excellence in Advanced Molecular Imaging, School of Physics, University of Melbourne, Parkville, Victoria 3010, Australia, bFaculty of Health Sciences, University of Sydney, Sydney NSW 2006, Australia, cSchool of Science and Technology, University of New England, Armidale NSW 2351, Australia, dManufacturing, CSIRO, Clayton, Victoria 3168, Australia, eSchool of Physics and Astronomy, Monash University, Clayton, Victoria 3800, Australia, and fSchool of Science, RMIT University, Melbourne, Victoria 3001, Australia. *Correspondence e-mail: timur.gureyev@unimelb.edu.au
It is shown that the average signal-to-noise ratio (SNR) in the three-dimensional electron-density distribution of a sample reconstructed by coherent diffractive imaging cannot exceed twice the square root of the ratio of the mean total number of scattered photons detected during the scan and the number of spatially resolved voxels in the reconstructed volume. This result leads to an upper bound on Shannon’s information capacity of this imaging method by specifying the maximum number of distinguishable density distributions within the reconstructed volume when the radiation dose delivered to the sample and the spatial resolution are both ﬁxed. If the spatially averaged SNR in the reconstructed electron density is ﬁxed instead, the radiation dose is shown to be proportional to the third or fourth power of the spatial resolution, depending on the sampling of the three-dimensional diffraction space and the scattering power of the sample.

1. Introduction
The tomographic form of coherent diffraction imaging (CDI) is typically concerned with the reconstruction of the threedimensional spatial distribution of electron density in a sample from a set of X-ray diffraction patterns collected in the far (Fraunhofer) region at different rotational positions of the sample (Sayre et al., 1998; Robinson et al., 2001; Marchesini et al., 2003; Chapman et al., 2006). The issue of sample damage, as a result of the X-ray dose delivered to the sample in the process of imaging, is central to this method, particularly when high-resolution imaging of biological samples is considered. It has been shown that when the signal-to-noise ratio (SNR) in the reconstructed electron-density distribution is ﬁxed, the X-ray dose delivered to the sample is proportional to the third (Bergh et al., 2008) or fourth (Howells et al., 2009) power of the spatial resolution. For single non-crystalline biological samples, this limits the spatial resolution to approximately 10 nm (Howells et al., 2009). More recently, it has been demonstrated that the use of ultra-short pulses (<100 fs) at X-ray free-electron laser (XFEL) sources allows one to ‘outrun’ the radiation damage by collecting many diffraction images from identical samples, each image being produced before the sample is destroyed by the X-ray pulse (Chapman et al., 2011; Quiney & Nugent, 2011; Martin et al., 2015). As a result, the dose limits established for biological samples with synchrotron sources (Howells et al., 2009) do not apply for

716 https://doi.org/10.1107/S2052252518010941

IUCrJ (2018). 5, 716–726

research papers

XFEL experiments (Chapman et al., 2011). There is an active effort to push XFEL imaging of single biological particles to atomic resolution and compete with X-ray crystallography and cryo-electron microscopy (Miao et al., 2015). Despite the extreme intensity of XFEL pulses, they scatter as few as 102– 103 photons per protein and the measured diffraction images are extremely noisy. The SNR is improved when a large number of diffraction images are assembled into a threedimensional set, and it is predicted that 105–106 diffraction patterns will be required for the three-dimensional imaging of a protein (Tegze & Bortel, 2012). However, a number of challenging problems exist in this form of CDI, such as ﬁnding the unknown orientation of each imaged sample from the lowSNR diffraction patterns and reconstructing the phase distribution from diffraction intensity measurements. The questions of signal, noise and spatial resolution are central to these problems (Elser, 2009; Kirian et al., 2011).
In CDI, the three-dimensional diffraction intensity volume (produced by an orientation-determination algorithm in the case of XFEL-type CDI) serves as the input for a phasing algorithm which ultimately recovers the real-space electron distribution in the sample. The SNR of the three-dimensional diffracted intensity volume impacts the accuracy of the recovered image. The impact of noise on popular CDI phasing algorithms has been characterized (Williams et al., 2007) and several innovations to improve robustness-to-noise have been proposed (Loh et al., 2010; Dilanian et al., 2010; Martin et al., 2012). Since phase retrieval is generally a non-linear problem, the impact of noise has diverse effects ranging from reduced resolution through to the failure of phasing algorithms to converge in more challenging cases. In the present paper, we do not study the noise tolerance of orientation-determination or phasing algorithms, which has been considered elsewhere (Loh & Elser, 2009; Giannakis et al., 2012; Williams et al., 2007; Loh et al., 2010; Dilanian et al., 2010). Rather we consider SNR limits that can be reached assuming particle orientation and phases are known. In this sense, our results provide an upper limit for the maximum achievable SNR in the electron-density distribution in the sample reconstructed at a certain spatial resolution if the particle orientation and phases are accurately determined by suitable algorithms. The obtained results hold under the assumption that there is no prior information about the sample, which is often not the case.
The impact of noise in XFEL diffraction imaging has been previously studied for the determination of particle orientation (Loh & Elser, 2009; Giannakis et al., 2012) and for phase retrieval (Williams et al., 2007; Loh et al., 2010; Dilanian et al., 2010). In the case of orientation determination, Bayesian methods (Loh & Elser, 2009) and manifold-based methods (Giannakis et al., 2012) have been developed to overcome the low SNR of individual images by analysing the data as an ensemble. Many ensemble approaches avoid assigning each measurement a speciﬁc orientation. Instead, they use probabilistic or geometric methods to merge the ensemble of twodimensional tomographic projections into a three-dimensional diffraction intensity volume. A one-dimensional proof-ofprinciple demonstration of a Bayesian orientation algorithm

was successful with only 2.5 photons per pattern on average (Philipp et al., 2012) and there are information-theoretic arguments that the XFEL signals for individual proteins will be sufﬁcient for orientation determination (Loh et al., 2010). However, it is critical to accurately estimate the number of required diffraction patterns, which, in turn, determines the experimental requirements for sample preparation, delivery and data collection.
We investigate the limits for SNR and spatial resolution in three-dimensional CDI from the point of view of the noise– resolution uncertainty principle (Gureyev et al., 2014, 2016). This principle states that, at a ﬁxed radiation dose, the SNR and spatial resolution can almost always be traded for each other, but the square of their ratio, normalized by the incident photon ﬂuence, is limited from above by the scattering power of the sample, i.e. the fraction of incident photons that are scattered by the sample (Gureyev et al., 2016). ‘Naive’ considerations tell us that, when the noise in the collected CDI data is dominated by Poisson-distributed photon-shot noise and, therefore, the squared SNR in a detector pixel is proportional to the number of collected photons, the squared SNR in the three-dimensional tomographic data should in principle be proportional to the third power of the spatial resolution Ár in the reconstructed sample. Indeed, when the linear dimension of a voxel in the sample is reduced twofold from Ár to Ár /2, its volume is reduced eightfold, from Á3r to Á3r/8, and the number of photons scattered by the volume will generally also decrease by a factor of eight. It transpires that this ‘naive’ view is correct in the case of CDI data uniformly sampled in reciprocal space, in which case the squared SNR in the reconstructed sample is indeed proportional to Á3r. More precisely, as the SNR is a dimensionless quantity, its square is actually inversely proportional to the total number, M, of resolution voxels in the reconstructed sample, M = V/Á3r, where V is the reconstructed volume. In a real experiment however, when the sample is effectively rotated during a tomographic CDI scan and the corresponding image planes in the diffraction space rotate accordingly, the sampling is usually not uniform, as the distance between the data points on the periphery of the diffraction space is larger than the sampling distance in a close vicinity of the centre of rotation. In fact, the sampling distance generally increases in proportion to the radial variable in the cylindrical coordinates in reciprocal space. The fact that the corresponding sampling is closer to cylindrical than spherical will be discussed in detail later in the present paper. This spatially non-uniform sampling has a strong effect on the SNR in the reconstructed electron density. For a typical sample and planar illumination, the number of scattered photons would normally decrease as a function of the diffraction angle, and hence also as a function of the radial coordinate in reciprocal space. Therefore, the SNR in the collected CDI data, being equal to the square root of the number of registered photons, will also decrease as a function of the radial coordinate. On the other hand, the effect of nonuniform sampling density of the experimental data implies that, in the reconstruction process, the high-angle diffraction data has to be multiplied by a factor proportional to the radial

IUCrJ (2018). 5, 716–726

Timur E. Gureyev et al.  Signal-to-noise, spatial resolution and information capacity 717

research papers

Figure 1 Sampling geometry of the diffraction space in a CDI experiment. The vector p() is normal to the detector plane and extends from the centre of a ﬁxed sphere, enclosing the sample to its surface with the angular coordinate  parametrizing the curve È drawn by p() on the surface of the sphere when the sample is rotated. The Cartesian coordinates (s, ) in the detector plane are ﬁxed by the requirement that s is parallel to the vector dp() tangential to È. Sampling volumes |Áq| = sÁsÁÁ around two different diffraction data points are indicated by greyscale shading (a more detailed description can be found in Section 4).
variable of the cylindrical coordinates (Fig. 1). The combination of these two factors leads to the fact that, overall, the lowSNR diffraction data have higher weights in the reconstructed image compared with high-SNR data. In other words, the noise is ampliﬁed in the reconstruction more strongly relative to the useful signal. This effect is well known in computed tomography (CT), where the singular values of the inverse X-ray and Radon transforms increase in proportion to the square root of the radial order of the corresponding basis functions, making these inverse operators (moderately) unstable with respect to noise in the input data (Natterer, 1986). This noise ampliﬁcation makes the squared SNR in the reconstructed data proportional to the fourth (rather than the third) power of spatial resolution, i.e. proportional to MÀ4/3 = Á4r/V4/3 (Howells et al., 2009; Gureyev et al., 2016).
As should be clear from the above considerations, the ‘fourth power law’: SNR2 ’ MÀ4/3 = Á4r /V 4/3 is likely to be dependent on two conditions. First, the sampling density in the diffraction space has to decrease in proportion to the radial variable in the cylindrical coordinates. As illustrated by the behaviour of the singular values in CT, this is a fundamental effect which cannot be overcome by a clever resampling of the registered data onto a uniform Cartesian grid, as part of the reconstruction process. Indeed, the corresponding interpolation of the data would inevitably increase the noise at least to the same degree as in an optimal reconstruction using the data on the original non-uniform sampling grid (Natterer, 1986).

Second, in order for the fourth-power law to hold, the diffraction intensity must be a decreasing function of the radial coordinate. When this is not so, for example, for ‘sharply peaked’ samples that generate a near-ﬂat distribution of diffraction signal in reciprocal space, the fourth-power law is replaced by the ‘third-power law’, SNR2 ’ MÀ1 = Á3r /V, the same as in the idealized case of spatially uniform sampling considered above. When the signal and noise have the same spatial distribution, it does not matter that the registered intensity data is multiplied by a factor proportional to the cylindrical radial coordinate in the reconstruction process, because this multiplication affects the signal and the noise in equal measure and the relative ampliﬁcation of noise does not take place. These facts are studied in detail in Section 4 of the present paper, after the basic model of CDI image formation is considered in Section 2 and a corresponding generic expression for the SNR in the reconstructed electron density is derived in Section 3. Section 5 of the paper contains a brief investigation of the intrinsic imaging-quality characteristic (Gureyev et al., 2014, 2016) and Shannon’s information capacity (Shannon, 1949; Cox & Sheppard, 1986) of CDI imaging systems. Appendix A contains a mathematical derivation of the expectation value of the square root of a Poissondistributed random variable, which is used to obtain the key result of Section 3. Appendix B contains a list of the main symbols used in this paper.

2. Signal-to-noise ratio in diffracted intensity data
Here we brieﬂy outline some well known mathematical formulae describing image formation in CDI that are relevant to our analysis. Let

IRðx;

yÞ



lim
T!1

IR;T

ðx;

yÞ

¼

hIR;T

ðx;

yÞi

ð1Þ

be the average image plane z =

intensity R, where

measured at IR;T ðx; yÞ ¼ T

Àp1oRinÀTtT=2=(2xj,UyR,ðxR;)y;intÞjt2hdet

is the instantaneous light irradiance averaged over the expo-

sure (or the illuminating pulse) time T, UR(x, y; t) is the complex wave amplitude (viewed as a wide-sense stationary

stochastic process) in the image plane and the angular

brackets denote the ensemble average. The variance of the

intensity registered by a photon-counting detector with

quantum efﬁciency  is approximately equal to (Goodman,

1985; Mandel & Wolf, 1995; Gureyev, Nesterets et al., 2017)

VR;h;T ðx; yÞ ﬃ À1hÀ2TÀ1IRðx; yÞ;

ð2Þ

where VR,h,T (x, y)  hIR2,h,T (x,y)i À hIR,h,T (x, y)i2 is the variance of the intensity, IR,h,T (x, y), registered in a single effective detector pixel with linear size h (more precisely, h is the width of the point-spread function of the detector) and centered at the point (x, y, R). Equation (2) has been derived under the assumption that the average intensity IRðx; yÞ spatially varies slowly over distances comparable with h, and therefore is approximately invariant with respect to the convolution with the point-spread function of the detector.

718 Timur E. Gureyev et al.  Signal-to-noise, spatial resolution and information capacity

IUCrJ (2018). 5, 716–726

research papers

In the semiclassical model of photodetection (Goodman, 1985; Mandel & Wolf, 1995), the quantity

nR;h;T ðx; yÞ   h2 T IRðx; yÞ

ð3Þ

represents the mean number of photons detected over time T within the detector ‘pixel’ area h2 centered at the point
(x, y, R). Deﬁning the squared SNR in the usual way as the
ratio of the squared intensity to the intensity variance, SNR2R;h;T ðx; yÞ  ½IRðx; yÞ2=VR;h;T ðx; yÞ; it is easy to verify from equations (1)–(3) that

SNR2R;h;T ðx; yÞ ﬃ nR;h;T ðx; yÞ;

ð4Þ

as expected in the case of Poisson photon counting statistics. The above derivation of equation (4) assumes that the
exposure time T is much larger than the coherence time Tc and the number of registered photons per pixel is not very large, so that nR;h;T ðx; yÞ ( T=Tc (Gureyev, Nesterets et al., 2017), as is the case in a typical CDI experiment. If the latter condition is not satisﬁed, for instance, if the beam has a very high degree of temporal coherence, then the SNR may depend not only on the photon counting statistics inherent to the photodetection process, but also on the photon statistics intrinsic to the radiation source (‘self noise’) (Mandel & Wolf, 1995). Finally, equation (4) also ignores the effect of sample damage, which can lead to a variation of the scattering potential during the exposure time. This type of effect has been considered previously in a CDI context in a number of publications (Quiney & Nugent, 2011; Martin et al., 2015).
Let us now describe how the SNR is related to the properties of the sample in the quasi-monochromatic case, within the constraints discussed in the previous paragraph. We assume that the incident beam is a plane wave propagating along the optic axis z, having spatially uniform intensity distribution, I(x, y, 0) = Iin, and a ﬂat phase, ’(x, y 0) = 0 in the object plane z = 0. We also assume that the scattering of the radiation by the sample is time-independent and weak, so that the standard ﬁrst Born approximation can be applied to describe the scattering. Finally, we assume that the scattered beam is paraxial, allowing us to use the Fresnel diffraction integral for the propagated amplitude. Under these assumptions, the beam intensity in the far (Fraunhofer) ﬁeld, R ) A2/, where A is the diameter of the sample and  is the mean wavelength of the radiation, can be described by the expression

IRðx; yÞ ﬃ Iinðre=RÞ2jðF3eÞ½x=ðRÞ; y=ðRÞ; 0j2; ð5Þ RR
where ðF3f Þð;;&Þ = exp½Ài 2 ðxþyþ&zÞf ðx;y;zÞdxdydz is the three-dimensional Fourier transform of f(x, y, z), re is the classical electron radius and eðrÞ is the electron-density distribution in the sample (Cowley, 1995). As the primary
unperturbed beam is typically blocked from the detector in
this type of experiment, the diffracted intensity in the vicinity of the origin of coordinates may be unknown.
Substituting the expression for the diffracted intensity from
equation (5) into equation (3), and then into equation (4), we
obtain

SNR2R;h;Tðx; yÞ ﬃ Finh2ðre=RÞ2jðF3eÞ½x=ðRÞ; y=ðRÞ; 0j2; ð6Þ

where Fin = TIin is the uniform incident photon ﬂuence (number of detected photons per unit area, which is assumed

to be known) in the object plane, corresponding to the

exposure time T and the detector efﬁciency . Using the

terminology from the work by Gureyev et al. (2014, 2016), we

can state that the two-dimensional ‘direct’ intrinsic imaging

quality of the considered CDI setup is equal to

QSðx; yÞ



SNRR;h;T ðx; yÞ Fi1n=;2T h

ﬃ

rRejðF3eÞ½x=ðRÞ; y=ðRÞ; 0j:

ð7Þ

The quantity QS characterizes the efﬁciency of utilization of incident photons by the imaging system in terms of achieving a certain SNR and spatial resolution (the latter two can be traded for each other at a ﬁxed radiation dose delivered to the sample). However, as CDI imaging is mainly concerned with the quality of reconstruction of the unknown internal structure of a sample, rather than that of the diffraction images, it is more interesting in this case to investigate the behaviour of the SNR and spatial resolution in the reconstructed electron density as a function of the radiation dose and other essential parameters.

3. Signal-to-noise ratio and spatial resolution in reconstructed electron density

According to equation (5), the diffracted intensity IRðx; yÞ contains information about the distribution of the threedimensional Fourier transform of the electron density, ðF3eÞð; ; &Þ in a plane (, , 0) passing through the centre of the coordinates in reciprocal space. If the sample is rotated prior to exposure, equation (5) transforms into

IRðqÞ ﬃ Iinðre=RÞ2jF3ej2ðqÞ;

ð8Þ

where IRðqÞ  Iinðre=RÞ2jF3eðWrÞj2ð; ; 0Þ ¼ Iinðre=RÞ2 Â jF3eðrÞj2½Wð; ; 0Þ denotes the mean intensity distribution IRðx; yÞ measured in the plane z = R after the sample has been rotated according to the orthogonal matrix W, q  W(, , 0),  = x/(R) and  = y/(R). Here we used the fact that the rotation of the sample coordinate space is equivalent to the rotation of the reciprocal space owing to the linearity of the Fourier transform and the orthogonality of rotation matrices.
According to equation (8), if the diffracted intensity distributions are collected for a sufﬁciently broad range of rotational positions of the sample (the conditions that such a range must satisfy are discussed below), then the whole threedimensional reciprocal space, except for a vicinity of the point (0, 0, 0), of the sample electron density can be probed. Furthermore, if the phase-retrieval problem can be solved for equation (8) in the sense that a unique complex amplitude, URðqÞ  I1R=2ðqÞ exp½i ’RðqÞ; can be found on the basis of appropriate assumptions about the sample and the imaging

IUCrJ (2018). 5, 716–726

Timur E. Gureyev et al.  Signal-to-noise, spatial resolution and information capacity 719

research papers

setup, then the electron-density distribution in the sample can be obtained by three-dimensional inverse Fourier transform of the complex amplitude (Sayre et al., 1998; Robinson et al., 2001; Marchesini et al., 2003; Chapman et al., 2006),

eðrÞ ﬃ ðR=reÞIiÀn1=2ðFÀ3 1URÞðrÞ:

ð9Þ

However, as the registered intensity is a stochastic distribu-

tion, then the reconstructed electron density is also going to be

stochastic. In general, the random character of the measured

diffracted intensity is determined by the properties of the

X-ray source, the sample and the detector. We have assumed

that the probabilistic properties of the source and the sample

do not affect the random behaviour of the measured intensity,

and the detector behaves as an ideal photon-counting

detector. Consequently, we assume that the data measured at

each pixel of the detector is a Poisson-distributed random

variable nR,h,T (q) with the mean deﬁned in equation (3). This

random variable corresponds to the number of photons

registered over the exposure time T by a photon-counting

detector located on the optic axis at distance R from the

sample, having quantum efﬁciency  and effective pixel area h2, with IR;h;T ðqÞ corresponding to the local radiation ﬂux incident on the detector pixel during the exposure time. The

electron-density distribution reconstructed from this random

registered photon ﬂuence data also represents a random variable, eðrÞ ¼ ðR=reÞIiÀn1=2ðFÀ3 1UR;h;T ÞðrÞ; where the complex
amplitude, UR,h,T(q), is obtained from the measured intensity IR,h,T (q)  (h2T)À1nR,h,T (q) with the help of a suitable phase-

retrieval procedure.

We would like to determine the SNR and the spatial reso-

lution in the reconstructed electron-density distribution e(r), corresponding to SNR described by equation (4) and spatial

resolution h in the collected diffraction intensity data. We

estimate the following spatial average form of the squared

SNR (Gureyev, Kozlov et al., 2017) in the reconstructed

density distribution,

R

SNR2a½e



R

heðrÞi2dr ½h2eðrÞi À heðrÞi2dr

;

ð10Þ

where angular brackets denote the ensemble average.

First, note thaRt according toRParseval’s thReorem and equa-

tðiRo=nr(e8Þ2)I,iÀwn1eRhIaRvðeqÞ

h2eðrÞidr ¼ h dq ﬃ ðR=reÞ2

ðM2e=ðrNÞidnÞrPi ¼Mm¼h1njFR;3h;TeððqqÞmjÞ2jdÁqqim¼j,

where Nin ¼ M nin;h;T ¼ Mh2TIin is the total number of

incident photons irradiating the sample volume during the

scan, M is equal to the total number of the detector pixels

multiplied by the number of projections in the scan and the

integral of the mean intensity distribution over the scanned

area of reciprocal space has been approximated by a sum over

discrete voxels with volume |Áqm| centered at Rthe measure-

Rment points qm. jhF3eðqÞij2dq ¼

Estimation ðR=reÞ2IiÀn1

R

of the quantity j hUR;h;T ðqÞij2dq;

heðrÞi2dr appearing

¼ in

the numerator and denominator of equation (10), is more

cRomplicated technically than the evaluation of the integral h2eðrÞidr above. The corresponding mathematical details can

be found in Appendix A. Applying equation (24) from Appendix A to equation (10), we obtain

SNPR2a ½Â e  nR;h;T

ðqmÞ

À

ð1=4ÞÃÁqm

þ

P

n2R;h;T ðqmÞÁqm

m2fM1g P ð1=4Þ

Áqmþ

P

Â nR;h;T

m2fM2
ðqmÞ À

g
n2R;h;T

ðqm

ÞÃÁqm



;

m2fM1 g

m2fM2 g

ð11Þ

where M1 is the number of voxels in the subset {M1} corresponding to all data points in which the mean number of

registered photons per pixel is larger than or equal to 1/2, and

{M2} is the complementary subset corresponding to M2 voxels, where the mean number of registered photons per pixel is

smaller than 1/2.

Consider ﬁrst the case where the mean number of registered

photons per pixel is smaller than 1/2 in almost all pixels, so that M1 ( M2 ﬃ M. Then, bPecause n2R;h;T ðqmÞ<ð1=P2ÞnR;h;T ðqmÞ when nRP ;h;T ðqmÞ < 1=2, and m2fM2g nR;h;T ðqmÞ À m2fM2g n2R;h;T ðqmÞ > m2fM2g n2R;h;T ðqmÞ; it follows from equation (11) that SNR2a[e] < 1. This is clearly an undesirable case, as one would normally want to achieve a reconstruction of the electron-

density distribution with an average SNR of at least 5,

according to Rose criterion (Rose, 1948). If, on the other hand,

the vast majority of pixels contain 1/2 or more photons on

P eaqveuMmra¼at1giojeÁn, cqomr(jr1eÀ1s)p1o, ntwhdhainetgretSotNhMeR22ar(½igehMt-1haﬃ4nPMd ,Mmsit¼dh1eenniRsw;ha;eTlowðqbamtyaÞsijnÁlafqrrmgoemj=r than unity. This result represents a ‘tight’ upper bound for SNR2a[e] in CDI in the sense that

SNR2a½e

PM

4 nR;h;T ðqmÞjÁqmj

SNR2a;max½e 

m¼1
PM

À 1; ð12Þ

jÁqmj

m¼1

where the maximum value deﬁned by the right-hand side of equation (12) can be reached for certain classes of diffracted intensities. In particular, this maximum is reached when nR;h;T ðqmÞ ! 1=2 for all values of m and the reconstructed phase distribution is the same for all members of the ensemble of measured CDI scans (and hence the phase does not contribute to the variance of the complex amplitude) (see Appendix A).

4. Effects of the scanning geometry and sample scattering strength on the SNR

In the case of uniform voxel size in reciprocal space, for

example, sampling on a regular Cartesian grid, we have |Áqm| = |Áq| = VÀ1 = (MÁ3r)À1, where Ár  (V/M)1/3 is the corre-

sPpoMmn¼d1 innRg;h;sTpðaqtmiaÞljÁreqsmojlu¼tioMn Ài1nÁtÀr h3eN Ro,bjeacntdspaecqeu. aTtihoenref(o1r2e),

P becMmo¼m1 neRs;h;TSðNqÞRis2a;mthaxe½mee anﬃtota4l ðnNum=MbeÞrÀof1r, egiwstheerreed

N photons

in the diffraction images collected at all diffraction angles in

one complete three-dimensional scan of the sample. Note that

720 Timur E. Gureyev et al.  Signal-to-noise, spatial resolution and information capacity

IUCrJ (2018). 5, 716–726

research papers

ð4N=MÞ À 1 ! ð2M=MÞ À 1 ¼ 1, so that the SNR here is always larger than or equal to unity. Furthermore, when nR;h;T ðqmÞ > 1 for all m, then 4N=M > 4, and it could be possible to approximate equation (13) further as

SNR2a;max½e ﬃ 4ðN=MÞ:

ð13Þ

We will use this slightly less precise approximation below. The fact that the squared SNR in equation (13) is propor-
tional to the third power of the spatial resolution Ár  (V/M)1/3, where V  |Áq|À1 is the reconstructed volume in the object space, rather than to the fourth power, as shown previously (Howells et al., 2009), is the consequence of our (unrealistic) assumption that the voxel volume, |Áqm|, is uniform throughout the diffraction space. This would be the case if the diffraction intensity data were collected on a regular Cartesian grid qmmm&  ðmh; mh; m&hÞ in the diffraction space, where m, m and m& are integers, each spanning the set f0; 1; 2; . . . ; L À 1g, L3 = M. However, this is difﬁcult to achieve in a real CDI experiment. When the diffraction data are collected on a regular cylindrical grid, which is the case when the sample is rotated around a ﬁxed axis, similar to conventional parallel-beam computed tomography (CT), the average squared SNR is known to be proportional to the fourth power of the spatial resolution (Natterer, 1986), and is given by

SNR2a;max½e ﬃ 4N=M4=3;

ð14Þ

where  is a dimensionless constant of the order of unity, which depends on the sampling and interpolation schemes, but not on the collected diffraction intensities (numbers of photons) (Gureyev et al., 2016). Compared with equation (13), here the additional power of Ár in the expression Á4r = (V/M)4/3, appears as a consequence of the ‘ramp’ ﬁltering, arising from the multiplication of the collected diffraction intensity data nR;h;T ðqmÞ by coefﬁcients proportional to s = (2 + &2)1/2 in the reconstruction process (Gureyev et al., 2016). In turn, the presence of the ramp ﬁlter in the reconstruction process is a direct consequence of the linear non-uniformity of the elemental voxel volume as a function of the radial coordinate in the cylindrical case. Indeed, the elemental volume in cylindrical coordinates is equal to |dq| = s ds dd, assuming that the sample is rotated around the y axis (which is parallel to the  axis) during the scan (Fig. 1). This means that the higher order diffraction orders are actually being measured with lower precision (higher noise) when the detector pixels are uniform in size, because the sampling density linearly decreases as a function of the radial coordinate, s. In terms of the singular value decomposition (SVD) of the relevant reconstruction operator (which implements the inverse parallel-beam X-ray transform in three dimensions), the same effect leads to the singular values being equal to lmm ¼ ðl þ 1Þ1=2=ð4Þ, s = lh, which increase in proportion to the square root of the radial order l of the corresponding basis functions (Natterer, 1986). Such behaviour of the SVD usually results in the ampliﬁcation of noise relative to the useful signal in the collected intensity data, and hence in lower SNR in the reconstructed sample, as in equation (14), compared with

equation (13). This happens because the magnitude of a typical diffraction signal decreases as a function of |q|, and hence the relative amount of shot noise increases with |q|. Therefore, when the reconstruction ampliﬁes high-order diffraction components, relative to the low-order ones, it effectively ampliﬁes the noise with respect to the signal. This effect is demonstrated explicitly below.
Considering the case where the imaged sample is rotated in an arbitrary continuous way in three-dimensions, we note ﬁrst that in order to provide a unique reconstruction of the sample, the set of all sample orientations used during the scan must satisfy the Orlov condition (Natterer, 1986; Orlov, 1975; Defrise et al., 1993). It is easier to describe this condition by specifying that the sample is stationary, while the source and the detector are synchronously rotated around the sample (as e.g. in medical CT), instead of the equivalent real situation where the source and the detector are ﬁxed and the sample is rotated (as in synchrotron-based CDI). Let S2 be a ﬁxed sphere enclosing the sample, and p denote a vector extending from the centre of the sphere to its surface and orthogonal to the detector plane. In the continuous case, the Orlov condition states that the line È, drawn on S2 by the vector p while the detector is rotated during the scan, must intersect all great (equatorial) circles on S2 (Fig. 1). For example, when the detector is rotated by 180 around the y () axis, as in conventional parallel-beam CT, the line È simply coincides with an equatorial semicircle. The Orlov condition is obviously satisﬁed in this case, because all equatorial circles on a sphere intersect any ﬁxed equatorial semicircle. In general, when the detector is rotated arbitrarily around S2, the line È does not lie in a single two-dimensional plane. However, it is still possible to introduce curved coordinates in a three-dimensional solid sphere enclosed by S2, where the ‘rotation angle’ parameter ’ parameterizes the line È on the surface, while two other coordinates (s, ) determine a position within the plane Å() through the centre of the sphere with the normal vector pointing to È() (Fig. 1). If Orlov’s condition is satisﬁed, the plane, Å(), sweeps the whole solid sphere, while the normal vector travels along the line È. If s is parallel to the vector dp() tangential to line È at point , and  is perpendicular to s within the two-dimensional plane Å(), then the elemental three-dimensional volume in these coordinates will be the same as in the cylindrical case, i.e. |dq| = s dsd d. Therefore, in the case of optimal Shannon sampling, the SNR here will be the same as in the cylindrical case above, i.e. as in equation (14). Finally, if the rotational positions during the ‘scan’ are discrete (and can be random in the XFEL-type CDI), a sufﬁcient condition for Shannon sampling can be formulated in the following way. Mapping all rotational positions Èm of the sample as points on S2, it should be possible to draw a continuous line È through all or a subset of the points Èm in such a way that: (i) the line È satisﬁes the Orlov condition; (ii) the distance between points Èm along the line È does not exceed RÁ = 2R/L, where L2 is the total number of pixels in the detector (assuming that detector pixels are square and do not have gaps between them). The condition Á = 2/L is further discussed below.

IUCrJ (2018). 5, 716–726

Timur E. Gureyev et al.  Signal-to-noise, spatial resolution and information capacity 721

research papers

One might think that the difference between equations (13)

and (14) is artiﬁcial, as any diffraction data collected on a

cylindrical, spherical or other sufﬁciently dense and regular

grid can be readily interpolated onto a suitable Cartesian grid,

which would then lead to equation (13), rather than equation

(14). However, it is known that the corresponding interpola-

tion tends to amplify the noise in the measured data (Natterer,

1986), thus leading to a higher power of M in the denominator

of equation (14). This is also true for random orientations of

the sample, where the corresponding normal vectors p uniformly sample the whole sphere S2. According to the Orlov

condition, such sampling may be overdetermined (e.g. a

sufﬁciently dense set of points on a single equatorial semicircle

already provides optimal sampling). Therefore, the behaviour

of the SNR will be expected to depend on the interpolation

scheme employed for remapping the sampling points from the

original scan grid points to a regular grid used in the recon-

struction. Some methods may actually skip this remapping

step and utilize the original grid points directly (Elser, 2009),

but the stability of the method, and hence the SNR in the

reconstructed electron-density distribution, will still inevitably

depend on the geometry of the sampling grid, as demonstrated

on a fundamental level by the behaviour of the singular values

of the X-ray transform (Natterer, 1986). An estimate of the

number of CDI projections required to provide Shannon’s

sampling, in the case of random orientations of the sample

uniformly distributed on a sphere, was given in Ekeberg et al.

(2015). This number is consistent with the Orlov condition and

the optimal angular sampling requirement in CT (Natterer,

1986), as discussed below.

Let us make the above arguments more precise by explicitly

calculating the SNR in the case of cylindrical sampling of

reciprocal space. Here we have jÁqmj ¼ slÁs Á Á ¼ lh3ð=LÞ; where sl = (l À 1)h, Ás = Á = h, Á ¼ =L, m ¼ ðl; m; mÞ, l ¼ 1; 2; . . . ; L=2, m ¼ 1; 2; . . . ; L, m ¼ 1; 2; . . . ; L, L is the number of rotational positions (i.e. the number of projections) in the scan, L2 is the number of pixels
in the detector, so that LL2=2 ¼ M is the total number of
data points in the scan. It is known (Natterer, 1986) that the

optimal (Shannon) sampling is achieved when L ¼ L=2. The corresponding number of diffraction patterns, (/2)L,

also agrees well with the estimate given for the XFEL-type CDI

case in the work by Ekeberg et al. (2015). Assuming optimal

|ﬃwsÁahmq2ehmpre3|liLn=ÀNg1cl2Po(ln/LlLd¼P=1i2)thilLmoP 3n.¼s1ALm,Pws¼e1LmaPh¼ca1oLmvnne¼sRÁe1;hqn;TuRð=;ehqn;T2mc/ðÞeLq, ,miPsMÞ =Mmt=h¼e2(1hn/3mR4L;)ehÀL;aT13nðPqﬃmnLlÞ¼Lu=j12Ám3laqbNnmedlrj,

of sl.

pShimotiolanrsly,coPlleMmc¼te1djÁiqnm

the j=

c2yhl3inLdÀr1icPalLl¼=s12hlePll Lmw¼it1hPrLmad¼i1u1s

ﬃ 2h3LÀ1ðL=2Þ4, when L/2 ) 1. Substituting these expres-

sions into equation (12), we ﬁnd that, in the case of cylindrical

sampling of the diffraction space, the maximum SNR achiev-

able in CDI under conditions deﬁned at the end of Section 3,

when nR;h;T ðqmÞ > 1 and the reconstructed phase is the same or all members of the ensemble of intensity measurements, is

equal to

X L=2

SNR2a;max½e ﬃ 16MÀ4=3 l Nl:

ð15Þ

l¼1

Let us consider two extreme cases. (i) ‘Sharply peaked samples’ with a spatial distribution of
electron density consisting of one or several very narrow peaks. For such samples, the distribution of diffracted intensity iNs la¼lmPostLmﬂ¼a1tP(sLmpa¼t1ianllRy;h;uTnðiqfomrÞm¼),ðn=R2;hÞ;TðNðq=mMÞ ÞﬃL2Na=nMd P¼Ll¼c=12olnNst,l ¼ ð=8ÞðN=MÞL3ðL=2 þ 1Þ ﬃ NL=4: Substituting this into equation (15), we see that SNR2a;max½e is described by equation (13), which was obtained earlier for arbitrary samples and uniform Cartesian sampling of the diffraction data. In particular, here SNR2a, max[e] is also proportional to the third power of the spatial resolution, Á3r = V/M. The cylindrical non-uniform sampling does not reduce SNR in this case compared with the uniform Cartesian sampling, because the ramp ﬁlter, involving multiplication by l in the discrete form, affects the noise and the signal equally.
(ii) ‘Spatially ﬂat’ samples with ‘slowly varying’ electrondensity distributions which produce sharply peaked distributions of diffracted intensity. Let us assume that the dominant cpthorionsvtrciidabesuedt,ibowynetthhoeatvﬁheresP ttortaLla¼d=l12imalNleoal rnﬃdneNru,m1suﬃbcehrNto.hfSartuebNgsis1tti)teurteiPdngpLl¼h=t22holitNsoniln.sItions equation (15), we arrive at SNR2a;max½e ﬃ 16N=M4=3, in agreement with equation (14) with  = 4. Cylindrical nonuniform sampling does decrease SNR in this case, because the ramp ﬁlter ampliﬁes the noise in the higher diffraction orders much more strongly than the signal which predominantly comes from the ﬁrst diffraction order.
It is logical to conclude that any real sample will belong somewhere in the range between the extremely sharp sample case (i) and the extremely ﬂat sample case (ii) and, as a consequence, the squared SNR in the electron-density distribution reconstructed from CDI data collected from such a sample will satisfy the inequality 4N=M4=3 SNR2a;max½e
4N=M: Note that the above results have been obtained with respect to the spatially averaged signal and noise variance in the reconstructed data. However, as for a typical sample, much fewer photons are scattered to high diffraction angles compared to small angles, the SNR in the high-order spatial frequencies of the reconstructed electron density is likely to be much lower compared with the SNR in the low-order spatial frequencies (except for very low-order frequencies, for which the diffraction data may not be registered at all, as it is masked by the unscattered transmitted beam and is blocked from the detector in a typical CDI experiment). In order to evaluate a true spatial resolution in the reconstructed sample, it may be necessary to estimate the SNR in the reconstructed high-order spatial frequencies. A relevant estimate can be readily obtained similarly to equation (12), in view of the one-to-one correspondence between the diffraction-intensity data collected at a particular q value and the spatial frequency of the same order in the reconstructed electron density according

722 Timur E. Gureyev et al.  Signal-to-noise, spatial resolution and information capacity

IUCrJ (2018). 5, 716–726

research papers

to equation (8). One only needs to replace the mean number of photons registered during the scan in all pixels by the corresponding mean number of photons registered in the pixels within the required range of q values. In particular, we can estimate the SNR in Fourier harmonics of radial order l of the reconstructed electron density. The following relationship can be derived similarly to equation (15):

SNR2l;max½e ﬃ 8Nl=ðL2Þ:

ð16Þ

Consider, for example, the case of rapidly decreasing diffrac-

tion intensity, Nl ¼ lÀC, where 2 <  < 1 and C is a

cNon¼stP antLl¼.=12TNhle¼tCotaPl mLl¼=e12alnÀ

number of ﬃ CðÞ;

photons when L/2

is )

equal to 1, where

() is the Riemann zeta function. This allows us to

approximate C ﬃ N=ðÞ. Then at l = L/2 we obtain NL=2 ﬃ ðL=2ÞÀ C ﬃ ðL=2ÞÀ N=ðÞ and SNR2L=2;max½e ﬃ 23þ½ðÞÀ1N=Mð2þÞ=3: In a model case with  = 4, this gives

SNR2L=2;max½e ﬃ 38N=M2. The last equation indicates that in order to maintain a ﬁxed SNR in the highest radial order of

spatial frequencies of the reconstructed electron density, it is

necessary in this case to increase the total number of regis-

tered scattered photons in proportion to the sixth power of the spatial resolution, Á6r = (V/M)2. This is a very demanding
requirement indeed, making the high-resolution CDI imaging

rather challenging in this case and calling for the use of high-

intensity X-ray sources, such as XFELs.

At the other extreme, when the diffraction intensity is ﬂat,

nR;h;T ðqmÞ ﬃ N=M ¼ const, we have previously calculated
that Nl ¼ ð=2ÞN=L for any l. Substituting this into equation (16) with l = L/2, we obtain SNR2L=2;max½e ﬃ 4N=M. This
result coincides with equation (13) as expected, because, in the

case of a ﬂat intensity, the SNR of any spatial Fourier

frequency coincides with the average SNR. Consequently, in

this case, in order to maintain a ﬁxed SNR in the highest

reconstructed Fourier frequencies, the number of scattered

photons N should be proportional to the third power of spatial

resolution, Á3r = V/M.

5. Imaging quality characteristic and information capacity of CDI

Let us consider further the case corresponding to equation (13), where SNR reaches the maximum possible value for CDI at a given radiation dose (which corresponds to the mean total number of diffracted photons N) and a given spatial resolution [which corresponds to the total number of voxels M, with the spatial resolution Ár  (V/M)1/3]. The three-dimensional reconstructive imaging quality characteristic of such a CDI system is equal to

QS;a;max ½e 



SNRa;max½e F~ i1n=2Á3r=2

ﬃ

2ðN=MÞ1=2 ðNin =V Þ1=2 Á3r =2

¼

2ðN=NinÞ1=2;

ð17Þ

where F˜ in = Nin/V is the uniform three-dimensional incident photon ﬂuence (number of photons per unit volume in the

sample space, accumulated during the whole threedimensional scan). The quantity Æ  N=Nin represents the scattering power of the imaged sample. Equation (17) is a remarkable result, given that it has been previously proven that for intensity-linear imaging systems the (two-dimensional, direct) imaging quality characteristic cannot exceed Æ1/2 (Gureyev et al., 2016). This is also the case in equation (7) above. The extra factor of 2 in equation (17) can be traced back to the factor of 4 in the numerator of equation (12), which in turn appeared as a consequence of the statistics of the denominator of equation (10) in the most favourable case, i.e. when the noise in the collected CDI data had Poisson statistics, the mean number of photons in each pixel was larger than or equal to 1/2, and the reconstructed phase distribution in each two-dimensional diffraction image was the same for all members of the statistical ensemble. Ultimately, this effect is the consequence of the quadratic dependence of the registered diffraction intensities on the electron density in the sample, as described by equation (5). When the registered intensity is Poisson-distributed, the reconstructed electron density behaves as a square root of a Poisson-distributed random variable, and hence the ratio of the squared mean electron density to its variance is approximately equal to n=ð1=4Þ ¼ 4n, when n > 1=2, as shown in Appendix A. For comparison, when measured intensities linearly depend on the electron density, as in the model case considered by Gureyev et al. (2016), the ratio of the squared mean to the variance is equal to n2=n ¼ n, which is four times smaller than in the ‘quadratic case’. Note however, that the actual value of the imaging quality characteristic in equation (17) is always small, as N=Nin ( 1 in accordance with the validity conditions of the ﬁrst Born approximation used in the derivation of equation (17).
In cases where the SNR is proportional to the fourth power of the spatial resolution, as in equation (14), the imaging quality characteristic is equal to

QS;a;max½e



SNRa;max½e F~ i1n=2Á3r=2

ﬃ

2N 1=2 M À2=3 Ni1n=2 M À1=2

¼ 2ðN=NinÞ1=2MÀ1=6:

ð18Þ

Therefore, in this case, the imaging quality characteristic decreases as a function of the number of resolution voxels. This is a direct consequence of the relative ampliﬁcation of noise with respect to the useful signal in the case when both the sampling density and the number of scattered photons are decreasing as a function of the radial coordinate in reciprocal space.
The Shannon information capacity of an imaging system with M voxels and average SNR 2ðN=MÞ1=2 > 1, is equal to

DðM; NÞ ’ 0:5M½log2ð4N=MÞ þ oð1Þ;

ð19Þ

where the term o(1) is much smaller than unity when the ratio N=M is large (Shannon, 1949; Cox & Sheppard, 1986; Gureyev et al., 2016). This result indicates that a CDI system with M pixels, each one collecting more than one photon on average and N photons in total across all the pixels used in a scan, is

IUCrJ (2018). 5, 716–726

Timur E. Gureyev et al.  Signal-to-noise, spatial resolution and information capacity 723

research papers

capable of distinguishing between approximately ð4N=MÞM=2 different samples, where each sample is represented by its electron-density values in M distinct voxels of equal size. In the case of communication systems, the same number represents the total of different messages that can be encoded by a system with a given number of channels and a given SNR (Shannon, 1949). Using the analogy with communication systems for the case of CDI, we state that the average SNR, 2ðN=MÞ1=2 is approximately equal to the number of different levels of electron density that can be distinguished at each one of M voxels in the reconstructed sample, in the presence of Poisson photon shot noise in the registered diffraction intensities. Thus, we have a simple description of the maximal set of distinct objects that can be reconstructed from the data collected by a CDI system using Nin ¼ N=Æ incident photons: each such object is represented by one of P  2ðN=MÞ1=2 possible electron-density levels in each of M independent ‘resolution voxels’ within volume V in the object space.
6. Conclusions
We have derived simple approximate expressions for the average SNR, intrinsic imaging quality and Shannon’s information capacity of CDI systems in terms of the total number of scattered photons collected in a three-dimensional scan and the number of resolution voxels in the reconstructed volume. We found that, at a ﬁxed radiation dose delivered to the sample, the SNR may be proportional to the third or fourth power of the spatial resolution, depending primarily on the scattering characteristics of the sample. These results can help to estimate the upper bounds on the SNR of the electron density that can be achieved in CDI experiments if the phases and particle orientation are accurately determined. Such bounds are expected to be useful for the design of future XFEL experiments, especially when they are pushed to smaller particles or single protein molecules that scatter very weakly.
In the present study, we have only taken into account the noise in the CDI data which appears as a result of photon counting statistics in an ideal detector. Critical factors contributing to noise in experimental CDI data, such as sample damage during the exposure, ﬂuctuations of the incident radiation between different exposures and variability in the sample conﬁgurations, have not been taken into account here. Discussions of the role of these factors in CDI experiments can be found in the previously cited publications (see e.g. Chapman et al., 2011; Quiney & Nugent, 2011; Martin et al., 2015; Miao et al., 2015). However, a further analysis of the effect of these factors on SNR and spatial resolution in the reconstructed samples, using the approach taken in the present paper, may still be of interest. We believe that such analysis could potentially provide some new insights into these important problems and contribute to simpliﬁed guidelines for the planning of future XFEL experiments. We plan to obtain and present the relevant results in a related subsequent publication.

APPENDIX A Expectation value of the square root of Poissondistributed variable

In this Appendix we derive a sharp upper bound for the

expression in the numerator of equation (10).

First, we consider the expectation value of the square

ÂrooPt 1 n¼o0fn1t=h2ðen value, f 2ðnÞ ¼

Poisson nÀ=nn1=!2Þ,Á2anadt

distribution, f ðnÞ  n1=2 ¼ expðÀnÞ ﬁnd an approximation for its square any n.

Following the suggestions at Mathematics StackExchange

(2018), we can derive analytical approximations for the

expectation value

Z n1=2  x1=2pðxÞ dx;

X 1 nn

pðxÞ ¼ expðÀnÞ

ðx À nÞ;

ð20Þ

n¼0 n!

when n ) 1 and n ( 1. In the ﬁrst case, we expand the function g(x) = x1/2 into the Taylor series around the point x ¼ n; gðxÞ ¼ n1=2 þ ½ðx À nÞ=2n1=2 À ½ðx À nÞ2=8n3=2 þ O½ðx À nÞ3=n5=2, when n ! 1. Substituting this into equation
(20), we obtain

n1=2 ¼ n1=2 À ð1=8ÞnÀ1=2 þ OðnÀ3=2Þ; when n ! 1; ð21Þ and hence Àn1=2Á2 ﬃ n À ð1=4Þ, when n ) 1.
When n ( 1, we can approximate expðÀnÞ ¼ 1À nþOðn2Þ, when n ! 0, and substitute this into the expression for p(x)
in equation (20),

pðxÞ ¼ ½1 À n þ Oðn2Þ½ðxÞ þ nðx À 1Þ þ ðn2=2Þðx À 2Þ þ Oðn3Þ
¼ ½1 À n þ Oðn2ÞðxÞ þ ðn À n2Þðx À 1Þ þ ðn2=2Þðx À 2Þ þ Oðn3Þ; n ! 0:

Therefore,
n1=2 ¼ n À n2½1 À ð2Þ1=2=2 þ Oðn3Þ; when n ! 0; ð22Þ and hence Àn1=2Á2 ﬃ n2, when n ( 1.

Figure 2 Numerically calculated values of f ðnÞ ¼ n1=2 as a function of n (triangles), and the corresponding asymptotes, f0ðnÞ ¼ n (dotted line) and f1ðnÞ ¼ n1=2 (dashed line), all plotted on a log–log scale.

724 Timur E. Gureyev et al.  Signal-to-noise, spatial resolution and information capacity

IUCrJ (2018). 5, 716–726

research papers

Figure 3 Numerically calculated values of the relative errors "0ðnÞ  n=n1=2 À 1 (dotted line) and "1ðnÞ  n1=2=n1=2 À 1 (dashed line) as a function of n, plotted on a log–log scale.

Let us now estimate the error between the asymptotic

approximations equations (21) and (22) and the exact value of

n1=2 for different values of n. Fig. 2 shows a comparison

between the numerically calculated values tion of n, i.e. the function f ðnÞ  expðÀnÞ

oPf 1 nn¼1=02n, 1a=s2

a funcðnn=n!Þ,

and the corresponding asymptotes, f0ðnÞ  n and f1ðnÞ  n1=2.

It is easy to see from Fig. 2 that the two asymptotes

approximate the function f ðnÞ quite well, not just when n ( 1

and n ) 1, but also when n 1 and n ! 1, respectively. In

order to estimate the accuracy of these approximations, we

calculated numerically the values of the function f ðnÞ ¼ n1=2 in

the range 0.001 n 100, and then evaluated the relative errors "0ðnÞ  n=n1=2 À 1 and "1ðnÞ  n1=2=n1=2 À 1 within the same range. The graphs of these error functions are shown in

Fig. 3.

The numerical estimates also show that the difference

between the approximation

&

fa2ðnÞ ¼

n2; if n < 1=2 n À 1=4; if n ! 1=2

ð23Þ

and the exact function f 2ðnÞ ¼ Àn1=2Á2, does not exceed 0.17,

while the relative error does not exceed 0.35, for any n.

Now consider the square modulus of the ensemble average

joJfÀ1aPcJj¼o1mjUpjljeexxprðain’djÞoj2m.

variable We can

U¼ apply

jUj expði’Þ, jhUij2 = the Cauchy–Schwarz

inequality ÂthPe Jj¼l1ajsUt j

with the factors expression and

|Uj|1/2 obtain

and jhU

ijjU2 jj1=2JeÀx2PpðiJj’¼1jÞjUtojj

jj expði’jÞj2 ¼ hjUji2R: Using this ineRquality, we then

¼¼arrðiðRvRe==rraeetÞÞ22tðIhMiÀne1=fRNoljinlhoÞUwPRin;Mmhg;¼T1rðehqnsÞu1Ri=j;l22ht;d,TqðqhmÞeiðð2rRjÞÁi=2rqdemrÞ2j¼:IiÀnI1t

Rj

hF3eðqÞij2 hIR1=;h2;T ðqÞi2

dq dq

is easy to see

that if the phases ’j are the same for all j, then |hUi|2 = h|U|i2; in

this case the last inequality for the integral of the square of the

mean electron density also becomes an equality.

We can now the function f 2

ðunsÞe¼thÀen1a=p2Áp2rotoxiombattaiionn

from

equation

(23)

for

Z

heðrÞi2dr

ðR=reÞ2ðM=NinÞ

&X

Â

½nR;h;T ðqmÞ À ð1=4ÞjÁqmj

m2fM1 g
X

'

þ

n2R;h;T ðqmÞjÁqmj ;

ð24Þ

m2fM2 g

where M1 is the number of elements in the subset {M1} consisting of all data points from one scan in which the mean number of registered photons per pixel is larger than or equal to 1/2, and {M2} represents the complementary subset consisting of M2 data points where the mean number of registered photons per pixel is smaller than 1/2.

APPENDIX B List of the main symbols used in the paper
A, diameter of the sample. F3f, three-dimensional Fourier transform of f. Fin, uniform incident photon ﬂuence (number of detected photons per unit area). F˜ in, uniform three-dimensional incident photon ﬂuence (number of photons per unit volume). h, detector pixel size. Iin, spatially uniform incident intensity. IR, average intensity in the image plane z = R. IR,h,T, intensity measured over time T in a pixel of size h located in the plane z = R. L, square root of the total number of pixels in the detector. L, number of rotational positions (i.e. the number of projections) in the scan. M, total number of resolution voxels in the reconstructed sample. nR,h,T, number of photons detected over time T within area h2 in the plane z = R. N, total number of photons collected at all diffraction angles in one complete three-dimensional scan. p, vector normal to the detector plane. q = (, , &), Cartesian coordinates in the diffraction space. q = (s, , ), cylindrical coordinates in the diffraction space. re, classical electron radius. r = (x, y, z), Cartesian coordinates in the object space. R, distance between the sample and the detector. s = (2 + &2)1/2, cylindrical radial coordinate in the diffraction space. SNRa[e], spatially averaged signal-to-noise ratio in the reconstructed electron density. T, exposure time. U ¼ I1=2 exp½i’, complex wave amplitude. VR,h,T, variance of IR,h,T. V, reconstructed volume. Ár, spatial resolution in the reconstructed sample. Áqm, discrete voxel centered at the measurement point with index m. , quantum efﬁciency of the detector. , radiation wavelength.

IUCrJ (2018). 5, 716–726

Timur E. Gureyev et al.  Signal-to-noise, spatial resolution and information capacity 725

research papers

, cylindrical angular coordinate in the diffraction space. È, curve drawn by the end of normal vector p while the sample is rotated. ’, phase of an electromagnetic wave. e, electron-density distribution in the sample. Æ, scattering power of the sample.
Acknowledgements
TEG would like to thank Dr Frank de Hoog for helpful discussions of mathematical issues relevant to the present paper.
References
Bergh, M., Huldt, G., Tıˆmneanu, N., Maia, F. R. N. C. & Hajdu, J. (2008). Q. Rev. Biophys. 41, 181–204.
Chapman, H. N., Barty, A., Marchesini, S., Noy, A., Hau-Riege, S. P., Cui, C., Howells, M. R., Rosen, R., He, H., Spence, J. C. H., Weierstall, U., Beetz, T., Jacobsen, C. & Shapiro, D. (2006). J. Opt. Soc. Am. A, 23, 1179–1200.
Chapman, H. N., Fromme, P., Barty, A., White, T. A., Kirian, R. A., Aquila, A., Hunter, M. S., Schulz, J., DePonte, D. P., Weierstall, U. R., Doak, B., Maia, F. R. N. C., Martin, A. V., Schlichting, I., Lomb, L., Coppola, N., Shoeman, R. L., Epp, S. W., Hartmann, R., Rolles, D., Rudenko, A., Foucar, L., Kimmel, N., Weidenspointner, G., Holl, P., Liang, M., Barthelmess, M., Caleman, C., Boutet, S., Bogan, M. J., Krzywinski, J., Bostedt, C., Bajt, S., Gumprecht, L., Rudek, B., Erk, B., Schmidt, C., Ho¨ mke, A., Reich, C., Pietschner, D., Stru¨ der, L., Hauser, G., Gorke, H., Ullrich, J., Herrmann, S., Schaller, G., Schopper, F., Soltau, H., Ku¨ hnel, K.-U., Messerschmidt, M., Bozek, J. D., Hau-Riege, S. P., Frank, M., Hampton, C. Y., Sierra, R. G., Starodub, D., Williams, G. J., Hajdu, J., Timneanu, N., Seibert, M. M., Andreasson, J., Rocker, A., Jo¨ nsson, O., Svenda, M., Stern, S., Nass, K., Andritschke, R., Schro¨ ter, C.-D., Krasniqi, F., Bott, M., Schmidt, K. E., Wang, X., Grotjohann, I., Holton, J. M., Barends, T. R. M., Neutze, R., Marchesini, S., Fromme, R., Schorb, S., Rupp, D., Adolph, M., Gorkhover, T., Andersson, I., Hirsemann, H., Potdevin, G., Graafsma, H., Nilsson, B. & Spence, J. C. H. (2011). Nature, 470, 73–77.
Cowley, J. M. (1995). Diffraction Physics. Amsterdam: Elsevier. Cox, I. J. & Sheppard, C. J. R. (1986). J. Opt. Soc. Am. A, 3, 1152–
1158. Defrise, M., Clack, R. & Townsend, D. (1993). J. Opt. Soc. Am. A, 10,
869–877. Dilanian, R. A., Williams, G. J., Whitehead, L. W., Vine, D. J., Peele,
A. G., Balaur, E., McNulty, I., Quiney, H. M. & Nugent, K. A. (2010). New J. Phys. 12, 093042. Ekeberg, T., Svenda, M., Abergel, C., Maia, F. R. N. C., Seltzer, V., Claverie, J.-M., Hantke, M., Jo¨ nsson, O., Nettelblad, C., van der Schot, G., Liang, M., DePonte, D. P., Barty, A., Seibert, M. M., Iwan, B., Andersson, I., Loh, D., Martin, A. V., Chapman, H., Bostedt, C., Bozek, J. D., Ferguson, K. R., Krzywinski, J., Epp, S. W., Rolles, D., Rudenko, A., Hartmann, R., Kimmel, N. & Hajdu, J. (2015). Phys. Rev. Lett. 114, 098102. Elser, V. (2009). IEEE Trans. Inf. Theory, 55, 4715–4722. Giannakis, D., Schwander, P. & Ourmazd, A. (2012). Opt. Express, 20, 12799–12826.

Goodman, J. W. (1985). Statistical Optics. Hoboken: Wiley. Gureyev, T. E., Kozlov, A., Nesterets, Ya. I., Paganin, D. M. & Quiney,
H. M. (2017). Sci. Rep. 7, 4542. Gureyev, T. E., Nesterets, Ya. I. & de Hoog, F. (2016). Opt. Express,
24, 17168–17182. Gureyev, T. E., Nesterets, Ya. I., de Hoog, F., Schmalz, G., Mayo, S. C.,
Mohammadi, S. & Tromba, G. (2014). Opt. Express, 22, 9087–9094. Gureyev, T. E., Nesterets, Ya. I., Kozlov, A., Paganin, D. M. & Quiney,
H. M. (2017). J. Opt. Soc. Am. A, 34, 2251–2260. Howells, M. R., Beetz, T., Chapman, H. N., Cui, C., Holton, J. M.,
Jacobsen, C. J., Kirz, J., Lima, E., Marchesini, S., Miao, H., Sayre, D., Shapiro, D. A., Spence, J. C. H. & Starodub, D. (2009). J. Electron Spectrosc. Relat. Phenom. 170, 4–12. Kirian, R. A., Schmidt, K. E., Wang, X., Doak, R. B. & Spence, J. C. H. (2011). Phys. Rev. E, 84, 011921. Loh, N., Eisebitt, S., Flewett, S. & Elser, V. (2010). Phys. Rev. E, 82, 061128. Loh, N. & Elser, V. (2009). Phys. Rev. E, 80, 026705. Mandel, L. & Wolf, E. (1995). Optical Coherence and Quantum Optics. Cambridge University Press. Marchesini, S., Chapman, H. N., Hau-Riege, S. P., London, R. A., Szoke, A., He, H., Howells, M. R., Padmore, H., Rosen, R., Spence, J. C. H. & Weierstall, U. (2003). Opt. Express, 11, 2344–2353. Martin, A. V., Corso, J. K., Caleman, C., Timneanu, N. & Quiney, H. M. (2015). IUCrJ, 2, 661–674. Martin, A. V., Wang, F., Loh, N. D., Ekeberg, T., Maia, F. R. N. C., Hantke, M., van der Schot, G., Hampton, C. Y., Sierra, R. G., Aquila, A., Bajt, S., Barthelmess, M., Bostedt, C., Bozek, J. D., Coppola, N., Epp, S. W., Erk, B., Fleckenstein, H., Foucar, L., Frank, M., Graafsma, H., Gumprecht, L., Hartmann, A., Hartmann, R., Hauser, G., Hirsemann, H., Holl, P., Kassemeyer, S., Kimmel, N., Liang, M., Lomb, L., Marchesini, S., Nass, K., Pedersoli, E., Reich, C., Rolles, D., Rudek, B., Rudenko, A., Schulz, J., Shoeman, R. L., Soltau, H., Starodub, D., Steinbrener, J., Stellato, F., Stru¨ der, L., Ullrich, J., Weidenspointner, G., White, T. A., Wunderer, C. B., Barty, A., Schlichting, I., Bogan, M. J. & Chapman, H. N. (2012). Opt. Express, 20, 16650–16661. Mathematics StackExchange (2018). Probability – Expected Value of Square Root of Poisson Random Variable, https://Math. stackexchange.com/questions/1536459/expected-value-of-squareroot-of-poisson-random-variable. Miao, J., Ishikawa, T., Robinson, I. K. & Murnane, M. M. (2015). Science, 348, 6234. Natterer, F. (1986). The Mathematics of Computerized Tomography. Verlag: Vieweg & Teubner. Orlov, S. S. (1975). Sov. Phys. Crystallogr. 20, 312–314. Philipp, H. T., Ayyer, K., Tate, M. W., Elser, V. & Gruner, S. M. (2012). Opt. Express, 20, 13129–13137. Quiney, H. M. & Nugent, K. A. (2011). Nat. Phys. 7, 142– 146. Robinson, I. K., Vartanyants, I. A., Williams, G. J., Pfeifer, M. A. & Pitney, J. A. (2001). Phys. Rev. Lett. 87, 195505. Rose, A. (1948). J. Opt. Soc. Am. 38, 196–208. Sayre, D., Chapman, H. N. & Miao, J. (1998). Acta Cryst. A54, 232– 239. Shannon, C. (1949). Proc. Inst. Radio Eng. 37, 10–21. Tegze, M. & Bortel, G. (2012). J. Struct. Biol. 179, 41–45. Williams, G., Pfeifer, M., Vartanyants, I. & Robinson, I. (2007). Acta Cryst. A63, 36–42.

726 Timur E. Gureyev et al.  Signal-to-noise, spatial resolution and information capacity

IUCrJ (2018). 5, 716–726

