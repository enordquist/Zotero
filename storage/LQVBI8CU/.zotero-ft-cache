A unified formulation of the constant temperature molecular dynamics methods
Cite as: J. Chem. Phys. 81, 511 (1984); https://doi.org/10.1063/1.447334 Submitted: 17 November 1983 • Accepted: 15 March 1984 • Published Online: 31 August 1998 Shuichi Nosé
ARTICLES YOU MAY BE INTERESTED IN Density-functional thermochemistry. III. The role of exact exchange The Journal of Chemical Physics 98, 5648 (1993); https://doi.org/10.1063/1.464913 Studies in Molecular Dynamics. I. General Method The Journal of Chemical Physics 31, 459 (1959); https://doi.org/10.1063/1.1730376 Commentary: The Materials Project: A materials genome approach to accelerating materials innovation APL Materials 1, 011002 (2013); https://doi.org/10.1063/1.4812323

J. Chem. Phys. 81, 511 (1984); https://doi.org/10.1063/1.447334 © 1984 American Institute of Physics.

81, 511

A unified formulation of the constant temperature molecular dynamics methods
Shuichi Nosea) Division o/Chemistry. National Research Councilo/Canada. Ottawa. Ontario. Canada. K1A OR6
(Received 17 November 1983; accepted 15 March 1984)
Three recently proposed constant temperature molecular dynamics methods by: (i) Nose (Mol. Phys., to be published); (ii) Hoover et al. [Phys. Rev. Lett. 48, 1818 (1982)], and Evans and Morriss [Chem. Phys. 77, 63 (1983)]; and (iii) Haile and Gupta [J. Chem. Phys. 79, 3067 (1983)] are examined analytically via calculating the equilibrium distribution functions and comparing them with that ofthe canonical ensemble. Except for effects due to momentum and angular momentum conservation, method (i) yields the rigorous canonical distribution in both momentum and coordinate space. Method (ii) can be made rigorous in coordinate space, and can be derived from method (i) by imposing a specific constraint. Method (iii) is not rigorous and gives a deviation of order N -1/2 from the canonical distribution (N the number of particles). The results for the constant temperature-constant pressure ensemble are similar to the canonical ensemble case.

I. INTRODUCTION

Recently, the extension of molecular dynamics (MD)

methods to treat ensembles other than the traditional micro-

canonical ensemble has attracted considerable attention.

The constant pressure MD method, first introduced by

Andersen I and subsequently extended by Parrinello and Rahman2-4 to allow for changes of the MD cell shape, has

demonstrated its usefulness in applications to structural changes in the solid state.2-9 Recently, Heyes lO employed a

similar approach to that of Anderson but used real variables

instead

of

the

scaled

variables.

l
-4

A

constant

pressure

MD

method based on nonequilibrium MD technique was also

proposed by Hoover et al. II

Several constant temperature MD methods have been

proposed. The purpose of the present article is to examine

and compare these methods and to establish a unified for-

malism for their derivation. Emphasis is placed on the static

properties and on the equilibrium distribution function.

The earliest method for the constant temperature MD

is a momentum scaling procedure, in which the velocities of

the particles are scaled at each time step to maintain the total

kinetic energy at a constant value. 12 This method has been

used without demonstrated justification. Haile and Gupta13

discussed how to add the constraint ofconstant kinetic ener-

gy to the equations of motion. As a special case, they pro-

posed a constraint method based on a momentum scaling

procedure. This is a refinement of the earlier method. It will

be shown in Sec. III C that the equilibrium distribution func-

tion in the momentum scaling method deviates from the ca-

nonical distribution by order N - 1/2 (N the number of parti-

cles). Andersonl proposed a hybrid ofMD and Monte Carlo

methods. In his approach, the particles change their veloc-

ities by stochastic collisions. The distribution of the veloc-

ities of the particles that collided is chosen to reproduce the

canonical ensemble. Because of the sudden change of the

velocities by collisions, the trajectory in the phase space is

discontinuous.

-) Present address: Department of Physics. Faculty ofScience and Technol· ogy, Keio University, 3-14-\ Hiyoshi, Kohoku-ku, Yokohama 223. Japan.

Hoover

et

al.

14 •

15

and

Evans l6

proposed

a

constraint

MD method which was derived from a nonequilibrium MD formulation. 17.18 This method will be called the HLME

method hereafter. In this method, an additional term - aPi is added to
the force term in Eq. (1.2) (qi> coordinate; Pi> momentum of particle i),

-ddqti

=

p./m.,

I

I

(Ll)

dpi

ar/J

-= ---ap·.

(1.2)

dt

aqi

I

Consequently, the equations are no longer in a canonical

form. The parameter a is determined from the requirement

that the total kinetic energy is constant,

(1.3)

or

+-~p.d-p/i m.=O. I dt I

(1.4)

Thus, we get

(1.5)

This method can produce the canonical distribution in coordinate space if we set g = 3N - 1, where N is the number of
particles (in the original papers14.16g = 3N). Further, in Sec.
III B, it will be shown that the HLME equations are derived from the extended system (ES) method 19 by imposing a particular constraint.
The extended system method by Nosel9 introduced an additional degree of freedom s, which acts as an external system for the physical system ofN particles. Ifwe choose an appropriate potential gkT In s, for the variable s, the equilibrium distribution function, projected onto the physical system from the extended system of the particles and the variable s, is exactly that of the canonical ensemble. The parameter g is an integer, essentially equal to the number of degrees of freedom in the physical system, but the exact value depends on the particular procedure.

J. Chern. Phys. 81 (1). 1 July 1984

0021-9606/84/130511-09$02.10

© 1984 American Institute of Physics

511

512

Shuichi Nose: Constant temperature molecular dynamics

In the present article, the basic formalism is that of the extended system method and other methods are analyzed in this formulation. The details of the ES method are given in Sec. II. The equations of motion of the ES method with a constraint and the derivation of the HLME method are given in Sec. III. Extension to the constant temperature-constant pressure (TP) ensemble is discussed in Sec. IV. The method by Evans and Morriss 18 is derived from the ES methOd l9 in a similar fashion as for the canonical ensemble case. Most of the discussion is exact only if we ignore the momentum and the angular momentum conservation laws. The correction for the momentum conservation as well as other comments are given in Sec. V.
II. THE EXTENDED SYSTEM METHOD

A. A virtual variable formulation

We start from a method which seems to be most convenient to obtain the equilibrium distribution function. In the ES method,19 an additional degree of freedom s is introduced which acts as an external system on the physical sys-
tem ofN particles, with coordinates q;, masses m; and poten-
tial energy rp (q'). We also introduce virtual variables
(coordinate q;. momentum Pi' and time t) which are related to the real variables (q;,p; ,t ') by

q; = q;.

(2.1)

P; = p;ls,

(2.2)

t' = r~t.

(2.3)

The real velocity (dq;I dt ;) is also expressed via a scaled form in the virtual variable formulation

dq; dq; dqi

-=S-=S-.

(2.4)

dt' dt dt

Thus, a simple interpretation of these transformations is scaling the time by dt' = dt Is. This is similar to scaling the coordinates in the constant pressure MD method. 1-4

The Hamiltonian ofthe extended system ofthe particles and the variable s in terms of the virtual variables is postulat-

ed as

H = ~)7/2mis2 + rp (q) + p;/2Q + gkT In s, (2.5)
i
Ps is the conjugate momentum of s; Q is a parameter of.dimension energy·(time)2 and behaves as a mass for the motion
otufrs~·;k tihseBpoaltrzammaentenr'sgcoisnsetsasnentt; ~Tallthy eeeqxutaelrnt oalltyhesent utemm?peerrao-f
degrees of freedom of the phYSIcal system. However, ItS exact value will be chosen to satisfy the canonical distribution exactly at equilibrium. As we will discuss later, a logarithmic dependence of the potential on the variable s, gkT In s, is essential for producing the canonical ensemble.
We assume the Hamiltonian formalism can be applied to Eq. (2.5) with the virtual variables. The equations ofmotion are

(2.6)

dpi = _ aH_

dt

aqi

-ddst

-_

aH
aps

-_PIsQ'

dps = _ aH = (2)7Imis2 _ gkT)IS.

dt

as

i

In Lagrangian form, these are

:t(mis2:~i) = - ::

or

(2.7)
(2.8)
(2.9)
(2.10)

s dt dt

(2.11)

and

dS !!...(Q ) =

[2)2(dqi )2Imi _ gkT]/S.

dt dt

i dt

(2.12)

The conserved quantities are the Hamiltonian H, the total momentum l:iP;, and the angular momentum

l:iqi XPi'

dH = I(aH dpi + aH dqi )
dt i api dt aqi dt

+ aH dps + aH ds = O.
aps dt as dt
The conservation laws for the last two quantities are derived from Eq. (2.7) and the properties satisfied by the potential
I arp = 0
i aqi and
Iqi X arp =0.
i aqi However, it should be noted here that during the ordinary type of simulations with periodic boundary condition the angular momentum is not conserved.
Because of the momentum and angular momentum conservation, the ensembles produced by the MD method are slightly different from the usual statistical mechanical ensembles.2°--22 These small deviations are ignored in the discussion in Secs. II-IV.
The partition function Z for N identical particles is obtained by integration of the equilibrium distribution functionp(x l ,x2, ... ) over the whole phase space.

Z

=

-1N!h

f3dN

X

l

f

d

X

2 ... p(XI,x2"")'

where h is Planck's constant and Xi is a generalized coordi-

nate (the constant factors for p and Z are ignored hereafter).

The projection ofthe equilibrium distribution function from

the space (x 1,x2) onto the space (x I) is carried out by integrat-

f ing with respect to the variable X 2' p(x.J = dx2 P(X I ,X2)·

In particular, we need a distribution functionp(p',q') that is projected from the extended system onto the physical system.

J. Chem. Phys., Vol. 81, No.1, 1 July 1984

Shuichi Nose: Constant temperature molecular dynamics

513

In the extended system, the total Hamiltonian of Eq. (2.5) is conserved. Therefore, this method produces a microcanonical ensemble and the distribution function p(p,q,ps,s) is expressed as 8(H-E); 8(x) is the Dirac delta function. The shortened forms dp = dp 1dp2".dpN' dq = dq1dq2".dqN' and
Ho(p,q) = ~jp7/2mj + ¢ (q) are used. The partition function
is

Z= f dps f dsf dp f dq

X8[ Ho(pls,q) + p;/2Q + gkTlns - E].

(2.13)

The virtual momenta pj and coordinates qj are transformed
to the real variables p; = pJs, q; = qj' The volume element
is dp dq = S3N dp'dq'. Hence

Z = f dps f dPJdqJdS'S3N8[Ho(p',q')

+p;/2Q +gkTln s - E ].

(2.14)

Because the argument ofthe 8 function in the above equation

has only one zero as a function of the variable s, we can

employ the equivalence relation 8 if(s)] = 8(s - so)lf'(so);sois

the zero ofj(s).

g~T Z =

f dps f dPJdqJdS'S3N + I

X8(s - exp{ - [Ho(p',q') + p;/2Q - E ]lgkT})
(2.15)

= g~Texp[ ( 3Ng+ 1 )E IkT ]fdps

xexp [ - (3N + 1 };/2QkT]fdPJdq'
g
xexp [ _ (3N + 1 )Ho(P',q')/kT].
g
If we choose g = 3N + 1, the partition function of the ex-
tended system is equivalent to that of the physical system in the canonical ensemble except for a constant factor:
Z = Cf dPJdq' exp[ - Ho(p',q')/kT],

and the equilibrium distribution function is p(p',q') = exp[ - Ho(p',q')/kT].

(2.16)

With the quasiergodic hypothesis which relates the time average along the trajectory to the ensemble average, the averages of any static quantities expressed as functions of pJs,qj along the trajectory determined by Eqs. (2.6)-(2.9), are exactly those in the canonical ensemble:

lim -1itoA (pls,q)dt = (A (pls,q) = (A (p',q',) c'
to-oo to 0 (2.17)
(".) and (".)c denote the ensemble average in the extended system and in the canonical ensemble, respectively. The first equivalence in Eq. (2.17) is achieved by sampling data points at integer mUltiples of the virtual time unit ..1 t. We call this virtual time sampling. In this sampling, the real time interval of each time step is unequal. If we sample using equal intervals in real time t ' with tI = ff)dt Is (we can use an interpola-

tion or the method in Sec. II B for this purpose), the result is a weighted average

lim -1 it.A (pls,q)dt' = lim -t2.. -1 itoA (pls,qd)-t

'.~ootl 0

'.~ootl to 0

s

=

[

lim -1 'o~oo to

itoA
0

(pls,qd)-t] s

I

(

lim -1 'o~oo to

i'O-dt) 0 s

= (A (PIS,q)/s)/(+).

(2.18)

From comparison with Eq. (2.15), we find that if we chooseg as g = 3N, the weighted average in the extended system [Eq. (2.18)] is identical to (A (p',q') c' In virtual time sampling, g
should be 3N + 1, and in real time sampling, g must be 3N.

B. Equations in real variables

The equations of motion [Eqs. (2.6)-(2.9)] can be transformed into the equations for the real variables
q; = qop; = pJs, t' = f'dt Is, s' = s, andp; = psis:

dq; dq; dqj

,

--;ji7 = sTt = sTt = pJmjs = pJmo

(2.19)

dp; dp; d

dpj 1 ds

-=s-=s-(pJs)=----Pj

dt' dt dt

dt s dt

= - aa~ - s'p;p;IQ,
qj

(2.20)

ds' =sds' =ls =s'2p;IQ, dt' dt dt

(2.21)

dp; dp; d

dps 1 ds

--;ji7 = sTt = sdtlpsls) = Tt - -; its

= (~p;2/mj -gkT )IS' -s'p/IQ.

(2.22)

Equations (2.19)-(2.22) are no longer canonical, since Eqs. (2.20) and (2.22) have additional force terms. H of Eq. (2.5), in terms of the real variables,

H' = LP/12m j +¢(q') + S,2p;2/2Q + gkTlns(2.23)
j

is not a Hamiltonian. This is a disadvantage of the real variable method. H' is still conserved

dH' dt '

=

~(aaHp;'

dp; dt'

+

aH'
aq;

d q; ) dt'

+aH-'-dp+; -a-H'=ds'0 ·
ap; dt' as' dt'

The Lagrangian forms are

d ( , dq;)
--;ji7 mjs dt' =

-

,a¢
s aq;

(2.24)

and

+ ~(g dS') = '\:'m.(dq'~)2 _ kT

dt' s' dt'

I dt' g.

(2.25)

The Lagrangian of the real time formulation is related to the original one by relation

L'=s(L +E),

(2.26)

J. Chern. Phys., Vol. 81, No.1, 1 July 1984

514

Shuichi Nose: Constant temperature molecular dynamics

E is the conserved value ofH ofEq. (2.5). These equations are to be solved in real time, so g must be g = 3N.

C. Other potentials for the variable s
We can construct another class ofconstant temperature MD method by replacing the potential for s by (for example)
gkTsn [n > 0, an integer andg = (3N - n + l)1n]. The equi-
librium distribution function can be readily obtained in a similar way.
p(p',q',ps) = ([ E - p;12Q - Ho(p',q')]/gkTjg

Xh [E-p;12Q-Ho(p',q')],

(2.27)

° where h (x) is the Heaviside function, h (x) = 1 for x> 0, and
h (x) = for x < 0. The Heaviside function is necessary to

limit the range of the intergration in phase space. This con-

straint arises because the potential gkTsn is positive semi-

definite; for some region in phase space (p',q',ps), the equa-

tion H = E does not have any real solution for s.

With the most favorable assumption (sn) = 1, the val-
ue of total energy E = (Ho(p/s,q) + (p;12Q) + gkT. Using the definition HI = (Ho(p/s,q) - Ho(p',q') + (p;12Q)

- p;12Q, Eq. (2.27) is

p(p',q',p.) = (1 + H/gkT)gh (gkT + HI)'

Note that the distribution for the variablePs cannot be separated from those of p' and q'. From the expansion of
g In(1 + a/g) with respect to lIg; g In(l + a/g) = a - a2/ 2g + a3/3i ..., p is approximated as

p = exp[H/kT - ~(HI/kTf/g].

(2.28)

Singe H I is a quantity of order N 1/2, the leading term of the deviation of p from the canonical distribution is of order
N-1I2.

As we can see from the derivation of the equilibrium distribution function [see Eqs. (2.14) and (2.15)], it is related to the inverse function of the potential for s.

p(p',q',p.) = f dS'S3N8[H" +I(s) - E]

However, fluctuations of the total kinetic energy are suppressed by imposing this constraint. The Hamiltonian [Eq. (2.5)]
H = LP;/2m,.s2 + l/J (q) + p;/2Q + gkTln s ,.
is contrained by the conditions 13

aH = _ [LP;/m,.s2 -gkT]/S=O

(3.2)

as

,.

and

aH -=p./Q=O.

(3.3)

aps

Equation (3.3) is trivial, and we ignore the p;/2Q term hereafter. The equations of motion for q,. and p,. maintain the same form as Eqs. (2.6) and (2.7):

a;- dq,
Tt=

aH 8p,

+

aH

as 8pi

=

aH

2

8p,. =p,lms,

(3 4) .

dp,.
-=

-a-H- -8H-a= s

- -aH=

-a- l/J

(3.5)

dt

aq,. as aq,.

aq,.

aq; ,

r but the value of s must be determined from Eq. (3.2), i.e.,

s = [q);/mygkT

(3.6)

The Hamiltonian [Eq. (2.5)] is still conserved:
dH = L(aH dp,. + 8H dq,.)
dt ; 8pj dt 8qj dt
+ aH dps + aH ds = 0.
8ps dt as dt
The partition function in this case is [recall that
Ho(p,q) = ,,Ip;/2m; + l/J (q)] z = f dsf dpf dq 8 [Ho(p/s,q) + gkTln s - E ]
H X8 {s - [q);/m;)lgkT

= f dS'S3N8(s - so)ll'(so) = S6N /I'(so);
So satisfies the relation I(so) = E - H", thus So =I-I
(E - H "). H" is that part ofthe Hamiltonian H [Eq. (2.5)] which is independent of s. Therefore, a logarithmic form is essential to produce the canonical distribution.
III. THE CONSTRAINT METHOD

A. Virtual variable formulation

The distribution function in momentum space is usually simple and the contribution of this term can be easily calculated in the canonical ensemble. Therefore, any method that produces the canonical distribution, even if only in coordinate space, can be useful in some situations. The standard way for this approach is to constrain the total kinetic energy term

L~(dq;)2 =~kT.

(3.1)

,. 2 dt' 2

= f dsf dpf dq {j [Ho(p/s,q) + gkT In s - E ]sgkT

X8 (s2gkT /2 - LP~/2m,.).
i
With the transformation p; = p,ls, q; = qiJ we get

8q):2 Z = [fdp'

/2m; - gkT /2)]fdq' f dS'S3N - IgkT

X{j [gkT /2 + l/J (q') + gkTln s - E]

= [fdP'8q);2/2m; -gkT/2)]Jdq'

3; /2 xexp{ -

[gkT + l/J (q') - E ]lkT}.

With g = 3N, we obtain the equilibrium distribution function p(p',q') = 8(LP;2/2mi - gkT /2)exp[ - l/J (q')lkT]. (3.7)
Equations (3.4}-(3.6) produce the canonical distribution in

J. Chem. Phys., Vol. 81, No.1, 1 July 1984

Shuichi Nose: Constant temperature molecular dynamics

515

coordinate space. Note that if we sample in real time, g must be3N- L

B. Eq~atfons In real varIable. The equations for the real variables q;, p;, t' are

-dd=qt;'

;

=

sdd-q=t ;

p

·

lm
I

.

s
I

=

P

I '

I

m

·
I

,

(3.8)

dp; =s~p;ls) =
dt' dt

_

at/J
aq;

_

ds p;. dt

(3.9)

These are formally equivalent to Eqs. (2.19) and (2.20). The derivative dsldt is obtained via the differentiation of Eq. (3.2),

-'7-~p'-d'p-, Im

I dl

I

ds =gkTs-
dt

or

ds = dt

_

(

L ;

a~p;lm;)lgkT. aq;

Equation (3.10) can be changed to

cIs = dt

_

(

L ;

aaq~ ;

p;lm;)lgkT

(3.10)

=

-

( ~~ aaq- t/:J dd- qt;' )IgkT=

-

-d/;g k T . dt'

(3.lt)

If one sets the parameter eX = dsldt. Eqs. (3.8)-(3.10) are

identical to Eqs. (Ll), (1.2), and (U) of the HLME meth-

od.

1 4--18

These

equations

are

based

on

real

time

sampling,

so

that ifg is set equal to 3N - 1we recover the canonical distri-

bution. In the original papers, 14.16 g = 3N was used.

As shown above, the HLME method is equivalent to

the ES method with the additional constraint ofEq. (3.2).

C. Another constraint method

Any other choice but the logarithmic form for the po-
tential function of s used in Eq. (2.S) leads to an ensemble
different from the canonical one. As an example, we derive
the equilibrium ciistribution function of the refined form of the momentum scaling (HG) method by Haile and Gupta. 13
I-s The starting Hamiltonian is (s corresponds to of
Ref. 13)

LP; H = 212m,s + t/J (q) + K.kTs.

;

2

With the constraint

(3.12)

iJH = _ ~p2/2m.s2 + K.kT==.O

as

~ I

,

2

(3.13)

or

the equations of motion are
d:dq. = p;lm;s = p;lm"

dp;

at/J

dt'= - aqz'

(3.14) (3.15)

The momenta p; = p;ls are considered to be the real mo-
menta. These equations are identical to the traditional momentum scaling equations. 12.23 The partition function is
I f J ~ Z = tlsfdp dq c5(fPfl2m;s + t/J (q) + kTs - E

]l}. {s - x~

[f(p;lm;)/gkT

With the transformation p; = p;/s, we get
[f f Z = dp' 8(fP;2/2m ; - gkT12)]Jdq ds.~N - 1

X {j [gkTs + t/J (q) - E ]
[I= dp' 6q):~12m; - gkT12)JJdq

X {[E - <p (q)]IgkT J3N- Ih [E - <p (q)].

(3.16)

Assuming the most favorable case: (8) = I, g = 3N - 1, and
E = gkT + (t/J), the equilibrium distribution function of
this method is

pIp',q) = 8(LP;2/2m; - gkT 12)
;
X (l + [(t/J) - t/J (q)]IgkT Jg
Xh[gkT + (t/J) - t/J (q)).

(3.17)

In the same way as in Sec. II C, Eq. (3.17} deviates from exp[ - <p (q)/kT] by orderN- I. The coordinate part ofp(p',q) in Eq. (3.17) is similar to the equilibrium distribution function of the microcanonical ensemble projected onto coordinate Space,

Pmc(q) = J dp c5(fP7/2m; + t/J - E)

(f = jdPc5(P 2 +t/J -E)JdP8[P- P;/2m;)I]

= CfdP.P3N-18lP2 + t/J-E)

= C'JdP·p 3N - 2c5[P_ (E - <p JI]

=C"(l 3N 1
=C'(E_t/J)2 -

+

(t/J)

3 N -t/J)2 -

1

3NkTI2

'

(3.18)

where P is a radius of a 3N dimension sphere and
E = VVkT + (; ). Therefore, the difference between the ca-
nonical ensemble and the ensemble generated by the HG
method13 is the same order as we expect between the micro-
canonical and the canonical ensembles. The ensemble corrections of order N -I for first order quantities (energy,
virial, ...) and those of order one for quantities relating to
fluctuation formulas (heat capacity, compressibility, ...J are generally expected.21•22 For example, the fluctuatioll of the potenti~ energy in the HG method is

«(8<P )2) = N(kT)23c:/(3 + c:) + 0(1),

(3.19)

where c: = (liNk )(d (t/J )ldT) is a heat capacity ofthe co-
ordinate part.

J. Chern. Phys., vor B1. No. 1,1 July 1984

516

Shuichi Nose: Constant temperature molecular dynamics

IV. THE CONSTANT TEMPERATURE-CONSTANT PRESSURE (TP) ENSEMBLE

A. The extended system method

Combined with the constant pressure MD method of

Anderson,1 the canonical ensemble MD method can be

readily extended to the TP ensemble. 19 Here we use the for-

mulation for uniform dilation given by Anderson,1 but the

extension to the generalized form of the constant pressure

simulation method by Parrinello and Rahman can be de-

rived in a similar way. 2--4

In the TP ensemble, the virtual variables (qop;, s, V, t)

are related to the real variables (q;,p;, s, V, 1') via scaling of the coordinates by VI /3 and scaling of the time by s (V, the

volume of a MD cell),

1

q;=V 3 qo

(4.1)

1

p; = p;IV 3 s,

(4.2)

t' = r~t.

(4.3)

The values of the components of the scaled coorqinates q;

are limited to the range of 0 to 1. The Hamiltonian is

2

1

H = I.P712mjv3S2 + q,{V3q) + p;12Q

;

+ gkTln s + pt/2W + Pex V,

(4.4)

wherepv is the conjugate momentum ofV,Wis a mass for

the volume motion, and Pex is the externally set pressure. The equations of motion are

(4.5)

(4.6)

(4.7)

Tdpst= -aaH;= ["+"p;21m; V1s2 -gkT] Is,

(4.8)

-d= V --a=H PvIW,

(4.9)

dt apv

[I.( -ddpt= v --aaHv=

;

p.21m·

I

t

V

1

s 2

_---aa-'q--q;4'1,t.,)]

I

3V-P ex

.

(4.1O)

In Lagrangian form, these are

!!...(m;v1 s2dq;) = _ aq, = _ aq,V~,

dt

dt

aq; aq;

(4.11)

!!...(#-) 1 = [I.V

q s2(d ;)2Im. -

gkT]IS,

(4.12)

dt dt

j

dt

t

{I.[ ~~]}/3V q

!d!t...(wEd-tV) =

;

V

1

s

2

(

dd

t ;

)

2

I

m

.
t

-

aq;

I

-P . ex

(4.13)

The equilibrium distribution function is obtained in the same way as in Secs. II and III. We define Ho(p,q) = I.;p;1
2m; + q, (q) as before. Then

1

1

Z = fdPv fdVfdPsfdsfdPfd(J(5[Ifo(P/V 3 S,V3 q) +p;12Q+gkTlns +pt!2W +Pex V -E].

The transformations equations (4.1) and (4.2) lead to

Z = f dpv f dps f dvfdPJdqJds S3Nc5[ Ho(p',q') + p;12Q + gkTln s + pt12W + Pex V - E]

c =

f dpv f dps f dvfdPJdq' exp [ -

(3N + 1} (Ho(p',q') + p;12Q + Pt/2W -
g

Pexp V -

E )lkT]

= CfdVfdPJdqJ exp [ -

(3N + g

1 }(Ho(P',q')

+ Pex

V)/kT].

For virtual time sampling, withg = 3N + 1, the equilibrium
distribution function is

p(p',q',V) = exp[ - (Ho(p',q') + Pex V)/kT] (4.14)

and the averages of any function ofp',q', V are identical with

those in the TP ensemble.

1i'o lim-

A

{pi

V

~
3

S,V

3~

q,V)dt

'o~oo 10 0

1

1

= (A (p/V3 s,V3 q,V)

= (A (p',q',V)TP'

(4.15)

(... )TP denotes the average in the TP ensemble. For real time sampling, g must be 3Nin order to produce the TP ensemble.

I
In the same fashion as in Sec. II B, we can also get the equa-
tions for real variables.

B. The constraint method

The equations for the contraint method are Eqs. (4.5)

and (4.6) and the constraints

1 -~ aH = _ (I.P7Im;V

gkT)IS=O,

as

j

(4.16)

~ aH = _ [I.(p;lm; v 1
av;

_

atP,q;) aqj

3Pex V]/3V:=O,

(4.17)

J. Chem. Phys., Vol. 81 , No.1, 1 July 1984 .

Shuichi Nose: Constant temperature molecular dynamics

517

The partition function is

8(¥;2 Z = cf dp'

/2m/ - gkT12)fdvfdq'

X exp { - C;)[gkT12 + ; (q') +Pex V]/kT}8
(4.18)

Ia
X (lgkT- t/J,q;)l3 -PexV], ; aq;

g is 3N for virtual time sampling and 3N - 1 for real time

sampling.
The equations for real variables (p; = pJV I /2S, q; =
sr V 1/3qjJ and t' = dt Is) are

(1 dq;
dt'

'I
=pj mj

+

dV), 3V dt' qj

(4.19)

and

dp; = _ at/J _ (_1_ dV)p; _ (dS)p;.

dt '

aq; 3V dt'

dt

(4.20)

The derivatives dsldt, 1/3 V dV Idt', are obtained via differ-

entiation ofEqs. (4.16) and (4.17),

(I ds + _1_ d~ = _ a~ ~)lgkT

dt 3V dt

; aq; mi

(4.21)

and

-1-d= V - (I a~ ~ + II ~; , q; ~)/ (4.22)

3V dt'

i aq; mi i j aqjaClj mi

( 9Pex

V

+ Ii

a~
aqi

q;

+Ii Ij aq~ia;q,j

q;q;).

If we define parameters a = dsldt and € = 1/3 V dV Idt',

Eqs. (4. 19H4.22) are identical to the equations given by Evans and Morrissl8 except that in this derivation the total

kinetic energy};; p;212m; has to be set equaIto (3N - 1)kT12 and not to 3NkT12.

V. DISCUSSION

A. Comparison of the extended system method and the constraint method
The constant temperature MD methods for the canonical and the TP ensembles are reviewed in Secs. II-IV. The

relation of these equations is listed in Table 1. The HLME method 14-18 and Evans-Morriss method 18 were derived as a special case ofthe ES method. 19 Other methods except those mentioned here and that by Anderson I do not seem to give the rigorous canonical distribution.
The methods were first presented in the virtual variable formulation, then transformed to the real variable case. The virtual variable formulation is the backbone of the constant temperature method. In this form, the equations remain canonical and the proof of equivalence with the canonical ensemble is straightforward. However, the unequal time intervals are not convenient for simulations. The real time formulation is recommended for applications. It should be remembered that in this case the equations are no longer canonical.
Both constant temperature methods (the ES and the HLME) are still not ideal. The number ofindependent variables are listed in Table II. The ES method has more independent variables than the equivalent statistical mechanical ensemble. This is the reason why the ES method give$ correct results for the static quantities, but the time evolution of s
andlor V are dependent on the adjustable parameters Q andlor W. This arbitrariness is both a disadvantage and an
advantage of this method. The calculation of the velocity autocorrelation functions in the constant pressure MD method7 and in the constant temperature method 13.24.25 show no significant difference from that of the ordinary MD method. Ifthe effects on the dynamics of the physical system
are negligible, we can select the parameters Qand W to opti-
mize the efficiency of the calculations. In the constraint method, the number of independent
variables is less than those of the statistical mechanical formulation, due to the addition ofthe constraints. Some of the static quantities in the constraint method are not exactly those appropriate to the canonical distribution. In the canonical ensemble, only the quantities dependent on the momentum are affected. In the TP ensemble, the pressure constaint depends both on the volume and on coordinate space.
Ifwe define the instantaneous temperature Ti and pressure Pi by
(5.1)
and

TABLE I. Relation between the various constant temperature methods.

Extended system method

Constraint method

Virtual variable equations
Real variable equations

Sec. II A. Nose- ~ constraint --~~~ Sec. III A

Eqs. (2.SH2.l2)

Eq. (3.2)

Eqs. (3.2H3.6)

tI transformation Eqs. (2.1H2.3)
Sec. II B Eqs. (2.19H2.2S)

I transformation t [Eqs. (2.1H2.3)]
Sec. III B. HLMEb Eqs. (3.8H3.10)

• Reference 19. bReferences 1~18.

J. Chem. Phys., Vol. 81, No.1, 1 July 1984

518

Shuichi Nos6; Constant temperature molecular dynamics

TABLE II. The number of independent variables in the various constant temperature MD methods. The numbers in brackets explicitly consider the momentum and angular momentum conservation.

Canonical Ensemble
TP Ensemble

Extended system method
6N + I
(6N-5)
6N+3 (6N-3)

Statistical mechanics
6N
6N+ I

Constraint method
6N-I (6N-7)
6N-l (6N-7)

(5.2)

the averages and the fluctuations of these quantities in the canonical and the TP ensemble are

(Ti ) = T,

(5.3)

«(Ti - T)2) = ~T2,

(5.4)

3N

(5.5)

and

(2.5)] and the number of degrees of freedom of the rotation must be added to g value.
The constant pressure MD method deviates by order N - t from the constant enthalpy-constant pressure ensemble in any case, due to the kinetic energy term for the volume
motion pt/2 W. Therefore, the effects of using different
functional forms for this term [e.g., A (vlPtj are much less
significant.4 However, in the canonical and the TP ensemble, methods, there are no intrinsic deviation of order N - 1 to start with, so different forms for these kinetic terms (e.g., p;/2Q or p;/2Qs2,pt V 2/2W) can give rise to deviations of order N - t. A careful choice of the functional form for the additional kinetic energy terms is important in these types of calculations.
Due to the conservation of the total momentum and angular momentum, MD methods produce ensembles that deviate slightly from the statistical mechanical ensembles. 2°-22 The true number of independent variables (when the above conservation laws are taken into account) are bracketed in Table II. In practice, the angular momentum is not conserved in MD simulations if we employ periodic boundary conditions. Here, we only discuss the effect of the momentum conservation law.
The momentum conservation law holds when it is expressed in terms of virtual variables

(5.6)

The fluctuations of Ti and Pi [Eqs. (5.4) and (5.6)] are suppressed in the constraint method. In the formulation of statistical mechanics, T and Pex are the temperature and pressure of the external system, and tbe values of the temperature and pressure in the physical system are defined only in an averaged sense by Eqs. (5.3) and (5.5).

8. Some comments

The proper choices for the values of the parameter g in the potential energy function for the variable s, gkT In s, are listed in Table III. These values depend on the nature of the method as well as on the type of sampling.
In the rigid molecule case, the kinetic energy term for

the molecular rotation ~!S2(J)Jiroi or l:!p",/ i- tp",/S3 (roo

t

t

angular velocity; Ii' moment ofinertia tensor; P"'I' the conju-

gate momentum of roi ) are added to the Hamiltonian [Eq.

TABLE III. Proper values of the parameter g in the potential function for s, gkTlns.

Extended system method

Constraint method

Sampling in virtual time
Sampling in real time

3N+ 1 3N

3N 3N-l

where Px' pY' pz are constants. The partition function in the extended system is modified
Z= JdPsJdsJdPJdq 8(H -E)
8(DiX - Px)8(DiY - Py )8(Diz - pz)·
iii
With the transformation to real variables, it becomes
Z= JdPsJdP'fdQ'fdS'S3N8(H'-E)8(S¥:X -Px)

X8(sD;y - py)8(sD;z - pz)

;

;

= JdPsJdP'fdQ'fdS'S3N-38(H'-E)8(¥;x -Px/s)

X8(D;y - py/s)8(D:Z - pJs).

i

i

If the total momentumpx = Py = pz = 0, momentum space

and coordinate space can be separated. Hence,

Z = fdPsfdP'8(~):X)8(D;y)8(D:Z)
Itt

(5.8)

From above equation, ifg = 3N + 3, the equilibrium distri-
bution function is

p(p',q') = exp[ - Ho(p',q')/kT ]8(D:X)8(D;.f)8(D~)·(5.9)

;

i

I

In momentum space, there is restriction due to momentum

J. Chem. Phys.• Vol. 81 , No.1, 1 July 1984

Shuichi Nose: Constant temperature molecular dynamics

519

conservation, but that has no effect in coordinate space. The instantaneous temperature should be defined as

D;2/2mi = (3N - 3)kT/2.
i

(5.10)

This follows from a decrease of the number of independent

variables. In the case of the TP ensemble, the weight factor

for the volume also changes.

Theoretically, static quantities are independent of the

value chosen for the parameter Q. However, in practice be-

cause of the finite number of time steps, the equivalence

equation (2.17) is not always satisfied. With small Q values,

the degree of freedom associated with s tends to decouple

from the physical system. On the other hand, large Qvalues

lead to inefficient sampling of phase space. The most effi-

cient calculation will be done by choosing same order of time

scales for the physical system and the variable s. If we only

consider the fluctuation ofs around the averaged value (s),
s = (s) + 8S,19 Eq. (2.12) can be simplified as

Q~s= - 2gkT8s.

dt 2

(S)2

(5.11)

The frequency of this harmonic equation is

ui = ( 2gkT ).
Q (S)2

(5.12)

We can choose a Qvalue such that ui in Eq. (5.12) gives the

same order of magnitude as the second moment of the fre-

quency spectrum of the velocity autocorrelation function of

the physical system.

This time scale approximately corresponds to the time

taken for a sound wave to travel the nearest neighbor distance.

VI. SUMMARY
Three constant temperature MD methods are examined analytically. Except for effects due to momentum and angular momentum conservation, the ES method19 gives rigorous equilibrium distribution functions in the canonical and in the TP ensembles. The HLME constraint method 14-18 give the canonical distribution only in coordinate space. Both the HLME and the Evans-Morriss method have been derived from the formulation of the ES method by imposing constraints. The Haile-Gupta method 13 on the other hand does not give the rigorous canonical distribution.

The virtual variable formulation is best suited for proof ofthe equivalence with the statistical mechanical ensembles. The equations based on the real variable formulations [Eqs. (2.19)-(2.25) or the HLME method] are recommended for applications.
The extension of the MD method to ensembles other than the microcanonical ensemble is formulated in a unified fashion. By introducing real variables and virtual variables the constant pressure MD method is generated from a scaling ofthe coordinates. The constant temperature MD method is obtained from a scaling of the time.
ACKNOWLEDGMENTS
The author thanks Mike Klein and Ray Somorjai for their interest and helpful discussions.
'H. C. Anderson, J. Chern. Phys. 72, 2384 (1980). 2M. Parrinello and A. Rahman, Phys. Rev. Lett. 45, 1196 (1980). 3M. Parrinello and A. Rahman, J. Appl. Phys. 52, 7182 (1981). 4S. Nose and M. L. Klein, Mol. Phys. 50, 1055 (1983). 'M. Parrinello, A. Rahman, and P. Vashishta, Phys. Rev. Lett. 50, 1073 (1983). 6S. Nose and M. L. Klein, Phys. Rev. Lett. SO, 1207 (1983). 7S. Nose and M. L. Klein, J. Chern. Phys. 78, 6928 (1983). "R. W. Irnpey, S. Nose, and M. L. Klein, Mol. Phys. 50, 243 (1983); D. Levesque, J.-J. Weis, and M. L. Klein, Phys. Rev. Lett. 51, 670 (1983). 9R. G. Munro and R. D. Mountain, Phys. Rev. B 28, 2261 (1983). IOD. M. Heyes, Chern. Phys. 82, 285 (1983). IIW. G. Hoover, D.J. Evans, R. B. Hickman, A.J. C. Ladd, W. T. Ashurst, and B. Moran, Phys. Rev. A 22, 1690 (1980). 12L. V. Woodcock, Chern. Phys. Lett. 10,257 (1971). I3J. M. Haile and S. Gupta, J. Chern. Phys. 79, 3067 (1983). I4W. G. Hoover, A. J. C. Ladd, and B. Moran, Phys. Rev. Lett. 48, 1818 (1982). "A. J. C. Laddand W. G. Hoover, Phys. Rev. B28, 1756(1983). '6D. J. Evans, J. Chern. Phys. 78, 3297 (1983). I7D. J. Evans, W. G. Hoover, B. H. Failor, B. Moran, and A. J. C. Ladd, Phys. Rev. A 28,1016 (1983). 'SD. J. Evans and G. P. Morriss, Chern. Phys. 77, 63 (1983); Phys. Lett. A 98,433 (1983). 19S. Nose, Mol. Phys. (to be published). 2OW. G. Hoover and B. J. Alder, J. Chern. Phys. 46, 686 (1967). 21J. L. Lebowitz, J. K. Percus, and L. Verlet, Phys. Rev. 153,250 (1967). 22D. C. Wallace and G. K. Straub, Phys. Rev. A 27, 2201 (1983). 23W. G. Hoover, Physica A 118,111 (1983), Eq. (1). 24D. Brown and J. H. R. Clarke, Mol. Phys. 51, 1243 (1984).
"s. Nose (unpublished work). The velocity autocorrelation functions in sol-
id and fluid states with different Q values are identical to those of the ordinary MD method within statistical errors.

J. Chem. Phys., Vol. 81, No.1, 1 July 1984

